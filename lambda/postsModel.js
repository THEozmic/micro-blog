!function(t,e){for(var n in e)t[n]=e[n]}(exports,function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=396)}([function(t,e){t.exports=require("util")},function(t,e,n){"use strict";const r=n(2).MongoError,o=n(2).ReadPreference;var i=e.formatSortValue=function(t){switch((""+t).toLowerCase()){case"ascending":case"asc":case"1":return 1;case"descending":case"desc":case"-1":return-1;default:throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]")}},s=e.formattedOrderClause=function(t){var e={};if(null==t)return null;if(Array.isArray(t)){if(0===t.length)return null;for(var n=0;n<t.length;n++)t[n].constructor===String?e[t[n]]=1:e[t[n][0]]=i(t[n][1])}else if(null!=t&&"object"==typeof t)e=t;else{if("string"!=typeof t)throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");e[t]=1}return e},u=e.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},c=["w","j","wtimeout","fsync"];const a=process.emitWarning?t=>process.emitWarning(t,"DeprecationWarning"):t=>console.error(t);function l(t,e){return`${t} option [${e}] is deprecated and will be removed in a later version.`}t.exports={filterOptions:function(t,e){var n={};for(var r in t)-1!==e.indexOf(r)&&(n[r]=t[r]);return n},mergeOptions:function(t,e){for(var n in e)t[n]=e[n];return t},translateOptions:function(t,e){var n={sslCA:"ca",sslCRL:"crl",sslValidate:"rejectUnauthorized",sslKey:"key",sslCert:"cert",sslPass:"passphrase",socketTimeoutMS:"socketTimeout",connectTimeoutMS:"connectionTimeout",replicaSet:"setName",rs_name:"setName",secondaryAcceptableLatencyMS:"acceptableLatency",connectWithNoPrimary:"secondaryOnlyConnectionAllowed",acceptableLatencyMS:"localThresholdMS"};for(var r in e)n[r]?t[n[r]]=e[r]:t[r]=e[r];return t},shallowClone:function(t){var e={};for(var n in t)e[n]=t[n];return e},getSingleProperty:function(t,e,n){Object.defineProperty(t,e,{enumerable:!0,get:function(){return n}})},checkCollectionName:function(t){if("string"!=typeof t)throw new r("collection name must be a String");if(!t||-1!==t.indexOf(".."))throw new r("collection names cannot be empty");if(-1!==t.indexOf("$")&&null==t.match(/((^\$cmd)|(oplog\.\$main))/))throw new r("collection names must not contain '$'");if(null!=t.match(/^\.|\.$/))throw new r("collection names must not start or end with '.'");if(-1!==t.indexOf("\0"))throw new r("collection names cannot contain a null character")},toError:function(t){if(t instanceof Error)return t;for(var e=t.err||t.errmsg||t.errMessage||t,n=r.create({message:e,driver:!0}),o="object"==typeof t?Object.keys(t):[],i=0;i<o.length;i++)try{n[o[i]]=t[o[i]]}catch(t){}return n},formattedOrderClause:s,parseIndexOptions:function(t){var e,n={},r=[];return"string"==typeof t?(r.push(t+"_1"),n[t]=1):Array.isArray(t)?t.forEach(function(t){"string"==typeof t?(r.push(t+"_1"),n[t]=1):Array.isArray(t)?(r.push(t[0]+"_"+(t[1]||1)),n[t[0]]=t[1]||1):u(t)&&(e=Object.keys(t)).forEach(function(e){r.push(e+"_"+t[e]),n[e]=t[e]})}):u(t)&&(e=Object.keys(t)).forEach(function(e){r.push(e+"_"+t[e]),n[e]=t[e]}),{name:r.join("_"),keys:e,fieldHash:n}},normalizeHintField:function(t){var e=null;if("string"==typeof t)e=t;else if(Array.isArray(t))e={},t.forEach(function(t){e[t]=1});else if(null!=t&&"object"==typeof t)for(var n in e={},t)e[n]=t[n];return e},handleCallback:function(t,e,n,r){try{if(null==t)return;if(t)return r?t(e,n,r):t(e,n)}catch(e){return process.nextTick(function(){throw e}),!1}return!0},decorateCommand:function(t,e,n){for(var r in e)-1===n.indexOf(r)&&(t[r]=e[r]);return t},isObject:u,debugOptions:function(t,e){var n={};return t.forEach(function(t){n[t]=e[t]}),n},MAX_JS_INT:Number.MAX_SAFE_INTEGER+1,mergeOptionsAndWriteConcern:function(t,e,n,r){for(var o=0;o<n.length;o++)t[n[o]]||void 0===e[n[o]]||(t[n[o]]=e[n[o]]);if(!r)return t;var i=!1;for(o=0;o<c.length;o++)if(t[c[o]]){i=!0;break}if(!i)for(o=0;o<c.length;o++)e[c[o]]&&(t[c[o]]=e[c[o]]);return t},translateReadPreference:function(t){var e=null;if(!t.readPreference)return t;if("string"==typeof(e=t.readPreference))t.readPreference=new o(e);else if(!e||e instanceof o||"object"!=typeof e){if(!(e instanceof o))throw new TypeError("Invalid read preference: "+e)}else{const n=e.mode||e.preference;n&&"string"==typeof n&&(t.readPreference=new o(n,e.tags,{maxStalenessSeconds:e.maxStalenessSeconds}))}return t},executeOperation:(t,e,n,o)=>{if(null==t)throw new TypeError("This method requires a valid topology instance");if(!Array.isArray(n))throw new TypeError("This method requires an array of arguments to apply");o=o||{};const i=t.s.promiseLibrary;let s,u,c,a=o.resultMutator,l=n[n.length-1];if(!o.skipSessions&&t.hasSessionSupport())if(null==(u=n[n.length-2])||null==u.session){c=Symbol(),s=t.startSession({owner:c});const e=n.length-2;n[e]=Object.assign({},n[e],{session:s})}else if(u.session&&u.session.hasEnded)throw new r("Use of expired sessions is not permitted");const h=(t,e)=>(function(n,r){if(s&&s.owner===c&&!o.returnsCursor)s.endSession(()=>(delete u.session,n?e(n):a?t(a(r)):void t(r)));else{if(n)return e(n);if(a)return t(a(r));t(r)}});if("function"==typeof l){l=n.pop();const t=h(t=>l(null,t),t=>l(t,null));n.push(t);try{return e.apply(null,n)}catch(e){throw t(e),e}}if(null!=n[n.length-1])throw new TypeError("final argument to `executeOperation` must be a callback");return new i(function(t,r){const o=h(t,r);n[n.length-1]=o;try{return e.apply(null,n)}catch(t){o(t)}})},applyRetryableWrites:function(t,e){return e&&e.s.options.retryWrites&&(t.retryWrites=!0),t},applyWriteConcern:function(t,e,n){n=n||{};const r=e.db,o=e.collection;if(n.session&&n.session.inTransaction())return t.writeConcern&&delete t.writeConcern,t;if(null!=n.w||null!=n.j||null!=n.fsync){const e={};return null!=n.w&&(e.w=n.w),null!=n.wtimeout&&(e.wtimeout=n.wtimeout),null!=n.j&&(e.j=n.j),null!=n.fsync&&(e.fsync=n.fsync),Object.assign(t,{writeConcern:e})}return!o||null==o.writeConcern.w&&null==o.writeConcern.j&&null==o.writeConcern.fsync?!r||null==r.writeConcern.w&&null==r.writeConcern.j&&null==r.writeConcern.fsync?t:Object.assign(t,{writeConcern:Object.assign({},r.writeConcern)}):Object.assign(t,{writeConcern:Object.assign({},o.writeConcern)})},resolveReadPreference:function(t,e){t=t||{};const n=(e=e||{}).db,r=e.collection,i=e.default,s=t.session;let u;if(t.readPreference?u=t.readPreference:s&&s.inTransaction()&&s.transaction.options.readPreference?u=s.transaction.options.readPreference:r&&r.s.readPreference?u=r.s.readPreference:n&&n.s.readPreference?u=n.s.readPreference:i&&(u=i),null==u)return null;if("string"==typeof u)u=new o(u);else if(!u||u instanceof o||"object"!=typeof u){if(!(u instanceof o))throw new TypeError("Invalid read preference: "+u)}else{const t=u.mode||u.preference;t&&"string"==typeof t&&(u=new o(t,u.tags,{maxStalenessSeconds:u.maxStalenessSeconds}))}return u},isPromiseLike:function(t){return t&&"function"==typeof t.then},decorateWithCollation:function(t,e,n){const o=e.s&&e.s.topology;if(!o)throw new TypeError('parameter "target" is missing a topology');const i=e.s.topology.capabilities();if(n.collation&&"object"==typeof n.collation){if(!i||!i.commandsTakeCollation)throw new r(`server ${o.s.coreTopology.name} does not support collation`);t.collation=n.collation}},decorateWithReadConcern:function(t,e){let n=Object.assign({},t.readConcern||{});e.s.readConcern&&Object.assign(n,e.s.readConcern),Object.keys(n).length>0&&Object.assign(t,{readConcern:n})},deprecateOptions:function(t,e){if(!0===process.noDeprecation)return e;const n=t.msgHandler?t.msgHandler:l,r=new Set;function o(){const o=arguments[t.optionsIndex];return u(o)&&0!==Object.keys(o).length?(t.deprecatedOptions.forEach(e=>{if(o.hasOwnProperty(e)&&!r.has(e)){r.add(e);const o=n(t.name,e);if(a(o),this&&this.getLogger){const t=this.getLogger();t&&t.warn(o)}}}),e.apply(this,arguments)):e.apply(this,arguments)}return Object.setPrototypeOf(o,e),e.prototype&&(o.prototype=e.prototype),o}}},function(t,e,n){"use strict";var r=n(143),o=n(96);const i=n(27).retrieveEJSON();try{var s=o("bson-ext");s&&(r=s)}catch(t){}t.exports={MongoError:n(4).MongoError,MongoNetworkError:n(4).MongoNetworkError,MongoParseError:n(4).MongoParseError,MongoTimeoutError:n(4).MongoTimeoutError,MongoWriteConcernError:n(4).MongoWriteConcernError,mongoErrorContextSymbol:n(4).mongoErrorContextSymbol,Connection:n(145),Server:n(98),ReplSet:n(250),Mongos:n(252),Logger:n(34),Cursor:n(77),ReadPreference:n(33),Sessions:n(253),BSON:r,EJSON:i,Query:n(18).Query,defaultAuthProviders:n(75).defaultAuthProviders,MongoCR:n(146),X509:n(147),Plain:n(148),GSSAPI:n(149),ScramSHA1:n(76).ScramSHA1,ScramSHA256:n(76).ScramSHA256,parseConnectionString:n(254)}},function(t,e,n){"use strict";const r=n(1).applyWriteConcern,o=n(1).applyRetryableWrites,i=n(1).checkCollectionName,s=n(2).BSON.Code,u=n(6).createIndex,c=n(1).decorateCommand,a=n(1).decorateWithCollation,l=n(1).decorateWithReadConcern,h=n(6).ensureIndex,p=n(6).evaluate,f=n(6).executeCommand,d=n(6).executeDbAdminCommand,m=n(1).formattedOrderClause,g=n(1).resolveReadPreference,y=n(1).handleCallback,_=n(6).indexInformation,v=n(1).isObject,w=n(2).BSON.Long,b=n(2).MongoError,O=n(2).ReadPreference,S=n(1).toError,A='function () {\nvar c = db[ns].find(condition);\nvar map = new Map();\nvar reduce_function = reduce;\n\nwhile (c.hasNext()) {\nvar obj = c.next();\nvar key = {};\n\nfor (var i = 0, len = keys.length; i < len; ++i) {\nvar k = keys[i];\nkey[k] = obj[k];\n}\n\nvar aggObj = map.get(key);\n\nif (aggObj == null) {\nvar newObj = Object.extend({}, key);\naggObj = Object.extend(newObj, initial);\nmap.put(key, aggObj);\n}\n\nreduce_function(obj, aggObj);\n}\n\nreturn { "result": map.values() };\n}';function C(t,e,n){const r=n.skip,o=n.limit;let i=n.hint;const s=n.maxTimeMS;e=e||{};const u={count:n.collectionName,query:e};return t.s.numberOfRetries?(t.s.options.hint?i=t.s.options.hint:t.s.cmd.hint&&(i=t.s.cmd.hint),a(u,t,t.s.cmd)):a(u,t,n),"number"==typeof r&&(u.skip=r),"number"==typeof o&&(u.limit=o),"number"==typeof s&&(u.maxTimeMS=s),i&&(u.hint=i),l(u,t),u}function T(t,e,n){if(null!=n){if(t&&n)return n(t);if(null==e)return n(null,{result:{ok:1}});e.deletedCount=e.result.n,n&&n(null,e)}}function E(t,e,n,o){const i={dropIndexes:t.s.name,index:e};r(i,{db:t.s.db,collection:t},n),f(t.s.db,i,n,(t,e)=>{if("function"==typeof o)return t?y(o,t,null):void y(o,null,e)})}function N(t,e,n,i,s,u){const c={findAndModify:t.s.name,query:e};(n=m(n))&&(c.sort=n),c.new=!!s.new,c.remove=!!s.remove,c.upsert=!!s.upsert;const l=s.projection||s.fields;l&&(c.fields=l),s.arrayFilters&&(c.arrayFilters=s.arrayFilters,delete s.arrayFilters),i&&!s.remove&&(c.update=i),s.maxTimeMS&&(c.maxTimeMS=s.maxTimeMS),s.serializeFunctions=s.serializeFunctions||t.s.serializeFunctions,s.checkKeys=!1;let h=Object.assign({},s);h=o(h,t.s.db),(h=r(h,{db:t.s.db,collection:t},s)).writeConcern&&(c.writeConcern=h.writeConcern),!0===h.bypassDocumentValidation&&(c.bypassDocumentValidation=h.bypassDocumentValidation),h.readPreference=O.primary;try{a(c,t,h)}catch(t){return u(t,null)}f(t.s.db,c,h,(t,e)=>t?y(u,t,null):y(u,null,e))}function $(t,e,n){_(t.s.db,t.s.name,e,n)}function I(t,e,n,i){"function"==typeof n&&(i=n,n={}),n=n||{},e=Array.isArray(e)?e:[e];let s=Object.assign({},n);s=o(s,t.s.db),!0===(s=r(s,{db:t.s.db,collection:t},n)).keepGoing&&(s.ordered=!1),s.serializeFunctions=n.serializeFunctions||t.s.serializeFunctions,e=R(t,e,n),t.s.topology.insert(t.s.namespace,e,s,(t,n)=>{if(null!=i){if(t)return y(i,t);if(null==n)return y(i,null,null);if(n.result.code)return y(i,S(n.result));if(n.result.writeErrors)return y(i,S(n.result.writeErrors[0]));n.ops=e,y(i,null,n)}})}function M(t,e,n){t.s.db.listCollections({name:t.s.name},e).toArray((e,r)=>e?y(n,e):0===r.length?y(n,b.create({message:`collection ${t.s.namespace} not found`,driver:!0})):void y(n,e,r[0].options||null))}function R(t,e,n){const r="boolean"==typeof n.forceServerObjectId?n.forceServerObjectId:t.s.db.options.forceServerObjectId;return!0===r?e:e.map(e=>(!0!==r&&null==e._id&&(e._id=t.s.pkFactory.createPk()),e))}function P(t){if(!v(t)||"ObjectID"===t._bsontype)return t;const e=Object.keys(t);let n;const r={};for(let o=e.length-1;o>=0;o--)"function"==typeof t[n=e[o]]?r[n]=new s(String(t[n])):r[n]=P(t[n]);return r}function j(t,e,n,i){"function"==typeof n?(i=n,n={}):"function"==typeof e&&(i=e,n={},e={}),n=n||{};let s=Object.assign({},n);s=o(s,t.s.db),s=r(s,{db:t.s.db,collection:t},n),null==e&&(e={});const u={q:e,limit:0};n.single?u.limit=1:s.retryWrites&&(s.retryWrites=!1);try{a(s,t,n)}catch(t){return i(t,null)}t.s.topology.remove(t.s.namespace,[u],s,(t,e)=>{if(null!=i)return t?y(i,t,null):null==e?y(i,null,null):e.result.code?y(i,S(e.result)):e.result.writeErrors?y(i,S(e.result.writeErrors[0])):void y(i,null,e)})}function D(t,e,n){if(null!=n){if(t)return n(t);if(null==e)return n(null,{result:{ok:1}});e.modifiedCount=null!=e.result.nModified?e.result.nModified:e.result.n,e.upsertedId=Array.isArray(e.result.upserted)&&e.result.upserted.length>0?e.result.upserted[0]:null,e.upsertedCount=Array.isArray(e.result.upserted)&&e.result.upserted.length?e.result.upserted.length:0,e.matchedCount=Array.isArray(e.result.upserted)&&e.result.upserted.length>0?0:e.result.n,n(null,e)}}function B(t,e,n,i,s){if("function"==typeof i&&(s=i,i=null),null==i&&(i={}),"function"!=typeof s&&(s=null),null==e||"object"!=typeof e)return s(S("selector must be a valid JavaScript object"));if(null==n||"object"!=typeof n)return s(S("document must be a valid JavaScript object"));let u=Object.assign({},i);u=o(u,t.s.db),(u=r(u,{db:t.s.db,collection:t},i)).serializeFunctions=i.serializeFunctions||t.s.serializeFunctions;const c={q:e,u:n};c.upsert=void 0!==i.upsert&&!!i.upsert,c.multi=void 0!==i.multi&&!!i.multi,u.arrayFilters&&(c.arrayFilters=u.arrayFilters,delete u.arrayFilters),u.retryWrites&&c.multi&&(u.retryWrites=!1);try{a(u,t,i)}catch(t){return s(t,null)}t.s.topology.update(t.s.namespace,[c],u,(t,e)=>{if(null!=s)return t?y(s,t,null):null==e?y(s,null,null):e.result.code?y(s,S(e.result)):e.result.writeErrors?y(s,S(e.result.writeErrors[0])):void y(s,null,e)})}t.exports={bulkWrite:function(t,e,n,i){t.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=t.s.options.ignoreUndefined);const s=!0===n.ordered||null==n.ordered?t.initializeOrderedBulkOp(n):t.initializeUnorderedBulkOp(n);let u=!1;try{for(let t=0;t<e.length;t++){const n=Object.keys(e[t])[0];e[t][n].collation&&(u=!0),s.raw(e[t])}}catch(t){return i(t,null)}let c=Object.assign({},n);c=o(c,t.s.db);const a=(c=r(c,{db:t.s.db,collection:t},n)).writeConcern?c.writeConcern:{},l=t.s.topology.capabilities();if(u&&l&&!l.commandsTakeCollation)return i(new b("server/primary/mongos does not support collation"));s.execute(a,c,(t,e)=>{if(!e&&t)return i(t,null);e.insertedCount=e.nInserted,e.matchedCount=e.nMatched,e.modifiedCount=e.nModified||0,e.deletedCount=e.nRemoved,e.upsertedCount=e.getUpsertedIds().length,e.upsertedIds={},e.insertedIds={},e.n=e.insertedCount;const n=e.getInsertedIds();for(let t=0;t<n.length;t++)e.insertedIds[n[t].index]=n[t]._id;const r=e.getUpsertedIds();for(let t=0;t<r.length;t++)e.upsertedIds[r[t].index]=r[t]._id;i(null,e)})},checkForAtomicOperators:function(t){const e=Object.keys(t);return 0===e.length?S("The update operation document must contain at least one atomic operator."):"$"!==e[0][0]?S("the update operation document must contain atomic operators."):void 0},count:function(t,e,n,r){let o;"function"==typeof n&&(r=n,n={}),(n=Object.assign({},n)).collectionName=t.s.name,n.readPreference=g(n,{db:t.s.db,collection:t});try{o=C(t,e,n)}catch(t){return r(t)}f(t.s.db,o,n,(t,e)=>{if(t)return y(r,t);y(r,null,e.n)})},countDocuments:function(t,e,n,r){const o=n.skip,i=n.limit;n=Object.assign({},n);const s=[{$match:e}];"number"==typeof o&&s.push({$skip:o}),"number"==typeof i&&s.push({$limit:i}),s.push({$group:{_id:null,n:{$sum:1}}}),delete n.limit,delete n.skip,t.aggregate(s,n).toArray((t,e)=>{if(t)return y(r,t);y(r,null,e.length?e[0].n:0)})},buildCountCommand:C,createIndex:function(t,e,n,r){u(t.s.db,t.s.name,e,n,r)},createIndexes:function(t,e,n,r){const o=t.s.topology.capabilities();for(let t=0;t<e.length;t++)if(null==e[t].name){const n=[];if(e[t].collation&&o&&!o.commandsTakeCollation)return r(new b("server/primary/mongos does not support collation"));for(let r in e[t].key)n.push(`${r}_${e[t].key[r]}`);e[t].name=n.join("_")}n=Object.assign({},n,{readPreference:O.PRIMARY}),f(t.s.db,{createIndexes:t.s.name,indexes:e},n,r)},deleteMany:function(t,e,n,r){n.single=!1,j(t,e,n,(t,e)=>T(t,e,r))},deleteOne:function(t,e,n,r){n.single=!0,j(t,e,n,(t,e)=>T(t,e,r))},distinct:function(t,e,n,r,o){const i=r.maxTimeMS,s={distinct:t.s.name,key:e,query:n};(r=Object.assign({},r)).readPreference=g(r,{db:t.s.db,collection:t}),"number"==typeof i&&(s.maxTimeMS=i),l(s,t,r);try{a(s,t,r)}catch(t){return o(t,null)}f(t.s.db,s,r,(t,e)=>{if(t)return y(o,t);y(o,null,e.values)})},dropIndex:E,dropIndexes:function(t,e,n){E(t,"*",e,t=>{if(t)return y(n,t,!1);y(n,null,!0)})},ensureIndex:function(t,e,n,r){h(t.s.db,t.s.name,e,n,r)},findAndModify:N,findAndRemove:function(t,e,n,r,o){r.remove=!0,N(t,e,n,null,r,o)},findOne:function(t,e,n,r){t.find(e,n).limit(-1).batchSize(1).next((t,e)=>{if(null!=t)return y(r,S(t),null);y(r,null,e)})},findOneAndDelete:function(t,e,n,r){const o=Object.assign({},n);o.fields=n.projection,o.remove=!0,N(t,e,n.sort,null,o,r)},findOneAndReplace:function(t,e,n,r,o){const i=Object.assign({},r);i.fields=r.projection,i.update=!0,i.new=void 0!==r.returnOriginal&&!r.returnOriginal,i.upsert=void 0!==r.upsert&&!!r.upsert,N(t,e,r.sort,n,i,o)},findOneAndUpdate:function(t,e,n,r,o){const i=Object.assign({},r);i.fields=r.projection,i.update=!0,i.new="boolean"==typeof r.returnOriginal&&!r.returnOriginal,i.upsert="boolean"==typeof r.upsert&&r.upsert,N(t,e,r.sort,n,i,o)},geoHaystackSearch:function(t,e,n,r,o){let i={geoSearch:t.s.name,near:[e,n]};i=c(i,r,["readPreference","session"]),(r=Object.assign({},r)).readPreference=g(r,{db:t.s.db,collection:t}),l(i,t,r),f(t.s.db,i,r,(t,e)=>{if(t)return y(o,t);(e.err||e.errmsg)&&y(o,S(e)),y(o,null,e)})},group:function(t,e,n,r,o,i,u,c,h){if(u){const u=o&&"Code"===o._bsontype?o:new s(o),p={group:{ns:t.s.name,$reduce:u,cond:n,initial:r,out:"inline"}};if(null!=i&&(p.group.finalize=i),"function"==typeof e||e&&"Code"===e._bsontype)p.group.$keyf=e&&"Code"===e._bsontype?e:new s(e);else{const t={};e.forEach(e=>{t[e]=1}),p.group.key=t}(c=Object.assign({},c)).readPreference=g(c,{db:t.s.db,collection:t}),l(p,t,c);try{a(p,t,c)}catch(t){return h(t,null)}f(t.s.db,p,c,(t,e)=>{if(t)return y(h,t,null);y(h,null,e.retval)})}else{const i=null!=o&&"Code"===o._bsontype?o.scope:{};i.ns=t.s.name,i.keys=e,i.condition=n,i.initial=r;const u=A.replace(/ reduce;/,o.toString()+";");p(t.s.db,new s(u,i),null,c,(t,e)=>{if(t)return y(h,t,null);y(h,null,e.result||e)})}},indexes:function(t,e,n){e=Object.assign({},{full:!0},e),_(t.s.db,t.s.name,e,n)},indexExists:function(t,e,n,r){$(t,n,(t,n)=>{if(null!=t)return y(r,t,null);if(!Array.isArray(e))return y(r,null,null!=n[e]);for(let t=0;t<e.length;t++)if(null==n[e[t]])return y(r,null,!1);return y(r,null,!0)})},indexInformation:$,insertOne:function(t,e,n,r){if(Array.isArray(e))return r(b.create({message:"doc parameter must be an object",driver:!0}));I(t,[e],n,(t,n)=>{if(null!=r){if(t&&r)return r(t);if(null==n)return r(null,{result:{ok:1}});n.insertedCount=n.result.n,n.insertedId=e._id,r&&r(null,n)}})},isCapped:function(t,e,n){M(t,e,(t,e)=>{if(t)return y(n,t);y(n,null,!(!e||!e.capped))})},mapReduce:function(t,e,o,i,s){const u={mapreduce:t.s.name,map:e,reduce:o},c=["readPreference","session","bypassDocumentValidation"];for(let t in i)"scope"===t?u[t]=P(i[t]):-1===c.indexOf(t)&&(u[t]=i[t]);(i=Object.assign({},i)).readPreference=g(i,{db:t.s.db,collection:t}),!1!==i.readPreference&&"primary"!==i.readPreference&&i.out&&1!==i.out.inline&&"inline"!==i.out?(i.readPreference="primary",r(u,{db:t.s.db,collection:t},i)):l(u,t,i),!0===i.bypassDocumentValidation&&(u.bypassDocumentValidation=i.bypassDocumentValidation);try{a(u,t,i)}catch(t){return s(t,null)}f(t.s.db,u,i,(e,r)=>{if(e)return y(s,e);if(1!==r.ok||r.err||r.errmsg)return y(s,S(r));const o={};if(r.timeMillis&&(o.processtime=r.timeMillis),r.counts&&(o.counts=r.counts),r.timing&&(o.timing=r.timing),r.results)return null!=i.verbose&&i.verbose?y(s,null,{results:r.results,stats:o}):y(s,null,r.results);let u=null;if(null!=r.result&&"object"==typeof r.result){const e=r.result;u=new(n(44))(e.db,t.s.db.s.topology,t.s.db.s.options).collection(e.collection)}else u=t.s.db.collection(r.result);if(null==i.verbose||!i.verbose)return y(s,e,u);y(s,e,{collection:u,stats:o})})},optionsOp:M,parallelCollectionScan:function(t,e,n){const r={parallelCollectionScan:t.s.name,numCursors:e.numCursors};l(r,t,e);const o=e.raw;delete e.raw,f(t.s.db,r,e,(r,i)=>{if(r)return y(n,r,null);if(null==i)return y(n,new Error("no result returned for parallelCollectionScan"),null);e=Object.assign({explicitlyIgnoreSession:!0},e);const s=[];o&&(e.raw=o);for(let n=0;n<i.cursors.length;n++){const r=i.cursors[n].cursor.id,o="number"==typeof r?w.fromNumber(r):r;s.push(t.s.topology.cursor(t.s.namespace,o,e))}y(n,null,s)})},prepareDocs:R,reIndex:function(t,e,n){const r={reIndex:t.s.name};f(t.s.db,r,e,(t,e)=>{if(null!=n)return t?y(n,t,null):void y(n,null,!!e.ok)})},removeDocuments:j,rename:function(t,e,o,s){const u=n(43);i(e);const c={renameCollection:`${t.s.dbName}.${t.s.name}`,to:`${t.s.dbName}.${e}`,dropTarget:"boolean"==typeof o.dropTarget&&o.dropTarget};r(c,{db:t.s.db,collection:t},o),d(t.s.db.admin().s.db,c,o,(n,r)=>{if(n)return y(s,n,null);if(r.errmsg)return y(s,S(r),null);try{return y(s,null,new u(t.s.db,t.s.topology,t.s.dbName,e,t.s.pkFactory,t.s.options))}catch(n){return y(s,S(n),null)}})},replaceOne:function(t,e,n,r,o){r.multi=!1,B(t,e,n,r,(t,e)=>{if(null!=o){if(t&&o)return o(t);if(null==e)return o(null,{result:{ok:1}});e.modifiedCount=null!=e.result.nModified?e.result.nModified:e.result.n,e.upsertedId=Array.isArray(e.result.upserted)&&e.result.upserted.length>0?e.result.upserted[0]:null,e.upsertedCount=Array.isArray(e.result.upserted)&&e.result.upserted.length?e.result.upserted.length:0,e.matchedCount=Array.isArray(e.result.upserted)&&e.result.upserted.length>0?0:e.result.n,e.ops=[n],o&&o(null,e)}})},save:function(t,e,n,o){const i=r(Object.assign({},n),{db:t.s.db,collection:t},n);if(null!=e._id)return i.upsert=!0,B(t,{_id:e._id},e,i,o);I(t,[e],i,(t,n)=>{if(null!=o)return null==e?y(o,null,null):t?y(o,t,null):void y(o,null,n)})},stats:function(t,e,n){const r={collStats:t.s.name};null!=e.scale&&(r.scale=e.scale),(e=Object.assign({},e)).readPreference=g(e,{db:t.s.db,collection:t}),f(t.s.db,r,e,n)},updateDocuments:B,updateMany:function(t,e,n,r,o){r.multi=!0,B(t,e,n,r,(t,e)=>D(t,e,o))},updateOne:function(t,e,n,r,o){r.multi=!1,B(t,e,n,r,(t,e)=>D(t,e,o))}}},function(t,e,n){"use strict";const r=Symbol("mongoErrorContextSymbol");class o extends Error{constructor(t){if(t instanceof Error)super(t.message),this.stack=t.stack;else{if("string"==typeof t)super(t);else for(var e in super(t.message||t.errmsg||t.$err||"n/a"),t)this[e]=t[e];Error.captureStackTrace(this,this.constructor)}this.name="MongoError",this[r]=this[r]||{}}static create(t){return new o(t)}}class i extends o{constructor(t){super(t),this.name="MongoNetworkError",this.errorLabels=["TransientTransactionError"]}}const s=new Set([6,7,89,91,189,9001,10107,11600,11602,13435,13436]);t.exports={MongoError:o,MongoNetworkError:i,MongoParseError:class extends o{constructor(t){super(t),this.name="MongoParseError"}},MongoTimeoutError:class extends o{constructor(t){super(t),this.name="MongoTimeoutError"}},MongoWriteConcernError:class extends o{constructor(t,e){super(t),this.name="MongoWriteConcernError",null!=e&&(this.result=e)}},mongoErrorContextSymbol:r,isRetryableError:function(t){return s.has(t.code)||t instanceof i||t.message.match(/not master/)||t.message.match(/node is recovering/)}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(83),o=n(38),i=n(84),s=n(160),u=n(8),c=n(82),a=n(56),l=n(307),h=n(14).Buffer,p=Symbol.for("mongoose:emitted");let f,d,m;const g=new Set(["__proto__","constructor","prototype"]);
/*!
 * Get the bson type, if it exists
 */
function y(t,e){return u(t,"_bsontype",void 0)===e}
/*!
 * Get the last element of an array
 */e.specialProperties=g,
/*!
 * Produces a collection name from model `name`. By default, just returns
 * the model name
 *
 * @param {String} name a model name
 * @param {Function} pluralize function that pluralizes the collection name
 * @return {String} a collection name
 * @api private
 */
e.toCollectionName=function(t,e){return"system.profile"===t?t:"system.indexes"===t?t:"function"==typeof e?e(t):t},
/*!
 * Determines if `a` and `b` are deep equal.
 *
 * Modified from node/lib/assert.js
 *
 * @param {any} a a value to compare to `b`
 * @param {any} b a value to compare to `a`
 * @return {Boolean}
 * @api private
 */
e.deepEqual=function t(n,r){if(n===r)return!0;if(n instanceof Date&&r instanceof Date)return n.getTime()===r.getTime();if(y(n,"ObjectID")&&y(r,"ObjectID")||y(n,"Decimal128")&&y(r,"Decimal128"))return n.toString()===r.toString();if(n instanceof RegExp&&r instanceof RegExp)return n.source===r.source&&n.ignoreCase===r.ignoreCase&&n.multiline===r.multiline&&n.global===r.global;if("object"!=typeof n&&"object"!=typeof r)return n==r;if(null===n||null===r||void 0===n||void 0===r)return!1;if(n.prototype!==r.prototype)return!1;if(n instanceof Number&&r instanceof Number)return n.valueOf()===r.valueOf();if(h.isBuffer(n))return e.buffer.areEqual(n,r);let o,i,s,u;b(n)&&(n=n.toObject()),b(r)&&(r=r.toObject());try{o=Object.keys(n),i=Object.keys(r)}catch(t){return!1}if(o.length!==i.length)return!1;for(o.sort(),i.sort(),u=o.length-1;u>=0;u--)if(o[u]!==i[u])return!1;for(u=o.length-1;u>=0;u--)if(!t(n[s=o[u]],r[s]))return!1;return!0},e.last=function(t){if(t.length>0)return t[t.length-1]},
/*!
 * Object clone with Mongoose natives support.
 *
 * If options.minimize is true, creates a minimal data object. Empty objects and undefined values will not be cloned. This makes the data payload sent to MongoDB as small as possible.
 *
 * Functions are never cloned.
 *
 * @param {Object} obj the object to clone
 * @param {Object} options
 * @param {Boolean} isArrayChild true if cloning immediately underneath an array. Special case for minimize.
 * @return {Object} the cloned object
 * @api private
 */
e.clone=function(t,n,i){if(null==t)return t;if(Array.isArray(t))return w(t,n);if(b(t))return n&&n.json&&"function"==typeof t.toJSON?t.toJSON(n):t.toObject(n);if(t.constructor)switch(e.getFunctionName(t.constructor)){case"Object":return v(t,n,i);case"Date":return new t.constructor(+t);case"RegExp":return s(t)}return t instanceof o?new o(t.id):y(t,"Decimal128")?n&&n.flattenDecimals?t.toJSON():r.fromString(t.toString()):!t.constructor&&e.isObject(t)?v(t,n,i):t.valueOf?t.valueOf():v(t,n,i)};const _=e.clone;
/*!
 * ignore
 */
/*!
 * ignore
 */
function v(t,e,n){const r=e&&e.minimize,o={};let i;for(const n in t){if(g.has(n))continue;const s=_(t[n],e);r&&void 0===s||(i||(i=!0),o[n]=s)}return r&&!n?i&&o:o}function w(t,e){const n=[];for(let r=0,o=t.length;r<o;r++)n.push(_(t[r],e,!0));return n}
/*!
 * Shallow copies defaults into options.
 *
 * @param {Object} defaults
 * @param {Object} options
 * @return {Object} the merged object
 * @api private
 */e.promiseOrCallback=function(t,e,n){if("function"==typeof t)return e(function(e){if(null==e)t.apply(this,arguments);else{null!=n&&n.listeners("error").length>0&&!e[p]&&(e[p]=!0,n.emit("error",e));try{t(e)}catch(e){return process.nextTick(()=>{throw e})}}});return new(i.get())((t,r)=>{e(function(e,o){return null!=e?(null!=n&&n.listeners("error").length>0&&!e[p]&&(e[p]=!0,n.emit("error",e)),r(e)):arguments.length>2?t(Array.prototype.slice.call(arguments,1)):void t(o)})})},e.options=function(t,e){const n=Object.keys(t);let r,o=n.length;for(e=e||{};o--;)(r=n[o])in e||(e[r]=t[r]);return e},
/*!
 * Generates a random string
 *
 * @api private
 */
e.random=function(){return Math.random().toString().substr(3)},
/*!
 * Merges `from` into `to` without overwriting existing properties.
 *
 * @param {Object} to
 * @param {Object} from
 * @api private
 */
e.merge=function t(n,r,i,s){i=i||{};const u=Object.keys(r);let c=0;const a=u.length;let l;s=s||"";const h=i.omitNested||{};for(;c<a;)if(l=u[c++],!(i.omit&&i.omit[l]||h[s]||g.has(l)))if(null==n[l])n[l]=r[l];else if(e.isObject(r[l])){if(e.isObject(n[l])||(n[l]={}),null!=r[l]){if(r[l].instanceOfSchema){n[l]=r[l].clone();continue}if(r[l]instanceof o){n[l]=new o(r[l]);continue}}t(n[l],r[l],i,s?s+"."+l:l)}else i.overwrite&&(n[l]=r[l])},
/*!
 * Applies toObject recursively.
 *
 * @param {Document|Array|Object} obj
 * @return {Object}
 * @api private
 */
e.toObject=function t(r){let o;if(m||(m=n(16)),null==r)return r;if(r instanceof m)return r.toObject();if(Array.isArray(r)){o=[];for(let e=0,n=r.length;e<n;++e)o.push(t(r[e]));return o}if(r.constructor&&"Object"===e.getFunctionName(r.constructor)||!r.constructor&&e.isObject(r)){o={};for(const e in r)g.has(e)||(o[e]=t(r[e]));return o}return r},
/*!
 * Determines if `arg` is an object.
 *
 * @param {Object|Array|String|Function|RegExp|any} arg
 * @api private
 * @return {Boolean}
 */
e.isObject=function(t){return!!h.isBuffer(t)||"[object Object]"===Object.prototype.toString.call(t)},
/*!
 * Determines if `arg` is a plain object.
 *
 * @param {Object|Array|String|Function|RegExp|any} arg
 * @api private
 * @return {Boolean}
 */
e.isPOJO=function(t){return t instanceof Object&&"Object"===t.constructor.name},
/*!
 * A faster Array.prototype.slice.call(arguments) alternative
 * @api private
 */
e.args=c,
/*!
 * process.nextTick helper.
 *
 * Wraps `callback` in a try/catch + nextTick.
 *
 * node-mongodb-native has a habit of state corruption when an error is immediately thrown from within a collection callback.
 *
 * @param {Function} callback
 * @api private
 */
e.tick=function(t){if("function"==typeof t)return function(){try{t.apply(this,arguments)}catch(t){process.nextTick(function(){throw t})}}},
/*!
 * Returns if `v` is a mongoose object that has a `toObject()` method we can use.
 *
 * This is for compatibility with libs like Date.js which do foolish things to Natives.
 *
 * @param {any} v
 * @api private
 */
e.isMongooseObject=function(t){return m||(m=n(16)),d||(d=n(60).Array),f||(f=n(60).Buffer),null!=t&&(null!=t.$__||t.isMongooseArray||t.isMongooseBuffer||t.$isMongooseMap)};const b=e.isMongooseObject;
/*!
 * Converts `expires` options of index objects to `expiresAfterSeconds` options for MongoDB.
 *
 * @param {Object} object
 * @api private
 */
/*!
 * Populate options constructor
 */
function O(t){this.path=t.path,this.match=t.match,this.select=t.select,this.options=t.options,this.model=t.model,"object"==typeof t.subPopulate&&(this.populate=t.subPopulate),null!=t.justOne&&(this.justOne=t.justOne),null!=t.count&&(this.count=t.count),this._docs={}}e.expires=function(t){if(!t||"Object"!==t.constructor.name)return;if(!("expires"in t))return;let e;e="string"!=typeof t.expires?t.expires:Math.round(l(t.expires)/1e3),t.expireAfterSeconds=e,delete t.expires},O.prototype.constructor=Object,e.PopulateOptions=O,
/*!
 * populate helper
 */
e.populate=function(t,n,r,o,i,s,u,c){if(1===arguments.length){if(t instanceof O)return[t];if(Array.isArray(t)){return function(t){const e=[];return t.forEach(function(t){/[\s]/.test(t.path)?t.path.split(" ").forEach(function(n){const r=Object.assign({},t);r.path=n,e.push(r)}):e.push(t)}),e}(t).map(function(t){return!t.populate||t.match||t.options,e.populate(t)[0]})}e.isObject(t)&&(o=t.match,i=t.options,n=t.select,r=t.model,s=t.populate,u=t.justOne,c=(t=t.path).count)}else"object"==typeof r&&(i=o,o=r,r=void 0);if("string"!=typeof t)throw new TypeError("utils.populate: invalid path. Expected string. Got typeof `"+typeof t+"`");if(Array.isArray(s)){const t=[];s.forEach(function(n){if(/[\s]/.test(n.path)){const r=Object.assign({},n);r.path.split(" ").forEach(function(n){r.path=n,t.push(e.populate(r)[0])})}else t.push(e.populate(n)[0])}),s=e.populate(t)}else"object"==typeof s&&(s=e.populate(s));const a=[],l=t.split(" ");i=e.clone(i);for(let t=0;t<l.length;++t)a.push(new O({path:l[t],select:n,match:o,options:i,model:r,subPopulate:s,justOne:u,count:c}));return a},
/*!
 * Return the value of `obj` at the given `path`.
 *
 * @param {String} path
 * @param {Object} obj
 */
e.getValue=function(t,e,n){return a.get(t,e,"_doc",n)},
/*!
 * Sets the value of `obj` at the given `path`.
 *
 * @param {String} path
 * @param {Anything} val
 * @param {Object} obj
 */
e.setValue=function(t,e,n,r,o){a.set(t,e,n,"_doc",r,o)},
/*!
 * Returns an array of values from object `o`.
 *
 * @param {Object} o
 * @return {Array}
 * @private
 */
e.object={},e.object.vals=function(t){const e=Object.keys(t);let n=e.length;const r=[];for(;n--;)r.push(t[e[n]]);return r},
/*!
 * @see exports.options
 */
e.object.shallowCopy=e.options;
/*!
 * Safer helper for hasOwnProperty checks
 *
 * @param {Object} obj
 * @param {String} prop
 */
const S=Object.prototype.hasOwnProperty;e.object.hasOwnProperty=function(t,e){return S.call(t,e)},
/*!
 * Determine if `val` is null or undefined
 *
 * @return {Boolean}
 */
e.isNullOrUndefined=function(t){return null==t},
/*!
 * ignore
 */
e.array={},
/*!
 * Flattens an array.
 *
 * [ 1, [ 2, 3, [4] ]] -> [1,2,3,4]
 *
 * @param {Array} arr
 * @param {Function} [filter] If passed, will be invoked with each item in the array. If `filter` returns a falsey value, the item will not be included in the results.
 * @return {Array}
 * @private
 */
e.array.flatten=function t(e,n,r){return r||(r=[]),e.forEach(function(e){Array.isArray(e)?t(e,n,r):n&&!n(e)||r.push(e)}),r},
/*!
 * Removes duplicate values from an array
 *
 * [1, 2, 3, 3, 5] => [1, 2, 3, 5]
 * [ ObjectId("550988ba0c19d57f697dc45e"), ObjectId("550988ba0c19d57f697dc45e") ]
 *    => [ObjectId("550988ba0c19d57f697dc45e")]
 *
 * @param {Array} arr
 * @return {Array}
 * @private
 */
e.array.unique=function(t){const e={},n={},r=[],i=t.length;for(let s=0;s<i;++s)if("number"==typeof t[s]||"string"==typeof t[s]||null==t[s]){if(e[t[s]])continue;r.push(t[s]),e[t[s]]=!0}else if(t[s]instanceof o){if(n[t[s].toString()])continue;r.push(t[s]),n[t[s].toString()]=!0}else r.push(t[s]);return r},
/*!
 * Determines if two buffers are equal.
 *
 * @param {Buffer} a
 * @param {Object} b
 */
e.buffer={},e.buffer.areEqual=function(t,e){if(!h.isBuffer(t))return!1;if(!h.isBuffer(e))return!1;if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;++n)if(t[n]!==e[n])return!1;return!0},e.getFunctionName=function(t){return t.name?t.name:(t.toString().trim().match(/^function\s*([^\s(]+)/)||[])[1]},
/*!
 * Decorate buffers
 */
e.decorate=function(t,e){for(const n in e)g.has(n)||(t[n]=e[n])},e.mergeClone=function(t,n){b(n)&&(n=n.toObject({transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1}));const r=Object.keys(n),o=r.length;let i,s=0;for(;s<o;)if(i=r[s++],!g.has(i))if(void 0===t[i])t[i]=e.clone(n[i],{transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1});else{let r=n[i];if(null==r||!r.valueOf||r instanceof Date||(r=r.valueOf()),e.isObject(r)){let n=r;b(r)&&!r.isMongooseBuffer&&(n=n.toObject({transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1})),r.isMongooseBuffer&&(n=h.from(n)),e.mergeClone(t[i],n)}else t[i]=e.clone(r,{flattenDecimals:!1})}},e.each=function(t,e){for(let n=0;n<t.length;++n)e(t[n])},
/*!
 * ignore
 */
e.noop=function(){}},function(t,e,n){"use strict";const r=n(1).applyWriteConcern,o=n(2).BSON.Code,i=n(1).resolveReadPreference,s=n(11),u=n(1).debugOptions,c=n(1).handleCallback,a=n(2).MongoError,l=n(1).parseIndexOptions,h=n(2).ReadPreference,p=n(1).toError,f=n(152),d=n(3).count,m=n(3).findOne,g=n(3).remove,y=n(3).updateOne,_=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"],v=["w","wtimeout","j","fsync","autoIndexId","strict","serializeFunctions","pkFactory","raw","readPreference","session"];function w(t,e,n,o,i){let s=Object.assign({},{readPreference:h.PRIMARY},o);if((s=r(s,{db:t},o)).writeConcern&&"function"!=typeof i)throw a.create({message:"Cannot use a writeConcern without a provided callback",driver:!0});if(t.serverConfig&&t.serverConfig.isDestroyed())return i(new a("topology was destroyed"));!function(t,e,n,o,i){const s=l(n),u="string"==typeof o.name?o.name:s.name,f=[{name:u,key:s.fieldHash}],d=Object.keys(f[0]).concat(["writeConcern","w","wtimeout","j","fsync","readPreference","session"]);for(let t in o)-1===d.indexOf(t)&&(f[0][t]=o[t]);const m=t.s.topology.capabilities();if(f[0].collation&&m&&!m.commandsTakeCollation){const t=new a("server/primary/mongos does not support collation");return t.code=67,i(t)}const g=r({createIndexes:e,indexes:f},{db:t},o);o.readPreference=h.PRIMARY,b(t,g,o,(t,e)=>t?c(i,t,null):0===e.ok?c(i,p(e),null):void c(i,null,u))}(t,e,n,s,(r,u)=>{if(null==r)return c(i,r,u);if(67===r.code||11e3===r.code||85===r.code||86===r.code||11600===r.code||197===r.code)return c(i,r,u);const l=S(t,e,n,o);s.checkKeys=!1,t.s.topology.insert(`${t.s.databaseName}.${f.SYSTEM_INDEX_COLLECTION}`,l,s,(t,e)=>{if(null!=i)return t?c(i,t):null==e?c(i,null,null):e.result.writeErrors?c(i,a.create(e.result.writeErrors[0]),null):void c(i,null,l.name)})})}function b(t,e,n,r){if(t.serverConfig&&t.serverConfig.isDestroyed())return r(new a("topology was destroyed"));const o=n.dbName||n.authdb||t.s.databaseName;n.readPreference=i(n,{db:t,default:h.primary}),t.s.logger.isDebug()&&t.s.logger.debug(`executing command ${JSON.stringify(e)} against ${o}.$cmd with options [${JSON.stringify(u(_,n))}]`),t.s.topology.command(`${o}.$cmd`,e,n,(t,e)=>t?c(r,t):n.full?c(r,null,e):void c(r,null,e.result))}function O(t,e,n,r){const o=null!=n.full&&n.full;if(t.serverConfig&&t.serverConfig.isDestroyed())return r(new a("topology was destroyed"));t.collection(e).listIndexes(n).toArray((t,e)=>t?r(p(t)):Array.isArray(e)?o?c(r,null,e):void c(r,null,function(t){let e={};for(let n=0;n<t.length;n++){const r=t[n];e[r.name]=[];for(let t in r.key)e[r.name].push([t,r.key[t]])}return e}(e)):c(r,null,[]))}function S(t,e,n,r){const o=l(n),i=o.fieldHash,s="string"==typeof r.name?r.name:o.name,u={ns:t.databaseName+"."+e,key:i,name:s},c=null!=r&&"object"!=typeof r&&r;r=null==r||"boolean"==typeof r?{}:r;const a=Object.keys(u);for(let t in r)-1===a.indexOf(t)&&(u[t]=r[t]);null==u.unique&&(u.unique=c);const h=["w","wtimeout","j","fsync","readPreference","session"];for(let t=0;t<h.length;t++)delete u[h[t]];return u}t.exports={addUser:function(t,e,o,i,u){const l=n(44);if(t.serverConfig&&t.serverConfig.isDestroyed())return u(new a("topology was destroyed"));!function(t,e,n,o,i){if("string"==typeof e&&null!=n&&"object"==typeof n&&(o=n,n=null),"function"==typeof o&&(i=o,o={}),null!=o.digestPassword)return i(p("The digestPassword option is not supported via add_user. Please use db.command('createUser', ...) instead for this option."));const u=null!=o.customData?o.customData:{};let a=Array.isArray(o.roles)?o.roles:[];const l="number"==typeof o.maxTimeMS?o.maxTimeMS:null;0===a.length&&console.log("Creating a user without roles is deprecated in MongoDB >= 2.6");const f={writeCommand:!0};o.dbName&&(f.dbName=o.dbName),null!=l&&(f.maxTimeMS=l),"admin"!==t.databaseName.toLowerCase()&&"admin"!==o.dbName||Array.isArray(o.roles)?Array.isArray(o.roles)||(a=["dbOwner"]):a=["root"];const d=t.s.topology.lastIsMaster().maxWireVersion>=7;let m={createUser:e,customData:u,roles:a,digestPassword:d};m=r(m,{db:t},o);let g=n;if(!d){const t=s.createHash("md5");t.update(e+":mongo:"+n),g=t.digest("hex")}"string"==typeof n&&(m.pwd=g),f.readPreference=h.primary,b(t,m,f,(t,n)=>t&&0===t.ok&&void 0===t.code?c(i,{code:-5e3},null):t?c(i,t,null):void c(i,n.ok?null:p(n),n.ok?[{user:e,pwd:""}]:null))}(t,e,o,i,(t,n)=>{if(t&&-5e3===t.code){const t=r(Object.assign({},i),{db:h},i),n=s.createHash("md5");n.update(e+":mongo:"+o);const a=n.digest("hex"),h=i.dbName?new l(i.dbName,h.s.topology,h.s.options):h,p=h.collection(f.SYSTEM_USER_COLLECTION);d(p,{},t,(n,r)=>{if(null!=n)return c(u,n,null);const o=Object.assign({projection:{dbName:1}},t);p.find({user:e},o).toArray(n=>{if(null!=n)return c(u,n,null);t.upsert=!0,y(p,{user:e},{$set:{user:e,pwd:a}},t,t=>0===r&&t?c(u,null,[{user:e,pwd:a}]):t?c(u,t,null):void c(u,null,[{user:e,pwd:a}]))})})}else{if(t)return c(u,t);c(u,t,n)}})},collections:function(t,e,r){const o=n(43);e=Object.assign({},e,{nameOnly:!0}),t.listCollections({},e).toArray((e,n)=>{if(null!=e)return c(r,e,null);n=n.filter(t=>-1===t.name.indexOf("$")),c(r,null,n.map(e=>new o(t,t.s.topology,t.s.databaseName,e.name,t.s.pkFactory,t.s.options)))})},createCollection:function(t,e,o,i){const s=n(43),u=r(Object.assign({},o),{db:t},o);if(t.serverConfig&&t.serverConfig.isDestroyed())return i(new a("topology was destroyed"));const l=Object.assign({},u,{nameOnly:!0});t.listCollections({name:e},l).setReadPreference(h.PRIMARY).toArray((n,l)=>{if(null!=n)return c(i,n,null);if(l.length>0&&u.strict)return c(i,a.create({message:`Collection ${e} already exists. Currently in strict mode.`,driver:!0}),null);if(l.length>0)try{return c(i,null,new s(t,t.s.topology,t.s.databaseName,e,t.s.pkFactory,o))}catch(n){return c(i,n)}const p={create:e};r(p,{db:t},o);for(let t in o)null!=o[t]&&"function"!=typeof o[t]&&-1===v.indexOf(t)&&(p[t]=o[t]);u.readPreference=h.PRIMARY,b(t,p,u,n=>{if(n)return c(i,n);c(i,null,new s(t,t.s.topology,t.s.databaseName,e,t.s.pkFactory,o))})})},createListener:function(t,e,n){return function(r){if(n.listeners(e).length>0){n.emit(e,r,t);for(let n=0;n<t.s.children.length;n++)t.s.children[n].emit(e,r,t.s.children[n])}}},createIndex:w,dropCollection:function(t,e,n,r){b(t,e,n,(e,n)=>t.serverConfig&&t.serverConfig.isDestroyed()?r(new a("topology was destroyed")):e?c(r,e):n.ok?c(r,null,!0):void c(r,null,!1))},dropDatabase:function(t,e,n,r){b(t,e,n,(e,n)=>t.serverConfig&&t.serverConfig.isDestroyed()?r(new a("topology was destroyed")):null!=r?e?c(r,e,null):void c(r,null,!!n.ok):void 0)},ensureIndex:function(t,e,n,o,i){const s=r({},{db:t},o),u=S(t,e,n,o).name;if(t.serverConfig&&t.serverConfig.isDestroyed())return i(new a("topology was destroyed"));s.readPreference=h.PRIMARY,O(t,e,s,(r,s)=>{if(null!=r&&26!==r.code)return c(i,r,null);if(null!=s&&s[u]){if("function"==typeof i)return c(i,null,u)}else w(t,e,n,o,i)})},evaluate:function(t,e,n,r,i){let s=e,u=[];if(t.serverConfig&&t.serverConfig.isDestroyed())return i(new a("topology was destroyed"));s&&"Code"===s._bsontype||(s=new o(s)),null==n||Array.isArray(n)||"function"==typeof n?null!=n&&Array.isArray(n)&&"function"!=typeof n&&(u=n):u=[n];let l={$eval:s,args:u};r.nolock&&(l.nolock=r.nolock),r.readPreference=new h(h.PRIMARY),b(t,l,r,(t,e)=>t?c(i,t,null):e&&1===e.ok?c(i,null,e.retval):e?c(i,a.create({message:`eval failed: ${e.errmsg}`,driver:!0}),null):void c(i,t,e))},executeCommand:b,executeDbAdminCommand:function(t,e,n,r){t.s.topology.command("admin.$cmd",e,n,(e,n)=>t.serverConfig&&t.serverConfig.isDestroyed()?r(new a("topology was destroyed")):e?c(r,e):void c(r,null,n.result))},listCollectionsTransforms:function(t){const e=`${t}.`;return{doc:t=>{const n=t.name.indexOf(e);return t.name&&0===n&&(t.name=t.name.substr(n+e.length)),t}}},indexInformation:O,profilingInfo:function(t,e,n){try{t.collection("system.profile").find({},e).toArray(n)}catch(t){return n(t,null)}},profilingLevel:function(t,e,n){b(t,{profile:-1},e,(t,e)=>{if(null==t&&1===e.ok){const t=e.was;return 0===t?n(null,"off"):1===t?n(null,"slow_only"):2===t?n(null,"all"):n(new Error("Error: illegal profiling level value "+t),null)}n(null!=t?t:new Error("Error with profile command"),null)})},removeUser:function(t,e,o,i){const s=n(44);!function(t,e,n,o){if("function"==typeof n&&(o=n,n={}),n=n||{},t.serverConfig&&t.serverConfig.isDestroyed())return o(new a("topology was destroyed"));const i={writeCommand:!0};n.dbName&&(i.dbName=n.dbName);const s="number"==typeof n.maxTimeMS?n.maxTimeMS:null;null!=s&&(i.maxTimeMS=s);let u={dropUser:e};u=r(u,{db:t},n),i.readPreference=h.primary,b(t,u,i,(t,e)=>t&&!t.ok&&void 0===t.code?c(o,{code:-5e3}):t?c(o,t,null):void c(o,null,!!e.ok))}(t,e,o,(t,n)=>{if(t&&-5e3===t.code){const t=r(Object.assign({},o),{db:n},o),n=o.dbName?new s(o.dbName,n.s.topology,n.s.options):n,u=n.collection(f.SYSTEM_USER_COLLECTION);m(u,{user:e},t,(n,r)=>{if(null==r)return c(i,n,!1);g(u,{user:e},t,t=>{c(i,t,!0)})})}else{if(t)return c(i,t);c(i,t,n)}})},setProfilingLevel:function(t,e,n,r){const o={};let i=0;if("off"===e)i=0;else if("slow_only"===e)i=1;else{if("all"!==e)return r(new Error("Error: illegal profiling level value "+e));i=2}o.profile=i,b(t,o,n,(t,n)=>null==t&&1===n.ok?r(null,e):r(null!=t?t:new Error("Error with profile command"),null))},validateDatabaseName:function(t){if("string"!=typeof t)throw a.create({message:"database name must be a string",driver:!0});if(0===t.length)throw a.create({message:"database name cannot be the empty string",driver:!0});if("$external"===t)return;const e=[" ",".","$","/","\\"];for(let n=0;n<e.length;n++)if(-1!==t.indexOf(e[n]))throw a.create({message:"database names cannot contain the character '"+e[n]+"'",driver:!0})}}},function(t,e,n){"use strict";var r=n(46),o="undefined"==typeof navigator,i={e:{}},s,u="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null;function c(){try{var t=s;return s=null,t.apply(this,arguments)}catch(t){return i.e=t,i}}function a(t){return s=t,c}var l=function(t,e){var n={}.hasOwnProperty;function r(){for(var r in this.constructor=t,this.constructor$=e,e.prototype)n.call(e.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=e.prototype[r])}return r.prototype=e.prototype,t.prototype=new r,t.prototype};function h(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function p(t){return"function"==typeof t||"object"==typeof t&&null!==t}function f(t){return h(t)?new Error(C(t)):t}function d(t,e){var n,r=t.length,o=new Array(r+1);for(n=0;n<r;++n)o[n]=t[n];return o[n]=e,o}function m(t,e,n){if(!r.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var o=Object.getOwnPropertyDescriptor(t,e);return null!=o?null==o.get&&null==o.set?o.value:n:void 0}function g(t,e,n){if(h(t))return t;var o={value:n,configurable:!0,enumerable:!1,writable:!0};return r.defineProperty(t,e,o),t}function y(t){throw t}var _=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1};if(r.isES5){var n=Object.getOwnPropertyNames;return function(t){for(var o=[],i=Object.create(null);null!=t&&!e(t);){var s;try{s=n(t)}catch(t){return o}for(var u=0;u<s.length;++u){var c=s[u];if(!i[c]){i[c]=!0;var a=Object.getOwnPropertyDescriptor(t,c);null!=a&&null==a.get&&null==a.set&&o.push(c)}}t=r.getPrototypeOf(t)}return o}}var o={}.hasOwnProperty;return function(n){if(e(n))return[];var r=[];t:for(var i in n)if(o.call(n,i))r.push(i);else{for(var s=0;s<t.length;++s)if(o.call(t[s],i))continue t;r.push(i)}return r}}(),v=/this\s*\.\s*\S+\s*=/;function w(t){try{if("function"==typeof t){var e=r.names(t.prototype),n=r.isES5&&e.length>1,o=e.length>0&&!(1===e.length&&"constructor"===e[0]),i=v.test(t+"")&&r.names(t).length>0;if(n||o||i)return!0}return!1}catch(t){return!1}}function b(t){function e(){}e.prototype=t;for(var n=8;n--;)new e;return t}var O=/^[a-z$_][a-z$_0-9]*$/i;function S(t){return O.test(t)}function A(t,e,n){for(var r=new Array(t),o=0;o<t;++o)r[o]=e+o+n;return r}function C(t){try{return t+""}catch(t){return"[no string representation]"}}function T(t){return t instanceof Error||null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function E(t){try{g(t,"isOperational",!0)}catch(t){}}function N(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function $(t){return T(t)&&r.propertyIsWritable(t,"stack")}var I="stack"in new Error?function(t){return $(t)?t:new Error(C(t))}:function(t){if($(t))return t;try{throw new Error(C(t))}catch(t){return t}};function M(t){return{}.toString.call(t)}function R(t,e,n){for(var o=r.names(t),i=0;i<o.length;++i){var s=o[i];if(n(s))try{r.defineProperty(e,s,r.getDescriptor(t,s))}catch(t){}}}var P=function(t){return r.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var j="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,n=[],r=t[Symbol.iterator]();!(e=r.next()).done;)n.push(e.value);return n};P=function(t){return r.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?j(t):null}}var D="undefined"!=typeof process&&"[object process]"===M(process).toLowerCase(),B="undefined"!=typeof process&&void 0!==process.env;function L(t){return B?process.env[t]:void 0}function F(){if("function"==typeof Promise)try{var t=new Promise(function(){});if("[object Promise]"==={}.toString.call(t))return Promise}catch(t){}}function U(t,e){return t.bind(e)}var q={isClass:w,isIdentifier:S,inheritedDataKeys:_,getDataPropertyOrDefault:m,thrower:y,isArray:r.isArray,asArray:P,notEnumerableProp:g,isPrimitive:h,isObject:p,isError:T,canEvaluate:o,errorObj:i,tryCatch:a,inherits:l,withAppended:d,maybeWrapAsError:f,toFastProperties:b,filledRange:A,toString:C,canAttachTrace:$,ensureErrorObject:I,originatesFromRejection:N,markAsOriginatingFromRejection:E,classString:M,copyDescriptors:R,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:D,hasEnvVariables:B,env:L,global:u,getNativePromise:F,domainBind:U},x;q.isRecentNode=q.isNode&&(x=process.versions.node.split(".").map(Number),0===x[0]&&x[1]>10||x[0]>0),q.isNode&&q.toFastProperties(process);try{throw new Error}catch(t){q.lastLineError=t}t.exports=q},function(t,e,n){"use strict";
/*!
 * Simplified lodash.get to work around the annoying null quirk. See:
 * https://github.com/lodash/lodash/issues/3659
 */function r(t,e){return null==t?t:t instanceof Map?t.get(e):t[e]}t.exports=function(t,e,n){const o=e.split(".");let i=e,s=t;for(const t of o){if(null==s)return n;if(null!=s[i])return s[i];s=r(s,t),i=i.substr(t.length+1)}return null==s?n:s}},function(t,e,n){"use strict";const r=n(86);
/*!
 * Module exports.
 */t.exports=r,r.messages=n(310),r.Messages=r.messages,r.DocumentNotFoundError=n(165),r.CastError=n(24),r.ValidationError=n(107),r.ValidatorError=n(311),r.VersionError=n(312),r.ParallelSaveError=n(313),r.OverwriteModelError=n(314),r.MissingSchemaError=n(315),r.DivergentArrayError=n(316)},function(t,e){t.exports=require("events")},function(t,e){t.exports=require("crypto")},function(t,e,n){"use strict";const r=n(99),o=n(0).format,i=n(33),s=n(14).Buffer;function u(t,e,n){t.listeners(e).length>0&&t.emit(e,n)}var c=n(241).version,a=o("Node.js %s, %s",process.version,r.endianness()),l=r.type(),h=process.platform,p=process.arch,f=r.release();function d(t){return JSON.parse(JSON.stringify(t))}var m=function(t){return t.s.serverDescription||(t.s.serverDescription={address:t.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),t.s.serverDescription},g=function(t,e){t.listeners("serverDescriptionChanged").length>0&&(t.emit("serverDescriptionChanged",{topologyId:-1!==t.s.topologyId?t.s.topologyId:t.id,address:t.name,previousDescription:m(t),newDescription:e}),t.s.serverDescription=e)},y=function(t){return t.s.topologyDescription||(t.s.topologyDescription={topologyType:"Unknown",servers:[{address:t.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}]}),t.s.topologyDescription},_=function(t,e){return e||(e=t.ismaster),e?e.ismaster&&"isdbgrid"===e.msg?"Mongos":e.ismaster&&!e.hosts?"Standalone":e.ismaster?"RSPrimary":e.secondary?"RSSecondary":e.arbiterOnly?"RSArbiter":"Unknown":"Unknown"},v=function(t){return function(e){if("destroyed"!==t.s.state){var n=(new Date).getTime();u(t,"serverHeartbeatStarted",{connectionId:t.name}),t.command("admin.$cmd",{ismaster:!0},{monitoring:!0},function(r,o){if(r)u(t,"serverHeartbeatFailed",{durationMS:i,failure:r,connectionId:t.name});else{t.emit("ismaster",o,t);var i=(new Date).getTime()-n;u(t,"serverHeartbeatSucceeded",{durationMS:i,reply:o.result,connectionId:t.name}),function(t,e,n){var r=_(t,e);return _(t,n)!==r}(t,t.s.ismaster,o.result)&&g(t,{address:t.name,arbiters:[],hosts:[],passives:[],type:t.s.inTopology?_(t):"Standalone"}),t.s.ismaster=o.result,t.s.isMasterLatencyMS=i}if("function"==typeof e)return e(r,o);t.s.inquireServerStateTimeout=setTimeout(v(t),t.s.haInterval)})}}};const w={endSessions:function(t,e){Array.isArray(t)||(t=[t]),this.command("admin.$cmd",{endSessions:t},{readPreference:i.primaryPreferred},()=>{"function"==typeof e&&e()})}};t.exports.SessionMixins=w,t.exports.resolveClusterTime=function(t,e){null==t.clusterTime?t.clusterTime=e:e.clusterTime.greaterThan(t.clusterTime.clusterTime)&&(t.clusterTime=e)},t.exports.inquireServerState=v,t.exports.getTopologyType=_,t.exports.emitServerDescriptionChanged=g,t.exports.emitTopologyDescriptionChanged=function(t,e){t.listeners("topologyDescriptionChanged").length>0&&(t.emit("topologyDescriptionChanged",{topologyId:-1!==t.s.topologyId?t.s.topologyId:t.id,address:t.name,previousDescription:y(t),newDescription:e}),t.s.serverDescription=e)},t.exports.cloneOptions=function(t){var e={};for(var n in t)e[n]=t[n];return e},t.exports.createClientInfo=function(t){var e=t.clientInfo?d(t.clientInfo):{driver:{name:"nodejs-core",version:c},os:{type:l,name:h,architecture:p,version:f}};if(e.platform&&-1===e.platform.indexOf("mongodb-core")?e.platform=o("%s, mongodb-core: %s",e.platform,c):e.platform||(e.platform=a),t.appname){var n=s.from(t.appname),r=n.length>128?n.slice(0,128).toString("utf8"):t.appname;e.application={name:r}}return e},t.exports.createCompressionInfo=function(t){return t.compression&&t.compression.compressors?(t.compression.compressors.forEach(function(t){if("snappy"!==t&&"zlib"!==t)throw new Error("compressors must be at least one of snappy or zlib")}),t.compression.compressors):[]},t.exports.clone=d,t.exports.diff=function(t,e){var n={servers:[]};t||(t={servers:[]});for(var r=0;r<t.servers.length;r++){for(var o=!1,i=0;i<e.servers.length;i++)if(e.servers[i].address.toLowerCase()===t.servers[r].address.toLowerCase()){o=!0;break}o||n.servers.push({address:t.servers[r].address,from:t.servers[r].type,to:"Unknown"})}for(i=0;i<e.servers.length;i++){for(o=!1,r=0;r<t.servers.length;r++)if(t.servers[r].address.toLowerCase()===e.servers[i].address.toLowerCase()){o=!0;break}o||n.servers.push({address:e.servers[i].address,from:"Unknown",to:e.servers[i].type})}for(r=0;r<t.servers.length;r++){var s=t.servers[r];for(i=0;i<e.servers.length;i++){var u=e.servers[i];s.address.toLowerCase()===u.address.toLowerCase()&&s.type!==u.type&&n.servers.push({address:s.address,from:s.type,to:u.type})}}return n},t.exports.Interval=function(t,e){var n=!1;this.start=function(){return this.isRunning()||(n=setInterval(t,e)),this},this.stop=function(){return clearInterval(n),n=!1,this},this.isRunning=function(){return!1!==n}},t.exports.Timeout=function(t,e){var n=!1;this.start=function(){return this.isRunning()||(n=setTimeout(t,e)),this},this.stop=function(){return clearTimeout(n),n=!1,this},this.isRunning=function(){return!(n&&n._called||!1===n)}},t.exports.isRetryableWritesSupported=function(t){return!(t.lastIsMaster().maxWireVersion<6||!t.logicalSessionTimeoutMinutes)}},,function(t,e,n){var r=n(63),o=r.Buffer;function i(t,e){for(var n in t)e[n]=t[n]}function s(t,e,n){return o(t,e,n)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?t.exports=r:(i(r,e),e.Buffer=s),i(o,s),s.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return o(t,e,n)},s.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=o(t);return void 0!==e?"string"==typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return o(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},function(t,e){t.exports=require("stream")},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(10).EventEmitter,o=n(308),i=n(9),s=n(47),u=n(167),c=n(168),a=n(110),l=n(19).ValidatorError,h=n(111),p=n(169),f=n(112).compile,d=n(112).defineKey,m=n(57).flatten,g=n(8),y=n(317),_=n(318),v=n(58),w=n(319),b=n(0).inspect,O=n(39).internalToObjectOptions,S=n(56),A=n(5),C=i.ValidationError,T=A.clone,E=A.deepEqual,N=A.isMongooseObject,$=n(23).documentArrayParent,I=n(23).getSymbol;let M,R,P;const j=A.specialProperties;function D(t,e,n,i){if("object"==typeof n&&null!=n&&(n=(i=n).skipId),i=i||{},this.$__=new o,this.$__.emitter=new r,this.isNew=!("isNew"in i)||i.isNew,this.errors=void 0,this.$__.$options=i||{},null!=t&&"object"!=typeof t)throw new c(t,"obj","Document");const s=this.schema;"boolean"==typeof e?(this.$__.strictMode=e,e=void 0):(this.$__.strictMode=s.options.strict,this.$__.selected=e);const u=s.requiredPaths(!0);for(let t=0;t<u.length;++t)this.$__.activePaths.require(u[t]);this.$__.emitter.setMaxListeners(0);let a=null;e&&"Object"===A.getFunctionName(e.constructor)&&(a=w(e));const l=!1===a&&e?
/*!
 * ignore
 */
function(t){const e={},n=Object.keys(t);for(let t=0;t<n.length;++t){const r=n[t].split("."),o=[];for(let t=0;t<r.length;++t)o.push(r[t]),e[o.join(".")]=1}return e}
/*!
 * ignore
 */(e):{};if(this.$__buildDoc(t,e,n,a,l,!1),B(this,e,n,a,l,!0,{isNew:this.isNew}),t&&(t instanceof D&&(this.isNew=t.isNew),this.$__original_set?this.$__original_set(t,void 0,!0):this.$set(t,void 0,!0)),i.willInit?this.once("init",()=>{B(this,e,n,a,l,!1,i.skipDefaults,this.isNew)}):B(this,e,n,a,l,!1,i.skipDefaults,this.isNew),this.$__._id=this._id,!s.options.strict&&t){const t=this;Object.keys(this._doc).forEach(function(e){e in s.tree||d(e,null,t)})}!
/*!
 * Runs queued functions
 */
function(t){const e=t.schema&&t.schema.callQueue;if(!e.length)return;let n;for(let r=0;r<e.length;++r)"pre"!==(n=e[r])[0]&&"post"!==n[0]&&"on"!==n[0]&&t[n[0]].apply(t,n[1])}
/*!
 * ignore
 */(this)}
/*!
 * Document exposes the NodeJS event emitter API, so you can use
 * `on`, `once`, etc.
 */function B(t,e,n,r,o,i,s){const u=Object.keys(t.schema.paths),c=u.length;for(let a=0;a<c;++a){let c,l="";const h=u[a];if("_id"===h&&n)continue;const p=t.schema.paths[h],f=h.split("."),d=f.length;let m=!1,g=t._doc;for(let n=0;n<d&&null!=g;++n){const u=f[n];if(l+=(l.length?".":"")+u,!0===r){if(l in e)break}else if(!1===r&&e&&!m)if(l in e)m=!0;else if(!o[l])break;if(n===d-1){if(void 0!==g[u])break;if("function"==typeof p.defaultValue){if(!p.defaultValue.$runBeforeSetters&&i)break;if(p.defaultValue.$runBeforeSetters&&!i)break}else if(!i)continue;if(s&&s[l])break;if(e&&null!==r)if(!0===r){if(h in e)continue;void 0!==(c=p.getDefault(t,!1))&&(g[u]=c,t.$__.activePaths.default(h))}else m&&void 0!==(c=p.getDefault(t,!1))&&(g[u]=c,t.$__.activePaths.default(h));else void 0!==(c=p.getDefault(t,!1))&&(g[u]=c,t.$__.activePaths.default(h))}else g=g[u]}}}
/*!
 * ignore
 */
function L(t){let e,n;const r={};!
/*!
 * ignore
 */
function(t){Object.keys(t.$__.activePaths.states.require).forEach(e=>{const n=t.schema.path(e);null!=n&&"function"==typeof n.originalRequiredValue&&(t.$__.cachedRequired[e]=n.originalRequiredValue.call(t))})}(t);let o=Object.keys(t.$__.activePaths.states.require).filter(function(e){return!(!t.isSelected(e)&&!t.isModified(e))&&(!(e in t.$__.cachedRequired)||t.$__.cachedRequired[e])});if(o=(o=(o=o.concat(Object.keys(t.$__.activePaths.states.init))).concat(Object.keys(t.$__.activePaths.states.modify))).concat(Object.keys(t.$__.activePaths.states.default)),!t.ownerDocument){const i=t.$__getAllSubdocs();let s;n=i.length;const u=t.modifiedPaths();for(e=0;e<n;++e)s=i[e],t.isModified(s.$basePath,u)&&!t.isDirectModified(s.$basePath)&&((o=o.filter(function(t){return null!=t&&0!==t.indexOf(s.$basePath+".")})).push(s.$basePath),r[s.$basePath]=!0)}for(n=o.length,e=0;e<n;++e){const n=o[e],r=t.schema.path(n);if(!r||!r.$isMongooseArray||r.$isMongooseDocumentArray&&!g(r,"schemaOptions.required"))continue;const i=t.getValue(n);if(i){const t=i.length;for(let e=0;e<t;++e)o.push(n+"."+e)}}const i={skipArrays:!0};for(n=o.length,e=0;e<n;++e){const n=o[e];if(t.schema.nested[n]){let e=t.getValue(n);N(e)&&(e=e.toObject({transform:!1}));const r=m(e,"",i),s=Object.keys(r).map(function(t){return n+"."+t});o=o.concat(s)}}for(n=o.length,e=0;e<n;++e){const n=o[e],r=t.schema.path(n);if(!r||!r.$isSchemaMap)continue;const i=t.getValue(n);if(null!=i)for(const t of i.keys())o.push(n+"."+t)}return[o,r]}
/*!
 * ignore
 */
/*!
 * Applies virtuals properties to `json`.
 *
 * @param {Document} self
 * @param {Object} json
 * @param {String} type either `virtuals` or `paths`
 * @return {Object} `json`
 */
function F(t,e,n,r){const o=t.schema,i=Object.keys(o[n]);let s=i.length;const u=s;let c,a,l,h=t._doc;if(!h)return e;if("virtuals"===n){for(r=r||{},s=0;s<u;++s){if(a=c=i[s],null!=r.path){if(!c.startsWith(r.path+"."))continue;a=c.substr(r.path.length+1)}const n=a.split(".");if(void 0===(l=T(t.get(c),r)))continue;const o=n.length;h=e;for(let t=0;t<o-1;++t)h[n[t]]=h[n[t]]||{},h=h[n[t]];h[n[o-1]]=l}return e}for(;s--;){const n=(c=i[s]).split("."),o=n.length,u=o-1;let a,p=e;h=t._doc;for(let e=0;e<o;++e){if(l=h[a=n[e]],e===u)p[a]=T(t.get(c),r);else{if(null==l){a in h&&(p[a]=l);break}p=p[a]||(p[a]={})}h=l}}return e}A.each(["on","once","emit","listeners","removeListener","setMaxListeners","removeAllListeners","addListener"],function(t){D.prototype[t]=function(){return this.$__.emitter[t].apply(this.$__.emitter,arguments)}}),D.prototype.constructor=D,D.prototype.schema,D.prototype.isNew,D.prototype.id,D.prototype.errors,D.prototype.$__buildDoc=function(t,e,n,r,o){const i={},s=Object.keys(this.schema.paths).filter(t=>!t.includes("$*")),u=s.length;let c=0;for(;c<u;++c){const u=s[c];if("_id"===u){if(n)continue;if(t&&"_id"in t)continue}const a=u.split("."),l=a.length,h=l-1;let p="",f=i,d=!1;for(let t=0;t<l;++t){const n=a[t];if(p+=(p.length?".":"")+n,!0===r){if(p in e)break}else if(!1===r&&e&&!d)if(p in e)d=!0;else if(!o[p])break;t<h&&(f=f[n]||(f[n]={}))}}this._doc=i},
/*!
 * Converts to POJO when you use the document for querying
 */
D.prototype.toBSON=function(){return this.toObject(O)},D.prototype.init=function(t,e,n){return"function"==typeof e&&(n=e,e=null),this.$__init(t,e),n&&n(null,this),this},
/*!
 * ignore
 */
D.prototype.$__init=function(t,e){if(this.isNew=!1,this.$init=!0,null!==t._id&&void 0!==t._id&&e&&e.populated&&e.populated.length){const n=String(t._id);for(let r=0;r<e.populated.length;++r){const o=e.populated[r];o.isVirtual?this.populated(o.path,A.getValue(o.path,t),o):this.populated(o.path,o._docs[n],o)}}
/*!
 * Init helper.
 *
 * @param {Object} self document instance
 * @param {Object} obj raw mongodb doc
 * @param {Object} doc object we are initializing
 * @api private
 */
return function t(e,n,r,o){o=o||"";const i=Object.keys(n);const s=i.length;let u;let c;let a;let h=0;for(;h<s;)p(h++);function p(s){if(a=i[s],c=o+a,u=e.schema.path(c),!e.schema.$isRootDiscriminator||e.isSelected(c))if(u||!A.isObject(n[a])||n[a].constructor&&"Object"!==A.getFunctionName(n[a].constructor))if(u){if(null===n[a])r[a]=null;else if(void 0!==n[a]){const t=n[a].$__||{},o=t.wasPopulated||null;if(u&&!o)try{r[a]=u.cast(n[a],e,!0)}catch(t){e.invalidate(t.path,new l({path:t.path,message:t.message,type:"cast",value:t.value}))}else r[a]=n[a]}e.isModified(c)||e.$__.activePaths.init(c)}else r[a]=n[a];else r[a]||(r[a]={}),t(e,n[a],r[a],c+".")}}(this,t,this._doc),this.emit("init",this),this.constructor.emit("init",this),this.$__._id=this._id,this},D.prototype.update=function(){const t=A.args(arguments);return t.unshift({_id:this._id}),this.constructor.update.apply(this.constructor,t)},D.prototype.updateOne=function(t,e,n){const r=this.constructor.updateOne({_id:this._id},t,e);return r._pre(t=>{this.constructor._middleware.execPre("updateOne",this,[],t)}),r._post(t=>{this.constructor._middleware.execPost("updateOne",this,[],{},t)}),null!=n?r.exec(n):r},D.prototype.replaceOne=function(){const t=A.args(arguments);return t.unshift({_id:this._id}),this.constructor.replaceOne.apply(this.constructor,t)},D.prototype.$session=function(t){if(0===arguments.length)return this.$__.session;if(this.$__.session=t,!this.ownerDocument){const e=this.$__getAllSubdocs();for(const n of e)n.$session(t)}return t},D.prototype.$set=function(t,e,n,r){n&&"Object"===A.getFunctionName(n.constructor)&&(r=n,n=void 0);const o=(r=r||{}).merge,c=n&&!0!==n,l=!0===n;let h,f,d,m,g,_=0;const v="strict"in r?r.strict:this.$__.strictMode;if(c&&((h=this.$__.adhocPaths||(this.$__.adhocPaths={}))[t]=this.schema.interpretAsType(t,n,this.schema.options)),"string"!=typeof t){if(null!=t){g=e?e+".":"",t instanceof D&&(t=t.$__isNested?t.toObject():t._doc);const n=(f=Object.keys(t)).length;if(0===n&&!this.schema.options.minimize)return e&&this.$set(e,{}),this;for(;_<n;)w.call(this,_++);return this}{const n=t;t=e,e=n}}function w(e){m=f[e];const r=g+m;if(d=this.schema.pathType(r),!0!==n||g||null==t[m]||"nested"!==d||null==this._doc[m]||0!==Object.keys(this._doc[m]).length||delete this._doc[m],null===t[m]||void 0===t[m]||!A.isObject(t[m])||t[m].constructor&&"Object"!==A.getFunctionName(t[m].constructor)||"virtual"===d||"real"===d||this.$__path(r)instanceof s||this.schema.paths[r]&&this.schema.paths[r].options&&this.schema.paths[r].options.ref)if(v){if(l&&void 0===t[m]&&void 0!==this.get(m))return;if("adhocOrUndefined"===d&&(d=y(this,r,{typeOnly:!0})),"real"===d||"virtual"===d){let e=t[m];this.schema.paths[r]&&this.schema.paths[r].$isSingleNested&&t[m]instanceof D&&(e=e.toObject({virtuals:!1,transform:!1})),this.$set(g+m,e,l)}else if("nested"===d&&t[m]instanceof D)this.$set(g+m,t[m].toObject({transform:!1}),l);else if("throw"===v)throw"nested"===d?new u(m,t[m]):new a(m)}else void 0!==t[m]&&this.$set(g+m,t[m],l);else this.$set(t[m],g+m,l)}const b=this.schema.pathType(t);if("nested"===b&&e){if(A.isObject(e)&&(!e.constructor||"Object"===A.getFunctionName(e.constructor))){if(o)return this.$set(e,t,l);this.setValue(t,null),p(this,t);const n=Object.keys(e);this.setValue(t,{});for(const r of n)this.$set(t+"."+r,e[r],l);return this.markModified(t),p(this,t,{skipDocArrays:!0}),this}return this.invalidate(t,new i.CastError("Object",e,t)),this}let O;const C=t.split(".");if("adhocOrUndefined"===b&&v){let n;for(_=0;_<C.length;++_){const r=C.slice(0,_+1).join(".");if(_+1<C.length&&"virtual"===this.schema.pathType(r))return S.set(t,e,this),this;if(null!=(O=this.schema.path(r))&&O instanceof s){n=!0;break}}if(null==O&&(O=y(this,t)),!n&&!O){if("throw"===v)throw new a(t);return this}}else{if("virtual"===b)return(O=this.schema.virtualpath(t)).applySetters(e,this),this;O=this.$__path(t)}let T,E=this._doc,N="";for(_=0;_<C.length-1;++_)E=E[C[_]],N+=(N.length>0?".":"")+C[_],E||(this.$set(N,{}),this.isSelected(N)||this.unmarkModified(N),E=this.getValue(N));if(C.length<=1)T=t;else{for(_=0;_<C.length;++_){const t=C.slice(0,_+1).join(".");if(null===this.get(t)){T=t;break}}T||(T=t)}const $=(()=>null!=this.$__.$options.priorDoc?this.$__.$options.priorDoc.getValue(t):l?void 0:this.getValue(t))();if(!O)return this.$__set(T,t,l,C,O,e,$),this;let I=!0;try{const n=(()=>{if(null==O.options)return!1;if(!(e instanceof D))return!1;const t=e.constructor,n=O.options.ref;if(null!=n&&(n===t.modelName||n===t.baseModelName))return!0;const r=O.options.refPath;if(null==r)return!1;const o=e.get(r);return o===t.modelName||o===t.baseModelName})();let r,o=!1;if(n&&e instanceof D&&(this.ownerDocument?this.ownerDocument().populated(this.$__fullPath(t),e._id,{model:e.constructor}):this.populated(t,e._id,{model:e.constructor}),o=!0),O.options&&Array.isArray(O.options[this.schema.options.typeKey])&&O.options[this.schema.options.typeKey].length&&O.options[this.schema.options.typeKey][0].ref&&Array.isArray(e)&&e.length>0&&e[0]instanceof D&&e[0].constructor.modelName&&(O.options[this.schema.options.typeKey][0].ref===e[0].constructor.baseModelName||O.options[this.schema.options.typeKey][0].ref===e[0].constructor.modelName)&&(this.ownerDocument?(r={model:e[0].constructor},this.ownerDocument().populated(this.$__fullPath(t),e.map(function(t){return t._id}),r)):(r={model:e[0].constructor},this.populated(t,e.map(function(t){return t._id}),r)),o=!0),null==this.schema.singleNestedPaths[t]){const t=l&&this.$__.$options.priorDoc?this.$__.$options.priorDoc:this;e=O.applySetters(e,t,!1,$)}!o&&this.$__.populated&&delete this.$__.populated[t],this.$markValid(t)}catch(n){this.invalidate(t,new i.CastError(O.instance,e,t,n)),I=!1}return I&&this.$__set(T,t,l,C,O,e,$),O.$isSingleNested&&(this.isDirectModified(t)||null==e)&&p(this,t),this},D.prototype.set=D.prototype.$set,D.prototype.$__shouldModify=function(t,e,n,r,o,i,s){return!!this.isNew||null==this.schema.singleNestedPaths[e]&&(void 0===i&&!this.isSelected(e)||!(void 0===i&&e in this.$__.activePaths.states.default)&&(!(this.populated(e)&&i instanceof D&&E(i._id,s))&&(!E(i,s||this.get(e))||!!(!n&&null!=i&&e in this.$__.activePaths.states.default&&E(i,o.getDefault(this,n))))))},D.prototype.$__set=function(t,e,r,o,i,s,u){P=P||n(59);const c=this.$__shouldModify(t,e,r,o,i,s,u),a=this;c&&(this.markModified(t),R||(R=n(119)),s&&s.isMongooseArray&&(s._registerAtomic("$set",s),s.isMongooseDocumentArray&&s.forEach(function(t){t&&t.__parentArray&&(t.__parentArray=s)}),this.$__.activePaths.forEach(function(t){0===t.indexOf(e+".")&&a.$__.activePaths.ignore(t)})));let l=this._doc,h=0;const p=o.length;let f="";for(;h<p;h++){const t=h+1===p;if(f+=f?"."+o[h]:o[h],j.has(o[h]))return;t?l instanceof Map?l.set(o[h],s):l[o[h]]=s:l[o[h]]&&"Object"===A.getFunctionName(l[o[h]].constructor)?l=l[o[h]]:l[o[h]]&&l[o[h]]instanceof P?l=l[o[h]]:l[o[h]]&&l[o[h]].$isSingleNested?l=l[o[h]]:l[o[h]]&&Array.isArray(l[o[h]])?l=l[o[h]]:(l[o[h]]=l[o[h]]||{},l=l[o[h]])}},D.prototype.getValue=function(t){return A.getValue(t,this._doc)},D.prototype.setValue=function(t,e){return A.setValue(t,e,this._doc),this},D.prototype.get=function(t,e,n){let r;n=n||{},e&&(r=this.schema.interpretAsType(t,e,this.schema.options));const o=this.$__path(t)||this.schema.virtualpath(t),i=t.split(".");let s=this._doc;if(o instanceof h){if(0===o.getters.length)return;return o.applyGetters(null,this)}for(let t=0,e=i.length;t<e;t++)s&&s._doc&&(s=s._doc),s=null==s?void 0:s instanceof Map?s.get(i[t]):t===e-1?A.getValue(i[t],s):s[i[t]];if(r&&(s=r.cast(s)),null!=o)s=o.applyGetters(s,this);else if(this.schema.nested[t]&&n.virtuals)return F(this,A.clone(s),"virtuals",{path:t});return s},
/*!
 * ignore
 */
D.prototype[I]=D.prototype.get,D.prototype.$__path=function(t){const e=this.$__.adhocPaths,n=e&&e.hasOwnProperty(t)?e[t]:null;return n||this.schema.path(t)},D.prototype.markModified=function(t,e){this.$__.activePaths.modify(t),null==e||this.ownerDocument||(this.$__.pathsToScopes[t]=e)},D.prototype.unmarkModified=function(t){this.$__.activePaths.init(t),delete this.$__.pathsToScopes[t]},D.prototype.$ignore=function(t){this.$__.activePaths.ignore(t)},D.prototype.modifiedPaths=function(t){t=t||{};const e=Object.keys(this.$__.activePaths.states.modify),n=this;return e.reduce(function(e,r){const o=r.split(".");if(e=e.concat(o.reduce(function(t,e,n){return t.concat(o.slice(0,n).concat(e).join("."))},[]).filter(function(t){return-1===e.indexOf(t)})),!t.includeChildren)return e;let i=n.get(r);if(null!=i&&"object"==typeof i)if(i._doc&&(i=i._doc),Array.isArray(i)){const t=i.length;for(let n=0;n<t;++n)if(-1===e.indexOf(r+"."+n)&&(e.push(r+"."+n),null!=i[n]&&i[n].$__)){const t=i[n].modifiedPaths();for(const o of t)e.push(r+"."+n+"."+o)}}else Object.keys(i).filter(function(t){return-1===e.indexOf(r+"."+t)}).forEach(function(t){e.push(r+"."+t)});return e},[])},D.prototype.isModified=function(t,e){if(t){Array.isArray(t)||(t=t.split(" "));const n=e||this.modifiedPaths(),r=Object.keys(this.$__.activePaths.states.modify);return t.some(function(t){return!!~n.indexOf(t)})||t.some(function(t){return r.some(function(e){return e===t||0===t.indexOf(e+".")})})}return this.$__.activePaths.some("modify")},D.prototype.$isDefault=function(t){return t in this.$__.activePaths.states.default},D.prototype.$isDeleted=function(t){return 0===arguments.length?!!this.$__.isDeleted:(this.$__.isDeleted=!!t,this)},D.prototype.isDirectModified=function(t){return t in this.$__.activePaths.states.modify},D.prototype.isInit=function(t){return t in this.$__.activePaths.states.init},D.prototype.isSelected=function(t){if(this.$__.selected){if("_id"===t)return 0!==this.$__.selected._id;const e=Object.keys(this.$__.selected);let n,r=e.length,o=null;if(1===r&&"_id"===e[0])return 0===this.$__.selected._id;for(;r--;)if("_id"!==(n=e[r])&&v(this.$__.selected[n])){o=!!this.$__.selected[n];break}if(null===o)return!0;if(t in this.$__.selected)return o;r=e.length;const i=t+".";for(;r--;)if("_id"!==(n=e[r])){if(0===n.indexOf(i))return o||n!==i;if(0===i.indexOf(n+"."))return o}return!o}return!0},D.prototype.isDirectSelected=function(t){if(this.$__.selected){if("_id"===t)return 0!==this.$__.selected._id;const e=Object.keys(this.$__.selected);let n,r=e.length,o=null;if(1===r&&"_id"===e[0])return 0===this.$__.selected._id;for(;r--;)if("_id"!==(n=e[r])&&v(this.$__.selected[n])){o=!!this.$__.selected[n];break}return null===o||(t in this.$__.selected?o:!o)}return!0},D.prototype.validate=function(t,e){return"function"==typeof t&&(e=t,t=null),A.promiseOrCallback(e,t=>this.$__validate(function(e){t(e)}),this.constructor.events)},D.prototype.$__validate=function(t){const e=this,n=()=>{const t=this.$__.validationError;if(this.$__.validationError=void 0,this.$__.cachedRequired={},this.emit("validate",e),this.constructor.emit("validate",e),t){for(const e in t.errors)!this[$]&&t.errors[e]instanceof i.CastError&&this.invalidate(e,t.errors[e]);return t}},r=L(this),o=r[0],s=r[1];if(0===o.length)return process.nextTick(function(){const r=n();if(r)return e.schema.s.hooks.execPost("validate:error",e,[e],{error:r},function(e){t(e)});t(null,e)});const u={};let c=0;const a=function(){const r=n();if(r)return e.schema.s.hooks.execPost("validate:error",e,[e],{error:r},function(e){t(e)});t(null,e)},l=function(t){null==t||u[t]||(u[t]=!0,c++,process.nextTick(function(){const n=e.schema.path(t);if(!n)return--c||a();if(!e.$isValid(t))return void(--c||a());const r=e.getValue(t),o=t in e.$__.pathsToScopes?e.$__.pathsToScopes[t]:e;n.doValidate(r,function(r){if(r&&(!n.$isMongooseDocumentArray||r.$isArrayValidatorError)){if(n.$isSingleNested&&"ValidationError"===r.name&&!1===n.schema.options.storeSubdocValidationError)return--c||a();e.invalidate(t,r,void 0,!0)}--c||a()},o,{skipSchemaValidators:s[t]})}))},h=o.length;for(let t=0;t<h;++t)l(o[t])},D.prototype.validateSync=function(t){const e=this;"string"==typeof t&&(t=t.split(" "));const n=L(this);let r=n[0];const o=n[1];if(t&&t.length){const e=[];for(let n=0;n<r.length;++n)-1!==t.indexOf(r[n])&&e.push(r[n]);r=e}const s={};r.forEach(function(t){if(s[t])return;s[t]=!0;const n=e.schema.path(t);if(!n)return;if(!e.$isValid(t))return;const r=e.getValue(t),i=n.doValidateSync(r,e,{skipSchemaValidators:o[t]});if(i&&(!n.$isMongooseDocumentArray||i.$isArrayValidatorError)){if(n.$isSingleNested&&"ValidationError"===i.name&&!1===n.schema.options.storeSubdocValidationError)return;e.invalidate(t,i,void 0,!0)}});const u=e.$__.validationError;if(e.$__.validationError=void 0,e.emit("validate",e),e.constructor.emit("validate",e),u)for(const t in u.errors)u.errors[t]instanceof i.CastError&&e.invalidate(t,u.errors[t]);return u},D.prototype.invalidate=function(t,e,n,r){if(this.$__.validationError||(this.$__.validationError=new C(this)),!this.$__.validationError.errors[t])return e&&"string"!=typeof e||(e=new l({path:t,message:e,type:r||"user defined",value:n})),this.$__.validationError===e?this.$__.validationError:(this.$__.validationError.addError(t,e),this.$__.validationError)},D.prototype.$markValid=function(t){this.$__.validationError&&this.$__.validationError.errors[t]&&(delete this.$__.validationError.errors[t],0===Object.keys(this.$__.validationError.errors).length&&(this.$__.validationError=null))},D.prototype.$isValid=function(t){return!this.$__.validationError||!this.$__.validationError.errors[t]},D.prototype.$__reset=function(){let t=this;return M||(M=n(40)),this.$__.activePaths.map("init","modify",function(e){return t.getValue(e)}).filter(function(t){return t&&t instanceof Array&&t.isMongooseDocumentArray&&t.length}).forEach(function(e){let n=e.length;for(;n--;){const t=e[n];t&&t.$__reset()}t.$__.activePaths.init(e._path),e._atomics={}}),this.$__.activePaths.map("init","modify",function(e){return t.getValue(e)}).filter(function(t){return t&&t.$isSingleNested}).forEach(function(e){e.$__reset(),t.$__.activePaths.init(e.$basePath)}),this.$__dirty().forEach(function(t){const e=t.value;e&&e._atomics&&(e._atomics={})}),this.$__.activePaths.clear("modify"),this.$__.activePaths.clear("default"),this.$__.validationError=void 0,this.errors=void 0,t=this,this.schema.requiredPaths().forEach(function(e){t.$__.activePaths.require(e)}),this},D.prototype.$__dirty=function(){const t=this;let e=this.$__.activePaths.map("modify",function(e){return{path:e,value:t.getValue(e),schema:t.$__path(e)}});(e=e.concat(this.$__.activePaths.map("default",function(e){if("_id"!==e&&null!=t.getValue(e))return{path:e,value:t.getValue(e),schema:t.$__path(e)}}))).sort(function(t,e){return t.path<e.path?-1:t.path>e.path?1:0});const n=[];let r,o;return e.forEach(function(t){t&&(0!==t.path.indexOf(r)?(r=t.path+".",n.push(t),o=t):o.value&&o.value._atomics&&o.value.hasAtomics()&&(o.value._atomics={},o.value._atomics.$set=o.value))}),o=r=null,n},D.prototype.$__setSchema=function(t){t.plugin(_,{deduplicate:!0}),f(t.tree,this,void 0,t.options);for(const e of Object.keys(t.virtuals))t.virtuals[e]._applyDefaultGetters();this.schema=t},D.prototype.$__getArrayPathsToValidate=function(){return M||(M=n(40)),this.$__.activePaths.map("init","modify",function(t){return this.getValue(t)}.bind(this)).filter(function(t){return t&&t instanceof Array&&t.isMongooseDocumentArray&&t.length}).reduce(function(t,e){return t.concat(e)},[]).filter(function(t){return t})},D.prototype.$__getAllSubdocs=function(){M||(M=n(40)),P=P||n(59);const t=this;return Object.keys(this._doc).reduce(function(e,n){return function t(e,n,r){const o=r?e[r]:e;return o instanceof P?n.push(o):o instanceof Map?n=Array.from(o.keys()).reduce(function(e,n){return t(o.get(n),e,null)},n):o&&o.$isSingleNested?(n=Object.keys(o._doc).reduce(function(e,n){return t(o._doc,e,n)},n)).push(o):o&&o.isMongooseDocumentArray?o.forEach(function(e){e&&e._doc&&(e instanceof P&&n.push(e),n=Object.keys(e._doc).reduce(function(n,r){return t(e._doc,n,r)},n))}):o instanceof D&&o.$__isNested&&o&&(n=Object.keys(o).reduce(function(e,n){return t(o,e,n)},n)),n}(t,e,n)},[])},D.prototype.$__handleReject=function(t){this.listeners("error").length?this.emit("error",t):this.constructor.listeners&&this.constructor.listeners("error").length?this.constructor.emit("error",t):this.listeners&&this.listeners("error").length&&this.emit("error",t)},D.prototype.$toObject=function(t,e){let n={transform:!0,flattenDecimals:!0};const r=e?"toJSON":"toObject",o=g(this,"constructor.base.options."+r,{}),i=g(this,"schema.options",{});let s;n=A.options(n,T(o)),n=A.options(n,T(i[r]||{})),"flattenMaps"in(t=t&&"Object"===A.getFunctionName(t.constructor)?T(t):{})||(t.flattenMaps=n.flattenMaps),s=null!=t.minimize?t.minimize:null!=n.minimize?n.minimize:i.minimize;const u=Object.assign(A.clone(t),{_isNested:!0,json:e,minimize:s});if((t.depopulate||g(t,"_parentOptions.depopulate",!1))&&t._isNested&&this.$__.wasPopulated)return T(this._id,u);(t=A.options(n,t))._isNested=!0,t.json=e,t.minimize=s,u._parentOptions=t;const c=t.transform;let a=T(this._doc,u)||{};t.getters&&(F(this,a,"paths",u),t.minimize&&(a=
/*!
 * Minimizes an object, removing undefined values and empty objects
 *
 * @param {Object} object to minimize
 * @return {Object}
 */
function t(e){const n=Object.keys(e);let r=n.length;let o;let i;let s;for(;r--;)i=n[r],s=e[i],A.isObject(s)&&!Buffer.isBuffer(s)&&(e[i]=t(s)),void 0!==e[i]?o=!0:delete e[i];return o?e:void 0}(a)||{})),(t.virtuals||t.getters&&!1!==t.virtuals)&&F(this,a,"virtuals",u),!1===t.versionKey&&this.schema.options.versionKey&&delete a[this.schema.options.versionKey];let l=t.transform;if(!0===l||i.toObject&&l){const e=t.json?i.toJSON:i.toObject;e&&(l="function"==typeof t.transform?t.transform:e.transform)}else t.transform=c;if("function"==typeof l){const e=l(this,a,t);void 0!==e&&(a=e)}return a},D.prototype.toObject=function(t){return this.$toObject(t)},D.prototype.toJSON=function(t){return this.$toObject(t,!0)},D.prototype.inspect=function(t){let e;return t&&"Object"===A.getFunctionName(t.constructor)&&((e=t).minimize=!1),this.toObject(e)},b.custom&&(
/*!
  * Avoid Node deprecation warning DEP0079
  */
D.prototype[b.custom]=D.prototype.inspect),D.prototype.toString=function(){return b(this.inspect())},D.prototype.equals=function(t){if(!t)return!1;const e=this.get("_id"),n=t.get?t.get("_id"):t;return e||n?e&&e.equals?e.equals(n):e===n:E(this,t)},D.prototype.populate=function(){if(0===arguments.length)return this;const t=this.$__.populate||(this.$__.populate={}),e=A.args(arguments);let n;if("function"==typeof e[e.length-1]&&(n=e.pop()),e.length){const n=A.populate.apply(null,e);for(let e=0;e<n.length;++e)t[n[e].path]=n[e]}if(n){const e=A.object.vals(t);this.$__.populate=void 0;let r=this.constructor;if(this.$__isNested){r=this.$__.scope.constructor;const t=this.$__.nestedPath;e.forEach(function(e){e.path=t+"."+e.path})}if(null!=this.$session()){const t=this.$session();e.forEach(e=>{null!=e.options?"session"in e.options||(e.options.session=t):e.options={session:t}})}r.populate(this,e,n)}return this},D.prototype.execPopulate=function(t){return A.promiseOrCallback(t,t=>{this.populate(t)},this.constructor.events)},D.prototype.populated=function(t,e,n){if(null==e){if(!this.$__.populated)return;const e=this.$__.populated[t];return e?e.value:void 0}if(!0===e){if(!this.$__.populated)return;return this.$__.populated[t]}return this.$__.populated||(this.$__.populated={}),this.$__.populated[t]={value:e,options:n},e},D.prototype.depopulate=function(t){let e;"string"==typeof t&&(t=t.split(" "));const n=this.$$populatedVirtuals?Object.keys(this.$$populatedVirtuals):[],r=g(this,"$__.populated",{});if(0===arguments.length){for(let t=0;t<n.length;t++)delete this.$$populatedVirtuals[n[t]],delete this._doc[n[t]],delete r[n[t]];const t=Object.keys(r);for(let n=0;n<t.length;n++)(e=this.populated(t[n]))&&(delete r[t[n]],this.$set(t[n],e));return this}for(let o=0;o<t.length;o++)e=this.populated(t[o]),delete r[t[o]],-1!==n.indexOf(t[o])?(delete this.$$populatedVirtuals[t[o]],delete this._doc[t[o]]):this.$set(t[o],e);return this},D.prototype.$__fullPath=function(t){return t||""},
/*!
 * Module exports.
 */
D.ValidationError=C,t.exports=D},,function(t,e,n){"use strict";var r=(0,n(20).retrieveBSON)().Long;const o=n(4).MongoError,i=n(14).Buffer;var s=0,u=n(32).opcodes,c=function(t,e,n,r){if(null==e)throw new Error("ns must be specified for query");if(null==n)throw new Error("query must be specified for query");if(-1!==e.indexOf("\0"))throw new Error("namespace cannot contain a null character");this.bson=t,this.ns=e,this.query=n,this.options=r||{},this.numberToSkip=r.numberToSkip||0,this.numberToReturn=r.numberToReturn||0,this.returnFieldSelector=r.returnFieldSelector||null,this.requestId=c.getRequestId(),this.pre32Limit=r.pre32Limit,this.serializeFunctions="boolean"==typeof r.serializeFunctions&&r.serializeFunctions,this.ignoreUndefined="boolean"==typeof r.ignoreUndefined&&r.ignoreUndefined,this.maxBsonSize=r.maxBsonSize||16777216,this.checkKeys="boolean"!=typeof r.checkKeys||r.checkKeys,this.batchSize=this.numberToReturn,this.tailable=!1,this.slaveOk="boolean"==typeof r.slaveOk&&r.slaveOk,this.oplogReplay=!1,this.noCursorTimeout=!1,this.awaitData=!1,this.exhaust=!1,this.partial=!1};c.prototype.incRequestId=function(){this.requestId=s++},c.nextRequestId=function(){return s+1},c.prototype.toBin=function(){var t=[],e=null,n=0;this.tailable&&(n|=2),this.slaveOk&&(n|=4),this.oplogReplay&&(n|=8),this.noCursorTimeout&&(n|=16),this.awaitData&&(n|=32),this.exhaust&&(n|=64),this.partial&&(n|=128),this.batchSize!==this.numberToReturn&&(this.numberToReturn=this.batchSize);var r=i.alloc(20+i.byteLength(this.ns)+1+4+4);t.push(r);var o=this.bson.serialize(this.query,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});t.push(o),this.returnFieldSelector&&Object.keys(this.returnFieldSelector).length>0&&(e=this.bson.serialize(this.returnFieldSelector,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined}),t.push(e));var s=r.length+o.length+(e?e.length:0),c=4;return r[3]=s>>24&255,r[2]=s>>16&255,r[1]=s>>8&255,r[0]=255&s,r[c+3]=this.requestId>>24&255,r[c+2]=this.requestId>>16&255,r[c+1]=this.requestId>>8&255,r[c]=255&this.requestId,r[(c+=4)+3]=0,r[c+2]=0,r[c+1]=0,r[c]=0,r[(c+=4)+3]=u.OP_QUERY>>24&255,r[c+2]=u.OP_QUERY>>16&255,r[c+1]=u.OP_QUERY>>8&255,r[c]=255&u.OP_QUERY,r[(c+=4)+3]=n>>24&255,r[c+2]=n>>16&255,r[c+1]=n>>8&255,r[c]=255&n,c=(c+=4)+r.write(this.ns,c,"utf8")+1,r[c-1]=0,r[c+3]=this.numberToSkip>>24&255,r[c+2]=this.numberToSkip>>16&255,r[c+1]=this.numberToSkip>>8&255,r[c]=255&this.numberToSkip,r[(c+=4)+3]=this.numberToReturn>>24&255,r[c+2]=this.numberToReturn>>16&255,r[c+1]=this.numberToReturn>>8&255,r[c]=255&this.numberToReturn,c+=4,t},c.getRequestId=function(){return++s};var a=function(t,e,n,r){r=r||{},this.numberToReturn=r.numberToReturn||0,this.requestId=s++,this.bson=t,this.ns=e,this.cursorId=n};a.prototype.toBin=function(){var t=4+i.byteLength(this.ns)+1+4+8+16,e=0,n=i.alloc(t);return n[e+3]=t>>24&255,n[e+2]=t>>16&255,n[e+1]=t>>8&255,n[e]=255&t,n[(e+=4)+3]=this.requestId>>24&255,n[e+2]=this.requestId>>16&255,n[e+1]=this.requestId>>8&255,n[e]=255&this.requestId,n[(e+=4)+3]=0,n[e+2]=0,n[e+1]=0,n[e]=0,n[(e+=4)+3]=u.OP_GETMORE>>24&255,n[e+2]=u.OP_GETMORE>>16&255,n[e+1]=u.OP_GETMORE>>8&255,n[e]=255&u.OP_GETMORE,n[(e+=4)+3]=0,n[e+2]=0,n[e+1]=0,n[e]=0,e=(e+=4)+n.write(this.ns,e,"utf8")+1,n[e-1]=0,n[e+3]=this.numberToReturn>>24&255,n[e+2]=this.numberToReturn>>16&255,n[e+1]=this.numberToReturn>>8&255,n[e]=255&this.numberToReturn,n[(e+=4)+3]=this.cursorId.getLowBits()>>24&255,n[e+2]=this.cursorId.getLowBits()>>16&255,n[e+1]=this.cursorId.getLowBits()>>8&255,n[e]=255&this.cursorId.getLowBits(),n[(e+=4)+3]=this.cursorId.getHighBits()>>24&255,n[e+2]=this.cursorId.getHighBits()>>16&255,n[e+1]=this.cursorId.getHighBits()>>8&255,n[e]=255&this.cursorId.getHighBits(),e+=4,n};var l=function(t,e,n){this.ns=e,this.requestId=s++,this.cursorIds=n};l.prototype.toBin=function(){var t=24+8*this.cursorIds.length,e=0,n=i.alloc(t);n[e+3]=t>>24&255,n[e+2]=t>>16&255,n[e+1]=t>>8&255,n[e]=255&t,n[(e+=4)+3]=this.requestId>>24&255,n[e+2]=this.requestId>>16&255,n[e+1]=this.requestId>>8&255,n[e]=255&this.requestId,n[(e+=4)+3]=0,n[e+2]=0,n[e+1]=0,n[e]=0,n[(e+=4)+3]=u.OP_KILL_CURSORS>>24&255,n[e+2]=u.OP_KILL_CURSORS>>16&255,n[e+1]=u.OP_KILL_CURSORS>>8&255,n[e]=255&u.OP_KILL_CURSORS,n[(e+=4)+3]=0,n[e+2]=0,n[e+1]=0,n[e]=0,n[(e+=4)+3]=this.cursorIds.length>>24&255,n[e+2]=this.cursorIds.length>>16&255,n[e+1]=this.cursorIds.length>>8&255,n[e]=255&this.cursorIds.length,e+=4;for(var r=0;r<this.cursorIds.length;r++)n[e+3]=this.cursorIds[r].getLowBits()>>24&255,n[e+2]=this.cursorIds[r].getLowBits()>>16&255,n[e+1]=this.cursorIds[r].getLowBits()>>8&255,n[e]=255&this.cursorIds[r].getLowBits(),n[(e+=4)+3]=this.cursorIds[r].getHighBits()>>24&255,n[e+2]=this.cursorIds[r].getHighBits()>>16&255,n[e+1]=this.cursorIds[r].getHighBits()>>8&255,n[e]=255&this.cursorIds[r].getHighBits(),e+=4;return n};var h=function(t,e,n,o,i){i=i||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1},this.parsed=!1,this.raw=e,this.data=o,this.bson=t,this.opts=i,this.length=n.length,this.requestId=n.requestId,this.responseTo=n.responseTo,this.opCode=n.opCode,this.fromCompressed=n.fromCompressed,this.responseFlags=o.readInt32LE(0),this.cursorId=new r(o.readInt32LE(4),o.readInt32LE(8)),this.startingFrom=o.readInt32LE(12),this.numberReturned=o.readInt32LE(16),this.documents=new Array(this.numberReturned),this.cursorNotFound=0!=(0&this.responseFlags),this.queryFailure=0!=(2&this.responseFlags),this.shardConfigStale=0!=(4&this.responseFlags),this.awaitCapable=0!=(8&this.responseFlags),this.promoteLongs="boolean"!=typeof i.promoteLongs||i.promoteLongs,this.promoteValues="boolean"!=typeof i.promoteValues||i.promoteValues,this.promoteBuffers="boolean"==typeof i.promoteBuffers&&i.promoteBuffers};h.prototype.isParsed=function(){return this.parsed},h.prototype.parse=function(t){if(!this.parsed){var e,n,i=(t=t||{}).raw||!1,s=t.documentsReturnedIn||null;if(n={promoteLongs:"boolean"==typeof t.promoteLongs?t.promoteLongs:this.opts.promoteLongs,promoteValues:"boolean"==typeof t.promoteValues?t.promoteValues:this.opts.promoteValues,promoteBuffers:"boolean"==typeof t.promoteBuffers?t.promoteBuffers:this.opts.promoteBuffers},this.index=20,1===this.numberReturned&&null!=s&&i){e=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24;var u=this.data.slice(this.index,this.index+e),c={};c[s]=!0,n.fieldsAsRaw=c;var a=this.bson.deserialize(u,n);if(a instanceof Error)throw a;if(a.errmsg)throw new o(a.errmsg);if(!a.cursor)throw new o("Cursor not found");return this.documents=a.cursor[s],this.numberReturned=this.documents.length,this.cursorId="number"==typeof a.cursor.id?r.fromNumber(a.cursor.id):a.cursor.id,this.index=this.index+e,void(this.parsed=!0)}for(var l=0;l<this.numberReturned;l++)e=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24,this.documents[l]=i?this.data.slice(this.index,this.index+e):this.bson.deserialize(this.data.slice(this.index,this.index+e),n),this.index=this.index+e;this.parsed=!0}},t.exports={Query:c,GetMore:a,Response:h,KillCursor:l}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(9),o=n(108),i=n(166),s=n(8),u=n(55),c=n(5),a=n(23).validatorErrorSymbol,l=r.CastError,h=r.ValidatorError;function p(t,e,n){this.path=t,this.instance=n,this.validators=[],this.getters=this.constructor.hasOwnProperty("getters")?this.constructor.getters.slice():[],this.setters=[],this.options=e,this._index=null,this.selected;for(const t in e)if(this[t]&&"function"==typeof this[t]){if("index"===t&&this._index)continue;const n=e[t];if("default"===t){this.default(n);continue}const r=Array.isArray(n)?n:[n];this[t].apply(this,r)}Object.defineProperty(this,"$$context",{enumerable:!1,configurable:!1,writable:!0,value:null})}
/*!
 * ignore
 */
function f(t){return this.castForQuery(t)}
/*!
 * ignore
 */function d(t){const e=this;return Array.isArray(t)?t.map(function(t){return e.castForQuery(t)}):[this.castForQuery(t)]}
/*!
 * Just like handleArray, except also allows `[]` because surprisingly
 * `$in: [1, []]` works fine
 */p.cast=function(t){return 0===arguments.length?this._cast:(!1===t&&(t=(t=>t)),this._cast=t,this._cast)},p.get=function(t){this.getters=this.hasOwnProperty("getters")?this.getters:[],this.getters.push(t)},p.prototype.default=function(t){return 1===arguments.length?void 0===t?void(this.defaultValue=void 0):(this.defaultValue=t,this.defaultValue):(arguments.length>1&&(this.defaultValue=c.args(arguments)),this.defaultValue)},p.prototype.index=function(t){return this._index=t,c.expires(this._index),this},p.prototype.unique=function(t){if(!1===this._index){if(!t)return;throw new Error('Path "'+this.path+'" may not have `index` set to false and `unique` set to true')}return null==this._index||!0===this._index?this._index={}:"string"==typeof this._index&&(this._index={type:this._index}),this._index.unique=t,this},p.prototype.text=function(t){return null===this._index||void 0===this._index||"boolean"==typeof this._index?this._index={}:"string"==typeof this._index&&(this._index={type:this._index}),this._index.text=t,this},p.prototype.sparse=function(t){return null===this._index||void 0===this._index||"boolean"==typeof this._index?this._index={}:"string"==typeof this._index&&(this._index={type:this._index}),this._index.sparse=t,this},p.prototype.set=function(t){if("function"!=typeof t)throw new TypeError("A setter must be a function.");return this.setters.push(t),this},p.prototype.get=function(t){if("function"!=typeof t)throw new TypeError("A getter must be a function.");return this.getters.push(t),this},p.prototype.validate=function(t,e,n){if("function"==typeof t||t&&"RegExp"===c.getFunctionName(t.constructor)){let o;return e instanceof Object&&!n?((o=c.clone(e)).message||(o.message=o.msg),o.validator=t,o.type=o.type||"user defined"):(e||(e=r.messages.general.default),n||(n="user defined"),o={message:e,type:n,validator:t}),this.validators.push(o),this}let o,i,s;for(o=0,i=arguments.length;o<i;o++){if(!(s=arguments[o])||"Object"!==c.getFunctionName(s.constructor)){throw new Error("Invalid validator. Received ("+typeof s+") "+s+". See http://mongoosejs.com/docs/api.html#schematype_SchemaType-validate")}this.validate(s.validator,s)}return this},p.prototype.required=function(t,e){let n={};if("object"==typeof t&&(e=(n=t).message||e,t=t.isRequired),!1===t)return this.validators=this.validators.filter(function(t){return t.validator!==this.requiredValidator},this),this.isRequired=!1,delete this.originalRequiredValue,this;const o=this;this.isRequired=!0,this.requiredValidator=function(e){const n=s(this,"$__.cachedRequired");if(null!=n&&!this.isSelected(o.path)&&!this.isModified(o.path))return!0;if(null!=n&&o.path in n){const t=!n[o.path]||o.checkRequired(e,this);return delete n[o.path],t}return"function"==typeof t&&!t.apply(this)||o.checkRequired(e,this)},this.originalRequiredValue=t,"string"==typeof t&&(e=t,t=void 0);const i=e||r.messages.general.required;return this.validators.unshift(Object.assign({},n,{validator:this.requiredValidator,message:i,type:"required"})),this},p.prototype.ref=function(t){return this.options.ref=t,this},p.prototype.getDefault=function(t,e){let n="function"==typeof this.defaultValue?this.defaultValue.call(t):this.defaultValue;if(null!=n){"object"!=typeof n||this.options&&this.options.shared||(n=c.clone(n));const r=this.cast(n,t,e);return r&&r.$isSingleNested&&(r.$parent=t),r}return n},
/*!
 * Applies setters without casting
 *
 * @api private
 */
p.prototype._applySetters=function(t,e,n,r){let o=t;const i=this.setters;let s=i.length;const u=this.caster;for(;s--;)o=i[s].call(e,o,this);if(Array.isArray(o)&&u&&u.setters){const t=[];for(let i=0;i<o.length;i++)t.push(u.applySetters(o[i],e,n,r));o=t}return o},p.prototype.applySetters=function(t,e,n,r,o){let i=this._applySetters(t,e,n,r,o);return null==i?i:i=this.cast(i,e,n,r,o)},p.prototype.applyGetters=function(t,e){let n=t;const r=this.getters,o=r.length;if(0===o)return n;for(let t=0;t<o;++t)n=r[t].call(e,n,this);return n},p.prototype.select=function(t){return this.selected=!!t,this},p.prototype.doValidate=function(t,e,n){let r=!1;const o=this.path;let i=this.validators.length;if(!i)return e(null);const s=function(t,n){if(!r)if(void 0===t||t)--i<=0&&u(function(){e(null)});else{const t=n.ErrorConstructor||h;(r=new t(n))[a]=!0,u(function(){e(r)})}},l=this;this.validators.forEach(function(e){if(r)return;const i=e.validator;let u;const a=c.clone(e);if(a.path=o,a.value=t,i instanceof RegExp)s(i.test(t),a);else if("function"==typeof i){if(void 0===t&&i!==l.requiredValidator)return void s(!0,a);if(a.isAsync)!
/*!
 * Handle async validators
 */
function(t,e,n,r,o){let i=!1;const s=t.call(e,n,function(t,e){i||(i=!0,e&&(r.message=e),o(t,r))});"boolean"==typeof s?(i=!0,o(s,r)):s&&"function"==typeof s.then&&s.then(function(t){i||(i=!0,o(t,r))},function(t){i||(i=!0,r.reason=t,o(!1,r))})}(i,n,t,a,s);else{try{u=a.propsParameter?i.call(n,t,a):i.call(n,t)}catch(t){u=!1,a.reason=t,t.message&&(a.message=t.message)}null!=u&&"function"==typeof u.then?u.then(function(t){s(t,a)},function(t){a.reason=t,s(u=!1,a)}):s(u,a)}}})},p.prototype.doValidateSync=function(t,e){let n=null;const r=this.path;if(!this.validators.length)return null;const o=function(t,e){if(!n&&void 0!==t&&!t){const t=e.ErrorConstructor||h;(n=new t(e))[a]=!0}};let i=this.validators;if(void 0===t){if(!(this.validators.length>0&&"required"===this.validators[0].type))return null;i=[this.validators[0]]}return i.forEach(function(i){if(n)return;const s=i.validator,u=c.clone(i);let a;if(u.path=r,u.value=t,!s.isAsync)if(s instanceof RegExp)o(s.test(t),u);else if("function"==typeof s){try{a=u.propsParameter?s.call(e,t,u):s.call(e,t)}catch(t){a=!1,u.reason=t}if(null!=a&&"function"==typeof a.then)return;o(a,u)}}),n},p._isRef=function(t,e,n,r){let o=r&&t.options&&(t.options.ref||t.options.refPath);if(!o&&n&&null!=n.$__){const e=n.$__fullPath(t.path);o=(n.ownerDocument?n.ownerDocument():n).populated(e)}if(o){if(null==e)return!0;if(!Buffer.isBuffer(e)&&"Binary"!==e._bsontype&&c.isObject(e))return!0}return!1},
/*!
 * ignore
 */
p.prototype.$conditionalHandlers={$all:d,$eq:f,$in:function(t){const e=this;return Array.isArray(t)?t.map(function(t){return Array.isArray(t)&&0===t.length?t:e.castForQuery(t)}):[this.castForQuery(t)]},$ne:f,$nin:d,$exists:o,$type:i},
/*!
 * Wraps `castForQuery` to handle context
 */
p.prototype.castForQueryWrapper=function(t){return this.$$context=t.context,"$conditional"in t?this.castForQuery(t.$conditional,t.val):t.$skipQueryCastForUpdate?this._castForQuery(t.val):this.castForQuery(t.val)},p.prototype.castForQuery=function(t,e){let n;if(2===arguments.length){if(!(n=this.$conditionalHandlers[t]))throw new Error("Can't use "+t);return n.call(this,e)}return e=t,this._castForQuery(e)},
/*!
 * Internal switch for runSetters
 *
 * @api private
 */
p.prototype._castForQuery=function(t){return this.applySetters(t,this.$$context)},p.checkRequired=function(t){return arguments.length>0&&(this._checkRequired=t),this._checkRequired},p.prototype.checkRequired=function(t){return null!=t},
/*!
 * Module exports.
 */
t.exports=e=p,e.CastError=l,e.ValidatorError=h},function(t,e,n){"use strict";var r=n(0).format,o=n(96),i=function(){throw new Error("Attempted to use Snappy compression, but Snappy is not installed. Install or disable Snappy compression and try again.")};e.setProperty=function(t,e,n,o){Object.defineProperty(t,e.name,{enumerable:!0,set:function(t){if("boolean"!=typeof t)throw new Error(r("%s required a boolean",e.name));!0===t&&(o.flags|=n),!1===t&&(o.flags&n)===n&&(o.flags^=n),e.value=t},get:function(){return e.value}})},e.getProperty=function(t,e,n,r,o){Object.defineProperty(t,e,{enumerable:!0,get:function(){return null==r[n]&&t.isParsed&&!t.isParsed()&&t.parse(),"function"==typeof o?o(r[n]):r[n]}})},e.getSingleProperty=function(t,e,n){Object.defineProperty(t,e,{enumerable:!0,get:function(){return n}})},e.copy=function(t,e){for(var n in e=e||{},t)e[n]=t[n];return e},e.debugOptions=function(t,e){var n={};return t.forEach(function(t){n[t]=e[t]}),n},e.retrieveBSON=function(){var t=n(143);t.native=!1;try{var e=o("bson-ext");if(e)return e.native=!0,e}catch(t){}return t},e.retrieveSnappy=function(){var t=null;try{t=o("snappy")}catch(t){}return t||(t={compress:i,uncompress:i,compressSync:i,uncompressSync:i}),t}},,,function(t,e,n){"use strict";e.validatorErrorSymbol=Symbol.for("mongoose:validatorError"),e.documentArrayParent=Symbol.for("mongoose:documentArrayParent"),e.modelSymbol=Symbol.for("mongoose#Model"),e.getSymbol=Symbol.for("mongoose#Document#get"),e.objectIdSymbol=Symbol.for("mongoose#ObjectId")},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(86),o=n(0);function i(t,e,n,i){let s=o.inspect(e);'"'!==(s=s.replace(/^'/,'"').replace(/'$/,'"')).charAt(0)&&(s='"'+s+'"'),r.call(this,"Cast to "+t+" failed for value "+s+' at path "'+n+'"'),this.name="CastError",Error.captureStackTrace?Error.captureStackTrace(this):this.stack=(new Error).stack,this.stringValue=s,this.kind=t,this.value=e,this.path=n,this.reason=i}
/*!
 * Inherits from MongooseError.
 */i.prototype=Object.create(r.prototype),i.prototype.constructor=r,
/*!
 * ignore
 */
i.prototype.setModel=function(t){this.model=t,this.message="Cast to "+this.kind+" failed for value "+this.stringValue+' at path "'+this.path+'" for model "'+t.modelName+'"'},
/*!
 * exports
 */
t.exports=i},,,function(t,e,n){"use strict";const r=n(11),o=n(96);const i=function(){throw new Error("The `mongodb-extjson` module was not found. Please install it and try again.")};t.exports={uuidV4:()=>{const t=r.randomBytes(16);return t[6]=15&t[6]|64,t[8]=63&t[8]|128,t},calculateDurationInMs:t=>{const e=process.hrtime(t);return(1e9*e[0]+e[1])/1e6},relayEvents:function(t,e,n){n.forEach(n=>t.on(n,t=>e.emit(n,t)))},collationNotSupported:function(t,e){return e&&e.collation&&t.ismaster&&t.ismaster.maxWireVersion<5},retrieveEJSON:function(){let t=null;try{t=o("mongodb-extjson")}catch(t){}return t||(t={parse:i,deserialize:i,serialize:i,stringify:i,setBSONModule:i,BSON:i}),t},retrieveKerberos:function(){let t;try{t=o("kerberos")}catch(t){if("MODULE_NOT_FOUND"===t.code)throw new Error("The `kerberos` module was not found. Please install it and try again.");throw t}return t}}},function(t,e,n){"use strict";const r=n(15).Transform,o=n(15).PassThrough,i=n(0).inherits,s=n(0).deprecate,u=n(1).handleCallback,c=n(2).ReadPreference,a=n(2).MongoError,l=n(15).Readable,h=n(2).Cursor,p=n(2).BSON.Map,f=n(1).executeOperation,d=n(54).count,m=n(54).each,g=n(54).hasNext,y=n(54).next,_=n(54).toArray,v=["tailable","oplogReplay","noCursorTimeout","awaitData","exhaust","partial"],w=["numberOfRetries","tailableRetryInterval"];function b(t,e,n,r,o,i){h.apply(this,Array.prototype.slice.call(arguments,0));const s=b.INIT,u=r.numberOfRetries||5,c=r.tailableRetryInterval||500,a=u,p=r.promiseLibrary||Promise;l.call(this,{objectMode:!0}),this.s={numberOfRetries:u,tailableRetryInterval:c,currentNumberOfRetries:a,state:s,streamOptions:{},bson:t,ns:e,cmd:n,options:r,topology:o,topologyOptions:i,promiseLibrary:p,currentDoc:null,explicitlyIgnoreSession:r.explicitlyIgnoreSession},!r.explicitlyIgnoreSession&&r.session&&(this.s.session=r.session),!0===this.s.options.noCursorTimeout&&this.addCursorFlag("noCursorTimeout",!0),this.sortValue=this.s.cmd.sort;const f=n.cursor&&n.cursor.batchSize?n.cursor&&n.cursor.batchSize:r.cursor&&r.cursor.batchSize?r.cursor.batchSize:1e3;this.setCursorBatchSize(f)}i(b,l),b.prototype._next=function(){return this._initImplicitSession&&this._initImplicitSession(),h.prototype.next.apply(this,arguments)};for(let t in h.prototype)b.prototype[t]=h.prototype[t];b.prototype._initImplicitSession=function(){this.s.explicitlyIgnoreSession||this.s.session||!this.s.topology.hasSessionSupport()||(this.s.session=this.s.topology.startSession({owner:this}),this.cursorState.session=this.s.session)},b.prototype._endSession=function(){h.prototype._endSession.apply(this,arguments)&&(this.s.session=void 0)},b.prototype.hasNext=function(t){return f(this.s.topology,g,[this,t],{skipSessions:!0})},b.prototype.next=function(t){return f(this.s.topology,y,[this,t],{skipSessions:!0})},b.prototype.filter=function(t){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.query=t,this},b.prototype.maxScan=s(function(t){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxScan=t,this},"Cursor.maxScan is deprecated, and will be removed in a later version"),b.prototype.hint=function(t){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.hint=t,this},b.prototype.min=function(t){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.min=t,this},b.prototype.max=function(t){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.max=t,this},b.prototype.returnKey=function(t){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.returnKey=t,this},b.prototype.showRecordId=function(t){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.showDiskLoc=t,this},b.prototype.snapshot=s(function(t){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.snapshot=t,this},"Cursor Snapshot is deprecated, and will be removed in a later version"),b.prototype.setCursorOption=function(t,e){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});if(-1===w.indexOf(t))throw a.create({message:`option ${t} is not a supported option ${w}`,driver:!0});return this.s[t]=e,"numberOfRetries"===t&&(this.s.currentNumberOfRetries=e),this},b.prototype.addCursorFlag=function(t,e){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});if(-1===v.indexOf(t))throw a.create({message:`flag ${t} is not a supported flag ${v}`,driver:!0});if("boolean"!=typeof e)throw a.create({message:`flag ${t} must be a boolean value`,driver:!0});return this.s.cmd[t]=e,this},b.prototype.addQueryModifier=function(t,e){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});if("$"!==t[0])throw a.create({message:`${t} is not a valid query modifier`,driver:!0});const n=t.substr(1);return this.s.cmd[n]=e,"orderby"===n&&(this.s.cmd.sort=this.s.cmd[n]),this},b.prototype.comment=function(t){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.comment=t,this},b.prototype.maxAwaitTimeMS=function(t){if("number"!=typeof t)throw a.create({message:"maxAwaitTimeMS must be a number",driver:!0});if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxAwaitTimeMS=t,this},b.prototype.maxTimeMS=function(t){if("number"!=typeof t)throw a.create({message:"maxTimeMS must be a number",driver:!0});if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxTimeMS=t,this},b.prototype.maxTimeMs=b.prototype.maxTimeMS,b.prototype.project=function(t){if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});return this.s.cmd.fields=t,this},b.prototype.sort=function(t,e){if(this.s.options.tailable)throw a.create({message:"Tailable cursor doesn't support sorting",driver:!0});if(this.s.state===b.CLOSED||this.s.state===b.OPEN||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});let n=t;return Array.isArray(n)&&Array.isArray(n[0])&&(n=new p(n.map(t=>{const e=[t[0],null];if("asc"===t[1])e[1]=1;else if("desc"===t[1])e[1]=-1;else{if(1!==t[1]&&-1!==t[1]&&!t[1].$meta)throw new a("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");e[1]=t[1]}return e}))),null!=e&&(n=[[t,e]]),this.s.cmd.sort=n,this.sortValue=n,this},b.prototype.batchSize=function(t){if(this.s.options.tailable)throw a.create({message:"Tailable cursor doesn't support batchSize",driver:!0});if(this.s.state===b.CLOSED||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});if("number"!=typeof t)throw a.create({message:"batchSize requires an integer",driver:!0});return this.s.cmd.batchSize=t,this.setCursorBatchSize(t),this},b.prototype.collation=function(t){return this.s.cmd.collation=t,this},b.prototype.limit=function(t){if(this.s.options.tailable)throw a.create({message:"Tailable cursor doesn't support limit",driver:!0});if(this.s.state===b.OPEN||this.s.state===b.CLOSED||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});if("number"!=typeof t)throw a.create({message:"limit requires an integer",driver:!0});return this.s.cmd.limit=t,this.setCursorLimit(t),this},b.prototype.skip=function(t){if(this.s.options.tailable)throw a.create({message:"Tailable cursor doesn't support skip",driver:!0});if(this.s.state===b.OPEN||this.s.state===b.CLOSED||this.isDead())throw a.create({message:"Cursor is closed",driver:!0});if("number"!=typeof t)throw a.create({message:"skip requires an integer",driver:!0});return this.s.cmd.skip=t,this.setCursorSkip(t),this},b.prototype.each=s(function(t){this.rewind(),this.s.state=b.INIT,m(this,t)},"Cursor.each is deprecated. Use Cursor.forEach instead."),b.prototype.forEach=function(t,e){if(this.rewind(),this.s.state=b.INIT,"function"!=typeof e)return new this.s.promiseLibrary((e,n)=>{m(this,(r,o)=>r?(n(r),!1):null==o?(e(null),!1):(t(o),!0))});m(this,(n,r)=>{if(n)return e(n),!1;if(null!=r)return t(r),!0;if(null==r&&e){const t=e;return e=null,t(null),!1}})},b.prototype.setReadPreference=function(t){if(this.s.state!==b.INIT)throw a.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(t instanceof c)this.s.options.readPreference=t;else{if("string"!=typeof t)throw new TypeError("Invalid read preference: "+t);this.s.options.readPreference=new c(t)}return this},b.prototype.toArray=function(t){if(this.s.options.tailable)throw a.create({message:"Tailable cursor cannot be converted to array",driver:!0});return f(this.s.topology,_,[this,t],{skipSessions:!0})},b.prototype.count=function(t,e,n){if(null==this.s.cmd.query)throw a.create({message:"count can only be used with find command",driver:!0});return"function"==typeof e&&(n=e,e={}),e=e||{},"function"==typeof t&&(n=t,t=!0),this.s.session&&(e=Object.assign({},e,{session:this.s.session})),f(this.s.topology,d,[this,t,e,n],{skipSessions:!!this.s.session})},b.prototype.close=function(t,e){"function"==typeof t&&(e=t,t={}),t=Object.assign({},{skipKillCursors:!1},t),this.s.state=b.CLOSED,t.skipKillCursors||this.kill();const n=()=>(this.emit("close"),"function"==typeof e?u(e,null,this):new this.s.promiseLibrary(t=>{t()}));return this.s.session?"function"==typeof e?this._endSession(()=>n()):new this.s.promiseLibrary(t=>{this._endSession(()=>n().then(t))}):n()},b.prototype.map=function(t){if(this.cursorState.transforms&&this.cursorState.transforms.doc){const e=this.cursorState.transforms.doc;this.cursorState.transforms.doc=(n=>t(e(n)))}else this.cursorState.transforms={doc:t};return this},b.prototype.isClosed=function(){return this.isDead()},b.prototype.destroy=function(t){t&&this.emit("error",t),this.pause(),this.close()},b.prototype.stream=function(t){return this.s.streamOptions=t||{},this},b.prototype.transformStream=function(t){const e=t||{};if("function"==typeof e.transform){const t=new r({objectMode:!0,transform:function(t,n,r){this.push(e.transform(t)),r()}});return this.pipe(t)}return this.pipe(new o({objectMode:!0}))},b.prototype.explain=function(t){return this.s.cmd.explain=!0,this.s.cmd.readConcern&&delete this.s.cmd.readConcern,f(this.s.topology,this._next.bind(this),[t],{skipSessions:!0})},b.prototype._read=function(){if(this.s.state===b.CLOSED||this.isDead())return this.push(null);this.next((t,e)=>t?(this.listeners("error")&&this.listeners("error").length>0&&this.emit("error",t),this.isDead()||this.close(),this.emit("end"),this.emit("finish")):"function"==typeof this.s.streamOptions.transform&&null!=e?this.push(this.s.streamOptions.transform(e)):this.cursorState.transforms&&"function"==typeof this.cursorState.transforms.doc&&null!=e?this.push(this.cursorState.transforms.doc(e)):(this.push(e),void(null===e&&this.isDead()&&this.once("end",()=>{this.close(),this.emit("finish")}))))},b.prototype.getLogger=function(){return this.logger},Object.defineProperty(b.prototype,"readPreference",{enumerable:!0,get:function(){return this&&this.s?this.s.options.readPreference:null}}),Object.defineProperty(b.prototype,"namespace",{enumerable:!0,get:function(){if(!this||!this.s)return null;const t=this.s.ns||"",e=t.indexOf(".");return e<0?{database:this.s.ns,collection:""}:{database:t.substr(0,e),collection:t.substr(e+1)}}}),b.INIT=0,b.OPEN=1,b.CLOSED=2,b.GET_MORE=3,t.exports=b},function(t,e){t.exports=require("assert")},function(t,e,n){"use strict";
/*!
 * ignore
 */let r=null;t.exports.get=function(){return r},t.exports.set=function(t){r=t}},function(t,e,n){"use strict";
/*!
 * Module dependencies
 */const r=n(8),o=n(58),i=n(5);
/*!
 * returns discriminator by discriminatorMapping.value
 *
 * @param {Model} model
 * @param {string} value
 */
function s(t,e){let n=null;if(!t.discriminators)return n;for(const r in t.discriminators){const o=t.discriminators[r];if(o.schema&&o.schema.discriminatorMapping&&o.schema.discriminatorMapping.value==e){n=o;break}}return n}
/*!
 * Set each path query option to lean
 *
 * @param {Object} option
 */
function u(t){return function(e){e.options||(e.options={}),e.options.lean=t}}
/*!
 * Handle the `WriteOpResult` from the server
 */
/*!
 * Prepare a set of path options for query population.
 *
 * @param {Query} query
 * @param {Object} options
 * @return {Array}
 */
e.preparePopulationOptions=function(t,e){const n=i.object.vals(t.options.populate);return null!=e.lean&&n.filter(t=>null==r(t,"options.lean")).forEach(u(e.lean)),n},
/*!
 * Prepare a set of path options for query population. This is the MongooseQuery
 * version
 *
 * @param {Query} query
 * @param {Object} options
 * @return {Array}
 */
e.preparePopulationOptionsMQ=function(t,e){const n=i.object.vals(t._mongooseOptions.populate);null!=e.lean&&n.filter(t=>null==r(t,"options.lean")).forEach(u(e.lean));const o=r(t,"options.session",null);null!=o&&n.forEach(t=>{null!=t.options?"session"in t.options||(t.options.session=o):t.options={session:o}});const s=t._fieldsForExec();return n.forEach(t=>{t._queryProjection=s}),n},e.getDiscriminatorByValue=s,
/*!
 * If the document is a mapped discriminator type, it returns a model instance for that type, otherwise,
 * it returns an instance of the given model.
 *
 * @param {Model}  model
 * @param {Object} doc
 * @param {Object} fields
 *
 * @return {Model}
 */
e.createModel=function(t,n,r,o){t.hooks.execPreSync("createModel",n);const u=t.schema?t.schema.discriminatorMapping:null,c=u&&u.isRoot?u.key:null,a=n[c];if(c&&a&&t.discriminators){const n=t.discriminators[a]||s(t,a);if(n){const t=i.clone(o);return e.applyPaths(t,n.schema),new n(void 0,t,!0)}}return new t(void 0,r,{skipId:!0,isNew:!1,willInit:!0})},
/*!
 * ignore
 */
e.applyPaths=function(t,e){let n,i,s,u;if(t)for(s=(i=Object.keys(t)).length;s--;)if("+"!==i[s][0]&&(u=t[i[s]],o(u))){n=0===u;break}const c=[],a=[],l=[],h=function(e,o){const s="+"+e,u=t&&s in t;if(u&&delete t[s],"boolean"!=typeof o.selected)return;if(u)return delete t[s],void(!1===n&&i.length>1&&!~i.indexOf(e)&&(t[e]=1));const l=e.split("."),h=l[0];if(!~a.indexOf(h)){if(!n&&r(o,"options.$skipDiscriminatorCheck",!1)){let e="";for(let n=0;n<l.length;++n){e+=(0===e.length?"":".")+l[n];const o=r(t,e,!1);if(o&&"object"!=typeof o)return}}(o.selected?c:a).push(e)}};switch(function t(e,n){n||(n="");if(-1!==l.indexOf(e))return;l.push(e);e.eachPath(function(e,r){n&&(e=n+"."+e),h(e,r),r.schema&&t(r.schema,e)});l.pop()}(e),n){case!0:for(let e=0;e<a.length;++e)t[a[e]]=0;break;case!1:e&&e.paths._id&&e.paths._id.options&&!1===e.paths._id.options.select&&(t._id=0);for(let e=0;e<c.length;++e)t[c[e]]=1;break;case void 0:if(null==t)break;for(const e of Object.keys(t||{}))"+"===e.charAt(0)&&delete t[e];for(let e=0;e<a.length;++e)t[a[e]]=0}},e.handleDeleteWriteOpResult=function(t){return function(e,n){return e?t(e):t(null,Object.assign({},n.result,{deletedCount:n.deletedCount}))}}},function(t,e,n){"use strict";var r=n(33),o=n(4).MongoError;t.exports={getReadPreference:function(t,e){var n=t.readPreference||new r("primary");if(e.readPreference&&(n=e.readPreference),"string"==typeof n&&(n=new r(n)),!(n instanceof r))throw new o("read preference must be a ReadPreference instance");return n},MESSAGE_HEADER_SIZE:16,opcodes:{OP_REPLY:1,OP_UPDATE:2001,OP_INSERT:2002,OP_QUERY:2004,OP_GETMORE:2005,OP_DELETE:2006,OP_KILL_CURSORS:2007,OP_COMPRESSED:2012},parseHeader:function(t){return{length:t.readInt32LE(0),requestId:t.readInt32LE(4),responseTo:t.readInt32LE(8),opCode:t.readInt32LE(12)}}}},function(t,e,n){"use strict";const r=function(t,e,n){if(e&&!Array.isArray(e)&&(console.warn("ReadPreference tags must be an array, this will change in the next major version"),void 0!==e.maxStalenessSeconds?(n=e,e=void 0):e=[e]),this.mode=t,this.tags=e,null!=(n=n||{}).maxStalenessSeconds){if(n.maxStalenessSeconds<=0)throw new TypeError("maxStalenessSeconds must be a positive integer");this.maxStalenessSeconds=n.maxStalenessSeconds,this.minWireVersion=5}if(this.mode===r.PRIMARY||!0===this.mode){if(this.tags&&Array.isArray(this.tags)&&this.tags.length>0)throw new TypeError("Primary read preference cannot be combined with tags");if(this.maxStalenessSeconds)throw new TypeError("Primary read preference cannot be combined with maxStalenessSeconds")}};Object.defineProperty(r.prototype,"preference",{enumerable:!0,get:function(){return this.mode}}),r.PRIMARY="primary",r.PRIMARY_PREFERRED="primaryPreferred",r.SECONDARY="secondary",r.SECONDARY_PREFERRED="secondaryPreferred",r.NEAREST="nearest";const o=[r.PRIMARY,r.PRIMARY_PREFERRED,r.SECONDARY,r.SECONDARY_PREFERRED,r.NEAREST,!0,!1,null];r.isValid=function(t){return-1!==o.indexOf(t)},r.prototype.isValid=function(t){return r.isValid("string"==typeof t?t:this.mode)};const i=["primaryPreferred","secondary","secondaryPreferred","nearest"];r.prototype.slaveOk=function(){return-1!==i.indexOf(this.mode)},r.prototype.equals=function(t){return t.mode===this.mode},r.prototype.toJSON=function(){const t={mode:this.mode};return Array.isArray(this.tags)&&(t.tags=this.tags),this.maxStalenessSeconds&&(t.maxStalenessSeconds=this.maxStalenessSeconds),t},r.primary=new r("primary"),r.primaryPreferred=new r("primaryPreferred"),r.secondary=new r("secondary"),r.secondaryPreferred=new r("secondaryPreferred"),r.nearest=new r("nearest"),t.exports=r},function(t,e,n){"use strict";var r=n(0).format,o=n(4).MongoError,i={},s={},u=null,c=process.pid,a=null,l=function(t,e){if(!(this instanceof l))return new l(t,e);e=e||{},this.className=t,e.logger?a=e.logger:null==a&&(a=console.log),e.loggerLevel&&(u=e.loggerLevel||"error"),null==s[this.className]&&(i[this.className]=!0)};l.prototype.debug=function(t,e){if(this.isDebug()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&i[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","DEBUG",this.className,c,n,t),u={type:"debug",message:t,className:this.className,pid:c,date:n};e&&(u.meta=e),a(o,u)}},l.prototype.warn=function(t,e){if(this.isWarn()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&i[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","WARN",this.className,c,n,t),u={type:"warn",message:t,className:this.className,pid:c,date:n};e&&(u.meta=e),a(o,u)}},l.prototype.info=function(t,e){if(this.isInfo()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&i[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","INFO",this.className,c,n,t),u={type:"info",message:t,className:this.className,pid:c,date:n};e&&(u.meta=e),a(o,u)}},l.prototype.error=function(t,e){if(this.isError()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&i[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","ERROR",this.className,c,n,t),u={type:"error",message:t,className:this.className,pid:c,date:n};e&&(u.meta=e),a(o,u)}},l.prototype.isInfo=function(){return"info"===u||"debug"===u},l.prototype.isError=function(){return"error"===u||"info"===u||"debug"===u},l.prototype.isWarn=function(){return"error"===u||"warn"===u||"info"===u||"debug"===u},l.prototype.isDebug=function(){return"debug"===u},l.reset=function(){u="error",s={}},l.currentLogger=function(){return a},l.setCurrentLogger=function(t){if("function"!=typeof t)throw new o("current logger must be a function");a=t},l.filter=function(t,e){"class"===t&&Array.isArray(e)&&(s={},e.forEach(function(t){s[t]=!0}))},l.setLevel=function(t){if("info"!==t&&"error"!==t&&"debug"!==t&&"warn"!==t)throw new Error(r("%s is an illegal logging level",t));u=t},t.exports=l},function(t,e,n){"use strict";var r,o,i=n(46),s=i.freeze,u=n(7),c=u.inherits,a=u.notEnumerableProp;function l(t,e){function n(r){if(!(this instanceof n))return new n(r);a(this,"message","string"==typeof r?r:e),a(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return c(n,Error),n}var h=l("Warning","warning"),p=l("CancellationError","cancellation error"),f=l("TimeoutError","timeout error"),d=l("AggregateError","aggregate error");try{r=TypeError,o=RangeError}catch(t){r=l("TypeError","type error"),o=l("RangeError","range error")}for(var m="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),g=0;g<m.length;++g)"function"==typeof Array.prototype[m[g]]&&(d.prototype[m[g]]=Array.prototype[m[g]]);i.defineProperty(d.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),d.prototype.isOperational=!0;var y=0;function _(t){if(!(this instanceof _))return new _(t);a(this,"name","OperationalError"),a(this,"message",t),this.cause=t,this.isOperational=!0,t instanceof Error?(a(this,"message",t.message),a(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}d.prototype.toString=function(){var t=Array(4*y+1).join(" "),e="\n"+t+"AggregateError of:\n";y++,t=Array(4*y+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",o=r.split("\n"),i=0;i<o.length;++i)o[i]=t+o[i];e+=(r=o.join("\n"))+"\n"}return y--,e},c(_,Error);var v=Error.__BluebirdErrorTypes__;v||(v=s({CancellationError:p,TimeoutError:f,OperationalError:_,RejectionError:_,AggregateError:d}),i.defineProperty(Error,"__BluebirdErrorTypes__",{value:v,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:r,RangeError:o,CancellationError:v.CancellationError,OperationalError:v.OperationalError,TimeoutError:v.TimeoutError,AggregateError:v.AggregateError,Warning:h}},function(t,e){t.exports=require("url")},function(t,e,n){"use strict";const r=n(2),o=n(255),i=n(78).connect;i.MongoError=r.MongoError,i.MongoNetworkError=r.MongoNetworkError,i.Admin=n(153),i.MongoClient=n(78),i.Db=n(44),i.Collection=n(43),i.Server=n(80),i.ReplSet=n(155),i.Mongos=n(154),i.ReadPreference=n(2).ReadPreference,i.GridStore=n(262),i.Chunk=n(156),i.Logger=r.Logger,i.AggregationCursor=n(151),i.CommandCursor=n(103),i.Cursor=n(28),i.GridFSBucket=n(263),i.CoreServer=n(2).Server,i.CoreConnection=n(2).Connection,i.Binary=r.BSON.Binary,i.Code=r.BSON.Code,i.Map=r.BSON.Map,i.DBRef=r.BSON.DBRef,i.Double=r.BSON.Double,i.Int32=r.BSON.Int32,i.Long=r.BSON.Long,i.MinKey=r.BSON.MinKey,i.MaxKey=r.BSON.MaxKey,i.ObjectID=r.BSON.ObjectID,i.ObjectId=r.BSON.ObjectID,i.Symbol=r.BSON.Symbol,i.Timestamp=r.BSON.Timestamp,i.BSONRegExp=r.BSON.BSONRegExp,i.Decimal128=r.BSON.Decimal128,i.connect=i,i.instrument=function(t,e){"function"==typeof t&&(e=t,t={});const n=new o;return n.instrument(i.MongoClient,e),n},t.exports=i},function(t,e,n){"use strict";const r=n(30).get().ObjectId,o=n(23).objectIdSymbol;
/*!
 * Getter for convenience with populate, see gh-6115
 */
Object.defineProperty(r.prototype,"_id",{enumerable:!1,configurable:!0,get:function(){return this}}),r.prototype[o]=!0,t.exports=r},function(t,e,n){"use strict";
/*!
 * ignore
 */e.internalToObjectOptions={transform:!1,virtuals:!1,getters:!1,_skipDepopulateTopLevel:!0,depopulate:!0,flattenDecimals:!1}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(16),o=n(119),i=n(38),s=n(183),u=n(8),c=n(31).getDiscriminatorByValue,a=n(39).internalToObjectOptions,l=n(0),h=n(5),p=n(23).documentArrayParent;
/*!
 * ignore
 */
class f extends Array{get isMongooseArray(){return!0}remove(){}}function d(t,e,n){const i=new f;Array.isArray(t)&&t.forEach(t=>{i.push(t)}),i._path=e;const s={isMongooseDocumentArray:!0,validators:[],_atomics:{},_schema:void 0,_handlers:void 0},c=Object.keys(o.mixin);let a=c.length;for(let t=0;t<a;++t)i[c[t]]=o.mixin[c[t]];const h=Object.keys(d.mixin);a=h.length;for(let t=0;t<a;++t)i[h[t]]=d.mixin[h[t]];l.inspect.custom&&(s[l.inspect.custom]=i.inspect);const p=Object.keys(s);a=p.length;for(let t=0;t<a;++t)i[p[t]]=s[p[t]];if(n&&n instanceof r){for(i._parent=n,i._schema=n.schema.path(e);u(i,"_schema.$isMongooseArray")&&!u(i,"_schema.$isMongooseDocumentArray");)i._schema=i._schema.casterConstructor;i._schema&&!i._schema.$isMongooseDocumentArray&&(i._schema=i._schema.casterConstructor),i._handlers={isNew:i.notify("isNew"),save:i.notify("save")},n.on("save",i._handlers.save),n.on("isNew",i._handlers.isNew)}return i}
/*!
 * Inherits from MongooseArray
 */d.mixin={
/*!
   * ignore
   */
toBSON:function(){return this.toObject(a)},_cast:function(t,e){let n=this._schema.casterConstructor;if((n.$isMongooseDocumentArray?t&&t.isMongooseDocumentArray:t instanceof n)||t&&t.constructor&&t.constructor.baseCasterConstructor===n)return t[p]&&t.__parentArray||(t[p]=this._parent,t.__parentArray=this),t.$setIndex(e),t;if(null==t)return null;if((Buffer.isBuffer(t)||t instanceof i||!h.isObject(t))&&(t={_id:t}),t&&n.discriminators&&n.schema&&n.schema.options&&n.schema.options.discriminatorKey)if("string"==typeof t[n.schema.options.discriminatorKey]&&n.discriminators[t[n.schema.options.discriminatorKey]])n=n.discriminators[t[n.schema.options.discriminatorKey]];else{const e=c(n,t[n.schema.options.discriminatorKey]);e&&(n=e)}return n.$isMongooseDocumentArray?n.cast(t,this,void 0,void 0,e):new n(t,this,void 0,void 0,e)},id:function(t){let e,n,o;try{e=s(t).toString()}catch(t){e=null}for(let s=0,u=this.length;s<u;s++)if(this[s]&&null!=(o=this[s].get("_id")))if(o instanceof r){if(n||(n=String(t)),n==o._id)return this[s]}else if(t instanceof i||o instanceof i){if(e==o)return this[s]}else if(h.deepEqual(t,o))return this[s];return null},toObject:function(t){return this.map(function(e){try{return e.toObject(t)}catch(t){return e||null}})},inspect:function(){return this.toObject()},create:function(t){let e=this._schema.casterConstructor;if(t&&e.discriminators&&e.schema&&e.schema.options&&e.schema.options.discriminatorKey)if("string"==typeof t[e.schema.options.discriminatorKey]&&e.discriminators[t[e.schema.options.discriminatorKey]])e=e.discriminators[t[e.schema.options.discriminatorKey]];else{const n=c(e,t[e.schema.options.discriminatorKey]);n&&(e=n)}return new e(t)},notify:function(t){const e=this;return function n(r,o){let i=(o=o||e).length;for(;i--;)if(null!=o[i]){switch(t){case"save":r=e[i]}o[i].isMongooseArray?n(r,o[i]):o[i]&&o[i].emit(t,r)}}}},
/*!
 * Module exports.
 */
t.exports=d},,function(t,e){function n(t,e){if(!(this instanceof n))return new n(t,e);this._bsontype="Long",this.low_=0|t,this.high_=0|e}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(t){var e=t||10;if(e<2||36<e)throw Error("radix out of range: "+e);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var r=n.fromNumber(e),o=this.div(r),i=o.multiply(r).subtract(this);return o.toString(e)+i.toInt().toString(e)}return"-"+this.negate().toString(e)}var s=n.fromNumber(Math.pow(e,6));i=this;for(var u="";!i.isZero();){var c=i.div(s),a=i.subtract(c.multiply(s)).toInt().toString(e);if((i=c).isZero())return a+u;for(;a.length<6;)a="0"+a;u=""+a+u}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!==this.high_?this.high_:this.low_,e=31;e>0&&0==(t&1<<e);e--);return 0!==this.high_?e+33:e+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(t){return this.high_===t.high_&&this.low_===t.low_},n.prototype.notEquals=function(t){return this.high_!==t.high_||this.low_!==t.low_},n.prototype.lessThan=function(t){return this.compare(t)<0},n.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},n.prototype.greaterThan=function(t){return this.compare(t)>0},n.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},n.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.subtract(t).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(t){var e=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=t.high_>>>16,u=65535&t.high_,c=t.low_>>>16,a=0,l=0,h=0,p=0;return h+=(p+=i+(65535&t.low_))>>>16,p&=65535,l+=(h+=o+c)>>>16,h&=65535,a+=(l+=r+u)>>>16,l&=65535,a+=e+s,a&=65535,n.fromBits(h<<16|p,a<<16|l)},n.prototype.subtract=function(t){return this.add(t.negate())},n.prototype.multiply=function(t){if(this.isZero())return n.ZERO;if(t.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return t.isOdd()?n.MIN_VALUE:n.ZERO;if(t.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&t.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*t.toNumber());var e=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=t.high_>>>16,u=65535&t.high_,c=t.low_>>>16,a=65535&t.low_,l=0,h=0,p=0,f=0;return p+=(f+=i*a)>>>16,f&=65535,h+=(p+=o*a)>>>16,p&=65535,h+=(p+=i*c)>>>16,p&=65535,l+=(h+=r*a)>>>16,h&=65535,l+=(h+=o*c)>>>16,h&=65535,l+=(h+=i*u)>>>16,h&=65535,l+=e*a+r*c+o*u+i*s,l&=65535,n.fromBits(p<<16|f,l<<16|h)},n.prototype.div=function(t){if(t.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(t.equals(n.ONE)||t.equals(n.NEG_ONE))return n.MIN_VALUE;if(t.equals(n.MIN_VALUE))return n.ONE;var e=this.shiftRight(1).div(t).shiftLeft(1);if(e.equals(n.ZERO))return t.isNegative()?n.ONE:n.NEG_ONE;var r=this.subtract(t.multiply(e));return e.add(r.div(t))}if(t.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();var o=n.ZERO;for(r=this;r.greaterThanOrEqual(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var i=Math.ceil(Math.log(e)/Math.LN2),s=i<=48?1:Math.pow(2,i-48),u=n.fromNumber(e),c=u.multiply(t);c.isNegative()||c.greaterThan(r);)e-=s,c=(u=n.fromNumber(e)).multiply(t);u.isZero()&&(u=n.ONE),o=o.add(u),r=r.subtract(c)}return o},n.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(t){return n.fromBits(this.low_&t.low_,this.high_&t.high_)},n.prototype.or=function(t){return n.fromBits(this.low_|t.low_,this.high_|t.high_)},n.prototype.xor=function(t){return n.fromBits(this.low_^t.low_,this.high_^t.high_)},n.prototype.shiftLeft=function(t){if(0===(t&=63))return this;var e=this.low_;if(t<32){var r=this.high_;return n.fromBits(e<<t,r<<t|e>>>32-t)}return n.fromBits(0,e<<t-32)},n.prototype.shiftRight=function(t){if(0===(t&=63))return this;var e=this.high_;if(t<32){var r=this.low_;return n.fromBits(r>>>t|e<<32-t,e>>t)}return n.fromBits(e>>t-32,e>=0?0:-1)},n.prototype.shiftRightUnsigned=function(t){if(0===(t&=63))return this;var e=this.high_;if(t<32){var r=this.low_;return n.fromBits(r>>>t|e<<32-t,e>>>t)}return 32===t?n.fromBits(e,0):n.fromBits(e>>>t-32,0)},n.fromInt=function(t){if(-128<=t&&t<128){var e=n.INT_CACHE_[t];if(e)return e}var r=new n(0|t,t<0?-1:0);return-128<=t&&t<128&&(n.INT_CACHE_[t]=r),r},n.fromNumber=function(t){return isNaN(t)||!isFinite(t)?n.ZERO:t<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:t+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:t<0?n.fromNumber(-t).negate():new n(t%n.TWO_PWR_32_DBL_|0,t/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(t,e){return new n(t,e)},n.fromString=function(t,e){if(0===t.length)throw Error("number format error: empty string");var r=e||10;if(r<2||36<r)throw Error("radix out of range: "+r);if("-"===t.charAt(0))return n.fromString(t.substring(1),r).negate();if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+t);for(var o=n.fromNumber(Math.pow(r,8)),i=n.ZERO,s=0;s<t.length;s+=8){var u=Math.min(8,t.length-s),c=parseInt(t.substring(s,s+u),r);if(u<8){var a=n.fromNumber(Math.pow(r,u));i=i.multiply(a).add(n.fromNumber(c))}else i=(i=i.multiply(o)).add(n.fromNumber(c))}return i},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),t.exports=n,t.exports.Long=n},function(t,e,n){"use strict";const r=n(0).deprecate,o=n(1).deprecateOptions,i=n(1).checkCollectionName,s=n(2).BSON.ObjectID,u=n(151),c=n(2).MongoError,a=n(1).toError,l=n(1).normalizeHintField,h=n(1).handleCallback,p=n(1).decorateCommand,f=n(1).decorateWithCollation,d=n(1).decorateWithReadConcern,m=n(1).formattedOrderClause,g=n(2).ReadPreference,y=n(103),_=n(257),v=n(258),w=n(102),b=n(1).executeOperation,O=n(1).applyWriteConcern,S=n(1).resolveReadPreference,A=n(3).bulkWrite,C=n(3).checkForAtomicOperators,T=n(3).count,E=n(3).countDocuments,N=n(3).createIndex,$=n(3).createIndexes,I=n(3).deleteMany,M=n(3).deleteOne,R=n(3).distinct,P=n(3).dropIndex,j=n(3).dropIndexes,D=n(3).ensureIndex,B=n(3).findAndModify,L=n(3).findAndRemove,F=n(3).findOne,U=n(3).findOneAndDelete,q=n(3).findOneAndReplace,x=n(3).findOneAndUpdate,W=n(3).geoHaystackSearch,V=n(3).group,H=n(3).indexes,Y=n(3).indexExists,Q=n(3).indexInformation,z=n(3).insertOne,K=n(3).isCapped,G=n(3).mapReduce,J=n(3).optionsOp,X=n(3).parallelCollectionScan,Z=n(3).prepareDocs,k=n(3).reIndex,tt=n(3).removeDocuments,et=n(3).rename,nt=n(3).replaceOne,rt=n(3).save,ot=n(3).stats,it=n(3).updateDocuments,st=n(3).updateMany,ut=n(3).updateOne,ct=["ignoreUndefined"];function at(t,e,n,r,o,u){i(r);const c=null==u||null==u.slaveOk?t.slaveOk:u.slaveOk,a=null==u||null==u.serializeFunctions?t.s.options.serializeFunctions:u.serializeFunctions,l=null==u||null==u.raw?t.s.options.raw:u.raw,h=null==u||null==u.promoteLongs?t.s.options.promoteLongs:u.promoteLongs,p=null==u||null==u.promoteValues?t.s.options.promoteValues:u.promoteValues,f=null==u||null==u.promoteBuffers?t.s.options.promoteBuffers:u.promoteBuffers;let d=null;const m=`${n}.${r}`,g=u.promiseLibrary||Promise;u&&u.readPreference?d=u.readPreference:t.options.readPreference&&(d=t.options.readPreference),o=null==o?s:o,this.s={pkFactory:o,db:t,topology:e,dbName:n,options:u,namespace:m,readPreference:d,slaveOk:c,serializeFunctions:a,raw:l,promoteLongs:h,promoteValues:p,promoteBuffers:f,internalHint:null,collectionHint:null,name:r,promiseLibrary:g,readConcern:u.readConcern,writeConcern:u.writeConcern}}Object.defineProperty(at.prototype,"dbName",{enumerable:!0,get:function(){return this.s.dbName}}),Object.defineProperty(at.prototype,"collectionName",{enumerable:!0,get:function(){return this.s.name}}),Object.defineProperty(at.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace}}),Object.defineProperty(at.prototype,"readConcern",{enumerable:!0,get:function(){return this.s.readConcern||{level:"local"}}}),Object.defineProperty(at.prototype,"writeConcern",{enumerable:!0,get:function(){let t={};return this.s.writeConcern?this.s.writeConcern:(null!=this.s.options.w&&(t.w=this.s.options.w),null!=this.s.options.j&&(t.j=this.s.options.j),null!=this.s.options.fsync&&(t.fsync=this.s.options.fsync),null!=this.s.options.wtimeout&&(t.wtimeout=this.s.options.wtimeout),t)}}),Object.defineProperty(at.prototype,"hint",{enumerable:!0,get:function(){return this.s.collectionHint},set:function(t){this.s.collectionHint=l(t)}});const lt=["maxScan","fields","snapshot"];at.prototype.find=o({name:"collection.find",deprecatedOptions:lt,optionsIndex:1},function(t,e,n){"object"==typeof n&&console.warn("Third parameter to `find()` must be a callback or undefined");let r=t;"function"!=typeof n&&("function"==typeof e?(n=e,e=void 0):null==e&&(n="function"==typeof r?r:void 0,r="object"==typeof r?r:void 0));const o=r=null==r?{}:r;if(Buffer.isBuffer(o)){const t=o[0]|o[1]<<8|o[2]<<16|o[3]<<24;if(t!==o.length){const e=new Error("query selector raw message size does not match message header size ["+o.length+"] != ["+t+"]");throw e.name="MongoError",e}}null!=r&&"ObjectID"===r._bsontype&&(r={_id:r}),e||(e={});let i=e.projection||e.fields;i&&!Buffer.isBuffer(i)&&Array.isArray(i)&&(i=i.length?i.reduce((t,e)=>(t[e]=1,t),{}):{_id:1});let s=Object.assign({},e);for(let t in this.s.options)-1!==ct.indexOf(t)&&(s[t]=this.s.options[t]);if(s.skip=e.skip?e.skip:0,s.limit=e.limit?e.limit:0,s.raw="boolean"==typeof e.raw?e.raw:this.s.raw,s.hint=null!=e.hint?l(e.hint):this.s.collectionHint,s.timeout=void 0===e.timeout?void 0:e.timeout,s.slaveOk=null!=e.slaveOk?e.slaveOk:this.s.db.slaveOk,s.readPreference=S(s,{db:this.s.db,collection:this}),null==s.readPreference||"primary"===s.readPreference&&"primary"===s.readPreference.mode||(s.slaveOk=!0),null!=r&&"object"!=typeof r)throw c.create({message:"query selector must be an object",driver:!0});const u={find:this.s.namespace,limit:s.limit,skip:s.skip,query:r};"boolean"==typeof s.awaitdata&&(s.awaitData=s.awaitdata),"boolean"==typeof s.timeout&&(s.noCursorTimeout=s.timeout),p(u,s,["session","collation"]),i&&(u.fields=i),s.db=this.s.db,s.promiseLibrary=this.s.promiseLibrary,null==s.raw&&"boolean"==typeof this.s.raw&&(s.raw=this.s.raw),null==s.promoteLongs&&"boolean"==typeof this.s.promoteLongs&&(s.promoteLongs=this.s.promoteLongs),null==s.promoteValues&&"boolean"==typeof this.s.promoteValues&&(s.promoteValues=this.s.promoteValues),null==s.promoteBuffers&&"boolean"==typeof this.s.promoteBuffers&&(s.promoteBuffers=this.s.promoteBuffers),u.sort&&(u.sort=m(u.sort)),d(u,this,e);try{f(u,this,e)}catch(t){if("function"==typeof n)return n(t,null);throw t}const a=this.s.topology.cursor(this.s.namespace,u,s);return"function"==typeof n?h(n,null,a):a}),at.prototype.insertOne=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},this.s.options.ignoreUndefined&&((e=Object.assign({},e)).ignoreUndefined=this.s.options.ignoreUndefined),b(this.s.topology,z,[this,t,e,n])},at.prototype.insertMany=function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e?Object.assign({},e):{ordered:!0},!Array.isArray(t)&&"function"==typeof n)return n(c.create({message:"docs parameter must be an array of documents",driver:!0}));if(!Array.isArray(t))return new this.s.promiseLibrary((t,e)=>{e(c.create({message:"docs parameter must be an array of documents",driver:!0}))});e.serializeFunctions=e.serializeFunctions||this.s.serializeFunctions;const r=[{insertMany:t=Z(this,t,e)}];return b(this.s.topology,A,[this,r,e,n],{resultMutator:e=>(function(t,e){const n={result:{ok:1,n:e.insertedCount},ops:t,insertedCount:e.insertedCount,insertedIds:e.insertedIds};return e.getLastOp()&&(n.result.opTime=e.getLastOp()),n})(t,e)})},at.prototype.bulkWrite=function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{ordered:!0},!Array.isArray(t))throw c.create({message:"operations must be an array of documents",driver:!0});return b(this.s.topology,A,[this,t,e,n])},at.prototype.insert=r(function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{ordered:!1},t=Array.isArray(t)?t:[t],!0===e.keepGoing&&(e.ordered=!1),this.insertMany(t,e,n)},"collection.insert is deprecated. Use insertOne, insertMany or bulkWrite instead."),at.prototype.updateOne=function(t,e,n,r){"function"==typeof n&&(r=n,n={}),n=n||{};const o=C(e);return o?"function"==typeof r?r(o):this.s.promiseLibrary.reject(o):(n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),b(this.s.topology,ut,[this,t,e,n,r]))},at.prototype.replaceOne=function(t,e,n,r){return"function"==typeof n&&(r=n,n={}),n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),b(this.s.topology,nt,[this,t,e,n,r])},at.prototype.updateMany=function(t,e,n,r){"function"==typeof n&&(r=n,n={}),n=n||{};const o=C(e);return o?"function"==typeof r?r(o):this.s.promiseLibrary.reject(o):(n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),b(this.s.topology,st,[this,t,e,n,r]))},at.prototype.update=r(function(t,e,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),b(this.s.topology,it,[this,t,e,n,r])},"collection.update is deprecated. Use updateOne, updateMany, or bulkWrite instead."),at.prototype.deleteOne=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=Object.assign({},e),this.s.options.ignoreUndefined&&((e=Object.assign({},e)).ignoreUndefined=this.s.options.ignoreUndefined),b(this.s.topology,M,[this,t,e,n])},at.prototype.removeOne=at.prototype.deleteOne,at.prototype.deleteMany=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=Object.assign({},e),this.s.options.ignoreUndefined&&((e=Object.assign({},e)).ignoreUndefined=this.s.options.ignoreUndefined),b(this.s.topology,I,[this,t,e,n])},at.prototype.removeMany=at.prototype.deleteMany,at.prototype.remove=r(function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},this.s.options.ignoreUndefined&&((e=Object.assign({},e)).ignoreUndefined=this.s.options.ignoreUndefined),b(this.s.topology,tt,[this,t,e,n])},"collection.remove is deprecated. Use deleteOne, deleteMany, or bulkWrite instead."),at.prototype.save=r(function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},this.s.options.ignoreUndefined&&((e=Object.assign({},e)).ignoreUndefined=this.s.options.ignoreUndefined),b(this.s.topology,rt,[this,t,e,n])},"collection.save is deprecated. Use insertOne, insertMany, updateOne, or updateMany instead."),at.prototype.findOne=o({name:"collection.find",deprecatedOptions:lt,optionsIndex:1},function(t,e,n){return"object"==typeof n&&console.warn("Third parameter to `findOne()` must be a callback or undefined"),"function"==typeof t&&(n=t,t={},e={}),"function"==typeof e&&(n=e,e={}),t=t||{},e=e||{},b(this.s.topology,F,[this,t,e,n])}),at.prototype.rename=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=Object.assign({},e,{readPreference:g.PRIMARY}),b(this.s.topology,et,[this,t,e,n])},at.prototype.drop=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},b(this.s.topology,this.s.db.dropCollection.bind(this.s.db),[this.s.name,t,e])},at.prototype.options=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},b(this.s.topology,J,[this,t,e])},at.prototype.isCapped=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},b(this.s.topology,K,[this,t,e])},at.prototype.createIndex=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},b(this.s.topology,N,[this,t,e,n])},at.prototype.createIndexes=function(t,e,n){return"function"==typeof e&&(n=e,e={}),"number"!=typeof(e=e?Object.assign({},e):{}).maxTimeMS&&delete e.maxTimeMS,b(this.s.topology,$,[this,t,e,n])},at.prototype.dropIndex=function(t,e,n){const r=Array.prototype.slice.call(arguments,1);return n="function"==typeof r[r.length-1]?r.pop():void 0,(e=r.length&&r.shift()||{}).readPreference=g.PRIMARY,b(this.s.topology,P,[this,t,e,n])},at.prototype.dropIndexes=function(t,e){return"function"==typeof t&&(e=t,t={}),"number"!=typeof(t=t?Object.assign({},t):{}).maxTimeMS&&delete t.maxTimeMS,b(this.s.topology,j,[this,t,e])},at.prototype.dropAllIndexes=r(at.prototype.dropIndexes,"collection.dropAllIndexes is deprecated. Use dropIndexes instead."),at.prototype.reIndex=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},b(this.s.topology,k,[this,t,e])},at.prototype.listIndexes=function(t){if(t=t||{},(t=Object.assign({},t)).readPreference=S(t,{db:this.s.db,collection:this}),t.cursorFactory=y,t.promiseLibrary=this.s.promiseLibrary,!this.s.topology.capabilities())throw new c("cannot connect to server");let e=t.batchSize?{batchSize:t.batchSize}:{};if(this.s.topology.capabilities().hasListIndexesCommand){const n={listIndexes:this.s.name,cursor:e};return e=this.s.topology.cursor(`${this.s.dbName}.$cmd`,n,t),t.readPreference&&e.setReadPreference(t.readPreference),e}const n=`${this.s.dbName}.system.indexes`;return e=this.s.topology.cursor(n,{find:n,query:{ns:this.s.namespace}},t),t.readPreference&&e.setReadPreference(t.readPreference),t.batchSize&&(e=e.batchSize(t.batchSize)),e},at.prototype.ensureIndex=r(function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},b(this.s.topology,D,[this,t,e,n])},"collection.ensureIndex is deprecated. Use createIndexes instead."),at.prototype.indexExists=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},b(this.s.topology,Y,[this,t,e,n])},at.prototype.indexInformation=function(t,e){const n=Array.prototype.slice.call(arguments,0);return e="function"==typeof n[n.length-1]?n.pop():void 0,t=n.length&&n.shift()||{},b(this.s.topology,Q,[this,t,e])},at.prototype.count=r(function(t,e,n){const r=Array.prototype.slice.call(arguments,0);return n="function"==typeof r[r.length-1]?r.pop():void 0,t=r.length&&r.shift()||{},e=r.length&&r.shift()||{},b(this.s.topology,T,[this,t,e,n])},"collection.count is deprecated, and will be removed in a future version. Use collection.countDocuments or collection.estimatedDocumentCount instead"),at.prototype.estimatedDocumentCount=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},b(this.s.topology,T,[this,null,t,e])},at.prototype.countDocuments=function(t,e,n){const r=Array.prototype.slice.call(arguments,0);return n="function"==typeof r[r.length-1]?r.pop():void 0,t=r.length&&r.shift()||{},e=r.length&&r.shift()||{},b(this.s.topology,E,[this,t,e,n])},at.prototype.distinct=function(t,e,n,r){const o=Array.prototype.slice.call(arguments,1);r="function"==typeof o[o.length-1]?o.pop():void 0;const i=o.length&&o.shift()||{},s=o.length&&o.shift()||{};return b(this.s.topology,R,[this,t,i,s,r])},at.prototype.indexes=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},b(this.s.topology,H,[this,t,e])},at.prototype.stats=function(t,e){const n=Array.prototype.slice.call(arguments,0);return e="function"==typeof n[n.length-1]?n.pop():void 0,t=n.length&&n.shift()||{},b(this.s.topology,ot,[this,t,e])},at.prototype.findOneAndDelete=function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},null==t||"object"!=typeof t)throw a("filter parameter must be an object");return b(this.s.topology,U,[this,t,e,n])},at.prototype.findOneAndReplace=function(t,e,n,r){if("function"==typeof n&&(r=n,n={}),n=n||{},null==t||"object"!=typeof t)throw a("filter parameter must be an object");if(null==e||"object"!=typeof e)throw a("replacement parameter must be an object");return b(this.s.topology,q,[this,t,e,n,r])},at.prototype.findOneAndUpdate=function(t,e,n,r){if("function"==typeof n&&(r=n,n={}),n=n||{},null==t||"object"!=typeof t)throw a("filter parameter must be an object");if(null==e||"object"!=typeof e)throw a("update parameter must be an object");const o=C(e);return o?"function"==typeof r?r(o):this.s.promiseLibrary.reject(o):b(this.s.topology,x,[this,t,e,n,r])},at.prototype.findAndModify=r(function(t,e,n,r,o){const i=Array.prototype.slice.call(arguments,1);return o="function"==typeof i[i.length-1]?i.pop():void 0,e=i.length&&i.shift()||[],n=i.length?i.shift():null,r=i.length&&i.shift()||{},(r=Object.assign({},r)).readPreference=g.PRIMARY,b(this.s.topology,B,[this,t,e,n,r,o])},"collection.findAndModify is deprecated. Use findOneAndUpdate, findOneAndReplace or findOneAndDelete instead."),at.prototype.findAndRemove=r(function(t,e,n,r){const o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length&&o.shift()||[],n=o.length&&o.shift()||{},b(this.s.topology,L,[this,t,e,n,r])},"collection.findAndRemove is deprecated. Use findOneAndDelete instead."),at.prototype.aggregate=function(t,e,n){if(Array.isArray(t))"function"==typeof e&&(n=e,e={}),null==e&&null==n&&(e={});else{const r=Array.prototype.slice.call(arguments,0);n=r.pop();const o=r[r.length-1];e=o&&(o.readPreference||o.explain||o.cursor||o.out||o.maxTimeMS||o.hint||o.allowDiskUse)?r.pop():{},t=r}let r=!1;const o={aggregate:this.s.name,pipeline:t};"string"==typeof e.out?(t.push({$out:e.out}),r=!0):t.length>0&&t[t.length-1].$out&&(r=!0),t.length>0&&t[t.length-1].$out&&this.s.topology.capabilities().commandsTakeWriteConcern&&O(o,{db:this.s.db,collection:this},e);try{f(o,this,e)}catch(t){if("function"==typeof n)return n(t,null);throw t}if(!0===e.bypassDocumentValidation&&(o.bypassDocumentValidation=e.bypassDocumentValidation),r||d(o,this,e),e.allowDiskUse&&(o.allowDiskUse=e.allowDiskUse),"number"==typeof e.maxTimeMS&&(o.maxTimeMS=e.maxTimeMS),e.hint&&(o.hint=e.hint),(e=Object.assign({},e)).readPreference=S(e,{db:this.s.db,collection:this}),e.explain){if(o.readConcern||o.writeConcern)throw a('"explain" cannot be used on an aggregate call with readConcern/writeConcern');o.explain=e.explain}if("string"==typeof e.comment&&(o.comment=e.comment),null!=e.cursor&&"object"!=typeof e.cursor)throw a("cursor options must be an object");if(e.cursor=e.cursor||{},e.batchSize&&(e.cursor.batchSize=e.batchSize),o.cursor=e.cursor,e.promiseLibrary=this.s.promiseLibrary,e.cursorFactory=u,"function"!=typeof n){if(!this.s.topology.capabilities())throw new c("cannot connect to server");return"boolean"==typeof e.allowDiskUse&&(o.allowDiskUse=e.allowDiskUse),"number"==typeof e.maxTimeMS&&(o.maxTimeMS=e.maxTimeMS),this.s.topology.cursor(this.s.namespace,o,e)}return h(n,null,this.s.topology.cursor(this.s.namespace,o,e))},at.prototype.watch=function(t,e){return t=t||[],e=e||{},Array.isArray(t)||(e=t,t=[]),new w(this,t,e)},at.prototype.parallelCollectionScan=function(t,e){return"function"==typeof t&&(e=t,t={numCursors:1}),t.numCursors=t.numCursors||1,t.batchSize=t.batchSize||1e3,(t=Object.assign({},t)).readPreference=S(t,{db:this.s.db,collection:this}),t.promiseLibrary=this.s.promiseLibrary,t.session&&(t.session=void 0),b(this.s.topology,X,[this,t,e],{skipSessions:!0})},at.prototype.geoHaystackSearch=function(t,e,n,r){const o=Array.prototype.slice.call(arguments,2);return r="function"==typeof o[o.length-1]?o.pop():void 0,n=o.length&&o.shift()||{},b(this.s.topology,W,[this,t,e,n,r])},at.prototype.group=r(function(t,e,n,r,o,i,s,u){const c=Array.prototype.slice.call(arguments,3);return u="function"==typeof c[c.length-1]?c.pop():void 0,r=c.length?c.shift():null,o=c.length?c.shift():null,i=c.length?c.shift():null,s=c.length&&c.shift()||{},"function"!=typeof o&&(i=o,o=null),!Array.isArray(t)&&t instanceof Object&&"function"!=typeof t&&"Code"!==t._bsontype&&(t=Object.keys(t)),"function"==typeof r&&(r=r.toString()),"function"==typeof o&&(o=o.toString()),i=null==i||i,b(this.s.topology,V,[this,t,e,n,r,o,i,s,u])},"MongoDB 3.6 or higher no longer supports the group command. We recommend rewriting using the aggregation framework."),at.prototype.mapReduce=function(t,e,n,r){if("function"==typeof n&&(r=n,n={}),null==n.out)throw new Error("the out option parameter must be defined, see mongodb docs for possible values");return"function"==typeof t&&(t=t.toString()),"function"==typeof e&&(e=e.toString()),"function"==typeof n.finalize&&(n.finalize=n.finalize.toString()),b(this.s.topology,G,[this,t,e,n,r])},at.prototype.initializeUnorderedBulkOp=function(t){return(t=t||{}).promiseLibrary=this.s.promiseLibrary,_(this.s.topology,this,t)},at.prototype.initializeOrderedBulkOp=function(t){return(t=t||{}).promiseLibrary=this.s.promiseLibrary,v(this.s.topology,this,t)},at.prototype.getLogger=function(){return this.s.db.s.logger},t.exports=at},function(t,e,n){"use strict";const r=n(10).EventEmitter,o=n(0).inherits,i=n(1).getSingleProperty,s=n(103),u=n(1).handleCallback,c=n(1).filterOptions,a=n(1).toError,l=n(2).ReadPreference,h=n(2).MongoError,p=n(2).ObjectID,f=n(2).Logger,d=n(43),m=n(1).mergeOptionsAndWriteConcern,g=n(1).executeOperation,y=n(1).applyWriteConcern,_=n(1).resolveReadPreference,v=n(102),w=n(0).deprecate,b=n(1).deprecateOptions,O=n(152),S=n(6).addUser,A=n(6).collections,C=n(6).createCollection,T=n(6).createIndex,E=n(6).createListener,N=n(6).dropCollection,$=n(6).dropDatabase,I=n(6).ensureIndex,M=n(6).evaluate,R=n(6).executeCommand,P=n(6).executeDbAdminCommand,j=n(6).indexInformation,D=n(6).listCollectionsTransforms,B=n(6).profilingInfo,L=n(6).profilingLevel,F=n(6).removeUser,U=n(6).setProfilingLevel,q=n(6).validateDatabaseName,x=["w","wtimeout","fsync","j","readPreference","readPreferenceTags","native_parser","forceServerObjectId","pkFactory","serializeFunctions","raw","bufferMaxEntries","authSource","ignoreUndefined","promoteLongs","promiseLibrary","readConcern","retryMiliSeconds","numberOfRetries","parentDb","noListener","loggerLevel","logger","promoteBuffers","promoteLongs","promoteValues","compression","retryWrites"];function W(t,e,n){if(n=n||{},!(this instanceof W))return new W(t,e,n);r.call(this);const o=n.promiseLibrary||Promise;(n=c(n,x)).promiseLibrary=o,this.s={databaseName:t,dbCache:{},children:[],topology:e,options:n,logger:f("Db",n),bson:e?e.bson:null,readPreference:n.readPreference,bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:-1,parentDb:n.parentDb||null,pkFactory:n.pkFactory||p,nativeParser:n.nativeParser||n.native_parser,promiseLibrary:o,noListener:"boolean"==typeof n.noListener&&n.noListener,readConcern:n.readConcern},q(this.s.databaseName),i(this,"serverConfig",this.s.topology),i(this,"bufferMaxEntries",this.s.bufferMaxEntries),i(this,"databaseName",this.s.databaseName),n.parentDb||this.s.noListener||(e.on("error",E(this,"error",this)),e.on("timeout",E(this,"timeout",this)),e.on("close",E(this,"close",this)),e.on("parseError",E(this,"parseError",this)),e.once("open",E(this,"open",this)),e.once("fullsetup",E(this,"fullsetup",this)),e.once("all",E(this,"all",this)),e.on("reconnect",E(this,"reconnect",this)))}o(W,r),Object.defineProperty(W.prototype,"topology",{enumerable:!0,get:function(){return this.s.topology}}),Object.defineProperty(W.prototype,"options",{enumerable:!0,get:function(){return this.s.options}}),Object.defineProperty(W.prototype,"slaveOk",{enumerable:!0,get:function(){return null!=this.s.options.readPreference&&("primary"!==this.s.options.readPreference||"primary"!==this.s.options.readPreference.mode)}}),Object.defineProperty(W.prototype,"writeConcern",{enumerable:!0,get:function(){const t={};return null!=this.s.options.w&&(t.w=this.s.options.w),null!=this.s.options.j&&(t.j=this.s.options.j),null!=this.s.options.fsync&&(t.fsync=this.s.options.fsync),null!=this.s.options.wtimeout&&(t.wtimeout=this.s.options.wtimeout),t}}),W.prototype.command=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=Object.assign({},e),g(this.s.topology,R,[this,t,e,n])},W.prototype.admin=function(){return new(n(153))(this,this.s.topology,this.s.promiseLibrary)};const V=["pkFactory","readPreference","serializeFunctions","strict","readConcern","ignoreUndefined","promoteValues","promoteBuffers","promoteLongs"];W.prototype.collection=function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},(e=Object.assign({},e)).promiseLibrary=this.s.promiseLibrary,e.readConcern=e.readConcern||this.s.readConcern,this.s.options.ignoreUndefined&&(e.ignoreUndefined=this.s.options.ignoreUndefined),null==(e=m(e,this.s.options,V,!0))||!e.strict)try{const r=new d(this,this.s.topology,this.s.databaseName,t,this.s.pkFactory,e);return n&&n(null,r),r}catch(t){if(t instanceof h&&n)return n(t);throw t}if("function"!=typeof n)throw a(`A callback is required in strict mode. While getting collection ${t}`);if(this.serverConfig&&this.serverConfig.isDestroyed())return n(new h("topology was destroyed"));const r=Object.assign({},e,{nameOnly:!0});this.listCollections({name:t},r).toArray((r,o)=>{if(null!=r)return u(n,r,null);if(0===o.length)return u(n,a(`Collection ${t} does not exist. Currently in strict mode.`),null);try{return u(n,null,new d(this,this.s.topology,this.s.databaseName,t,this.s.pkFactory,e))}catch(r){return u(n,r,null)}})},W.prototype.createCollection=b({name:"Db.createCollection",deprecatedOptions:["autoIndexId"],optionsIndex:1},function(t,e,n){return"function"==typeof e&&(n=e,e={}),(e=e||{}).promiseLibrary=e.promiseLibrary||this.s.promiseLibrary,g(this.s.topology,C,[this,t,e,n])}),W.prototype.stats=function(t,e){"function"==typeof t&&(e=t,t={});const n={dbStats:!0};return null!=(t=t||{}).scale&&(n.scale=t.scale),null==t.readPreference&&this.s.readPreference&&(t.readPreference=this.s.readPreference),this.command(n,t,e)},W.prototype.listCollections=function(t,e){t=t||{},e=e||{},(e=Object.assign({},e)).promiseLibrary=this.s.promiseLibrary,e.readPreference=_(e,{db:this,default:l.primary});let n=e.batchSize?{batchSize:e.batchSize}:{};if(this.serverConfig.capabilities().hasListCollectionsCommand){const r={listCollections:!0,filter:t,cursor:n,nameOnly:"boolean"==typeof e.nameOnly&&e.nameOnly};return e.cursorFactory=s,n=this.s.topology.cursor(`${this.s.databaseName}.$cmd`,r,e),e.readPreference&&n.setReadPreference(e.readPreference),n}this.serverConfig.capabilities().hasListCollectionsCommand||"string"!=typeof t.name||new RegExp("^"+this.databaseName+"\\.").test(t.name)||((t=Object.assign({},t)).name=`${this.s.databaseName}.${t.name}`),null==t&&(t.name=`/${this.s.databaseName}/`),t=t.name?{$and:[{name:t.name},{name:/^((?!\$).)*$/}]}:{name:/^((?!\$).)*$/};const r={transforms:D(this.s.databaseName)};return n=this.collection(O.SYSTEM_NAMESPACE_COLLECTION).find(t,r),e.readPreference&&n.setReadPreference(e.readPreference),e.batchSize&&(n=n.batchSize(e.batchSize)),n},W.prototype.eval=w(function(t,e,n,r){const o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length?o.shift():e,n=o.length&&o.shift()||{},g(this.s.topology,M,[this,t,e,n,r])},"Db.eval is deprecated as of MongoDB version 3.2"),W.prototype.renameCollection=function(t,e,n,r){"function"==typeof n&&(r=n,n={}),(n=n||{}).new_collection=!0;const o=this.collection(t);return g(this.s.topology,o.rename.bind(o),[e,n,r])},W.prototype.dropCollection=function(t,e,n){"function"==typeof e&&(n=e,e={});const r={drop:t};y(r,{db:this},e=e||{});const o=Object.assign({},this.s.options,{readPreference:l.PRIMARY});return e.session&&(o.session=e.session),g(this.s.topology,N,[this,r,o,n])},W.prototype.dropDatabase=function(t,e){"function"==typeof t&&(e=t,t={});const n={dropDatabase:1};y(n,{db:this},t=t||{});const r=Object.assign({},this.s.options,{readPreference:l.PRIMARY});return t.session&&(r.session=t.session),g(this.s.topology,$,[this,n,r,e])},W.prototype.collections=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},g(this.s.topology,A,[this,t,e])},W.prototype.executeDbAdminCommand=function(t,e,n){return"function"==typeof e&&(n=e,e={}),(e=e||{}).readPreference=_(e),g(this.s.topology,P,[this,t,e,n])},W.prototype.createIndex=function(t,e,n,r){return"function"==typeof n&&(r=n,n={}),n=n?Object.assign({},n):{},g(this.s.topology,T,[this,t,e,n,r])},W.prototype.ensureIndex=w(function(t,e,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},g(this.s.topology,I,[this,t,e,n,r])},"Db.ensureIndex is deprecated as of MongoDB version 3.0 / driver version 2.0"),W.prototype.addChild=function(t){if(this.s.parentDb)return this.s.parentDb.addChild(t);this.s.children.push(t)},W.prototype.addUser=function(t,e,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},g(this.s.topology,S,[this,t,e,n,r])},W.prototype.removeUser=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},g(this.s.topology,F,[this,t,e,n])},W.prototype.setProfilingLevel=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},g(this.s.topology,U,[this,t,e,n])},W.prototype.profilingInfo=w(function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},g(this.s.topology,B,[this,t,e])},"Db.profilingInfo is deprecated. Query the system.profile collection directly."),W.prototype.profilingLevel=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},g(this.s.topology,L,[this,t,e])},W.prototype.indexInformation=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},g(this.s.topology,j,[this,t,e,n])},W.prototype.unref=function(){this.s.topology.unref()},W.prototype.watch=function(t,e){return t=t||[],e=e||{},Array.isArray(t)||(e=t,t=[]),new v(this,t,e)},W.prototype.getLogger=function(){return this.s.logger},W.SYSTEM_NAMESPACE_COLLECTION=O.SYSTEM_NAMESPACE_COLLECTION,W.SYSTEM_INDEX_COLLECTION=O.SYSTEM_INDEX_COLLECTION,W.SYSTEM_PROFILE_COLLECTION=O.SYSTEM_PROFILE_COLLECTION,W.SYSTEM_USER_COLLECTION=O.SYSTEM_USER_COLLECTION,W.SYSTEM_COMMAND_COLLECTION=O.SYSTEM_COMMAND_COLLECTION,W.SYSTEM_JS_COLLECTION=O.SYSTEM_JS_COLLECTION,t.exports=W},function(t,e,n){"use strict";const r=n(10),o=n(2).MongoError,i=n(0).format,s=n(99),u=n(1).translateReadPreference,c=n(2).Sessions.ClientSession;var a=function(t,e){var n=this;e=e||{force:!1,bufferMaxEntries:-1},this.s={storedOps:[],storeOptions:e,topology:t},Object.defineProperty(this,"length",{enumerable:!0,get:function(){return n.s.storedOps.length}})};a.prototype.add=function(t,e,n,r,s){if(this.s.storeOptions.force)return s(o.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return s(o.create({message:i("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(o.create({message:i("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:t,n:e,o:n,op:r,c:s})},a.prototype.addObjectAndMethod=function(t,e,n,r,s){if(this.s.storeOptions.force)return s(o.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return s(o.create({message:i("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(o.create({message:i("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:t,m:n,o:e,p:r,c:s})},a.prototype.flush=function(t){for(;this.s.storedOps.length>0;)this.s.storedOps.shift().c(t||o.create({message:i("no connection available for operation"),driver:!0}))};var l=["primary","primaryPreferred","nearest","secondaryPreferred"],h=["secondary","secondaryPreferred"];a.prototype.execute=function(t){t=t||{};var e=this.s.storedOps;this.s.storedOps=[];for(var n="boolean"!=typeof t.executePrimary||t.executePrimary,r="boolean"!=typeof t.executeSecondary||t.executeSecondary;e.length>0;){var o=e.shift();"cursor"===o.t?n&&r?o.o[o.m].apply(o.o,o.p):n&&o.o.options&&o.o.options.readPreference&&-1!==l.indexOf(o.o.options.readPreference.mode)?o.o[o.m].apply(o.o,o.p):!n&&r&&o.o.options&&o.o.options.readPreference&&-1!==h.indexOf(o.o.options.readPreference.mode)&&o.o[o.m].apply(o.o,o.p):"auth"===o.t?this.s.topology[o.t].apply(this.s.topology,o.o):n&&r?this.s.topology[o.t](o.n,o.o,o.op,o.c):n&&o.op&&o.op.readPreference&&-1!==l.indexOf(o.op.readPreference.mode)?this.s.topology[o.t](o.n,o.o,o.op,o.c):!n&&r&&o.op&&o.op.readPreference&&-1!==h.indexOf(o.op.readPreference.mode)&&this.s.topology[o.t](o.n,o.o,o.op,o.c)}},a.prototype.all=function(){return this.s.storedOps};var p=function(t){var e=function(t,e,n){Object.defineProperty(t,e,{enumerable:!0,get:function(){return n}})},n=!1,r=!1,o=!1,i=!1,s=!1,u=!1,c=t.maxWriteBatchSize||1e3,a=!1,l=!1;t.minWireVersion>=0&&(o=!0),t.maxWireVersion>=1&&(n=!0,i=!0),t.maxWireVersion>=2&&(r=!0),t.maxWireVersion>=3&&(s=!0,u=!0),t.maxWireVersion>=5&&(a=!0,l=!0),null==t.minWireVersion&&(t.minWireVersion=0),null==t.maxWireVersion&&(t.maxWireVersion=0),e(this,"hasAggregationCursor",n),e(this,"hasWriteCommands",r),e(this,"hasTextSearch",o),e(this,"hasAuthCommands",i),e(this,"hasListCollectionsCommand",s),e(this,"hasListIndexesCommand",u),e(this,"minWireVersion",t.minWireVersion),e(this,"maxWireVersion",t.maxWireVersion),e(this,"maxNumberOfDocsInBatch",c),e(this,"commandsTakeWriteConcern",a),e(this,"commandsTakeCollation",l)};const f=n(260).version,d=i("Node.js %s, %s",process.version,s.endianness()),m=s.type(),g=process.platform,y=process.arch,_=s.release();class v extends r{constructor(){super(),this.clientInfo={driver:{name:"nodejs",version:f},os:{type:m,name:g,architecture:y,version:_},platform:d},this.setMaxListeners(1/0)}hasSessionSupport(){return null!=this.logicalSessionTimeoutMinutes}startSession(t,e){const n=new c(this,this.s.sessionPool,t,e);return n.once("ended",()=>{this.s.sessions=this.s.sessions.filter(t=>!t.equals(n))}),this.s.sessions.push(n),n}endSessions(t,e){return this.s.coreTopology.endSessions(t,e)}capabilities(){return this.s.sCapabilities?this.s.sCapabilities:null==this.s.coreTopology.lastIsMaster()?null:(this.s.sCapabilities=new p(this.s.coreTopology.lastIsMaster()),this.s.sCapabilities)}command(t,e,n,r){this.s.coreTopology.command(t,e,u(n),r)}insert(t,e,n,r){this.s.coreTopology.insert(t,e,n,r)}update(t,e,n,r){this.s.coreTopology.update(t,e,n,r)}remove(t,e,n,r){this.s.coreTopology.remove(t,e,n,r)}isConnected(t){return t=u(t=t||{}),this.s.coreTopology.isConnected(t)}isDestroyed(){return this.s.coreTopology.isDestroyed()}cursor(t,e,n){return(n=u(n=n||{})).disconnectHandler=this.s.store,n.topology=this,this.s.coreTopology.cursor(t,e,n)}lastIsMaster(){return this.s.coreTopology.lastIsMaster()}selectServer(t,e,n){return this.s.coreTopology.selectServer(t,e,n)}unref(){return this.s.coreTopology.unref()}auth(){var t=Array.prototype.slice.call(arguments,0);this.s.coreTopology.auth.apply(this.s.coreTopology,t)}logout(){var t=Array.prototype.slice.call(arguments,0);this.s.coreTopology.logout.apply(this.s.coreTopology,t)}connections(){return this.s.coreTopology.connections()}close(t){this.s.sessions.length&&this.s.sessions.forEach(t=>t.endSession()),this.s.sessionPool&&this.s.sessionPool.endAllPooledSessions(),this.s.coreTopology.destroy({force:"boolean"==typeof t&&t}),!0===t&&(this.s.storeOptions.force=t,this.s.store.flush())}}Object.defineProperty(v.prototype,"bson",{enumerable:!0,get:function(){return this.s.coreTopology.s.bson}}),Object.defineProperty(v.prototype,"parserType",{enumerable:!0,get:function(){return this.s.coreTopology.parserType}}),Object.defineProperty(v.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.coreTopology.logicalSessionTimeoutMinutes}}),Object.defineProperty(v.prototype,"type",{enumerable:!0,get:function(){return this.s.coreTopology.type}}),e.Store=a,e.ServerCapabilities=p,e.TopologyBase=v},function(t,e){var n=function(){"use strict";return void 0===this}();if(n)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return!(n&&!n.writable&&!n.set)}};else{var r={}.hasOwnProperty,o={}.toString,i={}.constructor.prototype,s=function(t){var e=[];for(var n in t)r.call(t,n)&&e.push(n);return e};t.exports={isArray:function(t){try{return"[object Array]"===o.call(t)}catch(t){return!1}},keys:s,names:s,defineProperty:function(t,e,n){return t[e]=n.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(t){return i}},isES5:n,propertyIsWritable:function(){return!0}}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(19),o=n(87),i=n(5);function s(t,e){if(e&&e.default){const t=e.default;Array.isArray(t)&&0===t.length?e.default=Array:!e.shared&&i.isObject(t)&&0===Object.keys(t).length&&(e.default=function(){return{}})}r.call(this,t,e,"Mixed"),this[o.schemaMixedSymbol]=!0}s.schemaName="Mixed",
/*!
 * Inherits from SchemaType.
 */
s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.get=r.get,s.prototype.cast=function(t){return t},s.prototype.castForQuery=function(t,e){return 2===arguments.length?e:t},
/*!
 * Module exports.
 */
t.exports=s},function(t,e){t.exports=require("fs")},,,function(t,e){function n(){if(!(this instanceof n))return new n;this._bsontype="MinKey"}t.exports=n,t.exports.MinKey=n},function(t,e,n){if("undefined"!=typeof global)var r=n(63).Buffer;function o(t,e){if(!(this instanceof o))return new o(t,e);if(!(null==t||"string"==typeof t||r.isBuffer(t)||t instanceof Uint8Array||Array.isArray(t)))throw new Error("only String, Buffer, Uint8Array or Array accepted");if(this._bsontype="Binary",t instanceof Number?(this.sub_type=t,this.position=0):(this.sub_type=null==e?i:e,this.position=0),null==t||t instanceof Number)void 0!==r?this.buffer=new r(o.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(o.BUFFER_SIZE)):this.buffer=new Array(o.BUFFER_SIZE),this.position=0;else{if("string"==typeof t)if(void 0!==r)this.buffer=new r(t);else{if("undefined"==typeof Uint8Array&&"[object Array]"!==Object.prototype.toString.call(t))throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=s(t)}else this.buffer=t;this.position=t.length}}o.prototype.put=function(t){if(null!=t.length&&"number"!=typeof t&&1!==t.length)throw new Error("only accepts single character String, Uint8Array or Array");if("number"!=typeof t&&t<0||t>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var e=null;if(e="string"==typeof t?t.charCodeAt(0):null!=t.length?t[0]:t,this.buffer.length>this.position)this.buffer[this.position++]=e;else if(void 0!==r&&r.isBuffer(this.buffer)){var n=new r(o.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=e}else{n=null,n="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(o.BUFFER_SIZE+this.buffer.length)):new Array(o.BUFFER_SIZE+this.buffer.length);for(var i=0;i<this.buffer.length;i++)n[i]=this.buffer[i];this.buffer=n,this.buffer[this.position++]=e}},o.prototype.write=function(t,e){if(e="number"==typeof e?e:this.position,this.buffer.length<e+t.length){var n=null;if(void 0!==r&&r.isBuffer(this.buffer))n=new r(this.buffer.length+t.length),this.buffer.copy(n,0,0,this.buffer.length);else if("[object Uint8Array]"===Object.prototype.toString.call(this.buffer)){n=new Uint8Array(new ArrayBuffer(this.buffer.length+t.length));for(var o=0;o<this.position;o++)n[o]=this.buffer[o]}this.buffer=n}if(void 0!==r&&r.isBuffer(t)&&r.isBuffer(this.buffer))t.copy(this.buffer,e,0,t.length),this.position=e+t.length>this.position?e+t.length:this.position;else if(void 0!==r&&"string"==typeof t&&r.isBuffer(this.buffer))this.buffer.write(t,e,"binary"),this.position=e+t.length>this.position?e+t.length:this.position;else if("[object Uint8Array]"===Object.prototype.toString.call(t)||"[object Array]"===Object.prototype.toString.call(t)&&"string"!=typeof t){for(o=0;o<t.length;o++)this.buffer[e++]=t[o];this.position=e>this.position?e:this.position}else if("string"==typeof t){for(o=0;o<t.length;o++)this.buffer[e++]=t.charCodeAt(o);this.position=e>this.position?e:this.position}},o.prototype.read=function(t,e){if(e=e&&e>0?e:this.position,this.buffer.slice)return this.buffer.slice(t,t+e);for(var n="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e)):new Array(e),r=0;r<e;r++)n[r]=this.buffer[t++];return n},o.prototype.value=function(t){if((t=null!=t&&t)&&void 0!==r&&r.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(void 0!==r&&r.isBuffer(this.buffer))return t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(t){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var e="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)e[n]=this.buffer[n];return e}return u(this.buffer,0,this.position)},o.prototype.length=function(){return this.position},o.prototype.toJSON=function(){return null!=this.buffer?this.buffer.toString("base64"):""},o.prototype.toString=function(t){return null!=this.buffer?this.buffer.slice(0,this.position).toString(t):""};var i=0,s=function(t){for(var e="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t.length)):new Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e},u=function(t,e,n){for(var r="",o=e;o<n;o++)r+=String.fromCharCode(t[o]);return r};o.BUFFER_SIZE=256,o.SUBTYPE_DEFAULT=0,o.SUBTYPE_FUNCTION=1,o.SUBTYPE_BYTE_ARRAY=2,o.SUBTYPE_UUID_OLD=3,o.SUBTYPE_UUID=4,o.SUBTYPE_MD5=5,o.SUBTYPE_USER_DEFINED=128,t.exports=o,t.exports.Binary=o},function(t,e){t.exports=require("path")},function(t,e,n){"use strict";const r=n(3).buildCountCommand,o=n(1).formattedOrderClause,i=n(1).handleCallback,s=n(2).MongoError,u=Array.prototype.push;function c(t,e){if(0!==t.bufferedCount())return t._next(e),c}function a(t,e){const r=n(28);if(t.s.state===r.CLOSED||t.isDead&&t.isDead())return i(e,s.create({message:"Cursor is closed",driver:!0}));if(t.s.state===r.INIT&&t.s.cmd.sort)try{t.s.cmd.sort=o(t.s.cmd.sort)}catch(t){return i(e,t)}t._next((n,o)=>{if(t.s.state=r.OPEN,n)return i(e,n);i(e,null,o)})}t.exports={count:function(t,e,n,o){e&&("number"==typeof t.cursorSkip()&&(n.skip=t.cursorSkip()),"number"==typeof t.cursorLimit()&&(n.limit=t.cursorLimit())),n.readPreference&&t.setReadPreference(n.readPreference),"number"!=typeof n.maxTimeMS&&t.s.cmd&&"number"==typeof t.s.cmd.maxTimeMS&&(n.maxTimeMS=t.s.cmd.maxTimeMS);let i={};i.skip=n.skip,i.limit=n.limit,i.hint=n.hint,i.maxTimeMS=n.maxTimeMS;const s=t.s.ns.indexOf(".");let u;i.collectionName=t.s.ns.substr(s+1);try{u=r(t,t.s.cmd.query,i)}catch(t){return o(t)}t.server=t.topology.s.coreTopology,t.s.topology.command(`${t.s.ns.substr(0,s)}.$cmd`,u,t.s.options,(t,e)=>{o(t,e?e.result.n:null)})},each:function t(e,r){const o=n(28);if(!r)throw s.create({message:"callback is mandatory",driver:!0});if(e.isNotified())return;if(e.s.state===o.CLOSED||e.isDead())return i(r,s.create({message:"Cursor is closed",driver:!0}));e.s.state===o.INIT&&(e.s.state=o.OPEN);let u=null;if(e.bufferedCount()>0){for(;u=c(e,r);)u(e,r);t(e,r)}else e.next((n,o)=>n?i(r,n):null==o?e.close({skipKillCursors:!0},()=>i(r,null,null)):void(!1!==i(r,null,o)&&t(e,r)))},hasNext:function(t,e){const r=n(28);return t.s.currentDoc?e(null,!0):t.isNotified()?e(null,!1):void a(t,(n,o)=>n?e(n,null):t.s.state===r.CLOSED||t.isDead()?e(null,!1):o?(t.s.currentDoc=o,void e(null,!0)):e(null,!1))},next:function(t,e){if(t.s.currentDoc){const n=t.s.currentDoc;return t.s.currentDoc=null,e(null,n)}a(t,e)},toArray:function(t,e){const r=n(28),o=[];t.rewind(),t.s.state=r.INIT;const s=()=>{t._next((n,r)=>{if(n)return t._endSession?t._endSession(()=>i(e,n)):i(e,n);if(null==r)return t.close({skipKillCursors:!0},()=>i(e,null,o));if(o.push(r),t.bufferedCount()>0){let e=t.readBufferedDocuments(t.bufferedCount());t.s.transforms&&"function"==typeof t.s.transforms.doc&&(e=e.map(t.s.transforms.doc)),u.apply(o,e)}s()})};s()}}},function(t,e,n){"use strict";
/*!
 * Centralize this so we can more easily work around issues with people
 * stubbing out `process.nextTick()` in tests using sinon:
 * https://github.com/sinonjs/lolex#automatically-incrementing-mocked-time
 * See gh-6074
 */t.exports=function(t){return process.nextTick(t)}},function(t,e,n){t.exports=n(306)},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(38),o=n(5);
/*!
 * ignore
 */
function i(t){return t&&"object"==typeof t&&!(t instanceof Date)&&!(t instanceof r)&&(!Array.isArray(t)||t.length>0)&&!(t instanceof Buffer)}e.flatten=
/*!
 * ignore
 */
function t(e,n,r){let s;s=e&&o.isMongooseObject(e)&&!Buffer.isBuffer(e)?Object.keys(e.toObject({transform:!1,virtuals:!1})):Object.keys(e||{});const u=s.length;const c={};n=n?n+".":"";for(let o=0;o<u;++o){const u=s[o],a=e[u];if(c[n+u]=a,i(a)){if(r&&r.skipArrays&&Array.isArray(a))continue;const e=t(a,n+u,r);for(const t in e)c[t]=e[t];Array.isArray(a)&&(c[n+u]=a)}}return c}
/*!
 * ignore
 */,e.modifiedPaths=function t(e,n,r){const s=Object.keys(e||{});const u=s.length;r=r||{};n=n?n+".":"";for(let c=0;c<u;++c){const u=s[c];let a=e[u];r[n+u]=!0,o.isMongooseObject(a)&&!Buffer.isBuffer(a)&&(a=a.toObject({transform:!1,virtuals:!1})),i(a)&&t(a,n+u,r)}return r}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t){return null==t||("object"!=typeof t||!("$meta"in t||"$slice"in t))}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(170)(),o=n(10).EventEmitter,i=n(55),s=n(39).internalToObjectOptions,u=n(8),c=n(5),a=n(0),l=n(23).documentArrayParent,h=n(23).validatorErrorSymbol;function p(t,e,n,o,i){e?(this.__parentArray=e,this[l]=e._parent):(this.__parentArray=void 0,this[l]=void 0),this.$setIndex(i),this.$isDocumentArrayElement=!0,r.call(this,t,o,n);const s=this;this.on("isNew",function(t){s.isNew=t}),s.on("save",function(){s.constructor.emit("save",s)})}
/*!
 * Inherit from Document
 */p.prototype=Object.create(r.prototype),p.prototype.constructor=p;for(const t in o.prototype)p[t]=o.prototype[t];p.prototype.toBSON=function(){return this.toObject(s)},
/*!
 * ignore
 */
p.prototype.$setIndex=function(t){if(this.__index=t,null!=u(this,"$__.validationError",null)){const t=Object.keys(this.$__.validationError.errors);for(const e of t)this.invalidate(e,this.$__.validationError.errors[e])}},p.prototype.markModified=function(t){this.$__.activePaths.modify(t),this.__parentArray&&(this.isNew?this.__parentArray._markModified():this.__parentArray._markModified(this,t))},
/*!
 * ignore
 */
p.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.arr[0].populate("path")`, use `doc.populate("arr.0.path")`')},p.prototype.save=function(t,e){return"function"==typeof t&&(e=t,t={}),(t=t||{}).suppressWarning||console.warn("mongoose: calling `save()` on a subdoc does **not** save the document to MongoDB, it only runs save middleware. Use `subdoc.save({ suppressWarning: true })` to hide this warning if you're sure this behavior is right for your app."),c.promiseOrCallback(e,t=>{this.$__save(t)})},p.prototype.$__save=function(t){return i(()=>t(null,this))},
/*!
 * no-op for hooks
 */
p.prototype.$__remove=function(t){return t(null,this)},p.prototype.remove=function(t,e){if("function"!=typeof t||e||(e=t,t=void 0),!this.__parentArray||t&&t.noop)return e&&e(null),this;let n;if(!this.willRemove){if(!(n=this._doc._id))throw new Error("For your own good, Mongoose does not know how to remove an EmbeddedDocument that has no _id");this.__parentArray.pull({_id:n}),this.willRemove=!0,
/*!
 * Registers remove event listeners for triggering
 * on subdocuments.
 *
 * @param {EmbeddedDocument} sub
 * @api private
 */
function(t){let e=t.ownerDocument();function n(){e.removeListener("save",n),e.removeListener("remove",n),t.emit("remove",t),t.constructor.emit("remove",t),e=t=null}e.on("save",n),e.on("remove",n)}(this)}return e&&e(null),this},p.prototype.update=function(){throw new Error("The #update method is not available on EmbeddedDocuments")},p.prototype.inspect=function(){return this.toObject({transform:!1,virtuals:!1,flattenDecimals:!1})},a.inspect.custom&&(
/*!
  * Avoid Node deprecation warning DEP0079
  */
p.prototype[a.inspect.custom]=p.prototype.inspect),p.prototype.invalidate=function(t,e,n){if(r.prototype.invalidate.call(this,t,e,n),!this[l]){if(e[h]||"ValidationError"===e.name)return!0;throw e}const o=this.__index;if(void 0!==o){const r=[this.__parentArray._path,o,t].join(".");this[l].invalidate(r,e,n)}return!0},p.prototype.$markValid=function(t){if(!this[l])return;const e=this.__index;if(void 0!==e){const n=[this.__parentArray._path,e,t].join(".");this[l].$markValid(n)}},
/*!
 * ignore
 */
p.prototype.$ignore=function(t){if(r.prototype.$ignore.call(this,t),!this[l])return;const e=this.__index;if(void 0!==e){const n=[this.__parentArray._path,e,t].join(".");this[l].$ignore(n)}},p.prototype.$isValid=function(t){return void 0===this.__index||!this[l]||(!this[l].$__.validationError||!this[l].$__.validationError.errors[this.$__fullPath(t)])},p.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;let t=this[l];if(!t)return this;for(;t[l]||t.$parent;)t=t[l]||t.$parent;return this.$__.ownerDocument=t,this.$__.ownerDocument},p.prototype.$__fullPath=function(t){if(!this.$__.fullPath){let e=this;if(!e[l])return t;const n=[];for(;e[l]||e.$parent;)e[l]?n.unshift(e.__parentArray._path):n.unshift(e.$basePath),e=e[l]||e.$parent;this.$__.fullPath=n.join("."),this.$__.ownerDocument||(this.$__.ownerDocument=e)}return t?this.$__.fullPath+"."+t:this.$__.fullPath},p.prototype.parent=function(){return this[l]},p.prototype.parentArray=function(){return this.__parentArray},
/*!
 * Module exports.
 */
t.exports=p},function(t,e,n){"use strict";
/*!
 * Module exports.
 */e.Array=n(119),e.Buffer=n(185),e.Document=e.Embedded=n(59),e.DocumentArray=n(40),e.Decimal128=n(83),e.ObjectId=n(38),e.Map=n(117),e.Subdocument=n(188)},,,function(t,e){t.exports=require("buffer")},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){function n(t){if(!(this instanceof n))return new n(t);this._bsontype="Double",this.value=t}n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},t.exports=n,t.exports.Double=n},function(t,e){function n(t,e){if(!(this instanceof n))return new n(t,e);this._bsontype="Timestamp",this.low_=0|t,this.high_=0|e}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(t){var e=t||10;if(e<2||36<e)throw Error("radix out of range: "+e);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var r=n.fromNumber(e),o=this.div(r),i=o.multiply(r).subtract(this);return o.toString(e)+i.toInt().toString(e)}return"-"+this.negate().toString(e)}var s=n.fromNumber(Math.pow(e,6));i=this;for(var u="";!i.isZero();){var c=i.div(s),a=i.subtract(c.multiply(s)).toInt().toString(e);if((i=c).isZero())return a+u;for(;a.length<6;)a="0"+a;u=""+a+u}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!==this.high_?this.high_:this.low_,e=31;e>0&&0==(t&1<<e);e--);return 0!==this.high_?e+33:e+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(t){return this.high_===t.high_&&this.low_===t.low_},n.prototype.notEquals=function(t){return this.high_!==t.high_||this.low_!==t.low_},n.prototype.lessThan=function(t){return this.compare(t)<0},n.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},n.prototype.greaterThan=function(t){return this.compare(t)>0},n.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},n.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.subtract(t).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(t){var e=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=t.high_>>>16,u=65535&t.high_,c=t.low_>>>16,a=0,l=0,h=0,p=0;return h+=(p+=i+(65535&t.low_))>>>16,p&=65535,l+=(h+=o+c)>>>16,h&=65535,a+=(l+=r+u)>>>16,l&=65535,a+=e+s,a&=65535,n.fromBits(h<<16|p,a<<16|l)},n.prototype.subtract=function(t){return this.add(t.negate())},n.prototype.multiply=function(t){if(this.isZero())return n.ZERO;if(t.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return t.isOdd()?n.MIN_VALUE:n.ZERO;if(t.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&t.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*t.toNumber());var e=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=t.high_>>>16,u=65535&t.high_,c=t.low_>>>16,a=65535&t.low_,l=0,h=0,p=0,f=0;return p+=(f+=i*a)>>>16,f&=65535,h+=(p+=o*a)>>>16,p&=65535,h+=(p+=i*c)>>>16,p&=65535,l+=(h+=r*a)>>>16,h&=65535,l+=(h+=o*c)>>>16,h&=65535,l+=(h+=i*u)>>>16,h&=65535,l+=e*a+r*c+o*u+i*s,l&=65535,n.fromBits(p<<16|f,l<<16|h)},n.prototype.div=function(t){if(t.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(t.equals(n.ONE)||t.equals(n.NEG_ONE))return n.MIN_VALUE;if(t.equals(n.MIN_VALUE))return n.ONE;var e=this.shiftRight(1).div(t).shiftLeft(1);if(e.equals(n.ZERO))return t.isNegative()?n.ONE:n.NEG_ONE;var r=this.subtract(t.multiply(e));return e.add(r.div(t))}if(t.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();var o=n.ZERO;for(r=this;r.greaterThanOrEqual(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var i=Math.ceil(Math.log(e)/Math.LN2),s=i<=48?1:Math.pow(2,i-48),u=n.fromNumber(e),c=u.multiply(t);c.isNegative()||c.greaterThan(r);)e-=s,c=(u=n.fromNumber(e)).multiply(t);u.isZero()&&(u=n.ONE),o=o.add(u),r=r.subtract(c)}return o},n.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(t){return n.fromBits(this.low_&t.low_,this.high_&t.high_)},n.prototype.or=function(t){return n.fromBits(this.low_|t.low_,this.high_|t.high_)},n.prototype.xor=function(t){return n.fromBits(this.low_^t.low_,this.high_^t.high_)},n.prototype.shiftLeft=function(t){if(0===(t&=63))return this;var e=this.low_;if(t<32){var r=this.high_;return n.fromBits(e<<t,r<<t|e>>>32-t)}return n.fromBits(0,e<<t-32)},n.prototype.shiftRight=function(t){if(0===(t&=63))return this;var e=this.high_;if(t<32){var r=this.low_;return n.fromBits(r>>>t|e<<32-t,e>>t)}return n.fromBits(e>>t-32,e>=0?0:-1)},n.prototype.shiftRightUnsigned=function(t){if(0===(t&=63))return this;var e=this.high_;if(t<32){var r=this.low_;return n.fromBits(r>>>t|e<<32-t,e>>>t)}return 32===t?n.fromBits(e,0):n.fromBits(e>>>t-32,0)},n.fromInt=function(t){if(-128<=t&&t<128){var e=n.INT_CACHE_[t];if(e)return e}var r=new n(0|t,t<0?-1:0);return-128<=t&&t<128&&(n.INT_CACHE_[t]=r),r},n.fromNumber=function(t){return isNaN(t)||!isFinite(t)?n.ZERO:t<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:t+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:t<0?n.fromNumber(-t).negate():new n(t%n.TWO_PWR_32_DBL_|0,t/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(t,e){return new n(t,e)},n.fromString=function(t,e){if(0===t.length)throw Error("number format error: empty string");var r=e||10;if(r<2||36<r)throw Error("radix out of range: "+r);if("-"===t.charAt(0))return n.fromString(t.substring(1),r).negate();if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+t);for(var o=n.fromNumber(Math.pow(r,8)),i=n.ZERO,s=0;s<t.length;s+=8){var u=Math.min(8,t.length-s),c=parseInt(t.substring(s,s+u),r);if(u<8){var a=n.fromNumber(Math.pow(r,u));i=i.multiply(a).add(n.fromNumber(c))}else i=(i=i.multiply(o)).add(n.fromNumber(c))}return i},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),t.exports=n,t.exports.Timestamp=n},function(t,e,n){var r="inspect",o=parseInt(16777215*Math.random(),10),i=new RegExp("^[0-9a-fA-F]{24}$");try{if(Buffer&&Buffer.from){var s=!0;r=n(0).inspect.custom||"inspect"}}catch(t){s=!1}for(var u=function t(e){if(e instanceof t)return e;if(!(this instanceof t))return new t(e);if(this._bsontype="ObjectID",null==e||"number"==typeof e)return this.id=this.generate(e),void(t.cacheHexString&&(this.__id=this.toString("hex")));var n=t.isValid(e);if(!n&&null!=e)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(n&&"string"==typeof e&&24===e.length&&s)return new t(new Buffer(e,"hex"));if(n&&"string"==typeof e&&24===e.length)return t.createFromHexString(e);if(null==e||12!==e.length){if(null!=e&&e.toHexString)return e;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=e,t.cacheHexString&&(this.__id=this.toString("hex"))},c=[],a=0;a<256;a++)c[a]=(a<=15?"0":"")+a.toString(16);u.prototype.toHexString=function(){if(u.cacheHexString&&this.__id)return this.__id;var t="";if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof h)return t=p(this.id),u.cacheHexString&&(this.__id=t),t;for(var e=0;e<this.id.length;e++)t+=c[this.id.charCodeAt(e)];return u.cacheHexString&&(this.__id=t),t},u.prototype.get_inc=function(){return u.index=(u.index+1)%16777215},u.prototype.getInc=function(){return this.get_inc()},u.prototype.generate=function(t){"number"!=typeof t&&(t=~~(Date.now()/1e3));var e=("undefined"==typeof process||1===process.pid?Math.floor(1e5*Math.random()):process.pid)%65535,n=this.get_inc(),r=new Buffer(12);return r[3]=255&t,r[2]=t>>8&255,r[1]=t>>16&255,r[0]=t>>24&255,r[6]=255&o,r[5]=o>>8&255,r[4]=o>>16&255,r[8]=255&e,r[7]=e>>8&255,r[11]=255&n,r[10]=n>>8&255,r[9]=n>>16&255,r},u.prototype.toString=function(t){return this.id&&this.id.copy?this.id.toString("string"==typeof t?t:"hex"):this.toHexString()},u.prototype[r]=u.prototype.toString,u.prototype.toJSON=function(){return this.toHexString()},u.prototype.equals=function(t){return t instanceof u?this.toString()===t.toString():"string"==typeof t&&u.isValid(t)&&12===t.length&&this.id instanceof h?t===this.id.toString("binary"):"string"==typeof t&&u.isValid(t)&&24===t.length?t.toLowerCase()===this.toHexString():"string"==typeof t&&u.isValid(t)&&12===t.length?t===this.id:!(null==t||!(t instanceof u||t.toHexString))&&t.toHexString()===this.toHexString()},u.prototype.getTimestamp=function(){var t=new Date,e=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24;return t.setTime(1e3*Math.floor(e)),t},u.index=~~(16777215*Math.random()),u.createPk=function(){return new u},u.createFromTime=function(t){var e=new Buffer([0,0,0,0,0,0,0,0,0,0,0,0]);return e[3]=255&t,e[2]=t>>8&255,e[1]=t>>16&255,e[0]=t>>24&255,new u(e)};var l=[];for(a=0;a<10;)l[48+a]=a++;for(;a<16;)l[55+a]=l[87+a]=a++;var h=Buffer,p=function(t){return t.toString("hex")};u.createFromHexString=function(t){if(void 0===t||null!=t&&24!==t.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(s)return new u(new Buffer(t,"hex"));for(var e=new h(12),n=0,r=0;r<24;)e[n++]=l[t.charCodeAt(r++)]<<4|l[t.charCodeAt(r++)];return new u(e)},u.isValid=function(t){return null!=t&&("number"==typeof t||("string"==typeof t?12===t.length||24===t.length&&i.test(t):t instanceof u||(t instanceof h||!!t.toHexString&&(12===t.id.length||24===t.id.length&&i.test(t.id)))))},Object.defineProperty(u.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(t){this.id[3]=255&t,this.id[2]=t>>8&255,this.id[1]=t>>16&255,this.id[0]=t>>24&255}}),t.exports=u,t.exports.ObjectID=u,t.exports.ObjectId=u},function(t,e){function n(t,e){if(!(this instanceof n))return new n;this._bsontype="BSONRegExp",this.pattern=t||"",this.options=e||"";for(var r=0;r<this.options.length;r++)if("i"!==this.options[r]&&"m"!==this.options[r]&&"x"!==this.options[r]&&"l"!==this.options[r]&&"s"!==this.options[r]&&"u"!==this.options[r])throw new Error("the regular expression options ["+this.options[r]+"] is not supported")}t.exports=n,t.exports.BSONRegExp=n},function(t,e,n){var r=Buffer&&n(0).inspect.custom||"inspect";function o(t){if(!(this instanceof o))return new o(t);this._bsontype="Symbol",this.value=t}o.prototype.valueOf=function(){return this.value},o.prototype.toString=function(){return this.value},o.prototype[r]=function(){return this.value},o.prototype.toJSON=function(){return this.value},t.exports=o,t.exports.Symbol=o},function(t,e){var n=function t(e,n){if(!(this instanceof t))return new t(e,n);this._bsontype="Code",this.code=e,this.scope=n};n.prototype.toJSON=function(){return{scope:this.scope,code:this.code}},t.exports=n,t.exports.Code=n},function(t,e,n){"use strict";var r=n(42),o=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,i=/^(\+|-)?(Infinity|inf)$/i,s=/^(\+|-)?NaN$/i,u=6176,c=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),a=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),l=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),h=/^([-+])?(\d+)?$/,p=function(t){return!isNaN(parseInt(t,10))},f=function(t){var e=r.fromNumber(1e9),n=r.fromNumber(0),o=0;if(!(t.parts[0]||t.parts[1]||t.parts[2]||t.parts[3]))return{quotient:t,rem:n};for(o=0;o<=3;o++)n=(n=n.shiftLeft(32)).add(new r(t.parts[o],0)),t.parts[o]=n.div(e).low_,n=n.modulo(e);return{quotient:t,rem:n}},d=function(t){this._bsontype="Decimal128",this.bytes=t};d.fromString=function(t){var e,n=!1,f=!1,m=!1,g=0,y=0,_=0,v=0,w=0,b=[0],O=0,S=0,A=0,C=0,T=0,E=0,N=[0,0],$=[0,0],I=0;if((t=t.trim()).length>=7e3)throw new Error(t+" not a valid Decimal128 string");var M=t.match(o),R=t.match(i),P=t.match(s);if(!M&&!R&&!P||0===t.length)throw new Error(t+" not a valid Decimal128 string");if(M&&M[4]&&void 0===M[2])throw new Error(t+" not a valid Decimal128 string");if("+"!==t[I]&&"-"!==t[I]||(n="-"===t[I++]),!p(t[I])&&"."!==t[I]){if("i"===t[I]||"I"===t[I])return new d(new Buffer(n?a:l));if("N"===t[I])return new d(new Buffer(c))}for(;p(t[I])||"."===t[I];)if("."!==t[I])O<34&&("0"!==t[I]||m)&&(m||(w=y),m=!0,b[S++]=parseInt(t[I],10),O+=1),m&&(_+=1),f&&(v+=1),y+=1,I+=1;else{if(f)return new d(new Buffer(c));f=!0,I+=1}if(f&&!y)throw new Error(t+" not a valid Decimal128 string");if("e"===t[I]||"E"===t[I]){var j=t.substr(++I).match(h);if(!j||!j[2])return new d(new Buffer(c));T=parseInt(j[0],10),I+=j[0].length}if(t[I])return new d(new Buffer(c));if(A=0,O){if(C=O-1,g=_,0!==T&&1!==g)for(;"0"===t[w+g-1];)g-=1}else A=0,C=0,b[0]=0,_=1,O=1,g=0;for(T<=v&&v-T>16384?T=-6176:T-=v;T>6111;){if((C+=1)-A>34){var D=b.join("");if(D.match(/^0+$/)){T=6111;break}return new d(new Buffer(n?a:l))}T-=1}for(;T<-6176||O<_;){if(0===C){T=-6176,g=0;break}if(O<_?_-=1:C-=1,!(T<6111)){if((D=b.join("")).match(/^0+$/)){T=6111;break}return new d(new Buffer(n?a:l))}T+=1}if(C-A+1<g&&"0"!==t[g]){var B=y;f&&-6176===T&&(w+=1,B+=1);var L=parseInt(t[w+C+1],10),F=0;if(L>=5&&(F=1,5===L))for(F=b[C]%2==1,E=w+C+2;E<B;E++)if(parseInt(t[E],10)){F=1;break}if(F)for(var U=C;U>=0&&++b[U]>9;U--)if(b[U]=0,0===U){if(!(T<6111))return new d(new Buffer(n?a:l));T+=1,b[U]=1}}if(N=r.fromNumber(0),$=r.fromNumber(0),0===g)N=r.fromNumber(0),$=r.fromNumber(0);else if(C-A<17)for(U=A,$=r.fromNumber(b[U++]),N=new r(0,0);U<=C;U++)$=($=$.multiply(r.fromNumber(10))).add(r.fromNumber(b[U]));else{for(U=A,N=r.fromNumber(b[U++]);U<=C-17;U++)N=(N=N.multiply(r.fromNumber(10))).add(r.fromNumber(b[U]));for($=r.fromNumber(b[U++]);U<=C;U++)$=($=$.multiply(r.fromNumber(10))).add(r.fromNumber(b[U]))}var q,x,W,V,H=function(t,e){if(!t&&!e)return{high:r.fromNumber(0),low:r.fromNumber(0)};var n=t.shiftRightUnsigned(32),o=new r(t.getLowBits(),0),i=e.shiftRightUnsigned(32),s=new r(e.getLowBits(),0),u=n.multiply(i),c=n.multiply(s),a=o.multiply(i),l=o.multiply(s);return u=u.add(c.shiftRightUnsigned(32)),c=new r(c.getLowBits(),0).add(a).add(l.shiftRightUnsigned(32)),{high:u=u.add(c.shiftRightUnsigned(32)),low:l=c.shiftLeft(32).add(new r(l.getLowBits(),0))}}(N,r.fromString("100000000000000000"));H.low=H.low.add($),q=H.low,x=$,W=q.high_>>>0,V=x.high_>>>0,(W<V||W===V&&q.low_>>>0<x.low_>>>0)&&(H.high=H.high.add(r.fromNumber(1))),e=T+u;var Y={low:r.fromNumber(0),high:r.fromNumber(0)};H.high.shiftRightUnsigned(49).and(r.fromNumber(1)).equals(r.fromNumber)?(Y.high=Y.high.or(r.fromNumber(3).shiftLeft(61)),Y.high=Y.high.or(r.fromNumber(e).and(r.fromNumber(16383).shiftLeft(47))),Y.high=Y.high.or(H.high.and(r.fromNumber(0x7fffffffffff)))):(Y.high=Y.high.or(r.fromNumber(16383&e).shiftLeft(49)),Y.high=Y.high.or(H.high.and(r.fromNumber(562949953421311)))),Y.low=H.low,n&&(Y.high=Y.high.or(r.fromString("9223372036854775808")));var Q=new Buffer(16);return I=0,Q[I++]=255&Y.low.low_,Q[I++]=Y.low.low_>>8&255,Q[I++]=Y.low.low_>>16&255,Q[I++]=Y.low.low_>>24&255,Q[I++]=255&Y.low.high_,Q[I++]=Y.low.high_>>8&255,Q[I++]=Y.low.high_>>16&255,Q[I++]=Y.low.high_>>24&255,Q[I++]=255&Y.high.low_,Q[I++]=Y.high.low_>>8&255,Q[I++]=Y.high.low_>>16&255,Q[I++]=Y.high.low_>>24&255,Q[I++]=255&Y.high.high_,Q[I++]=Y.high.high_>>8&255,Q[I++]=Y.high.high_>>16&255,Q[I++]=Y.high.high_>>24&255,new d(Q)};u=6176,d.prototype.toString=function(){for(var t,e,n,o,i,s,c=0,a=new Array(36),l=0;l<a.length;l++)a[l]=0;var h,p,d,m,g,y=0,_=!1,v={parts:new Array(4)},w=[];y=0;var b=this.bytes;if(o=b[y++]|b[y++]<<8|b[y++]<<16|b[y++]<<24,n=b[y++]|b[y++]<<8|b[y++]<<16|b[y++]<<24,e=b[y++]|b[y++]<<8|b[y++]<<16|b[y++]<<24,t=b[y++]|b[y++]<<8|b[y++]<<16|b[y++]<<24,y=0,{low:new r(o,n),high:new r(e,t)}.high.lessThan(r.ZERO)&&w.push("-"),(i=t>>26&31)>>3==3){if(30===i)return w.join("")+"Infinity";if(31===i)return"NaN";s=t>>15&16383,d=8+(t>>14&1)}else d=t>>14&7,s=t>>17&16383;if(h=s-u,v.parts[0]=(16383&t)+((15&d)<<14),v.parts[1]=e,v.parts[2]=n,v.parts[3]=o,0===v.parts[0]&&0===v.parts[1]&&0===v.parts[2]&&0===v.parts[3])_=!0;else for(g=3;g>=0;g--){var O=0,S=f(v);if(v=S.quotient,O=S.rem.low_)for(m=8;m>=0;m--)a[9*g+m]=O%10,O=Math.floor(O/10)}if(_)c=1,a[y]=0;else for(c=36,l=0;!a[y];)l++,c-=1,y+=1;if((p=c-1+h)>=34||p<=-7||h>0){for(w.push(a[y++]),(c-=1)&&w.push("."),l=0;l<c;l++)w.push(a[y++]);w.push("E"),p>0?w.push("+"+p):w.push(p)}else if(h>=0)for(l=0;l<c;l++)w.push(a[y++]);else{var A=c+h;if(A>0)for(l=0;l<A;l++)w.push(a[y++]);else w.push("0");for(w.push(".");A++<0;)w.push("0");for(l=0;l<c-Math.max(A-1,0);l++)w.push(a[y++])}return w.join("")},d.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},t.exports=d,t.exports.Decimal128=d},function(t,e){function n(){if(!(this instanceof n))return new n;this._bsontype="MaxKey"}t.exports=n,t.exports.MaxKey=n},function(t,e){function n(t,e,r){if(!(this instanceof n))return new n(t,e,r);this._bsontype="DBRef",this.namespace=t,this.oid=e,this.db=r}n.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:null==this.db?"":this.db}},t.exports=n,t.exports.DBRef=n},function(t,e,n){"use strict";var r=n(20).retrieveSnappy(),o=n(210),i={snappy:1,zlib:2};t.exports={compressorIDs:i,uncompressibleCommands:["ismaster","saslStart","saslContinue","getnonce","authenticate","createUser","updateUser","copydbSaslStart","copydbgetnonce","copydb"],compress:function(t,e,n){switch(t.options.agreedCompressor){case"snappy":r.compress(e,n);break;case"zlib":var i={};t.options.zlibCompressionLevel&&(i.level=t.options.zlibCompressionLevel),o.deflate(e,i,n);break;default:throw new Error('Attempt to compress message using unknown compressor "'+t.options.agreedCompressor+'".')}},decompress:function(t,e,n){if(t<0||t>i.length)throw new Error("Server sent message compressed using an unsupported compressor. (Received compressor ID "+t+")");switch(t){case i.snappy:r.uncompress(e,n);break;case i.zlib:o.inflate(e,n);break;default:n(null,e)}}}},function(t,e,n){"use strict";const r=n(146),o=n(147),i=n(148),s=n(149),u=n(243),c=n(76).ScramSHA1,a=n(76).ScramSHA256;t.exports={defaultAuthProviders:function(t){return{mongocr:new r(t),x509:new o(t),plain:new i(t),gssapi:new s(t),sspi:new u(t),"scram-sha-1":new c(t),"scram-sha-256":new a(t)}}}},function(t,e,n){"use strict";var r=n(0).format,o=n(11),i=n(20).retrieveBSON,s=n(18).Query,u=n(4).MongoError,c=n(14).Buffer;let a;try{a=n(244)}catch(t){}var l=i().Binary,h=function(t,e,n){this.db=t,this.username=e,this.password=n};h.prototype.equal=function(t){return t.db===this.db&&t.username===this.username&&t.password===this.password};var p=0,f=function(t,e){this.bson=t,this.authStore=[],this.id=p++,this.cryptoMethod=e||"sha1"};function d(t,e,n){return o.createHmac(t,e).update(n).digest()}var m={},g=0,y=function(){m={},g=0};const _={sha256:32,sha1:20};f.prototype.auth=function(t,e,n,i,p,f){var w=this,b=e.length;if(0===b)return f(null,null);var O=0,S=null;const A=this.cryptoMethod;let C,T="SCRAM-SHA-1";if("sha256"===A){T="SCRAM-SHA-256";let e=t.s&&t.s.saslprep||a;e?C=e(p):(console.warn("Warning: no saslprep library specified. Passwords will not be sanitized"),C=p)}else C=function(t,e){if("string"!=typeof t)throw new u("username must be a string");if("string"!=typeof e)throw new u("password must be a string");if(0===e.length)throw new u("password cannot be empty");var n=o.createHash("md5");return n.update(t+":mongo:"+e,"utf8"),n.digest("hex")}(i,p);for(var E=function(e){i=i.replace("=","=3D").replace(",","=2C");var a=o.randomBytes(24).toString("base64");const E=c.concat([c.from("n=","utf8"),c.from(i,"utf8"),c.from(",r=","utf8"),c.from(a,"utf8")]);var N={saslStart:1,mechanism:T,payload:new l(c.concat([c.from("n,,","utf8"),E])),autoAuthorize:1},$=function(t,e){return t?(O-=1,S=t,!1):e.result.$err?(S=e.result,!1):e.result.errmsg?(S=e.result,!1):(O+=1,!0)},I=function(t,e){var o,s;$(t,e),s=O,0===(o=b-=1)&&s>0?(v(w.authStore,new h(n,i,p)),f(null,!0)):0===o&&(null==S&&(S=new u(r("failed to authenticate using scram"))),f(S,!1))};t(e,new s(w.bson,r("%s.$cmd",n),N,{numberToSkip:0,numberToReturn:1}),function(a,T){if(!1===$(a,T))return 0===(b-=1)&&O>0?(v(w.authStore,new h(n,i,p)),f(null,!0)):0===b?(null==S&&(S=new u(r("failed to authenticate using scram"))),f(S,!1)):void 0;var N=function(t){for(var e={},n=t.split(","),r=0;r<n.length;r++){var o=n[r].split("=");e[o[0]]=o[1]}return e}(T.result.payload.value()),M=parseInt(N.i,10),R=N.s,P=N.r,j=r("c=biws,r=%s",P),D=function(t,e,n,r){const i=[t,e.toString("base64"),n].join("_");if(void 0!==m[i])return m[i];const s=o.pbkdf2Sync(t,e,n,_[r],r);return g>=200&&y(),m[i]=s,g+=1,s}(C,c.from(R,"base64"),M,A);if(M&&M<4096){const t=new u(`Server returned an invalid iteration count ${M}`);return f(t,!1)}const B=d(A,D,"Client Key"),L=(F=A,U=B,o.createHash(F).update(U).digest());var F,U;const q=[E,T.result.payload.value().toString("base64"),j].join(","),x=d(A,L,q),W=[j,r("p=%s",function(t,e){c.isBuffer(t)||(t=c.from(t)),c.isBuffer(e)||(e=c.from(e));const n=Math.max(t.length,e.length),r=[];for(let o=0;o<n;o+=1)r.push(t[o]^e[o]);return c.from(r).toString("base64")}(B,x))].join(","),V={saslContinue:1,conversationId:T.result.conversationId,payload:new l(c.from(W))};t(e,new s(w.bson,r("%s.$cmd",n),V,{numberToSkip:0,numberToReturn:1}),function(o,i){if(i&&!1===i.result.done){var u={saslContinue:1,conversationId:i.result.conversationId,payload:c.alloc(0)};t(e,new s(w.bson,r("%s.$cmd",n),u,{numberToSkip:0,numberToReturn:1}),function(t,e){I(t,e)})}else I(o,i)})})},N=function(t){process.nextTick(function(){E(t)})};e.length>0;)N(e.shift())};var v=function(t,e){for(var n=!1,r=0;r<t.length;r++)if(t[r].equal(e)){n=!0;break}n||t.push(e)};f.prototype.logout=function(t){this.authStore=this.authStore.filter(function(e){return e.db!==t})},f.prototype.reauthenticate=function(t,e,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(t,e,r[i].db,r[i].username,r[i].password,function(t){0===(o-=1)&&n(t,null)})};t.exports={ScramSHA1:class extends f{constructor(t){super(t,"sha1")}},ScramSHA256:class extends f{constructor(t){super(t,"sha256")}}}},function(t,e,n){"use strict";const r=n(34),o=n(20).retrieveBSON,i=n(4).MongoError,s=n(4).MongoNetworkError,u=n(4).mongoErrorContextSymbol,c=n(0).format,a=n(27).collationNotSupported;var l=o().Long,h=function(t,e,n,o,i,s){o=o||{},this.pool=null,this.server=null,this.disconnectHandler=o.disconnectHandler,this.bson=t,this.ns=e,this.cmd=n,this.options=o,this.topology=i,this.cursorState={cursorId:null,cmd:n,documents:o.documents||[],cursorIndex:0,dead:!1,killed:!1,init:!1,notified:!1,limit:o.limit||n.limit||0,skip:o.skip||n.skip||0,batchSize:o.batchSize||n.batchSize||1e3,currentLimit:0,transforms:o.transforms},"object"==typeof o.session&&(this.cursorState.session=o.session),"boolean"==typeof s.promoteLongs?this.cursorState.promoteLongs=s.promoteLongs:"boolean"==typeof o.promoteLongs&&(this.cursorState.promoteLongs=o.promoteLongs),"boolean"==typeof s.promoteValues?this.cursorState.promoteValues=s.promoteValues:"boolean"==typeof o.promoteValues&&(this.cursorState.promoteValues=o.promoteValues),"boolean"==typeof s.promoteBuffers?this.cursorState.promoteBuffers=s.promoteBuffers:"boolean"==typeof o.promoteBuffers&&(this.cursorState.promoteBuffers=o.promoteBuffers),s.reconnect&&(this.cursorState.reconnect=s.reconnect),this.logger=r("Cursor",s),"number"==typeof n?(this.cursorState.cursorId=l.fromNumber(n),this.cursorState.lastCursorId=this.cursorState.cursorId):n instanceof l&&(this.cursorState.cursorId=n,this.cursorState.lastCursorId=n)};h.prototype.setCursorBatchSize=function(t){this.cursorState.batchSize=t},h.prototype.cursorBatchSize=function(){return this.cursorState.batchSize},h.prototype.setCursorLimit=function(t){this.cursorState.limit=t},h.prototype.cursorLimit=function(){return this.cursorState.limit},h.prototype.setCursorSkip=function(t){this.cursorState.skip=t},h.prototype.cursorSkip=function(){return this.cursorState.skip},h.prototype._endSession=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};const n=this.cursorState.session;return n&&(t.force||n.owner===this)?(this.cursorState.session=void 0,n.endSession(e),!0):(e&&e(),!1)};var p=function(t,e,n){try{t(e,n)}catch(e){process.nextTick(function(){throw e})}};h.prototype._find=function(t){var e=this;e.logger.isDebug()&&e.logger.debug(c("issue initial query [%s] with flags [%s]",JSON.stringify(e.cmd),JSON.stringify(e.query)));var n={};(e.options.raw||e.cmd.raw)&&(n.raw=e.options.raw||e.cmd.raw),"string"==typeof e.query.documentsReturnedIn&&(n.documentsReturnedIn=e.query.documentsReturnedIn),"boolean"==typeof e.cursorState.promoteLongs&&(n.promoteLongs=e.cursorState.promoteLongs),"boolean"==typeof e.cursorState.promoteValues&&(n.promoteValues=e.cursorState.promoteValues),"boolean"==typeof e.cursorState.promoteBuffers&&(n.promoteBuffers=e.cursorState.promoteBuffers),"object"==typeof e.cursorState.session&&(n.session=e.cursorState.session),e.server.s.pool.write(e.query,n,function(n,r){if(n)return t(n);var o=r.message;if(o.queryFailure)return t(new i(o.documents[0]),null);if(Array.isArray(o.documents)&&1===o.documents.length&&(!e.cmd.find||e.cmd.find&&!1===e.cmd.virtual)&&("string"!=typeof o.documents[0].cursor||o.documents[0].$err||o.documents[0].errmsg||Array.isArray(o.documents[0].result))){if(o.documents[0].$err||o.documents[0].errmsg)return t(new i(o.documents[0]),null);if(null!=o.documents[0].cursor&&"string"!=typeof o.documents[0].cursor){var s=o.documents[0].cursor.id;return o.documents[0].cursor.ns&&(e.ns=o.documents[0].cursor.ns),e.cursorState.cursorId="number"==typeof s?l.fromNumber(s):s,e.cursorState.lastCursorId=e.cursorState.cursorId,e.cursorState.operationTime=o.documents[0].operationTime,Array.isArray(o.documents[0].cursor.firstBatch)&&(e.cursorState.documents=o.documents[0].cursor.firstBatch),t(null,o)}if(Array.isArray(o.documents[0].result))return e.cursorState.documents=o.documents[0].result,e.cursorState.cursorId=l.ZERO,t(null,o)}e.cursorState.cursorId=o.cursorId,e.cursorState.documents=o.documents,e.cursorState.lastCursorId=o.cursorId,e.cursorState.transforms&&"function"==typeof e.cursorState.transforms.query&&(e.cursorState.documents=e.cursorState.transforms.query(o)),t(null,o)})},h.prototype._getmore=function(t){this.logger.isDebug()&&this.logger.debug(c("schedule getMore call for query [%s]",JSON.stringify(this.query)));var e=this.options.raw||this.cmd.raw,n=this.cursorState.batchSize;this.cursorState.limit>0&&this.cursorState.currentLimit+n>this.cursorState.limit&&(n=this.cursorState.limit-this.cursorState.currentLimit);var r=this.server.s.pool;this.server.wireProtocolHandler.getMore(this.bson,this.ns,this.cursorState,n,e,r,this.options,t)},h.prototype.clone=function(){return this.topology.cursor(this.ns,this.cmd,this.options)},h.prototype.isDead=function(){return!0===this.cursorState.dead},h.prototype.isKilled=function(){return!0===this.cursorState.killed},h.prototype.isNotified=function(){return!0===this.cursorState.notified},h.prototype.bufferedCount=function(){return this.cursorState.documents.length-this.cursorState.cursorIndex},h.prototype.readBufferedDocuments=function(t){var e=this.cursorState.documents.length-this.cursorState.cursorIndex,n=t<e?t:e,r=this.cursorState.documents.slice(this.cursorState.cursorIndex,this.cursorState.cursorIndex+n);if(this.cursorState.transforms&&"function"==typeof this.cursorState.transforms.doc)for(var o=0;o<r.length;o++)r[o]=this.cursorState.transforms.doc(r[o]);return this.cursorState.limit>0&&this.cursorState.currentLimit+r.length>this.cursorState.limit&&(r=r.slice(0,this.cursorState.limit-this.cursorState.currentLimit),this.kill()),this.cursorState.currentLimit=this.cursorState.currentLimit+r.length,this.cursorState.cursorIndex=this.cursorState.cursorIndex+r.length,r},h.prototype.kill=function(t){if(this.cursorState.dead=!0,this.cursorState.killed=!0,this.cursorState.documents=[],null==this.cursorState.cursorId||this.cursorState.cursorId.isZero()||!1===this.cursorState.init)t&&t(null,null);else{var e=this.server.s.pool;this.server.wireProtocolHandler.killCursor(this.bson,this.ns,this.cursorState,e,t)}},h.prototype.rewind=function(){this.cursorState.init&&(this.cursorState.dead||this.kill(),this.cursorState.currentLimit=0,this.cursorState.init=!1,this.cursorState.dead=!1,this.cursorState.killed=!1,this.cursorState.notified=!1,this.cursorState.documents=[],this.cursorState.cursorId=null,this.cursorState.cursorIndex=0)};var f=function(t,e){if(t.pool&&t.pool.isDestroyed()){t.cursorState.killed=!0;const n=new s(c("connection to host %s:%s was destroyed",t.pool.host,t.pool.port));return g(t,()=>e(n)),!0}return!1},d=function(t,e){t.cursorState.dead=!0,m(t,e)},m=function(t,e){g(t,()=>p(e,null,null))},g=function(t,e){return t.cursorState.notified=!0,t.cursorState.documents=[],t.cursorState.cursorIndex=0,t._endSession?t._endSession(void 0,()=>e()):e()},y=function(t,e){if(t.cursorState.notified)return e(new Error("cursor is exhausted"));if(!function(t,e){return!!t.cursorState.killed&&(m(t,e),!0)}(t,e)&&!function(t,e){return!(!t.cursorState.dead||t.cursorState.killed||(t.cursorState.killed=!0,m(t,e),0))}(t,e)&&!function(t,e){return!(!t.cursorState.dead||!t.cursorState.killed||(p(e,new i("cursor is dead")),0))}(t,e)){if(!t.cursorState.init)return function(t,e){if(!t.topology.isConnected(t.options)){if("server"===t.topology._type&&!t.topology.s.options.reconnect)return e(new i("no connection available"));if(null!=t.disconnectHandler)return t.topology.isDestroyed()?e(new i("Topology was destroyed")):t.disconnectHandler.addObjectAndMethod("cursor",t,"next",[e],e)}return t.topology.selectServer(t.options,(n,r)=>{if(n)return null!=t.disconnectHandler?t.disconnectHandler.addObjectAndMethod("cursor",t,"next",[e],e):e(n);if(t.server=r,t.cursorState.init=!0,a(t.server,t.cmd))return e(new i(`server ${t.server.name} does not support collation`));try{if(t.query=t.server.wireProtocolHandler.command(t.bson,t.ns,t.cmd,t.cursorState,t.topology,t.options),t.query instanceof i)return e(t.query);y(t,e)}catch(n){return e(n)}})}(t,e);if(null==t.cursorState.cursorId){if(f(t,e))return;if(t.topology.isDestroyed())return e(new s("connection destroyed, not possible to instantiate cursor"));t._find(function(n){return n?p(e,n,null):(t.cursorState.cursorId&&t.cursorState.cursorId.isZero()&&t._endSession&&t._endSession(),0===t.cursorState.documents.length&&t.cursorState.cursorId&&t.cursorState.cursorId.isZero()&&!t.cmd.tailable&&!t.cmd.awaitData?m(t,e):void y(t,e))})}else{if(t.cursorState.limit>0&&t.cursorState.currentLimit>=t.cursorState.limit)return t.kill(),d(t,e);if(t.cursorState.cursorIndex!==t.cursorState.documents.length||l.ZERO.equals(t.cursorState.cursorId)){if(t.cursorState.documents.length===t.cursorState.cursorIndex&&t.cmd.tailable&&l.ZERO.equals(t.cursorState.cursorId))return p(e,new i({message:"No more documents in tailed cursor",tailable:t.cmd.tailable,awaitData:t.cmd.awaitData}));if(t.cursorState.documents.length===t.cursorState.cursorIndex&&l.ZERO.equals(t.cursorState.cursorId))d(t,e);else{if(t.cursorState.limit>0&&t.cursorState.currentLimit>=t.cursorState.limit)return t.kill(),d(t,e);t.cursorState.currentLimit+=1;var n=t.cursorState.documents[t.cursorState.cursorIndex++];if(!n||n.$err)return t.kill(),d(t,function(){p(e,new i(n?n.$err:void 0))});t.cursorState.transforms&&"function"==typeof t.cursorState.transforms.doc&&(n=t.cursorState.transforms.doc(n)),p(e,null,n)}}else{if(t.cursorState.documents=[],t.cursorState.cursorIndex=0,t.topology.isDestroyed())return e(new s("connection destroyed, not possible to instantiate cursor"));if(f(t,e))return;t._getmore(function(n,r,o){return n?(n instanceof i&&(n[u].isGetMore=!0),p(e,n)):(t.cursorState.cursorId&&t.cursorState.cursorId.isZero()&&t._endSession&&t._endSession(),t.connection=o,0===t.cursorState.documents.length&&t.cmd.tailable&&l.ZERO.equals(t.cursorState.cursorId)?p(e,new i({message:"No more documents in tailed cursor",tailable:t.cmd.tailable,awaitData:t.cmd.awaitData})):0===t.cursorState.documents.length&&t.cmd.tailable&&!l.ZERO.equals(t.cursorState.cursorId)?y(t,e):t.cursorState.limit>0&&t.cursorState.currentLimit>=t.cursorState.limit?d(t,e):void y(t,e))})}}}};h.prototype.next=function(t){y(this,t)},t.exports=h},function(t,e,n){"use strict";const r=n(102),o=n(44),i=n(10).EventEmitter,s=n(1).executeOperation,u=n(1).handleCallback,c=n(0).inherits,a=n(2).MongoError,l=n(105).connectOp,h=n(105).logout,p=n(105).validOptions;function f(t,e){if(!(this instanceof f))return new f(t,e);i.call(this),this.s={url:t,options:e||{},promiseLibrary:null,dbCache:{},sessions:[]};const n=this.s.options.promiseLibrary||Promise;this.s.promiseLibrary=n}c(f,i),f.prototype.connect=function(t){const e=p(this.s.options);if("string"==typeof t)throw new TypeError("`connect` only accepts a callback");return s(this,l,[this,e,t],{skipSessions:!0})},f.prototype.logout=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};const n=this.s.options.authSource?this.s.options.authSource:this.s.options.dbName;return s(this,h,[this,n,e],{skipSessions:!0})},f.prototype.close=function(t,e){"function"==typeof t&&(e=t,t=!1),this.topology&&this.topology.close(t),this.emit("close",this);for(const t in this.s.dbCache)this.s.dbCache[t].emit("close");return this.removeAllListeners("close"),"function"==typeof e?process.nextTick(()=>{u(e,null)}):new this.s.promiseLibrary(t=>{t()})},f.prototype.db=function(t,e){e=e||{},t||(t=this.s.options.dbName);const n=Object.assign({},this.s.options,e);if(this.s.dbCache[t]&&!0!==n.returnNonCachedInstance)return this.s.dbCache[t];if(n.promiseLibrary=this.s.promiseLibrary,!this.topology)throw new a("MongoClient must be connected before calling MongoClient.prototype.db");const r=new o(t,this.topology,n);return this.s.dbCache[t]=r,r},f.prototype.isConnected=function(t){return t=t||{},!!this.topology&&this.topology.isConnected(t)},f.connect=function(t,e,n){const r=Array.prototype.slice.call(arguments,1);return n="function"==typeof r[r.length-1]?r.pop():void 0,new f(t,e=(e=r.length?r.shift():null)||{}).connect(n)},f.prototype.startSession=function(t){if(t=Object.assign({explicit:!0},t),!this.topology)throw new a("Must connect to a server before calling this method");if(!this.topology.hasSessionSupport())throw new a("Current topology does not support sessions");return this.topology.startSession(t,this.s.options)},f.prototype.withSession=function(t,e){"function"==typeof t&&(e=t,t=void 0);const n=this.startSession(t);let r=(t,e,o)=>{if(r=(()=>{throw new ReferenceError("cleanupHandler was called too many times")}),o=Object.assign({throw:!0},o),n.endSession(),t){if(o.throw)throw t;return Promise.reject(t)}};try{const t=e(n);return Promise.resolve(t).then(t=>r(null,t)).catch(t=>r(t,null,{throw:!0}))}catch(t){return r(t,null,{throw:!1})}},f.prototype.watch=function(t,e){return t=t||[],e=e||{},Array.isArray(t)||(e=t,t=[]),new r(this,t,e)},f.prototype.getLogger=function(){return this.s.options.logger},t.exports=f},function(t,e,n){"use strict";const r=n(2).BSON.Long,o=n(2).MongoError,i=n(1).toError,s=n(1).handleCallback,u=n(1).applyRetryableWrites,c=n(1).applyWriteConcern,a=n(2).BSON.ObjectID,l=n(2).BSON,h=64,p=1,f=2,d=3,m=new l([l.Binary,l.Code,l.DBRef,l.Decimal128,l.Double,l.Int32,l.Long,l.Map,l.MaxKey,l.MinKey,l.ObjectId,l.BSONRegExp,l.Symbol,l.Timestamp]);class g{constructor(t){this.result=t}get ok(){return this.result.ok}get nInserted(){return this.result.nInserted}get nUpserted(){return this.result.nUpserted}get nMatched(){return this.result.nMatched}get nModified(){return this.result.nModified}get nRemoved(){return this.result.nRemoved}getInsertedIds(){return this.result.insertedIds}getUpsertedIds(){return this.result.upserted}getUpsertedIdAt(t){return this.result.upserted[t]}getRawResponse(){return this.result}hasWriteErrors(){return this.result.writeErrors.length>0}getWriteErrorCount(){return this.result.writeErrors.length}getWriteErrorAt(t){return t<this.result.writeErrors.length?this.result.writeErrors[t]:null}getWriteErrors(){return this.result.writeErrors}getLastOp(){return this.result.lastOp}getWriteConcernError(){if(0===this.result.writeConcernErrors.length)return null;if(1===this.result.writeConcernErrors.length)return this.result.writeConcernErrors[0];{let t="";for(let e=0;e<this.result.writeConcernErrors.length;e++){t+=this.result.writeConcernErrors[e].errmsg,0===e&&(t+=" and ")}return new y({errmsg:t,code:h})}}toJSON(){return this.result}toString(){return`BulkWriteResult(${this.toJSON(this.result)})`}isOk(){return 1===this.result.ok}}class y{constructor(t){this.err=t}get code(){return this.err.code}get errmsg(){return this.err.errmsg}toJSON(){return{code:this.err.code,errmsg:this.err.errmsg}}toString(){return`WriteConcernError(${this.err.errmsg})`}}class _{constructor(t){this.err=t}get code(){return this.err.code}get index(){return this.err.index}get errmsg(){return this.err.errmsg}getOperation(){return this.err.op}toJSON(){return{code:this.err.code,index:this.err.index,errmsg:this.err.errmsg,op:this.err.op}}toString(){return`WriteError(${JSON.stringify(this.toJSON())})`}}function v(t,e,n,o,i){if(o)i=o;else if(i&&i.result)i=i.result;else if(null==i)return;if(0===i.ok&&1===n.ok){n.ok=0;const t={index:0,code:i.code||0,errmsg:i.message,op:e.operations[0]};return void n.writeErrors.push(new _(t))}if(0===i.ok&&0===n.ok)return;if(i.opTime||i.lastOp){const t=i.lastOp||i.opTime;let e=null,o=null;if(t&&"Timestamp"===t._bsontype)null==n.lastOp?n.lastOp=t:t.greaterThan(n.lastOp)&&(n.lastOp=t);else{n.lastOp&&(e="number"==typeof n.lastOp.ts?r.fromNumber(n.lastOp.ts):n.lastOp.ts,o="number"==typeof n.lastOp.t?r.fromNumber(n.lastOp.t):n.lastOp.t);const i="number"==typeof t.ts?r.fromNumber(t.ts):t.ts,s="number"==typeof t.t?r.fromNumber(t.t):t.t;null==n.lastOp?n.lastOp=t:i.greaterThan(e)?n.lastOp=t:i.equals(e)&&s.greaterThan(o)&&(n.lastOp=t)}}e.batchType===p&&i.n&&(n.nInserted=n.nInserted+i.n),e.batchType===d&&i.n&&(n.nRemoved=n.nRemoved+i.n);let s=0;if(Array.isArray(i.upserted)){s=i.upserted.length;for(let t=0;t<i.upserted.length;t++)n.upserted.push({index:i.upserted[t].index+e.originalZeroIndex,_id:i.upserted[t]._id})}else i.upserted&&(s=1,n.upserted.push({index:e.originalZeroIndex,_id:i.upserted}));if(e.batchType===f&&i.n){const t=i.nModified;n.nUpserted=n.nUpserted+s,n.nMatched=n.nMatched+(i.n-s),n.nModified="number"==typeof t?n.nModified+t:null}if(Array.isArray(i.writeErrors))for(let t=0;t<i.writeErrors.length;t++){const r={index:e.originalZeroIndex+i.writeErrors[t].index,code:i.writeErrors[t].code,errmsg:i.writeErrors[t].errmsg,op:e.operations[i.writeErrors[t].index]};n.writeErrors.push(new _(r))}i.writeConcernError&&n.writeConcernErrors.push(new y(i.writeConcernError))}class w extends o{constructor(t,e){super(t.err||t.errmsg||t.errMessage||t),Object.assign(this,t),this.name="BulkWriteError",this.result=e}}class b{constructor(t){this.s=t.s}update(t){const e="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:t,multi:!0,upsert:e};return this.s.currentOp=null,this.s.options.addToOperationsList(this,f,n)}updateOne(t){const e="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:t,multi:!1,upsert:e};return this.s.currentOp=null,this.s.options.addToOperationsList(this,f,n)}replaceOne(t){this.updateOne(t)}upsert(){return this.s.currentOp.upsert=!0,this}deleteOne(){const t={q:this.s.currentOp.selector,limit:1};return this.s.currentOp=null,this.s.options.addToOperationsList(this,d,t)}delete(){const t={q:this.s.currentOp.selector,limit:0};return this.s.currentOp=null,this.s.options.addToOperationsList(this,d,t)}removeOne(){return this.deleteOne()}remove(){return this.delete()}}class O{constructor(t,e,n,r){this.isOrdered=r,n=null==n?{}:n;const o=e.collectionName,i=t.bson,s=t.lastIsMaster(),a=s&&s.maxBsonObjectSize?s.maxBsonObjectSize:16777216,l=s&&s.maxWriteBatchSize?s.maxWriteBatchSize:1e3;let h=Object.assign({},n);h=u(h,e.s.db);const p=(h=c(h,{collection:e},n)).writeConcern,f=n.promiseLibrary||Promise;this.s={bulkResult:{ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]},currentBatch:null,currentIndex:0,currentBatchSize:0,currentBatchSizeBytes:0,currentInsertBatch:null,currentUpdateBatch:null,currentRemoveBatch:null,batches:[],writeConcern:p,maxBatchSizeBytes:a,maxWriteBatchSize:l,namespace:o,bson:i,topology:t,options:h,currentOp:null,executed:!1,collection:e,promiseLibrary:f,err:null,checkKeys:"boolean"!=typeof n.checkKeys||n.checkKeys},!0===n.bypassDocumentValidation&&(this.s.bypassDocumentValidation=!0)}insert(t){return!0!==this.s.collection.s.db.options.forceServerObjectId&&null==t._id&&(t._id=new a),this.s.options.addToOperationsList(this,p,t)}find(t){if(!t)throw i("Bulk find operation must specify a selector");return this.s.currentOp={selector:t},new b(this)}raw(t){const e=Object.keys(t)[0],n="boolean"==typeof this.s.options.forceServerObjectId?this.s.options.forceServerObjectId:this.s.collection.s.db.options.forceServerObjectId;if(t.updateOne&&t.updateOne.q||t.updateMany&&t.updateMany.q||t.replaceOne&&t.replaceOne.q)return t[e].multi=!t.updateOne&&!t.replaceOne,this.s.options.addToOperationsList(this,f,t[e]);if(t.updateOne||t.updateMany||t.replaceOne){const n=!t.updateOne&&!t.replaceOne,r={q:t[e].filter,u:t[e].update||t[e].replacement,multi:n};return this.isOrdered?(r.upsert=!!t[e].upsert,t.collation&&(r.collation=t.collation)):t[e].upsert&&(r.upsert=!0),t[e].arrayFilters&&(r.arrayFilters=t[e].arrayFilters),this.s.options.addToOperationsList(this,f,r)}if(t.removeOne||t.removeMany||t.deleteOne&&t.deleteOne.q||t.deleteMany&&t.deleteMany.q)return t[e].limit=t.removeOne?1:0,this.s.options.addToOperationsList(this,d,t[e]);if(t.deleteOne||t.deleteMany){const n=t.deleteOne?1:0,r={q:t[e].filter,limit:n};return this.isOrdered&&t.collation&&(r.collation=t.collation),this.s.options.addToOperationsList(this,d,r)}if(t.insertOne&&null==t.insertOne.document)return!0!==n&&null==t.insertOne._id&&(t.insertOne._id=new a),this.s.options.addToOperationsList(this,p,t.insertOne);if(t.insertOne&&t.insertOne.document)return!0!==n&&null==t.insertOne.document._id&&(t.insertOne.document._id=new a),this.s.options.addToOperationsList(this,p,t.insertOne.document);if(!t.insertMany)throw i("bulkWrite only supports insertOne, insertMany, updateOne, updateMany, removeOne, removeMany, deleteOne, deleteMany");for(let e=0;e<t.insertMany.length;e++)!0!==n&&null==t.insertMany[e]._id&&(t.insertMany[e]._id=new a),this.s.options.addToOperationsList(this,p,t.insertMany[e])}bulkExecute(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},this.s.executed){const t=i("batch cannot be re-executed");return"function"==typeof n?n(t,null):this.s.promiseLibrary.reject(t)}if("function"==typeof t?n=t:t&&"object"==typeof t&&(this.s.writeConcern=t),this.isOrdered?this.s.currentBatch&&this.s.batches.push(this.s.currentBatch):(this.s.currentInsertBatch&&this.s.batches.push(this.s.currentInsertBatch),this.s.currentUpdateBatch&&this.s.batches.push(this.s.currentUpdateBatch),this.s.currentRemoveBatch&&this.s.batches.push(this.s.currentRemoveBatch)),0===this.s.batches.length){const t=i("Invalid Operation, no operations specified");return"function"==typeof n?n(t,null):this.s.promiseLibrary.reject(t)}return{options:e,callback:n}}finalOptionsHandler(t,e){const n=Object.assign({ordered:this.isOrdered},t.options);null!=this.s.writeConcern&&(n.writeConcern=this.s.writeConcern),!0!==n.bypassDocumentValidation&&delete n.bypassDocumentValidation,this.operationId&&(t.resultHandler.operationId=this.operationId),this.s.options.serializeFunctions&&(n.serializeFunctions=!0),this.s.options.ignoreUndefined&&(n.ignoreUndefined=!0),!0===this.s.bypassDocumentValidation&&(n.bypassDocumentValidation=!0),!1===this.s.checkKeys&&(n.checkKeys=!1),n.retryWrites&&(t.batch.batchType===f&&(n.retryWrites=n.retryWrites&&!t.batch.operations.some(t=>t.multi)),t.batch.batchType===d&&(n.retryWrites=n.retryWrites&&!t.batch.operations.some(t=>0===t.limit)));try{t.batch.batchType===p?this.s.topology.insert(this.s.collection.namespace,t.batch.operations,n,t.resultHandler):t.batch.batchType===f?this.s.topology.update(this.s.collection.namespace,t.batch.operations,n,t.resultHandler):t.batch.batchType===d&&this.s.topology.remove(this.s.collection.namespace,t.batch.operations,n,t.resultHandler)}catch(n){n.ok=0,s(e,null,v(0,t.batch,this.s.bulkResult,n,null))}}handleWriteError(t,e){return this.s.bulkResult.writeErrors.length>0?1===this.s.bulkResult.writeErrors.length?(s(t,new w(i(this.s.bulkResult.writeErrors[0]),e),null),!0):(s(t,new w(i({message:"write operation failed",code:this.s.bulkResult.writeErrors[0].code,writeErrors:this.s.bulkResult.writeErrors}),e),null),!0):e.getWriteConcernError()?(s(t,new w(i(e.getWriteConcernError()),e),null),!0):void 0}}Object.defineProperty(O.prototype,"length",{enumerable:!0,get:function(){return this.s.currentIndex}}),t.exports={Batch:class{constructor(t,e){this.originalZeroIndex=e,this.currentIndex=0,this.originalIndexes=[],this.batchType=t,this.operations=[],this.size=0,this.sizeBytes=0}},BulkOperationBase:O,BulkWriteError:w,BulkWriteResult:g,bson:m,FindOperators:b,handleMongoWriteConcernError:function(t,e,n,r,o){v(0,t,e,null,r.result);const u=new y({errmsg:r.result.writeConcernError.errmsg,code:r.result.writeConcernError.result});return s(o,new w(i(u),new g(e)),null)},LegacyOp:class{constructor(t,e,n){this.batchType=t,this.index=n,this.operation=e}},mergeBatchResults:v,INVALID_BSON_ERROR:22,MULTIPLE_ERROR:65,UNKNOWN_ERROR:8,WRITE_CONCERN_ERROR:h,INSERT:p,UPDATE:f,REMOVE:d,WriteError:_,WriteConcernError:y}},function(t,e,n){"use strict";const r=n(2).Server,o=n(28),i=n(45).TopologyBase,s=n(45).Store,u=n(2).MongoError,c=n(1).MAX_JS_INT,a=n(1).translateOptions,l=n(1).filterOptions,h=n(1).mergeOptions;var p=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","family","loggerLevel","logger","reconnectTries","reconnectInterval","monitoring","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","compression","promiseLibrary","monitorCommands"];class f extends i{constructor(t,e,n){super();const i=(n=l(n,p)).promiseLibrary;var f={force:!1,bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:c},d=n.store||new s(this,f);if(-1!==t.indexOf("/"))null!=e&&"object"==typeof e&&(n=e,e=null);else if(null==e)throw u.create({message:"port must be specified",driver:!0});var m="boolean"!=typeof n.auto_reconnect||n.auto_reconnect;m="boolean"==typeof n.autoReconnect?n.autoReconnect:m;var g=h({},{host:t,port:e,disconnectHandler:d,cursorFactory:o,reconnect:m,emitError:"boolean"!=typeof n.emitError||n.emitError,size:"number"==typeof n.poolSize?n.poolSize:5,monitorCommands:"boolean"==typeof n.monitorCommands&&n.monitorCommands});g=a(g,n);var y=n.socketOptions&&Object.keys(n.socketOptions).length>0?n.socketOptions:n;(g=a(g,y)).clientInfo=this.clientInfo,n.appname&&(g.clientInfo.application={name:n.appname}),this.s={coreTopology:new r(g),sCapabilities:null,clonedOptions:g,reconnect:g.reconnect,emitError:g.emitError,poolSize:g.size,storeOptions:f,store:d,host:t,port:e,options:n,sessionPool:null,sessions:[],promiseLibrary:i||Promise}}connect(t,e){var n=this;"function"==typeof t&&(e=t,t={}),null==t&&(t=this.s.clonedOptions),"function"!=typeof e&&(e=null),t=Object.assign({},this.s.clonedOptions,t),n.s.options=t,n.s.storeOptions.bufferMaxEntries="number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:-1;var r=function(){return function(t){["timeout","error","close"].forEach(function(t){n.s.coreTopology.removeListener(t,u[t])}),n.s.coreTopology.removeListener("connect",r);try{e(t)}catch(t){process.nextTick(function(){throw t})}}},o=function(t){return function(e){"error"!==t&&n.emit(t,e)}},i=function(){n.s.store.flush()},s=function(t){return function(e,r){n.emit(t,e,r)}},u={timeout:r("timeout"),error:r("error"),close:r("close")};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach(function(t){n.s.coreTopology.removeAllListeners(t)}),n.s.coreTopology.once("timeout",u.timeout),n.s.coreTopology.once("error",u.error),n.s.coreTopology.once("close",u.close),n.s.coreTopology.once("connect",function(){["timeout","error","close","destroy"].forEach(function(t){n.s.coreTopology.removeAllListeners(t)}),n.s.coreTopology.on("timeout",o("timeout")),n.s.coreTopology.once("error",o("error")),n.s.coreTopology.on("close",o("close")),n.s.coreTopology.on("destroy",i),n.emit("open",null,n);try{e(null,n)}catch(t){process.nextTick(function(){throw t})}}),n.s.coreTopology.on("reconnect",function(){n.emit("reconnect",n),n.s.store.execute()}),n.s.coreTopology.on("reconnectFailed",function(t){n.emit("reconnectFailed",t),n.s.store.flush(t)}),n.s.coreTopology.on("serverDescriptionChanged",s("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",s("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",s("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",s("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",s("serverOpening")),n.s.coreTopology.on("serverClosed",s("serverClosed")),n.s.coreTopology.on("topologyOpening",s("topologyOpening")),n.s.coreTopology.on("topologyClosed",s("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",s("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",s("commandStarted")),n.s.coreTopology.on("commandSucceeded",s("commandSucceeded")),n.s.coreTopology.on("commandFailed",s("commandFailed")),n.s.coreTopology.on("attemptReconnect",s("attemptReconnect")),n.s.coreTopology.on("monitoring",s("monitoring")),n.s.coreTopology.connect(t)}}Object.defineProperty(f.prototype,"poolSize",{enumerable:!0,get:function(){return this.s.coreTopology.connections().length}}),Object.defineProperty(f.prototype,"autoReconnect",{enumerable:!0,get:function(){return this.s.reconnect}}),Object.defineProperty(f.prototype,"host",{enumerable:!0,get:function(){return this.s.host}}),Object.defineProperty(f.prototype,"port",{enumerable:!0,get:function(){return this.s.port}}),t.exports=f},function(t,e,n){"use strict";
/*!
 * Connection states
 */const r=t.exports=Object.create(null);r[0]="disconnected",r[1]="connected",r[2]="connecting",r[3]="disconnecting",r[99]="uninitialized",r.disconnected=0,r.connected=1,r.connecting=2,r.disconnecting=3,r.uninitialized=99},function(t,e){t.exports=function(t,e,n){var r=[],o=t.length;if(0===o)return r;var i=e<0?Math.max(0,e+o):e||0;for(void 0!==n&&(o=n<0?n+o:n);o-- >i;)r[o-i]=t[o];return r}},function(t,e,n){"use strict";t.exports=n(30).get().Decimal128},function(t,e,n){"use strict";
/*!
 * ignore
 */const r=n(29),o=n(106),i={_promise:null,get:function(){return i._promise},set:function(t){r.ok("function"==typeof t,`mongoose.Promise must be a function, got ${t}`),i._promise=t,o.Promise=t}};
/*!
 * Use native promises by default
 */
i.set(global.Promise),t.exports=i},function(t,e,n){"use strict";var r=["find","findOne","update","updateMany","updateOne","replaceOne","remove","count","distinct","findAndModify","aggregate","findStream","deleteOne","deleteMany"];function o(){}for(var i=0,s=r.length;i<s;++i){var u=r[i];o.prototype[u]=c(u)}function c(t){return function(){throw new Error("collection."+t+" not implemented")}}t.exports=o,o.methods=r},function(t,e,n){"use strict";function r(t){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this):this.stack=(new Error).stack,this.message=t,this.name="MongooseError"}
/*!
 * Inherits from Error.
 */r.prototype=Object.create(Error.prototype),r.prototype.constructor=Error,t.exports=r},function(t,e,n){"use strict";e.schemaMixedSymbol=Symbol.for("mongoose:schema_mixed"),e.builtInMiddleware=Symbol.for("mongoose:built-in-middleware")},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(10).EventEmitter,o=n(171),i=n(19),s=n(111),u=n(172),c=n(174),a=n(8),l=n(321),h=n(173),p=n(322),f=n(56),d=n(30).get().ReadPreference,m=n(87),g=n(0),y=n(5),_=n(323);let v;const w=n(175).middlewareFunctions,b=n(113).middlewareFunctions,O=w.concat(b).reduce((t,e)=>t.add(e),new Set);let S=0;function A(t,e){if(!(this instanceof A))return new A(t,e);if(this.obj=t,this.paths={},this.aliases={},this.subpaths={},this.virtuals={},this.singleNestedPaths={},this.nested={},this.inherits={},this.callQueue=[],this._indexes=[],this.methods={},this.methodOptions={},this.statics={},this.tree={},this.query={},this.childSchemas=[],this.plugins=[],this.$id=++S,this.s={hooks:new o},this.options=this.defaultOptions(e),Array.isArray(t))for(const e of t)this.add(e);else t&&this.add(t);const n=t&&t._id&&y.isObject(t._id);if(!this.paths._id&&!this.options.noId&&this.options._id&&!n){const t={_id:{auto:!0}};t._id[this.options.typeKey]=A.ObjectId,this.add(t)}this.setupTimestamp(this.options.timestamps)}
/*!
 * Create virtual properties with alias field
 */
/*!
 * Inherit from EventEmitter.
 */
A.prototype=Object.create(r.prototype),A.prototype.constructor=A,A.prototype.instanceOfSchema=!0,
/*!
 * ignore
 */
Object.defineProperty(A.prototype,"$schemaType",{configurable:!1,enumerable:!1,writable:!0}),Object.defineProperty(A.prototype,"childSchemas",{configurable:!1,enumerable:!0,writable:!0}),A.prototype.obj,A.prototype.paths,A.prototype.tree,A.prototype.clone=function(){const t=new A({},this._userProvidedOptions);return t.base=this.base,t.obj=this.obj,t.options=y.clone(this.options),t.callQueue=this.callQueue.map(function(t){return t}),t.methods=y.clone(this.methods),t.methodOptions=y.clone(this.methodOptions),t.statics=y.clone(this.statics),t.query=y.clone(this.query),t.plugins=Array.prototype.slice.call(this.plugins),t._indexes=y.clone(this._indexes),t.s.hooks=this.s.hooks.clone(),t._originalSchema=null==this._originalSchema?this._originalSchema:this._originalSchema.clone(),t.tree=y.clone(this.tree),t.paths=y.clone(this.paths),t.nested=y.clone(this.nested),t.subpaths=y.clone(this.subpaths),t.childSchemas=this.childSchemas.slice(),t.singleNestedPaths=y.clone(this.singleNestedPaths),t.virtuals=y.clone(this.virtuals),t.$globalPluginsApplied=this.$globalPluginsApplied,t.$isRootDiscriminator=this.$isRootDiscriminator,null!=this.discriminatorMapping&&(t.discriminatorMapping=Object.assign({},this.discriminatorMapping)),null!=t.discriminators&&(t.discriminators=Object.assign({},this.discriminators)),t.aliases=Object.assign({},this.aliases),t.on("init",t=>this.emit("init",t)),t},A.prototype.defaultOptions=function(t){t&&!1===t.safe&&(t.safe={w:0}),t&&t.safe&&0===t.safe.w&&(t.versionKey=!1),this._userProvidedOptions=null==t?{}:y.clone(t);const e=a(this,"base.options",{});return(t=y.options({strict:!("strict"in e)||e.strict,bufferCommands:!0,capped:!1,versionKey:"__v",discriminatorKey:"__t",minimize:!0,autoIndex:null,shardKey:null,read:null,validateBeforeSave:!0,noId:!1,_id:!0,noVirtualId:!1,id:!0,typeKey:"type"},y.clone(t))).read&&(t.read=d(t.read)),t},A.prototype.add=function(t,e){if(t instanceof A)return void p(this,t);e=e||"";const n=Object.keys(t);for(let r=0;r<n.length;++r){const o=n[r];if(null==t[o])throw new TypeError("Invalid value for schema path `"+e+o+"`");if(Array.isArray(t[o])&&1===t[o].length&&null==t[o][0])throw new TypeError("Invalid value for schema Array path `"+e+o+"`");!y.isObject(t[o])||t[o].constructor&&"Object"!==y.getFunctionName(t[o].constructor)||t[o][this.options.typeKey]&&("type"!==this.options.typeKey||!t[o].type.type)?(e&&(this.nested[e.substr(0,e.length-1)]=!0),this.path(e+o,t[o])):Object.keys(t[o]).length?(this.nested[e+o]=!0,this.add(t[o],e+o+".")):(e&&(this.nested[e.substr(0,e.length-1)]=!0),this.path(e+o,t[o]))}return function(t,e){e=e||Object.keys(t.paths);for(const n of e){const e=a(t.paths[n],"options");if(null==e)continue;const r=t.paths[n].path,o=e.alias;if(o){if("string"!=typeof o)throw new Error("Invalid value for alias option on "+r+", got "+o);t.aliases[o]=r,t.virtual(o).get(function(t){return function(){return"function"==typeof this.get?this.get(t):this[t]}}(r)).set(function(t){return function(e){return this.set(t,e)}}(r))}}}(this,Object.keys(t).map(t=>e?e+t:t)),this},A.reserved=Object.create(null),A.prototype.reserved=A.reserved;const C=A.reserved;C.prototype=C.emit=C.on=C.once=C.listeners=C.removeListener=C.collection=C.db=C.errors=C.init=C.isModified=C.isNew=C.get=C.modelName=C.save=C.schema=C.toObject=C.validate=C.remove=C.populated=C._pres=C._posts=1;
/*!
 * Document keys to print warnings for
 */
const T={};
/*!
 * ignore
 */
function E(t,e){const n=e.split(/\.(\d+)\.|\.(\d+)$/).filter(Boolean);if(n.length<2)return t.paths.hasOwnProperty(n[0])?t.paths[n[0]]:null;let r=t.path(n[0]),o=!1;if(!r)return r;const s=n.length-1;for(let t=1;t<n.length;++t){o=!1;const e=n[t];if(t===s&&r&&!/\D/.test(e)){if(r.$isMongooseDocumentArray){const t=r;(r=new i(e,{required:a(r,"schemaOptions.required",!1)})).cast=function(e,n,r){return t.cast(e,n,r)[0]},r.$isMongooseDocumentArrayElement=!0,r.caster=t.caster,r.schema=t.schema}else r=r instanceof v.Array?r.caster:void 0;break}if(/\D/.test(e)){if(!r||!r.schema){r=void 0;break}o="nested"===r.schema.pathType(e),r=r.schema.path(e)}}return t.subpaths[e]=r,r?"real":o?"nested":"adhocOrUndefined"}
/*!
 * ignore
 */T.increment="`increment` should not be used as a schema path name unless you have disabled versioning.",A.prototype.path=function(t,e){if(void 0===e){if(this.paths.hasOwnProperty(t))return this.paths[t];if(this.subpaths.hasOwnProperty(t))return this.subpaths[t];if(this.singleNestedPaths.hasOwnProperty(t))return this.singleNestedPaths[t];for(const e of Object.keys(this.paths)){if(!e.includes(".$*"))continue;if(new RegExp("^"+e.replace(/\.\$\*/g,".[^.]+")+"$").test(t))return this.paths[e]}return/\.\d+\.?.*$/.test(t)?function(t,e){return E(t,e),t.subpaths[e]}(this,t):void 0}if(C[t])throw new Error("`"+t+"` may not be used as a schema pathname");T[t]&&console.log("WARN: "+T[t]),"object"==typeof e&&"ref"in e&&_(e.ref,t);const n=t.split(/\./),r=n.pop();let o=this.tree;n.forEach(function(e,r){if(o[e]||(o[e]={}),"object"!=typeof o[e]){const i="Cannot set nested path `"+t+"`. Parent path `"+n.slice(0,r).concat([e]).join(".")+"` already set to type "+o[e].name+".";throw new Error(i)}o=o[e]}),o[r]=y.clone(e),this.paths[t]=this.interpretAsType(t,e,this.options);const i=this.paths[t];if(i.$isSchemaMap){const n=t+".$*";this.paths[t+".$*"]=this.interpretAsType(n,e.of||{type:{}},this.options),i.$__schemaType=this.paths[t+".$*"]}if(i.$isSingleNested){for(const e in i.schema.paths)this.singleNestedPaths[t+"."+e]=i.schema.paths[e];for(const e in i.schema.singleNestedPaths)this.singleNestedPaths[t+"."+e]=i.schema.singleNestedPaths[e];Object.defineProperty(i.schema,"base",{configurable:!0,enumerable:!1,writable:!1,value:this.base}),i.caster.base=this.base,this.childSchemas.push({schema:i.schema,model:i.caster})}else i.$isMongooseDocumentArray&&(Object.defineProperty(i.schema,"base",{configurable:!0,enumerable:!1,writable:!1,value:this.base}),i.casterConstructor.base=this.base,this.childSchemas.push({schema:i.schema,model:i.casterConstructor}));return this},Object.defineProperty(A.prototype,"base",{configurable:!0,enumerable:!1,writable:!0,value:null}),A.prototype.interpretAsType=function(t,e,n){if(e instanceof i)return e;const r=null!=this.base?this.base.Schema.Types:A.Types;if(e.constructor){if("Object"!==y.getFunctionName(e.constructor)){const t=e;(e={})[n.typeKey]=t}}let o,s=!e[n.typeKey]||"type"===n.typeKey&&e.type.type?{}:e[n.typeKey];if("Object"===y.getFunctionName(s.constructor)||"mixed"===s)return new r.Mixed(t,e);if(Array.isArray(s)||Array===s||"array"===s){let i=Array===s||"array"===s?e.cast:s[0];if(i&&i.instanceOfSchema)return new r.DocumentArray(t,i,e);if(i&&i[n.typeKey]&&i[n.typeKey].instanceOfSchema)return new r.DocumentArray(t,i[n.typeKey],e,i);if(Array.isArray(i))return new r.Array(t,this.interpretAsType(t,i,n),e);if("string"==typeof i)i=r[i.charAt(0).toUpperCase()+i.substring(1)];else if(i&&(!i[n.typeKey]||"type"===n.typeKey&&i.type.type)&&"Object"===y.getFunctionName(i.constructor)){if(Object.keys(i).length){const o={minimize:n.minimize};n.typeKey&&(o.typeKey=n.typeKey),n.hasOwnProperty("strict")&&(o.strict=n.strict);const s=new A(i,o);return s.$implicitlyCreated=!0,new r.DocumentArray(t,s,e)}return new r.Array(t,r.Mixed,e)}if(i&&!((o="string"==typeof(s=!i[n.typeKey]||"type"===n.typeKey&&i.type.type?i:i[n.typeKey])?s:s.schemaName||y.getFunctionName(s))in r))throw new TypeError("Invalid schema configuration: "+`\`${o}\` is not a valid type within the array \`${t}\`.`+"See http://bit.ly/mongoose-schematypes for a list of valid schema types.");return new r.Array(t,i||r.Mixed,e,n)}if(s&&s.instanceOfSchema)return new r.Embedded(s,t,e);if((o=Buffer.isBuffer(s)?"Buffer":"function"==typeof s||"object"==typeof s?s.schemaName||y.getFunctionName(s):null==s?""+s:s.toString())&&(o=o.charAt(0).toUpperCase()+o.substring(1)),"ObjectID"===o&&(o="ObjectId"),null==r[o])throw new TypeError(`Invalid schema configuration: \`${o}\` is not `+`a valid type at path \`${t}\`. See `+"http://bit.ly/mongoose-schematypes for a list of valid schema types.");return new r[o](t,e)},A.prototype.eachPath=function(t){const e=Object.keys(this.paths),n=e.length;for(let r=0;r<n;++r)t(e[r],this.paths[e[r]]);return this},A.prototype.requiredPaths=function(t){if(this._requiredpaths&&!t)return this._requiredpaths;const e=Object.keys(this.paths);let n=e.length;const r=[];for(;n--;){const t=e[n];this.paths[t].isRequired&&r.push(t)}return this._requiredpaths=r,this._requiredpaths},A.prototype.indexedPaths=function(){return this._indexedpaths?this._indexedpaths:(this._indexedpaths=this.indexes(),this._indexedpaths)},A.prototype.pathType=function(t){if(t in this.paths)return"real";if(t in this.virtuals)return"virtual";if(t in this.nested)return"nested";if(t in this.subpaths)return"real";if(t in this.singleNestedPaths)return"real";for(const e of Object.keys(this.paths)){if(!e.includes(".$*"))continue;if(new RegExp("^"+e.replace(/\.\$\*/g,".[^.]+")+"$").test(t))return"real"}return/\.\d+\.|\.\d+$/.test(t)?E(this,t):"adhocOrUndefined"},A.prototype.hasMixedParent=function(t){const e=t.split(/\./g);t="";for(let n=0;n<e.length;++n)if((t=n>0?t+"."+e[n]:e[n])in this.paths&&this.paths[t]instanceof v.Mixed)return!0;return!1},A.prototype.setupTimestamp=function(t){const e=this.childSchemas.find(function(t){return!!t.schema.options.timestamps});if(!t&&!e)return;const n=h(t,"createdAt"),r=h(t,"updatedAt"),o={};function i(t){const e=this.model.base.now();c(e,n,r,this.getUpdate(),this.options,this.schema),u(e,this.getUpdate(),this.model.schema),t()}this.$timestamps={createdAt:n,updatedAt:r},r&&!this.paths[r]&&(o[r]=Date),n&&!this.paths[n]&&(o[n]=Date),this.add(o),this.pre("save",function(t){if(!1===a(this,"$__.saveOptions.timestamps"))return t();const e=(this.ownerDocument?this.ownerDocument():this).constructor.base.now(),o=this._id&&this._id.auto;if(n&&!this.get(n)&&this.isSelected(n)&&this.set(n,o?this._id.getTimestamp():e),r&&(this.isNew||this.isModified())){let t=e;this.isNew&&(null!=n?t=this.get(n):o&&(t=this._id.getTimestamp())),this.set(r,t)}t()}),this.methods.initializeTimestamps=function(){return n&&!this.get(n)&&this.set(n,new Date),r&&!this.get(r)&&this.set(r,new Date),this},i[m.builtInMiddleware]=!0,this.pre("findOneAndUpdate",i),this.pre("replaceOne",i),this.pre("update",i),this.pre("updateOne",i),this.pre("updateMany",i)},A.prototype.queue=function(t,e){return this.callQueue.push([t,e]),this},A.prototype.pre=function(t){if(t instanceof RegExp){const e=Array.prototype.slice.call(arguments,1);for(const n of O)t.test(n)&&this.pre.apply(this,[n].concat(e));return this}return this.s.hooks.pre.apply(this.s.hooks,arguments),this},A.prototype.post=function(t){if(t instanceof RegExp){const e=Array.prototype.slice.call(arguments,1);for(const n of O)t.test(n)&&this.post.apply(this,[n].concat(e));return this}return this.s.hooks.post.apply(this.s.hooks,arguments),this},A.prototype.plugin=function(t,e){if("function"!=typeof t)throw new Error('First param to `schema.plugin()` must be a function, got "'+typeof t+'"');if(e&&e.deduplicate)for(let e=0;e<this.plugins.length;++e)if(this.plugins[e].fn===t)return this;return this.plugins.push({fn:t,opts:e}),t(this,e),this},A.prototype.method=function(t,e,n){if("string"!=typeof t)for(const e in t)this.methods[e]=t[e],this.methodOptions[e]=y.clone(n);else this.methods[t]=e,this.methodOptions[t]=y.clone(n);return this},A.prototype.static=function(t,e){if("string"!=typeof t)for(const e in t)this.statics[e]=t[e];else this.statics[t]=e;return this},A.prototype.index=function(t,e){return t||(t={}),e||(e={}),e.expires&&y.expires(e),this._indexes.push([t,e]),this},A.prototype.set=function(t,e,n){if(1===arguments.length)return this.options[t];switch(t){case"read":this.options[t]=d(e,n),this._userProvidedOptions[t]=this.options[t];break;case"safe":N(this.options,e),this._userProvidedOptions[t]=this.options[t];break;case"timestamps":this.setupTimestamp(e),this.options[t]=e,this._userProvidedOptions[t]=this.options[t];break;default:this.options[t]=e,this._userProvidedOptions[t]=this.options[t]}return this};
/*!
 * ignore
 */
const N=g.deprecate(function(t,e){t.safe=!1===e?{w:0}:e},"Mongoose: The `safe` option for schemas is deprecated. Use the `writeConcern` option instead: http://bit.ly/mongoose-write-concern");A.prototype.get=function(t){return this.options[t]};const $="2d 2dsphere hashed text".split(" ");
/*!
 * ignore
 */
function I(t){return 0===t.indexOf("$[")&&t.lastIndexOf("]")===t.length-1}
/*!
 * Module exports.
 */Object.defineProperty(A,"indexTypes",{get:function(){return $},set:function(){throw new Error("Cannot overwrite Schema.indexTypes")}}),A.prototype.indexes=function(){return l(this)},A.prototype.virtual=function(t,e){if(e&&e.ref){if(!e.localField)throw new Error("Reference virtuals require `localField` option");if(!e.foreignField)throw new Error("Reference virtuals require `foreignField` option");this.pre("init",function(n){if(f.has(t,n)){const r=f.get(t,n);this.$$populatedVirtuals||(this.$$populatedVirtuals={}),e.justOne||e.count?this.$$populatedVirtuals[t]=Array.isArray(r)?r[0]:r:this.$$populatedVirtuals[t]=Array.isArray(r)?r:null==r?[]:[r],f.unset(t,n)}});const n=this.virtual(t);return n.options=e,n.get(function(){return this.$$populatedVirtuals||(this.$$populatedVirtuals={}),t in this.$$populatedVirtuals?this.$$populatedVirtuals[t]:null}).set(function(n){this.$$populatedVirtuals||(this.$$populatedVirtuals={}),e.justOne||e.count?(this.$$populatedVirtuals[t]=Array.isArray(n)?n[0]:n,"object"!=typeof this.$$populatedVirtuals[t]&&(this.$$populatedVirtuals[t]=e.count?n:null)):(this.$$populatedVirtuals[t]=Array.isArray(n)?n:null==n?[]:[n],this.$$populatedVirtuals[t]=this.$$populatedVirtuals[t].filter(function(t){return t&&"object"==typeof t}))})}const n=this.virtuals,r=t.split(".");if("real"===this.pathType(t))throw new Error('Virtual path "'+t+'" conflicts with a real path in the schema');return n[t]=r.reduce(function(n,o,i){return n[o]||(n[o]=i===r.length-1?new s(e,t):{}),n[o]},this.tree),n[t]},A.prototype.virtualpath=function(t){return this.virtuals.hasOwnProperty(t)?this.virtuals[t]:null},A.prototype.remove=function(t){return"string"==typeof t&&(t=[t]),Array.isArray(t)&&t.forEach(function(t){if(this.path(t)){delete this.paths[t];const e=t.split("."),n=e.pop();let r=this.tree;for(let t=0;t<e.length;++t)r=r[e[t]];delete r[n]}},this),this},A.prototype.loadClass=function(t,e){return t===Object.prototype||t===Function.prototype||t.prototype.hasOwnProperty("$isMongooseModelPrototype")?this:(this.loadClass(Object.getPrototypeOf(t)),e||Object.getOwnPropertyNames(t).forEach(function(e){if(e.match(/^(length|name|prototype)$/))return;const n=Object.getOwnPropertyDescriptor(t,e);"function"==typeof n.value&&this.static(e,n.value)},this),Object.getOwnPropertyNames(t.prototype).forEach(function(n){if(n.match(/^(constructor)$/))return;const r=Object.getOwnPropertyDescriptor(t.prototype,n);e||"function"==typeof r.value&&this.method(n,r.value),"function"==typeof r.get&&this.virtual(n).get(r.get),"function"==typeof r.set&&this.virtual(n).set(r.set)},this),this)},
/*!
 * ignore
 */
A.prototype._getSchema=function(t){const e=this.path(t),n=[];if(e)return e.$fullPath=t,e;const r=t.split(".");for(let t=0;t<r.length;++t)("$"===r[t]||I(r[t]))&&(r[t]="0");return function t(e,r){let o,i,s=e.length+1;for(;s--;)if(i=e.slice(0,s).join("."),o=r.path(i)){if(n.push(i),o.caster){if(o.caster instanceof v.Mixed)return o.caster.$fullPath=n.join("."),o.caster;if(s!==e.length&&o.schema){let n;return"$"===e[s]||I(e[s])?s+1===e.length?o:((n=t(e.slice(s+1),o.schema))&&(n.$isUnderneathDocArray=n.$isUnderneathDocArray||!o.schema.$isSingleNested),n):((n=t(e.slice(s),o.schema))&&(n.$isUnderneathDocArray=n.$isUnderneathDocArray||!o.schema.$isSingleNested),n)}}return o.$fullPath=n.join("."),o}}(r,this)},
/*!
 * ignore
 */
A.prototype._getPathType=function(t){if(this.path(t))return"real";return function t(e,n){let r,o,i=e.length+1;for(;i--;){if(o=e.slice(0,i).join("."),r=n.path(o))return r.caster?r.caster instanceof v.Mixed?{schema:r,pathType:"mixed"}:i!==e.length&&r.schema?"$"===e[i]||I(e[i])?i===e.length-1?{schema:r,pathType:"nested"}:t(e.slice(i+1),r.schema):t(e.slice(i),r.schema):{schema:r,pathType:r.$isSingleNested?"nested":"array"}:{schema:r,pathType:"real"};if(i===e.length&&n.nested[o])return{schema:n,pathType:"nested"}}return{schema:r||n,pathType:"undefined"}}(t.split("."),this)},t.exports=e=A,A.Types=v=n(114),
/*!
 * ignore
 */
e.ObjectId=v.ObjectId},function(t,e,n){"use strict";
/*!
 * Module requirements.
 */const r=n(115);
/*!
 * @ignore
 */
/*!
 * @ignore
 */
function o(t){return r.cast()(t)}e.castToNumber=o,e.castArraysOfNumbers=function t(e,n){e.forEach(function(r,i){Array.isArray(r)?t(r,n):e[i]=o.call(n,r)})}},function(t,e,n){var r=n(343),o=n(200);t.exports=function(t){return null!=t&&o(t.length)&&!r(t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isAsync=void 0;var r,o=n(366),i=(r=o)&&r.__esModule?r:{default:r};var s="function"==typeof Symbol;function u(t){return s&&"AsyncFunction"===t[Symbol.toStringTag]}e.default=function(t){return u(t)?(0,i.default)(t):t},e.isAsync=u},function(t,e){t.exports=require("net")},,function(t,e,n){"use strict";if(void 0!==global.Map)t.exports=global.Map,t.exports.Map=global.Map;else{var r=function(t){this._keys=[],this._values={};for(var e=0;e<t.length;e++)if(null!=t[e]){var n=t[e],r=n[0],o=n[1];this._keys.push(r),this._values[r]={v:o,i:this._keys.length-1}}};r.prototype.clear=function(){this._keys=[],this._values={}},r.prototype.delete=function(t){var e=this._values[t];return null!=e&&(delete this._values[t],this._keys.splice(e.i,1),!0)},r.prototype.entries=function(){var t=this,e=0;return{next:function(){var n=t._keys[e++];return{value:void 0!==n?[n,t._values[n].v]:void 0,done:void 0===n}}}},r.prototype.forEach=function(t,e){e=e||this;for(var n=0;n<this._keys.length;n++){var r=this._keys[n];t.call(e,this._values[r].v,r,e)}},r.prototype.get=function(t){return this._values[t]?this._values[t].v:void 0},r.prototype.has=function(t){return null!=this._values[t]},r.prototype.keys=function(){var t=this,e=0;return{next:function(){var n=t._keys[e++];return{value:void 0!==n?n:void 0,done:void 0===n}}}},r.prototype.set=function(t,e){return this._values[t]?(this._values[t].v=e,this):(this._keys.push(t),this._values[t]={v:e,i:this._keys.length-1},this)},r.prototype.values=function(){var t=this,e=0;return{next:function(){var n=t._keys[e++];return{value:void 0!==n?t._values[n].v:void 0,done:void 0===n}}}},Object.defineProperty(r.prototype,"size",{enumerable:!0,get:function(){return this._keys.length}}),t.exports=r,t.exports.Map=r}},function(t,e){var n=function(t){if(!(this instanceof n))return new n(t);this._bsontype="Int32",this.value=t};n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},t.exports=n,t.exports.Int32=n},function(t,e,n){(function(t){var e=n(53),r=n(48),o=n(0).format,i=n(236),s=n(238),u=r.existsSync||e.existsSync,c=function(t){for(var n=!1;!n;)if(u(t+"/package.json"))n=t;else{if("/"===t)return!1;t=e.dirname(t)}return t},a=function(e,u){(u=u||{}).strict="boolean"!=typeof u.strict||u.strict;var a=function(e){for(var n=t,i=!1;n;){s=n.filename;var s=c(s);if(s){var u=JSON.parse(r.readFileSync(o("%s/package.json",s))),a=e.split(/\//);if(u.peerOptionalDependencies&&(!u.peerOptionalDependencies||u.peerOptionalDependencies[a[0]])){i=!0;break}n=n.parent}else n=n.parent}if(!i)throw new Error(o("no optional dependency [%s] defined in peerOptionalDependencies in any package.json",a[0]));return{object:u,parts:a}}(e),l=a.object,h=a.parts,p=l.peerOptionalDependencies[h[0]],f=void 0,d=e;try{f=n(97)(d)}catch(t){try{if(null==(d=i(process.cwd(),e)))return;f=n(97)(d)}catch(t){if("MODULE_NOT_FOUND"===t.code)return}}var m=c(n(97).resolve(d));if(!m)throw new Error("package.json can not be located");var g=JSON.parse(r.readFileSync(o("%s/package.json",m))).version;if(0==s.satisfies(g,p)&&u.strict){var y=new Error(o("optional dependency [%s] found but version [%s] did not satisfy constraint [%s]",h[0],g,p));throw y.code="OPTIONAL_MODULE_NOT_FOUND",y}return f};a.exists=function(t){try{return void 0!==a(t)}catch(t){return!1}},t.exports=a}).call(this,n(64)(t))},function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=97},function(t,e,n){"use strict";var r=n(0).inherits,o=n(0).format,i=n(10).EventEmitter,s=n(33),u=n(34),c=n(20).debugOptions,a=n(20).retrieveBSON,l=n(239),h=n(18).Query,p=n(4).MongoError,f=n(4).MongoNetworkError,d=n(248),m=n(249),g=n(77),y=n(12),_=n(12).createClientInfo,v=n(12).createCompressionInfo,w=n(12).resolveClusterTime,b=n(12).SessionMixins,O=n(27).relayEvents;const S=n(27).collationNotSupported;var A=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","singleBufferSerializtion","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"],C=0,T=!1,E={},N=a(),$=function(t){t=t||{},i.call(this),this.id=C++,this.s={options:t,logger:u("Server",t),Cursor:t.cursorFactory||g,bson:t.bson||new N([N.Binary,N.Code,N.DBRef,N.Decimal128,N.Double,N.Int32,N.Long,N.Map,N.MaxKey,N.MinKey,N.ObjectId,N.BSONRegExp,N.Symbol,N.Timestamp]),pool:null,disconnectHandler:t.disconnectHandler,monitoring:"boolean"!=typeof t.monitoring||t.monitoring,inTopology:!!t.parent,monitoringInterval:"number"==typeof t.monitoringInterval?t.monitoringInterval:5e3,topologyId:-1,compression:{compressors:v(t)},parent:t.parent},this.s.parent||(this.s.clusterTime=null),this.ismaster=null,this.lastIsMasterMS=-1,this.monitoringProcessId=null,this.initialConnect=!0,this.wireProtocolHandler=new d,this._type="server",this.clientInfo=_(t),this.lastUpdateTime=0,this.lastWriteDate=0,this.staleness=0};function I(t,e,n,r,i,s){return t.s.pool.isConnected()||!t.s.options.reconnect||null==t.s.disconnectHandler||i.monitoring?t.s.pool.isConnected()?void 0:(s(new p(o("no connection available to server %s",t.name))),!0):(t.s.disconnectHandler.add(e,n,r,i,s),!0)}r($,i),Object.assign($.prototype,b),Object.defineProperty($.prototype,"type",{enumerable:!0,get:function(){return this._type}}),Object.defineProperty($.prototype,"parserType",{enumerable:!0,get:function(){return N.native?"c++":"js"}}),Object.defineProperty($.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}}),Object.defineProperty($.prototype,"clusterTime",{enumerable:!0,set:function(t){const e=this.s.parent?this.s.parent:this.s;w(e,t)},get:function(){return(this.s.parent?this.s.parent:this.s).clusterTime||null}}),$.enableServerAccounting=function(){T=!0,E={}},$.disableServerAccounting=function(){T=!1},$.servers=function(){return E},Object.defineProperty($.prototype,"name",{enumerable:!0,get:function(){return this.s.options.host+":"+this.s.options.port}});var M=function(t,e){return function(n){if(t.s.logger.isInfo()){var r=n instanceof p?JSON.stringify(n):{};t.s.logger.info(o("server %s fired event %s out with message %s",t.name,e,r))}if("connect"===e){var i=t.s.compression&&t.s.compression.compressors?t.s.compression.compressors:[],s=new h(t.s.bson,"admin.$cmd",Object.assign({ismaster:!0,client:t.clientInfo,compression:i},function(t){if(!t)return{};const e=t.auth||[],n=e[0]||t.authMechanism,r=e[1]||t.authSource||t.dbName||"admin",o=e[2]||t.user;return"string"==typeof n&&"DEFAULT"!==n.toUpperCase()?{}:o?{saslSupportedMechs:`${r}.${o}`}:{}}(t.s.options)),{numberToSkip:0,numberToReturn:-1,checkKeys:!1,slaveOk:!0}),u=(new Date).getTime();t.s.pool.write(s,{socketTimeout:t.s.options.connectionTimeout||2e3},function(e,n){t.lastIsMasterMS=(new Date).getTime()-u;const r=function(t,e){return t||(e&&e.result&&0===e.result.ok?new p(e.result):void 0)}(e,n);if(r)return t.destroy(),t.emit("error",r);if(!((i=n.result)&&"number"==typeof i.maxWireVersion&&i.maxWireVersion>=2)){t.destroy();const e="2.6",r="Server at "+t.s.options.host+":"+t.s.options.port+" reports wire version "+(n.result.maxWireVersion||0)+", but this version of Node.js Driver requires at least 2 (MongoDB"+e+").";return t.emit("error",new p(r),t)}var i;if(n.result&&n.result.compression){for(var s=0;s<t.s.compression.compressors.length;s++)if(n.result.compression.indexOf(t.s.compression.compressors[s])>-1){t.s.pool.options.agreedCompressor=t.s.compression.compressors[s];break}t.s.compression.zlibCompressionLevel&&(t.s.pool.options.zlibCompressionLevel=t.s.compression.zlibCompressionLevel)}t.initialConnect=!1,t.ismaster=n.result,"isdbgrid"===t.ismaster.msg&&(t._type="mongos"),t.wireProtocolHandler=t.ismaster.maxWireVersion>=4?new m:new d,t.s.monitoring&&(t.monitoringProcessId=setTimeout(function t(e){return function(){if(!e.s.pool.isDestroyed()){e.emit("monitoring",e);var n=new h(e.s.bson,"admin.$cmd",{ismaster:!0},{numberToSkip:0,numberToReturn:-1,checkKeys:!1,slaveOk:!0}),r=(new Date).getTime();e.s.pool.write(n,{socketTimeout:"number"!=typeof e.s.options.connectionTimeout?2e3:e.s.options.connectionTimeout,monitoring:!0},function(n,o){e.lastIsMasterMS=(new Date).getTime()-r,e.s.pool.isDestroyed()||(o&&(e.ismaster=o.result),e.monitoringProcessId=setTimeout(t(e),e.s.monitoringInterval))})}}}(t),t.s.monitoringInterval)),y.emitServerDescriptionChanged(t,{address:t.name,arbiters:[],hosts:[],passives:[],type:y.getTopologyType(t)}),t.s.inTopology||y.emitTopologyDescriptionChanged(t,{topologyType:"Single",servers:[{address:t.name,arbiters:[],hosts:[],passives:[],type:y.getTopologyType(t)}]}),t.s.logger.isInfo()&&t.s.logger.info(o("server %s connected with ismaster [%s]",t.name,JSON.stringify(t.ismaster))),t.emit("connect",t)})}else{if(T&&-1!==["close","timeout","error","parseError","reconnectFailed"].indexOf(e)&&(t.s.inTopology||t.emit("topologyOpening",{topologyId:t.id}),delete E[t.id]),"close"===e&&y.emitServerDescriptionChanged(t,{address:t.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),"reconnectFailed"===e)return t.emit("reconnectFailed",n),void(t.listeners("error").length>0&&t.emit("error",n));if("disconnected"===t.s.pool.state&&t.initialConnect&&-1!==["close","timeout","error","parseError"].indexOf(e))return t.initialConnect=!1,t.emit("error",new f(o("failed to connect to server [%s] on first connect [%s]",t.name,n)));if("reconnect"===e)return y.emitServerDescriptionChanged(t,{address:t.name,arbiters:[],hosts:[],passives:[],type:y.getTopologyType(t)}),t.emit(e,t);t.emit(e,n)}}};function R(t){return t.s.pool?t.s.pool.isDestroyed()?new p("server instance pool was destroyed"):void 0:new p("server instance is not connected")}$.prototype.connect=function(t){if(t=t||{},T&&(E[this.id]=this),this.s.pool&&!this.s.pool.isDisconnected()&&!this.s.pool.isDestroyed())throw new p(o("server instance in invalid state %s",this.s.pool.state));this.s.pool=new l(this,Object.assign(this.s.options,t,{bson:this.s.bson})),this.s.pool.on("close",M(this,"close")),this.s.pool.on("error",M(this,"error")),this.s.pool.on("timeout",M(this,"timeout")),this.s.pool.on("parseError",M(this,"parseError")),this.s.pool.on("connect",M(this,"connect")),this.s.pool.on("reconnect",M(this,"reconnect")),this.s.pool.on("reconnectFailed",M(this,"reconnectFailed")),O(this.s.pool,this,["commandStarted","commandSucceeded","commandFailed"]),this.s.inTopology||this.emit("topologyOpening",{topologyId:this.id}),this.emit("serverOpening",{topologyId:-1!==this.s.topologyId?this.s.topologyId:this.id,address:this.name}),t.auth?this.s.pool.connect.apply(this.s.pool,t.auth):this.s.pool.connect()},$.prototype.getDescription=function(){var t=this.ismaster||{},e={type:y.getTopologyType(this),address:this.name};return t.hosts&&(e.hosts=t.hosts),t.arbiters&&(e.arbiters=t.arbiters),t.passives&&(e.passives=t.passives),t.setName&&(e.setName=t.setName),e},$.prototype.lastIsMaster=function(){return this.ismaster},$.prototype.unref=function(){this.s.pool.unref()},$.prototype.isConnected=function(){return!!this.s.pool&&this.s.pool.isConnected()},$.prototype.isDestroyed=function(){return!!this.s.pool&&this.s.pool.isDestroyed()},$.prototype.command=function(t,e,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var i=function(t,e){if(R(t),e.readPreference&&!(e.readPreference instanceof s))throw new Error("readPreference must be an instance of ReadPreference")}(this,n);if(i)return r(i);if(n=Object.assign({},n,{wireProtocolCommand:!1}),this.s.logger.isDebug()&&this.s.logger.debug(o("executing command [%s] against %s",JSON.stringify({ns:t,cmd:e,options:c(A,n)}),this.name)),!I(this,"command",t,e,n,r)){if(S(this,e))return r(new p(`server ${this.name} does not support collation`));var u=n.topology||{},a=this.wireProtocolHandler.command(this.s.bson,t,e,{},u,n);if(a instanceof p)return r(a,null);a.slaveOk=!!n.readPreference&&n.readPreference.slaveOk();var l={raw:"boolean"==typeof n.raw&&n.raw,promoteLongs:"boolean"!=typeof n.promoteLongs||n.promoteLongs,promoteValues:"boolean"!=typeof n.promoteValues||n.promoteValues,promoteBuffers:"boolean"==typeof n.promoteBuffers&&n.promoteBuffers,command:!0,monitoring:"boolean"==typeof n.monitoring&&n.monitoring,fullResult:"boolean"==typeof n.fullResult&&n.fullResult,requestId:a.requestId,socketTimeout:"number"==typeof n.socketTimeout?n.socketTimeout:null,session:n.session||null};this.s.pool.write(a,l,r)}},$.prototype.insert=function(t,e,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var o=R(this);return o?r(o):I(this,"insert",t,e,n,r)?void 0:(e=Array.isArray(e)?e:[e],this.wireProtocolHandler.insert(this.s.pool,t,this.s.bson,e,n,r))},$.prototype.update=function(t,e,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var o=R(this);return o?r(o):I(this,"update",t,e,n,r)?void 0:S(this,n)?r(new p(`server ${this.name} does not support collation`)):(e=Array.isArray(e)?e:[e],this.wireProtocolHandler.update(this.s.pool,t,this.s.bson,e,n,r))},$.prototype.remove=function(t,e,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var o=R(this);return o?r(o):I(this,"remove",t,e,n,r)?void 0:S(this,n)?r(new p(`server ${this.name} does not support collation`)):(e=Array.isArray(e)?e:[e],this.wireProtocolHandler.remove(this.s.pool,t,this.s.bson,e,n,r))},$.prototype.cursor=function(t,e,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(this.s.bson,t,e,n,r,this.s.options)},$.prototype.logout=function(t,e){this.s.pool.logout(t,e)},$.prototype.auth=function(t,e){"default"===t&&(t=function(t){if(t){if(Array.isArray(t.saslSupportedMechs))return t.saslSupportedMechs.indexOf("SCRAM-SHA-256")>=0?"scram-sha-256":"scram-sha-1";if(t.maxWireVersion>=3)return"scram-sha-1"}return"mongocr"}(this.ismaster));var n=Array.prototype.slice.call(arguments,0);n[0]=t;var r=n[n.length-1];if(!I(this,"auth",e,n,{},r))return this.lastIsMaster()&&this.lastIsMaster().arbiterOnly?r(null,!0):void this.s.pool.auth.apply(this.s.pool,n)},$.prototype.equals=function(t){return"string"==typeof t?this.name.toLowerCase()===t.toLowerCase():!!t.name&&this.name.toLowerCase()===t.name.toLowerCase()},$.prototype.connections=function(){return this.s.pool.allConnections()},$.prototype.selectServer=function(t,e,n){"function"==typeof t&&void 0===n&&(n=t,t=void 0,e={}),"function"==typeof e&&(n=e,e=t,t=void 0),n(null,this)};var P=["close","error","timeout","parseError","connect"];$.prototype.destroy=function(t){if(!this._destroyed){t=t||{};var e=this;T&&delete E[this.id],this.monitoringProcessId&&clearTimeout(this.monitoringProcessId),e.s.pool?(t.emitClose&&e.emit("close",e),t.emitDestroy&&e.emit("destroy",e),P.forEach(function(t){e.s.pool.removeAllListeners(t)}),e.listeners("serverClosed").length>0&&e.emit("serverClosed",{topologyId:-1!==e.s.topologyId?e.s.topologyId:e.id,address:e.name}),e.listeners("topologyClosed").length>0&&!e.s.inTopology&&e.emit("topologyClosed",{topologyId:e.id}),e.s.logger.isDebug()&&e.s.logger.debug(o("destroy called on server %s",e.name)),this.s.pool.destroy(t.force),this._destroyed=!0):this._destroyed=!0}},t.exports=$},function(t,e){t.exports=require("os")},function(t,e,n){"use strict";const r=n(4).MongoError;let o,i;o={NO_TRANSACTION:"NO_TRANSACTION",STARTING_TRANSACTION:"STARTING_TRANSACTION",TRANSACTION_IN_PROGRESS:"TRANSACTION_IN_PROGRESS",TRANSACTION_COMMITTED:"TRANSACTION_COMMITTED",TRANSACTION_COMMITTED_EMPTY:"TRANSACTION_COMMITTED_EMPTY",TRANSACTION_ABORTED:"TRANSACTION_ABORTED"},i={NO_TRANSACTION:["NO_TRANSACTION","STARTING_TRANSACTION"],STARTING_TRANSACTION:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","TRANSACTION_ABORTED"],TRANSACTION_IN_PROGRESS:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_ABORTED"],TRANSACTION_COMMITTED:["TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_ABORTED:["STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_COMMITTED_EMPTY:["TRANSACTION_COMMITTED_EMPTY","NO_TRANSACTION"]};t.exports={TxnState:o,Transaction:class{constructor(t){if(t=t||{},this.state=o.NO_TRANSACTION,this.options={},t.writeConcern||void 0!==t.w){if((t.writeConcern?t.writeConcern.w:t.w)<=0)throw new r("Transactions do not support unacknowledged write concern");this.options.writeConcern=t.writeConcern?t.writeConcern:{w:t.w}}t.readConcern&&(this.options.readConcern=t.readConcern),t.readPreference&&(this.options.readPreference=t.readPreference)}get isActive(){return-1!==[o.STARTING_TRANSACTION,o.TRANSACTION_IN_PROGRESS].indexOf(this.state)}transition(t){const e=i[this.state];if(!e||-1===e.indexOf(t))throw new r(`Attempted illegal state transition from [${this.state}] to [${t}]`);this.state=t}}}},function(t,e){t.exports=require("querystring")},function(t,e,n){"use strict";const r=n(10),o=n(256).isResumableError,i=n(2).MongoError;var s=["maxAwaitTimeMS","collation","readPreference"];const u={COLLECTION:Symbol("Collection"),DATABASE:Symbol("Database"),CLUSTER:Symbol("Cluster")};var c=function(t){t.resumeToken&&(t.options.resumeAfter=t.resumeToken);var e=h(t);if(t.listenerCount("change")>0&&e.on("data",function(e){d({changeStream:t,change:e,eventEmitter:!0})}),e.on("close",function(){t.emit("close")}),e.on("end",function(){t.emit("end")}),e.on("error",function(e){d({changeStream:t,error:e,eventEmitter:!0})}),t.pipeDestinations){const n=e.stream(t.streamOptions);for(let e in t.pipeDestinations)n.pipe(e)}return e};function a(t){return t.resumeToken||t.options.resumeAfter}function l(t){const e=t.topology.lastIsMaster()||{};return e.maxWireVersion&&e.maxWireVersion>=7&&t.options.startAtOperationTime}var h=function(t){const e=t.topology,n=t.namespace,r=t.pipeline,o=t.options,i=t.cursorNamespace;var c={fullDocument:o.fullDocument||"default"};const h=a(t),p=l(t);h&&(c.resumeAfter=h),p&&(c.startAtOperationTime=p);var f={};s.forEach(function(t){o[t]&&(f[t]=o[t])}),t.type===u.CLUSTER&&(c.allChangesForCluster=!0);var d=[{$changeStream:c}];d=d.concat(r);var m={aggregate:t.type===u.COLLECTION?n.collection:1,pipeline:d,readConcern:{level:"majority"},cursor:{batchSize:o.batchSize||1}};return e.cursor(i,m,f)};const p=3e4;function f(t,e,n){setTimeout(()=>{e&&null==e.start&&(e.start=process.hrtime());const r=e.start||process.hrtime(),o=e.timeout||p,s=e.readPreference;if(t.isConnected({readPreference:s}))return n(null,null);const u=process.hrtime(r);if((1e9*u[0]+u[1])/1e6>o)return n(new i("Timed out waiting for connection"));f(t,e,n)},3e3)}function d(t){const e=t.changeStream,n=t.error,r=t.change,i=t.callback,s=t.eventEmitter||!1,u=e.topology,h=e.cursor.options;if(n){if(o(n)&&!e.attemptingResume){if(e.attemptingResume=!0,!a(e)&&!l(e)){const t=e.cursor.cursorState.operationTime;e.options=Object.assign({startAtOperationTime:t},e.options)}return["data","close","end","error"].forEach(t=>e.cursor.removeAllListeners(t)),e.cursor.close(),s?void f(u,{readPreference:h.readPreference},t=>{if(t)return e.emit("error",t);e.cursor=c(e)}):i?void f(u,{readPreference:h.readPreference},t=>{if(t)return i(t,null);e.cursor=c(e),e.next(i)}):new Promise((t,e)=>{f(u,{readPreference:h.readPreference},n=>{if(n)return e(n);t()})}).then(()=>e.cursor=c(e)).then(()=>e.next())}return s?e.emit("error",n):"function"==typeof i?i(n,null):e.promiseLibrary.reject(n)}if(e.attemptingResume=!1,!r||!r._id){var p=new Error("A change stream document has been received that lacks a resume token (_id).");return s?e.emit("error",p):"function"==typeof i?i(p,null):e.promiseLibrary.reject(p)}return e.resumeToken=r._id,s?e.emit("change",r):"function"==typeof i?i(n,r):e.promiseLibrary.resolve(r)}t.exports=class extends r{constructor(t,e,r){super();const o=n(43),s=n(44),a=n(78);if(this.pipeline=e||[],this.options=r||{},this.cursorNamespace=void 0,this.namespace={},t instanceof o)this.type=u.COLLECTION,this.topology=t.s.db.serverConfig,this.namespace={collection:t.collectionName,database:t.s.db.databaseName},this.cursorNamespace=`${this.namespace.database}.${this.namespace.collection}`;else if(t instanceof s)this.type=u.DATABASE,this.namespace={collection:"",database:t.databaseName},this.cursorNamespace=this.namespace.database,this.topology=t.serverConfig;else{if(!(t instanceof a))throw new TypeError("changeDomain provided to ChangeStream constructor is not an instance of Collection, Db, or MongoClient");this.type=u.CLUSTER,this.namespace={collection:"",database:"admin"},this.cursorNamespace=this.namespace.database,this.topology=t.topology}this.promiseLibrary=t.s.promiseLibrary,!this.options.readPreference&&t.s.readPreference&&(this.options.readPreference=t.s.readPreference);const l=this.topology.lastIsMaster();if(!l)throw new i("Topology does not have an ismaster yet.");this.operationTime=l.operationTime,this.cursor=c(this),this.on("newListener",t=>{"change"===t&&this.cursor&&0===this.listenerCount("change")&&this.cursor.on("data",t=>d({changeStream:this,change:t,eventEmitter:!0}))}),this.on("removeListener",t=>{"change"===t&&0===this.listenerCount("change")&&this.cursor&&this.cursor.removeAllListeners("data")})}hasNext(t){return this.cursor.hasNext(t)}next(t){var e=this;return this.isClosed()?t?t(new Error("Change Stream is not open."),null):e.promiseLibrary.reject(new Error("Change Stream is not open.")):this.cursor.next().then(n=>d({changeStream:e,change:n,callback:t})).catch(n=>d({changeStream:e,error:n,callback:t}))}isClosed(){return!this.cursor||this.cursor.isClosed()}close(t){if(!this.cursor)return t?t():this.promiseLibrary.resolve();var e=this.cursor;return delete this.cursor,e.close(t)}pipe(t,e){return this.pipeDestinations||(this.pipeDestinations=[]),this.pipeDestinations.push(t),this.cursor.pipe(t,e)}unpipe(t){return this.pipeDestinations&&this.pipeDestinations.indexOf(t)>-1&&this.pipeDestinations.splice(this.pipeDestinations.indexOf(t),1),this.cursor.unpipe(t)}stream(t){return this.streamOptions=t,this.cursor.stream(t)}pause(){return this.cursor.pause()}resume(){return this.cursor.resume()}}},function(t,e,n){"use strict";const r=n(0).inherits,o=n(2).ReadPreference,i=n(2).MongoError,s=n(15).Readable,u=n(28);var c=function(t,e,n,r,o,i){u.apply(this,Array.prototype.slice.call(arguments,0));var a=c.INIT,l=r.promiseLibrary||Promise;s.call(this,{objectMode:!0}),this.s={maxTimeMS:null,state:a,streamOptions:{},bson:t,ns:e,cmd:n,options:r,topology:o,topologyOptions:i,promiseLibrary:l,session:r.session}};r(c,s);for(var a=["_next","next","hasNext","each","forEach","toArray","rewind","bufferedCount","readBufferedDocuments","close","isClosed","kill","setCursorBatchSize","_find","_getmore","_killcursor","isDead","explain","isNotified","isKilled","_endSession","_initImplicitSession"],l=0;l<a.length;l++)c.prototype[a[l]]=u.prototype[a[l]];c.prototype.setReadPreference=function(t){if(this.s.state===c.CLOSED||this.isDead())throw i.create({message:"Cursor is closed",driver:!0});if(this.s.state!==c.INIT)throw i.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(t instanceof o)this.s.options.readPreference=t;else{if("string"!=typeof t)throw new TypeError("Invalid read preference: "+t);this.s.options.readPreference=new o(t)}return this},c.prototype.batchSize=function(t){if(this.s.state===c.CLOSED||this.isDead())throw i.create({message:"Cursor is closed",driver:!0});if("number"!=typeof t)throw i.create({message:"batchSize requires an integer",driver:!0});return this.s.cmd.cursor&&(this.s.cmd.cursor.batchSize=t),this.setCursorBatchSize(t),this},c.prototype.maxTimeMS=function(t){return this.s.topology.lastIsMaster().minWireVersion>2&&(this.s.cmd.maxTimeMS=t),this},c.prototype.getLogger=function(){return this.logger},c.prototype.get=c.prototype.toArray,c.INIT=0,c.OPEN=1,c.CLOSED=2,t.exports=c},function(t,e,n){"use strict";const r=n(6).executeCommand,o=n(6).executeDbAdminCommand;t.exports={replSetGetStatus:function(t,e,n){o(t.s.db,{replSetGetStatus:1},e,n)},serverStatus:function(t,e,n){o(t.s.db,{serverStatus:1},e,n)},validateCollection:function(t,e,n,o){const i={validate:e},s=Object.keys(n);for(let t=0;t<s.length;t++)n.hasOwnProperty(s[t])&&"session"!==s[t]&&(i[s[t]]=n[s[t]]);r(t.s.db,i,n,(t,n)=>null!=t?o(t,null):0===n.ok?o(new Error("Error with validate command"),null):null!=n.result&&n.result.constructor!==String?o(new Error("Error with validation data"),null):null!=n.result&&null!=n.result.match(/exception|corrupt/)?o(new Error("Error: invalid collection "+e),null):null==n.valid||n.valid?o(null,n):o(new Error("Error: invalid collection "+e),null))}}},function(t,e,n){"use strict";const r=n(259),o=n(0).deprecate,i=n(2).Logger,s=n(2).MongoError,u=n(154),c=n(2).parseConnectionString,a=n(2).ReadPreference,l=n(155),h=n(80),p=n(2).Sessions.ServerSessionPool,f=["timeout","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha","all","fullsetup","open"],d=["native_parser"],m=["server","replset","replSet","mongos","db"],g=o(n(261),"current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect."),y=["poolSize","ssl","sslValidate","sslCA","sslCert","sslKey","sslPass","sslCRL","autoReconnect","noDelay","keepAlive","keepAliveInitialDelay","connectTimeoutMS","family","socketTimeoutMS","reconnectTries","reconnectInterval","ha","haInterval","replicaSet","secondaryAcceptableLatencyMS","acceptableLatencyMS","connectWithNoPrimary","authSource","w","wtimeout","j","forceServerObjectId","serializeFunctions","ignoreUndefined","raw","bufferMaxEntries","readPreference","pkFactory","promiseLibrary","readConcern","maxStalenessSeconds","loggerLevel","logger","promoteValues","promoteBuffers","promoteLongs","domainsEnabled","checkServerIdentity","validateOptions","appname","auth","user","password","authMechanism","compression","fsync","readPreferenceTags","numberOfRetries","auto_reconnect","minSize","monitorCommands","retryWrites","useNewUrlParser"];function _(t,e){e.on("authenticated",O(t,"authenticated")),e.on("error",O(t,"error")),e.on("timeout",O(t,"timeout")),e.on("close",O(t,"close")),e.on("parseError",O(t,"parseError")),e.once("open",O(t,"open")),e.once("fullsetup",O(t,"fullsetup")),e.once("all",O(t,"all")),e.on("reconnect",O(t,"reconnect"))}function v(t,e){t.topology=e,e.s.sessionPool=new p(e.s.coreTopology)}function w(t,e,o,p){if(o=Object.assign({},o),null==p)throw new Error("no callback function provided");const d=i("MongoClient",o);if(e instanceof h||e instanceof l||e instanceof u)return function(t,e,n,o){v(t,e),_(t,e),N(t,e);let i=Object.assign({},n);"string"!=typeof n.readPreference&&"string"!=typeof n.read_preference||(i.readPreference=new a(n.readPreference||n.read_preference));return e.connect(i,b(t,i,(e,n)=>e?o(e,n):i.user||i.password||i.authMechanism?r(t,i.user,i.password,i,t=>{if(t)return o(t,n);o(t,n)}):void o(e,n)))}(t,e,o,w);const m=o.useNewUrlParser?c:g,y=o.useNewUrlParser?I:T;function w(t,e){const n="seed list contains no mongos proxies, replicaset connections requires the parameter replicaSet to be supplied in the URI or options object, mongodb://server:port/db?replicaSet=name";if(t&&"no mongos proxies found in seed list"===t.message)return d.isWarn()&&d.warn(n),p(new s(n));p(t,e)}m(e,o,(e,r)=>{if(e)return p(e);const i=y(r),s=A(i,o);return null==s.socketTimeoutMS&&(s.socketTimeoutMS=36e4),null==s.connectTimeoutMS&&(s.connectTimeoutMS=3e4),s.db_options&&s.db_options.auth&&delete s.db_options.auth,t.s.options=s,0===i.servers.length?p(new Error("connection string must contain at least one seed host")):s.replicaSet||s.rs_name?S(t,"replicaset",s,b(t,s,w)):i.servers.length>1?S(t,"mongos",s,b(t,s,w)):function(t,e,r){e.promiseLibrary=t.s.promiseLibrary;const o=M(e)[0],i=function(t,e){const r=n(78),o=[];return t instanceof r&&f.forEach(n=>{e.on(n,(e,r)=>{"open"===n?o.push({event:n,object1:t}):o.push({event:n,object1:e,object2:r})})}),o}(t,o);o.connect(e,(n,s)=>{if(n)return o.close(!0),r(n);!function(t){f.forEach(e=>t.removeAllListeners(e))}(o),N(t,o),_(t,o);const u=s.lastIsMaster();if(v(t,s),u&&"isdbgrid"===u.msg)return s.close(),S(t,"mongos",e,r);!function(t,e){for(let n=0;n<e.length;n++)t.emit(e[n].event,e[n].object1,e[n].object2)}(t,i),r(n,s)})}(t,s,b(t,s,w))})}function b(t,e,n){return(o,i)=>o?C(o,i,n):e.auth?void r(t,e.user,e.password,e,(t,r)=>{if(r)C(null,i,n);else{i&&i.close(),C(t||new Error("Could not authenticate user "+e.auth[0]),i,n)}}):C(o,i,n)}function O(t,e){const n=new Set(["all","fullsetup","open","reconnect"]);return(r,o)=>{if(n.has(e))return t.emit(e,t);t.emit(e,r,o)}}function S(t,e,n,r){n.promiseLibrary=t.s.promiseLibrary;const o={};"unified"===e&&(o.createServers=!1);const i=M(n,o);let s;"mongos"===e?s=new u(i,n):"replicaset"===e&&(s=new l(i,n)),_(t,s),N(t,s),s.connect(n,(e,n)=>{if(e)return s.close(!0),r(e);v(t,n),r(null,n)})}function A(t,e){const n=["mongos","server","db","replset","db_options","server_options","rs_options","mongos_options"],r=["readconcern","compression"];for(const o in e)-1!==r.indexOf(o.toLowerCase())?t[o]=e[o]:-1!==n.indexOf(o.toLowerCase())?t=E(t,e[o],!1):!e[o]||"object"!=typeof e[o]||Buffer.isBuffer(e[o])||Array.isArray(e[o])?t[o]=e[o]:t=E(t,e[o],!0);return t}function C(t,e,n){return process.nextTick(()=>{try{n(t,e)}catch(t){throw e&&e.close(),t}})}function T(t){return E(A({},t),t,!1)}function E(t,e,n){for(const r in e)e[r]&&"object"==typeof e[r]&&n?t=E(t,e[r],n):t[r]=e[r];return t}function N(t,e){["serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"].forEach(n=>{e.on(n,(e,r)=>{t.emit(n,e,r)})})}const $=y.reduce((t,e)=>(t[e.toLowerCase()]=e,t),{});function I(t){let e=Object.assign({servers:t.hosts},t.options);for(let t in e){const n=$[t];n&&(e[n]=e[t])}if(t.auth){const n=t.auth;for(let t in n)n[t]&&(e[t]=n[t]);n.username&&(e.auth=n,e.user=n.username),n.db&&(e.authSource=e.authSource||n.db)}return t.defaultDatabase&&(e.dbName=t.defaultDatabase),e.maxpoolsize&&(e.poolSize=e.maxpoolsize),e.readconcernlevel&&(e.readConcern={level:e.readconcernlevel}),e.wtimeoutms&&(e.wtimeout=e.wtimeoutms),e}function M(t,e){if(e=Object.assign({},{createServers:!0},e),"string"!=typeof t.readPreference&&"string"!=typeof t.read_preference||(t.readPreference=new a(t.readPreference||t.read_preference)),t.readPreference&&(t.readPreferenceTags||t.read_preference_tags)&&(t.readPreference.tags=t.readPreferenceTags||t.read_preference_tags),t.maxStalenessSeconds&&(t.readPreference.maxStalenessSeconds=t.maxStalenessSeconds),null==t.socketTimeoutMS&&(t.socketTimeoutMS=36e4),null==t.connectTimeoutMS&&(t.connectTimeoutMS=3e4),e.createServers)return t.servers.map(e=>e.domain_socket?new h(e.domain_socket,27017,t):new h(e.host,e.port,t))}t.exports={connectOp:function(t,e,n){if(e)return n(e);w(t,t.s.url,t.s.options,e=>{if(e)return n(e);n(null,t)})},logout:function(t,e,n){t.topology.logout(e,t=>{if(t)return n(t);n(null,!0)})},validOptions:function(t){const e=y.concat(m);for(const n in t)if(-1===d.indexOf(n)){if(-1===e.indexOf(n)&&t.validateOptions)return new s(`option ${n} is not supported`);-1===e.indexOf(n)&&console.warn(`the options [${n}] is not supported`),-1!==m.indexOf(n)&&console.warn("the server/replset/mongos/db options are deprecated, "+`all their options are supported at the top level of the options object [${y}]`)}}}},function(t,e,n){"use strict";var r=n(82),o=n(29),i=n(0),s=n(159),u=n(266)("mquery");function c(t,e){if(!(this instanceof c))return new c(t,e);var n=this.constructor.prototype;this.op=n.op||void 0,this.options={},this.setOptions(n.options),this._conditions=n._conditions?s.clone(n._conditions):{},this._fields=n._fields?s.clone(n._fields):void 0,this._update=n._update?s.clone(n._update):void 0,this._path=n._path||void 0,this._distinct=n._distinct||void 0,this._collection=n._collection||void 0,this._traceFunction=n._traceFunction||void 0,e&&this.setOptions(e),t&&(t.find&&t.remove&&t.update?this.collection(t):this.find(t))}var a="$geoWithin";Object.defineProperty(c,"use$geoWithin",{get:function(){return"$geoWithin"==a},set:function(t){a=!0===t?"$geoWithin":"$within"}}),c.prototype.toConstructor=function(){function t(e,n){if(!(this instanceof t))return new t(e,n);c.call(this,e,n)}s.inherits(t,c);var e=t.prototype;return e.options={},e.setOptions(this.options),e.op=this.op,e._conditions=s.clone(this._conditions),e._fields=s.clone(this._fields),e._update=s.clone(this._update),e._path=this._path,e._distinct=this._distinct,e._collection=this._collection,e._traceFunction=this._traceFunction,t},c.prototype.setOptions=function(t){if(!t||!s.isObject(t))return this;for(var e,n=s.keys(t),r=0;r<n.length;++r)if("function"==typeof this[e=n[r]]){var o=s.isArray(t[e])?t[e]:[t[e]];this[e].apply(this,o)}else this.options[e]=t[e];return this},c.prototype.collection=function(t){return this._collection=new c.Collection(t),this},c.prototype.collation=function(t){return this.options.collation=t,this},c.prototype.$where=function(t){return this._conditions.$where=t,this},c.prototype.where=function(){if(!arguments.length)return this;this.op||(this.op="find");var t=typeof arguments[0];if("string"==t)return this._path=arguments[0],2===arguments.length&&(this._conditions[this._path]=arguments[1]),this;if("object"==t&&!Array.isArray(arguments[0]))return this.merge(arguments[0]);throw new TypeError("path must be a string or object")},c.prototype.equals=function(t){this._ensurePath("equals");var e=this._path;return this._conditions[e]=t,this},c.prototype.eq=function(t){this._ensurePath("eq");var e=this._path;return this._conditions[e]=t,this},c.prototype.or=function(t){var e=this._conditions.$or||(this._conditions.$or=[]);return s.isArray(t)||(t=[t]),e.push.apply(e,t),this},c.prototype.nor=function(t){var e=this._conditions.$nor||(this._conditions.$nor=[]);return s.isArray(t)||(t=[t]),e.push.apply(e,t),this},c.prototype.and=function(t){var e=this._conditions.$and||(this._conditions.$and=[]);return Array.isArray(t)||(t=[t]),e.push.apply(e,t),this},
/*!
 * gt, gte, lt, lte, ne, in, nin, all, regex, size, maxDistance
 *
 *     Thing.where('type').nin(array)
 */
"gt gte lt lte ne in nin all regex size maxDistance minDistance".split(" ").forEach(function(t){c.prototype[t]=function(){var e,n;return 1===arguments.length?(this._ensurePath(t),n=arguments[0],e=this._path):(n=arguments[1],e=arguments[0]),(null===this._conditions[e]||"object"==typeof this._conditions[e]?this._conditions[e]:this._conditions[e]={})["$"+t]=n,this}}),c.prototype.mod=function(){var t,e;return 1===arguments.length?(this._ensurePath("mod"),t=arguments[0],e=this._path):2!==arguments.length||s.isArray(arguments[1])?3===arguments.length?(t=r(arguments,1),e=arguments[0]):(t=arguments[1],e=arguments[0]):(this._ensurePath("mod"),t=r(arguments),e=this._path),(this._conditions[e]||(this._conditions[e]={})).$mod=t,this},c.prototype.exists=function(){var t,e;return 0===arguments.length?(this._ensurePath("exists"),t=this._path,e=!0):1===arguments.length?"boolean"==typeof arguments[0]?(this._ensurePath("exists"),t=this._path,e=arguments[0]):(t=arguments[0],e=!0):2===arguments.length&&(t=arguments[0],e=arguments[1]),(this._conditions[t]||(this._conditions[t]={})).$exists=e,this},c.prototype.elemMatch=function(){if(null==arguments[0])throw new TypeError("Invalid argument");var t,e,n;if("function"==typeof arguments[0])this._ensurePath("elemMatch"),e=this._path,t=arguments[0];else if(s.isObject(arguments[0]))this._ensurePath("elemMatch"),e=this._path,n=arguments[0];else if("function"==typeof arguments[1])e=arguments[0],t=arguments[1];else{if(!arguments[1]||!s.isObject(arguments[1]))throw new TypeError("Invalid argument");e=arguments[0],n=arguments[1]}return t&&(t(n=new c),n=n._conditions),(this._conditions[e]||(this._conditions[e]={})).$elemMatch=n,this},c.prototype.within=function(){if(this._ensurePath("within"),this._geoComparison=a,0===arguments.length)return this;if(2===arguments.length)return this.box.apply(this,arguments);if(2<arguments.length)return this.polygon.apply(this,arguments);var t=arguments[0];if(!t)throw new TypeError("Invalid argument");if(t.center)return this.circle(t);if(t.box)return this.box.apply(this,t.box);if(t.polygon)return this.polygon.apply(this,t.polygon);if(t.type&&t.coordinates)return this.geometry(t);throw new TypeError("Invalid argument")},c.prototype.box=function(){var t,e;if(3===arguments.length)t=arguments[0],e=[arguments[1],arguments[2]];else{if(2!==arguments.length)throw new TypeError("Invalid argument");this._ensurePath("box"),t=this._path,e=[arguments[0],arguments[1]]}return(this._conditions[t]||(this._conditions[t]={}))[this._geoComparison||a]={$box:e},this},c.prototype.polygon=function(){var t,e;return"string"==typeof arguments[0]?(e=arguments[0],t=r(arguments,1)):(this._ensurePath("polygon"),e=this._path,t=r(arguments)),(this._conditions[e]||(this._conditions[e]={}))[this._geoComparison||a]={$polygon:t},this},c.prototype.circle=function(){var t,e;if(1===arguments.length)this._ensurePath("circle"),t=this._path,e=arguments[0];else{if(2!==arguments.length)throw new TypeError("Invalid argument");t=arguments[0],e=arguments[1]}if(!("radius"in e&&e.center))throw new Error("center and radius are required");var n=this._conditions[t]||(this._conditions[t]={}),r=e.spherical?"$centerSphere":"$center",o=this._geoComparison||a;return n[o]={},n[o][r]=[e.center,e.radius],"unique"in e&&(n[o].$uniqueDocs=!!e.unique),this},c.prototype.near=function(){var t,e;if(this._geoComparison="$near",0===arguments.length)return this;if(1===arguments.length)this._ensurePath("near"),t=this._path,e=arguments[0];else{if(2!==arguments.length)throw new TypeError("Invalid argument");t=arguments[0],e=arguments[1]}if(!e.center)throw new Error("center is required");var n=this._conditions[t]||(this._conditions[t]={}),r=e.spherical?"$nearSphere":"$near";if(Array.isArray(e.center)){n[r]=e.center;var o="maxDistance"in e?e.maxDistance:null;null!=o&&(n.$maxDistance=o),null!=e.minDistance&&(n.$minDistance=e.minDistance)}else{if("Point"!=e.center.type||!Array.isArray(e.center.coordinates))throw new Error(i.format("Invalid GeoJSON specified for %s",r));n[r]={$geometry:e.center},"maxDistance"in e&&(n[r].$maxDistance=e.maxDistance),"minDistance"in e&&(n[r].$minDistance=e.minDistance)}return this},c.prototype.intersects=function(){if(this._ensurePath("intersects"),this._geoComparison="$geoIntersects",0===arguments.length)return this;var t=arguments[0];if(null!=t&&t.type&&t.coordinates)return this.geometry(t);throw new TypeError("Invalid argument")},c.prototype.geometry=function(){if("$within"!=this._geoComparison&&"$geoWithin"!=this._geoComparison&&"$near"!=this._geoComparison&&"$geoIntersects"!=this._geoComparison)throw new Error("geometry() must come after `within()`, `intersects()`, or `near()");var t,e;if(1!==arguments.length)throw new TypeError("Invalid argument");if(this._ensurePath("geometry"),e=this._path,!(t=arguments[0]).type||!Array.isArray(t.coordinates))throw new TypeError("Invalid argument");return(this._conditions[e]||(this._conditions[e]={}))[this._geoComparison]={$geometry:t},this},c.prototype.select=function(){var t=arguments[0];if(!t)return this;if(1!==arguments.length)throw new Error("Invalid select: select only takes 1 argument");this._validate("select");var e,n,r=this._fields||(this._fields={}),o=typeof t;if(("string"==o||s.isArgumentsObject(t))&&"number"==typeof t.length||Array.isArray(t)){for("string"==o&&(t=t.split(/\s+/)),e=0,n=t.length;e<n;++e){var i=t[e];if(i){var u="-"==i[0]?0:1;0===u&&(i=i.substring(1)),r[i]=u}}return this}if(s.isObject(t)){var c=s.keys(t);for(e=0;e<c.length;++e)r[c[e]]=t[c[e]];return this}throw new TypeError("Invalid select() argument. Must be string or object.")},c.prototype.slice=function(){if(0===arguments.length)return this;var t,e;if(this._validate("slice"),1===arguments.length){var n=arguments[0];if("object"==typeof n&&!Array.isArray(n)){for(var o=Object.keys(n),i=o.length,s=0;s<i;++s)this.slice(o[s],n[o[s]]);return this}this._ensurePath("slice"),t=this._path,e=arguments[0]}else 2===arguments.length?"number"==typeof arguments[0]?(this._ensurePath("slice"),t=this._path,e=r(arguments)):(t=arguments[0],e=arguments[1]):3===arguments.length&&(t=arguments[0],e=r(arguments,1));return(this._fields||(this._fields={}))[t]={$slice:e},this},c.prototype.sort=function(t){if(!t)return this;var e,n,r;this._validate("sort");var o=typeof t;if(Array.isArray(t)){for(n=t.length,e=0;e<t.length;++e){if(!Array.isArray(t[e]))throw new Error("Invalid sort() argument, must be array of arrays");p(this.options,t[e][0],t[e][1])}return this}if(1===arguments.length&&"string"==o){for(n=(t=t.split(/\s+/)).length,e=0;e<n;++e)if(r=t[e]){var i="-"==r[0]?-1:1;-1===i&&(r=r.substring(1)),h(this.options,r,i)}return this}if(s.isObject(t)){var u=s.keys(t);for(e=0;e<u.length;++e)r=u[e],h(this.options,r,t[r]);return this}if("undefined"!=typeof Map&&t instanceof Map)return function(t,e){if(t.sort=t.sort||new Map,!(t.sort instanceof Map))throw new TypeError("Can't mix sort syntaxes. Use either array or object or map consistently");e.forEach(function(e,n){var r=String(e||1).toLowerCase();if(!(r=l[r]))throw new TypeError("Invalid sort value: < "+n+": "+e+" >");t.sort.set(n,r)})}
/*!
 * limit, skip, maxScan, batchSize, comment
 *
 * Sets these associated options.
 *
 *     query.comment('feed query');
 */(this.options,t),this;throw new TypeError("Invalid sort() argument. Must be a string, object, or array.")};
/*!
 * @ignore
 */
var l={1:1,"-1":-1,asc:1,ascending:1,desc:-1,descending:-1};function h(t,e,n){if(Array.isArray(t.sort))throw new TypeError("Can't mix sort syntaxes. Use either array or object:\n- `.sort([['field', 1], ['test', -1]])`\n- `.sort({ field: 1, test: -1 })`");var r;if(n&&n.$meta)(r=t.sort||(t.sort={}))[e]={$meta:n.$meta};else{r=t.sort||(t.sort={});var o=String(n||1).toLowerCase();if(!(o=l[o]))throw new TypeError("Invalid sort value: { "+e+": "+n+" }");r[e]=o}}function p(t,e,n){if(t.sort=t.sort||[],!Array.isArray(t.sort))throw new TypeError("Can't mix sort syntaxes. Use either array or object:\n- `.sort([['field', 1], ['test', -1]])`\n- `.sort({ field: 1, test: -1 })`");var r=String(n||1).toLowerCase();if(!(r=l[r]))throw new TypeError("Invalid sort value: [ "+e+", "+n+" ]");t.sort.push([e,r])}
/*!
 * Internal helper for update, updateMany, updateOne
 */
function f(t,e,n,r,o,i,a){return t.op=e,c.canMerge(n)&&t.merge(n),r&&t._mergeUpdate(r),s.isObject(o)&&t.setOptions(o),i||a?!t._update||!t.options.overwrite&&0===s.keys(t._update).length?(a&&s.soon(a.bind(null,null,0)),t):(o=t._optionsForExec(),a||(o.safe=!1),n=t._conditions,r=t._updateForExec(),u("update",t._collection.collectionName,n,r,o),a=t._wrapCallback(e,a,{conditions:n,doc:r,options:o}),t._collection[e](n,r,o,s.tick(a)),t):t}["limit","skip","maxScan","batchSize","comment"].forEach(function(t){c.prototype[t]=function(e){return this._validate(t),this.options[t]=e,this}}),c.prototype.maxTime=c.prototype.maxTimeMS=function(t){return this._validate("maxTime"),this.options.maxTimeMS=t,this},c.prototype.snapshot=function(){return this._validate("snapshot"),this.options.snapshot=!arguments.length||!!arguments[0],this},c.prototype.hint=function(){if(0===arguments.length)return this;this._validate("hint");var t=arguments[0];if(s.isObject(t)){var e=this.options.hint||(this.options.hint={});for(var n in t)e[n]=t[n];return this}if("string"==typeof t)return this.options.hint=t,this;throw new TypeError("Invalid hint. "+t)},c.prototype.j=function(t){return this.options.j=t,this},c.prototype.slaveOk=function(t){return this.options.slaveOk=!arguments.length||!!t,this},c.prototype.read=c.prototype.setReadPreference=function(t){return arguments.length>1&&!c.prototype.read.deprecationWarningIssued&&(console.error("Deprecation warning: 'tags' argument is not supported anymore in Query.read() method. Please use mongodb.ReadPreference object instead."),c.prototype.read.deprecationWarningIssued=!0),this.options.readPreference=s.readPref(t),this},c.prototype.readConcern=c.prototype.r=function(t){return this.options.readConcern=s.readConcern(t),this},c.prototype.tailable=function(){return this._validate("tailable"),this.options.tailable=!arguments.length||!!arguments[0],this},c.prototype.writeConcern=c.prototype.w=function(t){return"object"==typeof t?(void 0!==t.j&&(this.options.j=t.j),void 0!==t.w&&(this.options.w=t.w),void 0!==t.wtimeout&&(this.options.wtimeout=t.wtimeout)):this.options.w="m"===t?"majority":t,this},c.prototype.wtimeout=c.prototype.wTimeout=function(t){return this.options.wtimeout=t,this},c.prototype.merge=function(t){if(!t)return this;if(!c.canMerge(t))throw new TypeError("Invalid argument. Expected instanceof mquery or plain object");return t instanceof c?(t._conditions&&s.merge(this._conditions,t._conditions),t._fields&&(this._fields||(this._fields={}),s.merge(this._fields,t._fields)),t.options&&(this.options||(this.options={}),s.merge(this.options,t.options)),t._update&&(this._update||(this._update={}),s.mergeClone(this._update,t._update)),t._distinct&&(this._distinct=t._distinct),this):(s.merge(this._conditions,t),this)},c.prototype.find=function(t,e){if(this.op="find","function"==typeof t?(e=t,t=void 0):c.canMerge(t)&&this.merge(t),!e)return this;var n=this._conditions,r=this._optionsForExec();return this.$useProjection?r.projection=this._fieldsForExec():r.fields=this._fieldsForExec(),u("find",this._collection.collectionName,n,r),e=this._wrapCallback("find",e,{conditions:n,options:r}),this._collection.find(n,r,s.tick(e)),this},c.prototype.cursor=function(t){if(this.op){if("find"!==this.op)throw new TypeError(".cursor only support .find method")}else this.find(t);var e=this._conditions,n=this._optionsForExec();return this.$useProjection?n.projection=this._fieldsForExec():n.fields=this._fieldsForExec(),u("findCursor",this._collection.collectionName,e,n),this._collection.findCursor(e,n)},c.prototype.findOne=function(t,e){if(this.op="findOne","function"==typeof t?(e=t,t=void 0):c.canMerge(t)&&this.merge(t),!e)return this;var n=this._conditions,r=this._optionsForExec();return this.$useProjection?r.projection=this._fieldsForExec():r.fields=this._fieldsForExec(),u("findOne",this._collection.collectionName,n,r),e=this._wrapCallback("findOne",e,{conditions:n,options:r}),this._collection.findOne(n,r,s.tick(e)),this},c.prototype.count=function(t,e){if(this.op="count",this._validate(),"function"==typeof t?(e=t,t=void 0):c.canMerge(t)&&this.merge(t),!e)return this;var n=this._conditions,r=this._optionsForExec();return u("count",this._collection.collectionName,n,r),e=this._wrapCallback("count",e,{conditions:n,options:r}),this._collection.count(n,r,s.tick(e)),this},c.prototype.distinct=function(t,e,n){if(this.op="distinct",this._validate(),!n){switch(typeof e){case"function":n=e,"string"==typeof t&&(e=t,t=void 0);break;case"undefined":case"string":break;default:throw new TypeError("Invalid `field` argument. Must be string or function")}switch(typeof t){case"function":n=t,t=e=void 0;break;case"string":e=t,t=void 0}}if("string"==typeof e&&(this._distinct=e),c.canMerge(t)&&this.merge(t),!n)return this;if(!this._distinct)throw new Error("No value for `distinct` has been declared");var r=this._conditions,o=this._optionsForExec();return u("distinct",this._collection.collectionName,r,o),n=this._wrapCallback("distinct",n,{conditions:r,options:o}),this._collection.distinct(this._distinct,r,o,s.tick(n)),this},c.prototype.update=function(t,e,n,r){var o;switch(arguments.length){case 3:"function"==typeof n&&(r=n,n=void 0);break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0);break;case 1:switch(typeof t){case"function":r=t,t=n=e=void 0;break;case"boolean":o=t,t=void 0;break;default:e=t,t=n=void 0}}return f(this,"update",t,e,n,o,r)},c.prototype.updateMany=function(t,e,n,r){var o;switch(arguments.length){case 3:"function"==typeof n&&(r=n,n=void 0);break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0);break;case 1:switch(typeof t){case"function":r=t,t=n=e=void 0;break;case"boolean":o=t,t=void 0;break;default:e=t,t=n=void 0}}return f(this,"updateMany",t,e,n,o,r)},c.prototype.updateOne=function(t,e,n,r){var o;switch(arguments.length){case 3:"function"==typeof n&&(r=n,n=void 0);break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0);break;case 1:switch(typeof t){case"function":r=t,t=n=e=void 0;break;case"boolean":o=t,t=void 0;break;default:e=t,t=n=void 0}}return f(this,"updateOne",t,e,n,o,r)},c.prototype.replaceOne=function(t,e,n,r){var o;switch(arguments.length){case 3:"function"==typeof n&&(r=n,n=void 0);break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0);break;case 1:switch(typeof t){case"function":r=t,t=n=e=void 0;break;case"boolean":o=t,t=void 0;break;default:e=t,t=n=void 0}}return this.setOptions({overwrite:!0}),f(this,"replaceOne",t,e,n,o,r)},c.prototype.remove=function(t,e){var n;if(this.op="remove","function"==typeof t?(e=t,t=void 0):c.canMerge(t)?this.merge(t):!0===t&&(n=t,t=void 0),!n&&!e)return this;var r=this._optionsForExec();e||(r.safe=!1);var o=this._conditions;return u("remove",this._collection.collectionName,o,r),e=this._wrapCallback("remove",e,{conditions:o,options:r}),this._collection.remove(o,r,s.tick(e)),this},c.prototype.deleteOne=function(t,e){var n;if(this.op="deleteOne","function"==typeof t?(e=t,t=void 0):c.canMerge(t)?this.merge(t):!0===t&&(n=t,t=void 0),!n&&!e)return this;var r=this._optionsForExec();e||(r.safe=!1),delete r.justOne;var o=this._conditions;return u("deleteOne",this._collection.collectionName,o,r),e=this._wrapCallback("deleteOne",e,{conditions:o,options:r}),this._collection.deleteOne(o,r,s.tick(e)),this},c.prototype.deleteMany=function(t,e){var n;if(this.op="deleteMany","function"==typeof t?(e=t,t=void 0):c.canMerge(t)?this.merge(t):!0===t&&(n=t,t=void 0),!n&&!e)return this;var r=this._optionsForExec();e||(r.safe=!1),delete r.justOne;var o=this._conditions;return u("deleteOne",this._collection.collectionName,o,r),e=this._wrapCallback("deleteOne",e,{conditions:o,options:r}),this._collection.deleteMany(o,r,s.tick(e)),this},c.prototype.findOneAndUpdate=function(t,e,n,r){switch(this.op="findOneAndUpdate",this._validate(),arguments.length){case 3:"function"==typeof n&&(r=n,n={});break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0),n=void 0;break;case 1:"function"==typeof t?(r=t,t=n=e=void 0):(e=t,t=n=void 0)}return c.canMerge(t)&&this.merge(t),e&&this._mergeUpdate(e),n&&this.setOptions(n),r?this._findAndModify("update",r):this},c.prototype.findOneAndRemove=c.prototype.findOneAndDelete=function(t,e,n){return this.op="findOneAndRemove",this._validate(),"function"==typeof e?(n=e,e=void 0):"function"==typeof t&&(n=t,t=void 0),c.canMerge(t)&&this.merge(t),e&&this.setOptions(e),n?this._findAndModify("remove",n):this},c.prototype._findAndModify=function(t,e){o.equal("function",typeof e);var n,r=this._optionsForExec();if("remove"==t)r.remove=!0;else if("new"in r||(r.new=!0),"upsert"in r||(r.upsert=!1),!(n=this._updateForExec())){if(!r.upsert)return this.findOne(e);n={$set:{}}}null!=this._fieldsForExec()&&(this.$useProjection?r.projection=this._fieldsForExec():r.fields=this._fieldsForExec());var i=this._conditions;return u("findAndModify",this._collection.collectionName,i,n,r),e=this._wrapCallback("findAndModify",e,{conditions:i,doc:n,options:r}),this._collection.findAndModify(i,n,r,s.tick(e)),this},c.prototype._wrapCallback=function(t,e,n){var r=this._traceFunction||c.traceFunction;if(r){n.collectionName=this._collection.collectionName;var o=r&&r.call(null,t,n,this),i=(new Date).getTime();return function(t,n){if(o){var r=(new Date).getTime()-i;o.call(null,t,n,r)}e&&e.apply(null,arguments)}}return e},c.prototype.setTraceFunction=function(t){return this._traceFunction=t,this},c.prototype.exec=function(t,e){switch(typeof t){case"function":e=t,t=null;break;case"string":this.op=t}o.ok(this.op,"Missing query type: (find, update, etc)"),"update"!=this.op&&"remove"!=this.op||e||(e=!0);var n=this;if("function"!=typeof e)return new c.Promise(function(t,e){n[n.op](function(n,r){n?e(n):t(r),t=e=null})});this[this.op](e)},c.prototype.thunk=function(){var t=this;return function(e){t.exec(e)}},c.prototype.then=function(t,e){var n=this;return new c.Promise(function(t,e){n.exec(function(n,r){n?e(n):t(r),t=e=null})}).then(t,e)},c.prototype.stream=function(t){if("find"!=this.op)throw new Error("stream() is only available for find");var e=this._conditions,n=this._optionsForExec();return this.$useProjection?n.projection=this._fieldsForExec():n.fields=this._fieldsForExec(),u("stream",this._collection.collectionName,e,n,t),this._collection.findStream(e,n,t)},c.prototype.selected=function(){return!!(this._fields&&Object.keys(this._fields).length>0)},c.prototype.selectedInclusively=function(){if(!this._fields)return!1;var t=Object.keys(this._fields);if(0===t.length)return!1;for(var e=0;e<t.length;++e){var n=t[e];if(0===this._fields[n])return!1;if(this._fields[n]&&"object"==typeof this._fields[n]&&this._fields[n].$meta)return!1}return!0},c.prototype.selectedExclusively=function(){if(!this._fields)return!1;var t=Object.keys(this._fields);if(0===t.length)return!1;for(var e=0;e<t.length;++e){var n=t[e];if(0===this._fields[n])return!0}return!1},c.prototype._mergeUpdate=function(t){this._update||(this._update={}),t instanceof c?t._update&&s.mergeClone(this._update,t._update):s.mergeClone(this._update,t)},c.prototype._optionsForExec=function(){return s.clone(this.options)},c.prototype._fieldsForExec=function(){return s.clone(this._fields)},c.prototype._updateForExec=function(){for(var t=s.clone(this._update),e=s.keys(t),n=e.length,r={};n--;){var o=e[n];this.options.overwrite?r[o]=t[o]:"$"!==o[0]?(r.$set||(t.$set?r.$set=t.$set:r.$set={}),r.$set[o]=t[o],e.splice(n,1),~e.indexOf("$set")||e.push("$set")):"$set"===o&&r.$set||(r[o]=t[o])}return this._compiledUpdate=r,r},c.prototype._ensurePath=function(t){if(!this._path)throw new Error(t+"() must be used after where() when called with these arguments")},
/*!
 * Permissions
 */
c.permissions=n(272),c._isPermitted=function(t,e){var n=c.permissions[e];return!n||!0!==n[t]},c.prototype._validate=function(t){var e,n;if(void 0===t){if("function"!=typeof(n=c.permissions[this.op]))return!0;e=n(this)}else c._isPermitted(t,this.op)||(e=t);if(e)throw new Error(e+" cannot be used with "+this.op)},c.canMerge=function(t){return t instanceof c||s.isObject(t)},c.setGlobalTraceFunction=function(t){c.traceFunction=t},
/*!
 * Exports.
 */
c.utils=s,c.env=n(162),c.Collection=n(273),c.BaseCollection=n(85),c.Promise=n(275),t.exports=c},function(t,e,n){"use strict";
/*!
 * Module requirements
 */const r=n(9),o=n(0);function i(t){this.errors={},this._message="",t&&"model"===t.constructor.name?(this._message=t.constructor.modelName+" validation failed",r.call(this,this._message)):(this._message="Validation failed",r.call(this,this._message)),this.name="ValidationError",Error.captureStackTrace?Error.captureStackTrace(this):this.stack=(new Error).stack,t&&(t.errors=this.errors)}
/*!
 * Inherits from MongooseError.
 */
/*!
 * ignore
 */
function s(t){const e=Object.keys(t.errors||{}),n=e.length,r=[];let o;for(let i=0;i<n;++i)o=e[i],t!==t.errors[o]&&r.push(o+": "+t.errors[o].message);return r.join(", ")}
/*!
 * Module exports
 */i.prototype=Object.create(r.prototype),i.prototype.constructor=r,i.prototype.toString=function(){return this.name+": "+s(this)},
/*!
 * inspect helper
 */
i.prototype.inspect=function(){return Object.assign(new Error(this.message),this)},o.inspect.custom&&(
/*!
  * Avoid Node deprecation warning DEP0079
  */
i.prototype[o.inspect.custom]=i.prototype.inspect)
/*!
 * Helper for JSON.stringify
 */,i.prototype.toJSON=function(){return Object.assign({},this,{message:this.message})},
/*!
 * add message
 */
i.prototype.addError=function(t,e){this.errors[t]=e,this.message=this._message+": "+s(this)},t.exports=i},function(t,e,n){"use strict";const r=n(109);
/*!
 * ignore
 */t.exports=function(t){const e=null!=this?this.path:null;return r(t,e)}},function(t,e,n){"use strict";const r=n(24);
/*!
 * Given a value, cast it to a boolean, or throw a `CastError` if the value
 * cannot be casted. `null` and `undefined` are considered valid.
 *
 * @param {Any} value
 * @param {String} [path] optional the path to set on the CastError
 * @return {Boolean|null|undefined}
 * @throws {CastError} if `value` is not one of the allowed values
 * @api private
 */t.exports=function(e,n){if(null==e)return e;if(t.exports.convertToTrue.has(e))return!0;if(t.exports.convertToFalse.has(e))return!1;throw new r("boolean",e,n)},t.exports.convertToTrue=new Set([!0,"true",1,"1","yes"]),t.exports.convertToFalse=new Set([!1,"false",0,"0","no"])},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(9);function o(t,e){e=e||"Field `"+t+"` is not in schema and strict mode is set to throw.",r.call(this,e),this.name="StrictModeError",Error.captureStackTrace?Error.captureStackTrace(this):this.stack=(new Error).stack,this.path=t}
/*!
 * Inherits from MongooseError.
 */o.prototype=Object.create(r.prototype),o.prototype.constructor=r,t.exports=o},function(t,e,n){"use strict";function r(t,e){this.path=e,this.getters=[],this.setters=[],this.options=Object.assign({},t)}r.prototype._applyDefaultGetters=function(){if(this.getters.length>0||this.setters.length>0)return;const t="$"+this.path;this.getters.push(function(){return this[t]}),this.setters.push(function(e){this[t]=e})},
/*!
 * ignore
 */
r.prototype.clone=function(){const t=new r(this.name,this.options);return t.getters=[].concat(this.getters),t.setters=[].concat(this.setters),t},r.prototype.get=function(t){return this.getters.push(t),this},r.prototype.set=function(t){return this.setters.push(t),this},r.prototype.applyGetters=function(t,e){let n=t;for(let t=this.getters.length-1;t>=0;t--)n=this.getters[t].call(e,n,this);return n},r.prototype.applySetters=function(t,e){let n=t;for(let t=this.setters.length-1;t>=0;t--)n=this.setters[t].call(e,n,this);return n},
/*!
 * exports
 */
t.exports=r},function(t,e,n){"use strict";const r=n(8),o=n(23).getSymbol,i=n(5);let s;
/*!
 * exports
 */
/*!
 * Compiles schemas.
 */
function u(t,e,r,o){s=s||n(16);const u=Object.keys(t),a=u.length;let l,h;for(let n=0;n<a;++n){l=t[h=u[n]],c(h,"Object"===i.getFunctionName(l.constructor)&&Object.keys(l).length&&(!l[o.typeKey]||"type"===o.typeKey&&l.type.type)?l:null,e,r,u,o)}}
/*!
 * Defines the accessor named prop on the incoming prototype.
 */function c(t,e,c,a,l,h){s=s||n(16);const p=(a?a+".":"")+t;a=a||"",e?Object.defineProperty(c,t,{enumerable:!0,configurable:!0,get:function(){const t=this;if(this.$__.getters||(this.$__.getters={}),!this.$__.getters[p]){const n=Object.create(s.prototype,function(t){const e={};return Object.getOwnPropertyNames(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n),e[n].get?delete e[n]:e[n].enumerable=-1===["isNew","$__","errors","_doc"].indexOf(n)}),e}(this));a||(n.$__.scope=this),n.$__.nestedPath=p,Object.defineProperty(n,"schema",{enumerable:!1,configurable:!0,writable:!1,value:c.schema}),Object.defineProperty(n,"toObject",{enumerable:!1,configurable:!0,writable:!1,value:function(){return i.clone(t.get(p,null,{virtuals:r(this,"schema.options.toObject.virtuals",null)}))}}),Object.defineProperty(n,"toJSON",{enumerable:!1,configurable:!0,writable:!1,value:function(){return t.get(p,null,{virtuals:r(t,"schema.options.toJSON.virtuals",null)})}}),Object.defineProperty(n,"$__isNested",{enumerable:!1,configurable:!0,writable:!1,value:!0}),u(e,n,p,h),this.$__.getters[p]=n}return this.$__.getters[p]},set:function(t){return t instanceof s&&(t=t.toObject({transform:!1})),(this.$__.scope||this).$set(p,t)}}):Object.defineProperty(c,t,{enumerable:!0,configurable:!0,get:function(){return this[o].call(this.$__.scope||this,p)},set:function(t){return this.$set.call(this.$__.scope||this,p,t)}})}e.compile=u,e.defineKey=c},function(t,e,n){"use strict";const r=n(87),o=n(5);
/*!
 * Register hooks for this model
 *
 * @param {Model} model
 * @param {Schema} schema
 */
function i(t,e,n){const s={useErrorHandlers:!0,numCallbackParams:1,nullResultByDefault:!0,contextParameter:!0},u=(n=n||{}).decorateDoc?t:t.prototype;t.$appliedHooks=!0;for(let t=0;t<e.childSchemas.length;++t){const r=e.childSchemas[t].model;if(!r.$appliedHooks&&(i(r,e.childSchemas[t].schema,n),null!=r.discriminators)){const t=Object.keys(r.discriminators);for(let e=0;e<t.length;++e)i(r.discriminators[t[e]],r.discriminators[t[e]].schema,n)}}const c=e.s.hooks.filter(t=>"updateOne"===t.name?!!t.document:"remove"!==t.name||(null==t.document||!!t.document)).filter(t=>!e.methods[t.name]||!t.fn[r.builtInMiddleware]);t._middleware=c,u.$__save=c.createWrapper("save",u.$__save,null,s),u.$__validate=c.createWrapper("validate",u.$__validate,null,s),u.$__remove=c.createWrapper("remove",u.$__remove,null,s),u.$__init=c.createWrapperSync("init",u.$__init,null,s);const a=Object.keys(e.methods),l=Object.assign({},s,{checkForPromise:!0});for(const e of a){if(!c.hasHooks(e))continue;const n=u[e];u[e]=function(){const n=Array.prototype.slice.call(arguments),r=o.last(n),i=null==r?n:n.slice(0,n.length-1);return o.promiseOrCallback(r,t=>{this[`$__${e}`].apply(this,i.concat([t]))},t.events)},u[`$__${e}`]=c.createWrapper(e,n,null,l)}}
/*!
 * ignore
 */
t.exports=i,
/*!
 * ignore
 */
i.middlewareFunctions=["save","validate","remove","updateOne","init"]},function(t,e,n){"use strict";
/*!
 * Module exports.
 */e.String=n(176),e.Number=n(115),e.Boolean=n(180),e.DocumentArray=n(324),e.Embedded=n(327),e.Array=n(116),e.Buffer=n(184),e.Date=n(181),e.ObjectId=n(182),e.Mixed=n(47),e.Decimal128=e.Decimal=n(328),e.Map=n(186),e.Oid=e.ObjectId,e.Object=e.Mixed,e.Bool=e.Boolean},function(t,e,n){"use strict";
/*!
 * Module requirements.
 */const r=n(9),o=n(19),i=n(178),s=n(179),u=n(5),c=o.CastError;let a;function l(t,e){o.call(this,t,e,"Number")}
/*!
 * ignore
 */
function h(t){return this.cast(t)}l.get=o.get,
/*!
 * ignore
 */
l._cast=i,l.cast=function(t){return 0===arguments.length?this._cast:(!1===t&&(t=(t=>{if("number"!=typeof t)throw new Error;return t})),this._cast=t,this._cast)},l.schemaName="Number",
/*!
 * Inherits from SchemaType.
 */
l.prototype=Object.create(o.prototype),l.prototype.constructor=l,
/*!
 * ignore
 */
l._checkRequired=(t=>"number"==typeof t||t instanceof Number),l.checkRequired=o.checkRequired,l.prototype.checkRequired=function(t,e){return o._isRef(this,t,e,!0)?!!t:this.constructor._checkRequired(t)},l.prototype.min=function(t,e){if(this.minValidator&&(this.validators=this.validators.filter(function(t){return t.validator!==this.minValidator},this)),null!=t){let n=e||r.messages.Number.min;n=n.replace(/{MIN}/,t),this.validators.push({validator:this.minValidator=function(e){return null==e||e>=t},message:n,type:"min",min:t})}return this},l.prototype.max=function(t,e){if(this.maxValidator&&(this.validators=this.validators.filter(function(t){return t.validator!==this.maxValidator},this)),null!=t){let n=e||r.messages.Number.max;n=n.replace(/{MAX}/,t),this.validators.push({validator:this.maxValidator=function(e){return null==e||e<=t},message:n,type:"max",max:t})}return this},l.prototype.cast=function(t,e,r){if(o._isRef(this,t,e,r)){if(null==t)return t;if(a||(a=n(16)),t instanceof a)return t.$__.wasPopulated=!0,t;if("number"==typeof t)return t;if(Buffer.isBuffer(t)||!u.isObject(t))throw new c("number",t,this.path);const r=e.$__fullPath(this.path),o=new((e.ownerDocument?e.ownerDocument():e).populated(r,!0).options.model)(t);return o.$__.wasPopulated=!0,o}const i=t&&void 0!==t._id?t._id:t;try{return this.constructor.cast()(i)}catch(t){throw new c("number",i,this.path)}},l.prototype.$conditionalHandlers=u.options(o.prototype.$conditionalHandlers,{$bitsAllClear:s,$bitsAnyClear:s,$bitsAllSet:s,$bitsAnySet:s,$gt:h,$gte:h,$lt:h,$lte:h,$mod:function(t){const e=this;return Array.isArray(t)?t.map(function(t){return e.cast(t)}):[this.cast(t)]}}),l.prototype.castForQuery=function(t,e){let n;if(2===arguments.length){if(!(n=this.$conditionalHandlers[t]))throw new c("Can't use "+t+" with Number.");return n.call(this,e)}return e=this._castForQuery(t)},
/*!
 * Module exports.
 */
t.exports=l},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(108),o=n(166),i=n(86),s=n(19),u=s.CastError,c={Array:v,Boolean:n(180),Date:n(181),Number:n(115),String:n(176),ObjectId:n(182),Buffer:n(184),Map:n(186)},a=n(47),l=n(118),h=n(8),p=n(0),f=n(5),d=n(89).castToNumber,m=n(187),g=n(31).getDiscriminatorByValue;let y,_;function v(t,e,r,o){_||(_=n(60).Embedded);let i,u,l="type";if(o&&o.typeKey&&(l=o.typeKey),e){let n={};"Object"===f.getFunctionName(e.constructor)&&(e[l]?(delete(n=f.clone(e))[l],e=e[l]):e=a),e===Object&&(e=a);const r="string"==typeof e?e:f.getFunctionName(e),o=r in c?c[r]:e;this.casterConstructor=o,"function"!=typeof o||o.$isArraySubdocument||o.$isSchemaMap?this.caster=o:this.caster=new o(null,n),this.caster instanceof _||(this.caster.path=t)}if(this.$isMongooseArray=!0,s.call(this,t,r,"Array"),null!=this.defaultValue&&(i=this.defaultValue,u="function"==typeof i),!("defaultValue"in this)||void 0!==this.defaultValue){const t=function(){let t=[];return u?t=i.call(this):null!=i&&(t=t.concat(i)),t};t.$runBeforeSetters=!0,this.default(t)}}v.schemaName="Array",v.options={castNonArrays:!0},
/*!
 * Inherits from SchemaType.
 */
v.prototype=Object.create(s.prototype),v.prototype.constructor=v,v.prototype.enum=function(){const t=h(this,"caster.instance");if("String"!==t)throw new Error("`enum` can only be set on an array of strings, not "+t);return this.caster.enum.apply(this.caster,arguments),this},v.prototype.applyGetters=function(t,e){return this.caster.options&&this.caster.options.ref?t:s.prototype.applyGetters.call(this,t,e)},v.prototype.cast=function(t,e,r){let o,i;if(y||(y=n(60).Array),Array.isArray(t)){if(!t.length&&e){const t=e.schema.indexedPaths();for(o=0,i=t.length;o<i;++o){const e=t[o][0][this.path];if("2dsphere"===e||"2d"===e)return}}if(t&&t.isMongooseArray?t&&t.isMongooseArray&&(t=new y(t,this.path,e)):t=new y(t,this.path,e),this.caster&&this.casterConstructor!==a)try{for(o=0,i=t.length;o<i;o++)t[o]=this.caster.cast(t[o],e,r)}catch(e){throw new u("["+e.kind+"]",p.inspect(t),this.path,e)}return t}if(r||v.options.castNonArrays)return e&&r&&e.markModified(this.path),this.cast([t],e,r);throw new u("Array",p.inspect(t),this.path)},
/*!
 * Ignore
 */
v.prototype.discriminator=function(t,e){let n=this;for(;n.$isMongooseArray&&!n.$isMongooseDocumentArray;)if(null==(n=n.casterConstructor)||"function"==typeof n)throw new i("You can only add an embedded discriminator on a document array, "+this.path+" is a plain array");return n.discriminator(t,e)},v.prototype.castForQuery=function(t,e){let n,r;if(2===arguments.length){if(!(n=this.$conditionalHandlers[t]))throw new Error("Can't use "+t+" with Array.");r=n.call(this,e)}else{r=t;let e=this.casterConstructor;if(r&&e.discriminators&&e.schema&&e.schema.options&&e.schema.options.discriminatorKey)if("string"==typeof r[e.schema.options.discriminatorKey]&&e.discriminators[r[e.schema.options.discriminatorKey]])e=e.discriminators[r[e.schema.options.discriminatorKey]];else{const t=g(e,r[e.schema.options.discriminatorKey]);t&&(e=t)}const n=this.casterConstructor.prototype;let o=n&&(n.castForQuery||n.cast);!o&&e.castForQuery&&(o=e.castForQuery);const i=this.caster;Array.isArray(r)?(this.setters.reverse().forEach(t=>{r=t.call(this,r,this)}),r=r.map(function(t){return f.isObject(t)&&t.$elemMatch?t:o?t=o.call(i,t):null!=t?t=new e(t):t})):o?r=o.call(i,r):null!=r&&(r=new e(r))}return r};const w=v.prototype.$conditionalHandlers={};w.$all=function(t){return Array.isArray(t)||(t=[t]),t=t.map(function(t){if(f.isObject(t)){const e={};return e[this.path]=t,l(this.casterConstructor.schema,e)[this.path]}return t},this),this.castForQuery(t)},w.$options=String,w.$elemMatch=function(t){const e=Object.keys(t),n=e.length;let r,o;for(let i=0;i<n;++i)o=t[r=e[i]],0===r.indexOf("$")&&o&&(t[r]=this.castForQuery(r,o));return l(this.casterConstructor.schema,t)},w.$geoIntersects=m.cast$geoIntersects,w.$or=w.$and=function(t){if(!Array.isArray(t))throw new TypeError("conditional $or/$and require array");const e=[];for(let n=0;n<t.length;++n)e.push(l(this.casterConstructor.schema,t[n]));return e},w.$near=w.$nearSphere=m.cast$near,w.$within=w.$geoWithin=m.cast$within,w.$size=w.$minDistance=w.$maxDistance=d,w.$exists=r,w.$type=o,w.$eq=w.$gt=w.$gte=w.$lt=w.$lte=w.$ne=w.$nin=w.$regex=v.prototype.castForQuery,w.$in=s.prototype.$conditionalHandlers.$in,
/*!
 * Module exports.
 */
t.exports=v},function(t,e,n){"use strict";const r=n(47),o=n(8),i=n(0);
/*!
 * ignore
 */
class s extends Map{constructor(t,e,n,o){null!=t&&"Object"===t.constructor.name&&(t=Object.keys(t).reduce((e,n)=>e.concat([[n,t[n]]]),[])),super(t),this.$__parent=null!=n&&null!=n.$__?n:null,this.$__path=e,this.$__schemaType=null==o?new r(e):o,this.$__runDeferred()}$init(t,e){u(t),super.set(t,e),null!=e&&e.$isSingleNested&&(e.$basePath=this.$__path+"."+t)}$__set(t,e){super.set(t,e)}set(t,e){if(u(t),null==this.$__schemaType)return this.$__deferred=this.$__deferred||[],void this.$__deferred.push({key:t,value:e});const n=this.$__path+"."+t,r=null!=this.$__parent&&this.$__parent.$__?this.$__parent.populated(n)||this.$__parent.populated(this.$__path):null;if(null!=r)null==e.$__&&(e=new r.options.model(e)),e.$__.wasPopulated=!0;else try{e=this.$__schemaType.applySetters(e,this.$__parent,!1,this.get(t))}catch(t){if(null!=this.$__parent&&null!=this.$__parent.$__)return void this.$__parent.invalidate(n,t);throw t}super.set(t,e),null!=e&&e.$isSingleNested&&(e.$basePath=this.$__path+"."+t),null!=this.$__parent&&this.$__parent.$__&&this.$__parent.markModified(this.$__path+"."+t)}toBSON(){return new Map(this)}toObject(t){if(o(t,"flattenMaps")){const t={},e=this.keys();for(const n of e)t[n]=this.get(n);return t}return new Map(this)}toJSON(){const t={},e=this.keys();for(const n of e)t[n]=this.get(n);return t}inspect(){return new Map(this)}$__runDeferred(){if(this.$__deferred){for(let t=0;t<this.$__deferred.length;++t)this.set(this.$__deferred[t].key,this.$__deferred[t].value);this.$__deferred=null}}}
/*!
 * Since maps are stored as objects under the hood, keys must be strings
 * and can't contain any invalid characters
 */
function u(t){const e=typeof t;if("string"!==e)throw new TypeError(`Mongoose maps only support string keys, got ${e}`);if(t.startsWith("$"))throw new Error(`Mongoose maps do not support keys that start with "$", got "${t}"`);if(t.includes("."))throw new Error(`Mongoose maps do not support keys that contain ".", got "${t}"`)}i.inspect.custom&&Object.defineProperty(s.prototype,i.inspect.custom,{enumerable:!1,writable:!1,configurable:!1,value:s.prototype.inspect}),Object.defineProperty(s.prototype,"$__set",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(s.prototype,"$__parent",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(s.prototype,"$__path",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(s.prototype,"$__schemaType",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(s.prototype,"$isMongooseMap",{enumerable:!1,writable:!1,configurable:!1,value:!0}),Object.defineProperty(s.prototype,"$__deferredCalls",{enumerable:!1,writable:!1,configurable:!1,value:!0}),t.exports=s},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(110),o=n(114),i=n(326),s=n(8),u=n(0),c=n(5),a=["Polygon","MultiPolygon"];function l(t,e,n){if(Array.isArray(t))t.forEach(function(r,o){if(Array.isArray(r)||c.isObject(r))return l(r,e,n);t[o]=e.castForQueryWrapper({val:r,context:n})});else{const r=Object.keys(t);let o=r.length;for(;o--;){const i=r[o],s=t[i];Array.isArray(s)||c.isObject(s)?(l(s,e,n),t[i]=s):t[i]=e.castForQuery({val:s,context:n})}}}t.exports=function t(e,n,h,p){if(Array.isArray(n))throw new Error("Query filter must be an object, got an array ",u.inspect(n));const f=Object.keys(n);let d,m,g,y,_,v,w,b=f.length;for(h=h||{};b--;)if(w=n[_=f[b]],"$or"===_||"$nor"===_||"$and"===_){let n=w.length;for(;n--;)w[n]=t(e,w[n],h,p)}else{if("$where"===_){if("string"!==(v=typeof w)&&"function"!==v)throw new Error("Must have a string or function for $where");"function"===v&&(n[_]=w.toString());continue}if("$elemMatch"===_)w=t(e,w,h,p);else if("$text"===_)w=i(w,_);else{if(!e)continue;if(!(g=e.path(_))){const t=_.split(".");let r=t.length;for(;r--;){const o=t.slice(0,r).join("."),i=t.slice(r).join("."),u=e.path(o),c=s(u,"schema.options.discriminatorKey");if(null!=u&&null!=s(u,"schema.discriminators")&&null!=c&&i!==c){const t=s(n,o+"."+c);null!=t&&(g=u.schema.discriminators[t].path(i))}}}if(g){if(null==w)continue;if("Object"===w.constructor.name)if(m=Object.keys(w).some(function(t){return"$"===t.charAt(0)&&"$id"!==t&&"$ref"!==t})){const n=Object.keys(w);let r,o=n.length;for(;o--;)if(y=w[r=n[o]],"$not"===r){if(y&&g&&!g.caster){if((d=Object.keys(y)).length&&"$"===d[0].charAt(0))for(const t in y)y[t]=g.castForQueryWrapper({$conditional:t,val:y[t],context:p});else w[r]=g.castForQueryWrapper({$conditional:r,val:y,context:p});continue}t(g.caster?g.caster.schema:e,y,h,p)}else w[r]=g.castForQueryWrapper({$conditional:r,val:y,context:p})}else n[_]=g.castForQueryWrapper({val:w,context:p});else if(Array.isArray(w)&&-1===["Buffer","Array"].indexOf(g.instance)){const t=[];for(let e=0;e<w.length;e++)t.push(g.castForQueryWrapper({val:w[e],context:p}));n[_]={$in:t}}else n[_]=g.castForQueryWrapper({val:w,context:p})}else{const i=_.split(".");let s,u,f,d=i.length;for(;d--&&(s=i.slice(0,d).join("."),!(g=e.path(s))););if(g){g.caster&&g.caster.schema?((f={})[u=i.slice(d).join(".")]=w,n[_]=t(g.caster.schema,f,h,p)[u]):n[_]=w;continue}if(c.isObject(w)){let t="";if(w.$near?t="$near":w.$nearSphere?t="$nearSphere":w.$within?t="$within":w.$geoIntersects?t="$geoIntersects":w.$geoWithin&&(t="$geoWithin"),t){const e=new o.Number("__QueryCasting__");let n=w[t];if(null!=w.$maxDistance&&(w.$maxDistance=e.castForQueryWrapper({val:w.$maxDistance,context:p})),null!=w.$minDistance&&(w.$minDistance=e.castForQueryWrapper({val:w.$minDistance,context:p})),"$within"===t){const t=n.$center||n.$centerSphere||n.$box||n.$polygon;if(!t)throw new Error("Bad $within parameter: "+JSON.stringify(w));n=t}else if("$near"===t&&"string"==typeof n.type&&Array.isArray(n.coordinates))n=n.coordinates;else if(("$near"===t||"$nearSphere"===t||"$geoIntersects"===t)&&n.$geometry&&"string"==typeof n.$geometry.type&&Array.isArray(n.$geometry.coordinates))null!=n.$maxDistance&&(n.$maxDistance=e.castForQueryWrapper({val:n.$maxDistance,context:p})),null!=n.$minDistance&&(n.$minDistance=e.castForQueryWrapper({val:n.$minDistance,context:p})),c.isMongooseObject(n.$geometry)&&(n.$geometry=n.$geometry.toObject({transform:!1,virtuals:!1})),n=n.$geometry.coordinates;else if("$geoWithin"===t)if(n.$geometry){c.isMongooseObject(n.$geometry)&&(n.$geometry=n.$geometry.toObject({virtuals:!1}));const t=n.$geometry.type;if(-1===a.indexOf(t))throw new Error('Invalid geoJSON type for $geoWithin "'+t+'", must be "Polygon" or "MultiPolygon"');n=n.$geometry.coordinates}else n=n.$box||n.$polygon||n.$center||n.$centerSphere,c.isMongooseObject(n)&&(n=n.toObject({virtuals:!1}));l(n,e,p);continue}}if(e.nested[_])continue;if(h.upsert&&h.strict){if("throw"===h.strict)throw new r(_);throw new r(_,'Path "'+_+'" is not in schema, strict mode is `true`, and upsert is `true`.')}if("throw"===h.strictQuery)throw new r(_,'Path "'+_+'" is not in schema and strictQuery is true.');h.strictQuery&&delete n[_]}}}return n}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(59),o=n(16),i=n(38),s=n(169),u=n(8),c=n(39).internalToObjectOptions,a=n(5),l=n(0),h=a.isMongooseObject;function p(t,e,n){const r=[].concat(t),i=Object.keys(p.mixin),s=i.length;for(let t=0;t<s;++t)r[i[t]]=p.mixin[i[t]];return r._path=e,r.isMongooseArray=!0,r.validators=[],r._atomics={},r._schema=void 0,l.inspect.custom&&(r[l.inspect.custom]=r.inspect),n&&n instanceof o&&(r._parent=n,r._schema=n.schema.path(e)),r}
/*!
 * ignore
 */
function f(t,e){const n=u(t,"_schema.caster.options.ref",null);0===t.length&&e.length>0&&
/*!
 * ignore
 */
function(t,e){if(!e)return!1;for(let n=0;n<t.length;++n){const r=t[n];if(null==r)return!1;const i=r.constructor;if(!(r instanceof o)||i.modelName!==e&&i.baseModelName!==e)return!1}return!0}(e,n)&&t._parent.populated(t._path,[],{model:e[0].constructor})}
/*!
 * Module exports.
 */p.mixin={
/*!
   * ignore
   */
toBSON:function(){return this.toObject(c)},_atomics:void 0,_parent:void 0,_cast:function(t){let e,n=!1;if(this._parent&&(n=this._parent.populated(this._path,!0)),n&&null!=t){return e=n.options.model||n.options.Model,(Buffer.isBuffer(t)||t instanceof i||!a.isObject(t))&&(t={_id:t}),t.schema&&t.schema.discriminatorMapping&&void 0!==t.schema.discriminatorMapping.key||(t=new e(t)),this._schema.caster.applySetters(t,this._parent,!0)}return this._schema.caster.applySetters(t,this._parent,!1)},_markModified:function(t,e){const n=this._parent;let r;return n&&(r=this._path,arguments.length&&(r=null!=e?r+"."+this.indexOf(t)+"."+e:r+"."+t),n.markModified(r,arguments.length>0?t:n)),this},_registerAtomic:function(t,e){if("$set"===t)return this._atomics={$set:e},this;const n=this._atomics;if("$pop"===t&&!("$pop"in n)){const t=this;this._parent.once("save",function(){t._popped=t._shifted=null})}if(this._atomics.$set||Object.keys(n).length&&!(t in n))return this._atomics={$set:this},this;let o;if("$pullAll"===t||"$addToSet"===t)n[t]||(n[t]=[]),n[t]=n[t].concat(e);else if("$pullDocs"===t){const t=n.$pull||(n.$pull={});e[0]instanceof r?(o=t.$or||(t.$or=[]),Array.prototype.push.apply(o,e.map(function(t){return t.toObject({transform:!1,virtuals:!1})}))):(o=t._id||(t._id={$in:[]})).$in=o.$in.concat(e)}else"$push"===t?(n.$push=n.$push||{$each:[]},n.$push.$each=n.$push.$each.concat(e)):n[t]=e;return this},$__getAtomics:function(){const t=[],e=Object.keys(this._atomics);let n=e.length;const r=Object.assign({},c,{_isNested:!0});if(0===n)return t[0]=["$set",this.toObject(r)],t;for(;n--;){const o=e[n];let i=this._atomics[o];h(i)?i=i.toObject(r):Array.isArray(i)?i=this.toObject.call(i,r):null!=i&&Array.isArray(i.$each)?i.$each=this.toObject.call(i.$each,r):i.valueOf&&(i=i.valueOf()),"$addToSet"===o&&(i={$each:i}),t.push([o,i])}return t},hasAtomics:function(){return this._atomics&&"Object"===this._atomics.constructor.name?Object.keys(this._atomics).length:0},_mapCast:function(t,e){return this._cast(t,this.length+e)},push:function(){f(this,arguments);let t=[].map.call(arguments,this._mapCast,this);t=this._schema.applySetters(t,this._parent,void 0,void 0,{skipDocumentArrayCast:!0});const e=[].push.apply(this,t);return this._registerAtomic("$push",t),this._markModified(),e},nonAtomicPush:function(){const t=[].map.call(arguments,this._mapCast,this),e=[].push.apply(this,t);return this._registerAtomic("$set",this),this._markModified(),e},$pop:function(){if(this._registerAtomic("$pop",1),this._markModified(),!this._popped)return this._popped=!0,[].pop.call(this)},pop:function(){const t=[].pop.call(this);return this._registerAtomic("$set",this),this._markModified(),t},$shift:function(){if(this._registerAtomic("$pop",-1),this._markModified(),!this._shifted)return this._shifted=!0,[].shift.call(this)},shift:function(){const t=[].shift.call(this);return this._registerAtomic("$set",this),this._markModified(),t},pull:function(){const t=[].map.call(arguments,this._cast,this),e=this._parent.get(this._path);let n,i=e.length;for(;i--;)if((n=e[i])instanceof o){t.some(function(t){return n.equals(t)})&&[].splice.call(e,i,1)}else~e.indexOf.call(t,n)&&[].splice.call(e,i,1);return t[0]instanceof r?this._registerAtomic("$pullDocs",t.map(function(t){return t._id||t})):this._registerAtomic("$pullAll",t),this._markModified(),s(this._parent,this._path)>0&&this._registerAtomic("$set",this),this},splice:function(){let t;if(f(this,Array.prototype.slice.call(arguments,2)),arguments.length){const e=[];for(let t=0;t<arguments.length;++t)e[t]=t<2?arguments[t]:this._cast(arguments[t],arguments[0]+(t-2));t=[].splice.apply(this,e),this._registerAtomic("$set",this),this._markModified(),s(this._parent,this._path)}return t},unshift:function(){f(this,arguments);let t=[].map.call(arguments,this._cast,this);return t=this._schema.applySetters(t,this._parent),[].unshift.apply(this,t),this._registerAtomic("$set",this),this._markModified(),this.length},sort:function(){const t=[].sort.apply(this,arguments);return this._registerAtomic("$set",this),this._markModified(),t},addToSet:function(){f(this,arguments);let t=[].map.call(arguments,this._mapCast,this);t=this._schema.applySetters(t,this._parent);const e=[];let n="";return t[0]instanceof r?n="doc":t[0]instanceof Date&&(n="date"),t.forEach(function(t){let r;const o=+t;switch(n){case"doc":r=this.some(function(e){return e.equals(t)});break;case"date":r=this.some(function(t){return+t===o});break;default:r=~this.indexOf(t)}r||([].push.call(this,t),this._registerAtomic("$addToSet",t),this._markModified(),[].push.call(e,t))},this),e},set:function(t,e){const n=this._cast(e,t);return this[t]=n,this._markModified(t),this},toObject:function(t){return t&&t.depopulate?((t=a.clone(t))._isNested=!0,this.map(function(e){return e instanceof o?e.toObject(t):e})):this.slice()},inspect:function(){return JSON.stringify(this)},indexOf:function(t){t instanceof i&&(t=t.toString());for(let e=0,n=this.length;e<n;++e)if(t==this[e])return e;return-1}},p.mixin.remove=p.mixin.pull,t.exports=p},function(t,e,n){"use strict";const r=n(112).defineKey,o=n(5),i={toJSON:!0,toObject:!0,_id:!0,id:!0};
/*!
 * ignore
 */
t.exports=function(t,e,n,s){if(!n||!n.instanceOfSchema)throw new Error("You must pass a valid discriminator Schema");if(t.schema.discriminatorMapping&&!t.schema.discriminatorMapping.isRoot)throw new Error('Discriminator "'+e+'" can only be a discriminator of the root model');const u=t.schema.options.discriminatorKey,c={};if(c[u]={default:void 0,select:!0,$skipDiscriminatorCheck:!0},c[u][t.schema.options.typeKey]=String,t.schema.add(c),r(u,null,t.prototype,null,[u],t.schema.options),n.path(u)&&!0!==n.path(u).options.$skipDiscriminatorCheck)throw new Error('Discriminator "'+e+'" cannot have field with name "'+u+'"');let a=e;if("string"==typeof s&&s.length&&(a=s),function(e,n){if(e._originalSchema=e.clone(),n.paths._id&&n.paths._id.options&&!n.paths._id.options.auto){const t=e;o.merge(e,t),delete e.paths._id,delete e.tree._id}const r=Object.keys(n.paths),s=[];for(let t=0;t<r.length;++t)e.nested[r[t]]&&s.push(r[t]);o.merge(e,n,{omit:{discriminators:!0,$parentSchema:!0},omitNested:s.reduce((t,e)=>(t["tree."+e]=!0,t),{})});for(let t=0;t<s.length;++t)delete e.paths[s[t]];const c={};c[u]={default:a,select:!0,set:function(t){if(t===a)return a;throw new Error("Can't set discriminator key \""+u+'"')},$skipDiscriminatorCheck:!0},c[u][e.options.typeKey]=String,e.add(c),e.discriminatorMapping={key:u,value:a,isRoot:!1},n.options.collection&&(e.options.collection=n.options.collection);const l=e.options.toJSON,h=e.options.toObject,p=e.options._id,f=e.options.id,d=Object.keys(e.options);e.options.discriminatorKey=n.options.discriminatorKey;for(let t=0;t<d.length;++t){const r=d[t];if(!i[r]&&!o.deepEqual(e.options[r],n.options[r]))throw new Error("Can't customize discriminator option "+r+" (can only modify "+Object.keys(i).join(", ")+")")}e.options=o.clone(n.options),l&&(e.options.toJSON=l),h&&(e.options.toObject=h),void 0!==p&&(e.options._id=p),e.options.id=f,e.s.hooks=t.schema.s.hooks.merge(e.s.hooks),e.plugins=Array.prototype.slice(n.plugins),e.callQueue=n.callQueue.concat(e.callQueue),delete e._requiredpaths}(n,t.schema),t.discriminators||(t.discriminators={}),t.schema.discriminatorMapping||(t.schema.discriminatorMapping={key:u,value:null,isRoot:!0}),t.schema.discriminators||(t.schema.discriminators={}),n.$globalPluginsApplied=!1,t.schema.discriminators[e]=n,t.discriminators[e])throw new Error('Discriminator with name "'+e+'" already exists');return n}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(24),o=n(165),i=n(171),s=n(168),u=n(333),c=n(30).get().ReadPreference,a=n(190),l=n(118),h=n(335),p=n(192),f=n(338),d=n(8),m=n(339),g=n(31),y=n(340),_=n(106),v=n(341),w=n(193),b=n(82),O=n(342),S=n(0),A=n(5),C=n(370);function T(t,e,n,r){this._mongooseOptions||(this._mongooseOptions={}),e=e||{},this._transforms=[],this._hooks=new i,this._executionCount=0;const o=Object.keys(e);for(let t=0;t<o.length;++t){const n=o[t];this._mongooseOptions[n]=e[n]}r&&(this.mongooseCollection=r),n&&(this.model=n,this.schema=n.schema),this.model&&this.model._mapreduce&&this.lean(),_.call(this,this.mongooseCollection,e),t&&this.find(t),this.options=this.options||{},this.$useProjection=!0;const s=d(this,"schema.options.collation",null);null!=s&&(this.options.collation=s)}
/*!
 * inherit mquery
 */T.prototype=new _,T.prototype.constructor=T,T.base=_.prototype,T.use$geoWithin=_.use$geoWithin,T.prototype.toConstructor=function(){const t=this.model,e=this.mongooseCollection,n=function(o,i){if(!(this instanceof n))return new n(o,i);this._mongooseOptions=A.clone(r._mongooseOptions),T.call(this,o,i||null,t,e)};S.inherits(n,t.Query);const r=n.prototype;return r.options={},r.setOptions(this.options),r.op=this.op,r._conditions=A.clone(this._conditions),r._fields=A.clone(this._fields),r._update=A.clone(this._update,{flattenDecimals:!1}),r._path=this._path,r._distinct=this._distinct,r._collection=this._collection,r._mongooseOptions=this._mongooseOptions,n},T.prototype.slice=function(){if(0===arguments.length)return this;let t,e;if(this._validate("slice"),1===arguments.length){const n=arguments[0];if("object"==typeof n&&!Array.isArray(n)){const t=Object.keys(n),e=t.length;for(let r=0;r<e;++r)this.slice(t[r],n[t[r]]);return this}this._ensurePath("slice"),t=this._path,e=arguments[0]}else 2===arguments.length?"number"==typeof arguments[0]?(this._ensurePath("slice"),t=this._path,e=b(arguments)):(t=arguments[0],e=arguments[1]):3===arguments.length&&(t=arguments[0],e=b(arguments,1));const n={};return n[t]={$slice:e},this.select(n),this},T.prototype.mod=function(){let t,e;return 1===arguments.length?(this._ensurePath("mod"),t=arguments[0],e=this._path):2!==arguments.length||Array.isArray(arguments[1])?3===arguments.length?(t=b(arguments,1),e=arguments[0]):(t=arguments[1],e=arguments[0]):(this._ensurePath("mod"),t=b(arguments),e=this._path),(this._conditions[e]||(this._conditions[e]={})).$mod=t,this},T.prototype.select=function(){let t,e,n=arguments[0];if(!n)return this;if(1!==arguments.length)throw new Error("Invalid select: select only takes 1 argument");this._validate("select");const r=this._fields||(this._fields={}),o=this._userProvidedFields||(this._userProvidedFields={}),i=typeof n;if(("string"==i||"[object Arguments]"===Object.prototype.toString.call(n))&&"number"==typeof n.length||Array.isArray(n)){for("string"==i&&(n=n.split(/\s+/)),t=0,e=n.length;t<e;++t){let e=n[t];if(!e)continue;const i="-"==e[0]?0:1;0===i&&(e=e.substring(1)),r[e]=i,o[e]=i}return this}if(A.isObject(n)){const e=Object.keys(n);for(t=0;t<e.length;++t)r[e[t]]=n[e[t]],o[e[t]]=n[e[t]];return this}throw new TypeError("Invalid select() argument. Must be string or object.")},T.prototype.read=function(t,e){const n=new c(t,e);return this.options.readPreference=n,this},T.prototype.session=function(t){return null==t&&delete this.options.session,this.options.session=t,this},T.prototype.w=function(t){return null==t&&delete this.options.w,this.options.w=t,this},T.prototype.j=function(t){return null==t&&delete this.options.j,this.options.j=t,this},T.prototype.wtimeout=function(t){return null==t&&delete this.options.wtimeout,this.options.wtimeout=t,this},T.prototype.getOptions=function(){return this.options},T.prototype.setOptions=function(t,e){if(e)return this._mongooseOptions=t&&A.clone(t)||{},this.options=t||{},"populate"in t&&this.populate(this._mongooseOptions),this;if(null==t)return this;if("object"!=typeof t)throw new Error('Options must be an object, got "'+t+'"');if(Array.isArray(t.populate)){const e=t.populate;delete t.populate;const n=e.length;for(let t=0;t<n;++t)this.populate(e[t])}return"useFindAndModify"in t&&(this._mongooseOptions.useFindAndModify=t.useFindAndModify,delete t.useFindAndModify),"omitUndefined"in t&&(this._mongooseOptions.omitUndefined=t.omitUndefined,delete t.omitUndefined),T.base.setOptions.call(this,t)},T.prototype.explain=function(t){return 0===arguments.length?(this.options.explain=!0,this):(this.options.explain=t,this)},T.prototype.maxTimeMS=function(t){return this.options.maxTimeMS=t,this},T.prototype.getQuery=function(){return this._conditions},T.prototype.setQuery=function(t){this._conditions=t},T.prototype.getUpdate=function(){return this._update},T.prototype.setUpdate=function(t){this._update=t},T.prototype._fieldsForExec=function(){return A.clone(this._fields)},T.prototype._updateForExec=function(){const t=A.clone(this._update,{transform:!1,depopulate:!0}),e=Object.keys(t);let n=e.length;const r={};for(;n--;){const o=e[n];this.options.overwrite?r[o]=t[o]:"$"!==o[0]?(r.$set||(t.$set?r.$set=t.$set:r.$set={}),r.$set[o]=t[o],e.splice(n,1),~e.indexOf("$set")||e.push("$set")):"$set"===o&&r.$set||(r[o]=t[o])}return r},T.prototype._optionsForExec=function(t){const e=A.clone(this.options);if(delete e.populate,!(t=t||this.model))return e;const n=d(t,"schema.options.safe",null);"safe"in e||null==n||E(e,n),a(t.schema,e);const r=d(t,"schema.options.read");return"readPreference"in e||!r||(e.readPreference=r),void 0!==e.upsert&&(e.upsert=!!e.upsert),e};
/*!
 * ignore
 */
const E=S.deprecate(function(t,e){t.safe=e},"Mongoose: the `safe` option is deprecated. Use write concerns instead: http://bit.ly/mongoose-w");
/*!
 * ignore
 */
function N(t){try{h(t)}catch(e){t.error(e)}}
/*!
 * hydrates a document
 *
 * @param {Model} model
 * @param {Document} doc
 * @param {Object} res 3rd parameter to callback
 * @param {Object} fields
 * @param {Query} self
 * @param {Array} [pop] array of paths used in population
 * @param {Function} callback
 */
function $(t,e,n,r,o,i,s,u){const c=s?{populated:s}:void 0,a=g.createModel(t,e,o,i);try{a.init(e,c,l)}catch(t){l(t)}function l(t){return t?process.nextTick(()=>u(t)):(a.$session(r.session),r.rawResult?(n.value=a,process.nextTick(()=>u(null,n))):void process.nextTick(()=>u(null,a)))}}
/*!
 * If the model is a discriminator type and not root, then add the key & value to the criteria.
 */function I(t){if(!t||!t.model||!t.model.schema)return;const e=t.model.schema;e&&e.discriminatorMapping&&!e.discriminatorMapping.isRoot&&(t._conditions[e.discriminatorMapping.key]=e.discriminatorMapping.value)}
/*!
 * Get options from query opts, falling back to the base mongoose object.
 */
function M(t,e,n){const r=t._optionsForExec(t.model);return e in r?r[e]:e in t.model.base.options?t.model.base.options[e]:n}
/*!
 * Override mquery.prototype._findAndModify to provide casting etc.
 *
 * @param {String} type - either "remove" or "update"
 * @param {Function} callback
 * @api private
 */
/*!
 * ignore
 */
function R(t,e,n,r){return n.rawResult?r(null,e):r(null,t)}
/*!
 * Override mquery.prototype._mergeUpdate to handle mongoose objects in
 * updates.
 *
 * @param {Object} doc
 * @api private
 */
/*!
 * ignore
 */
function P(t,e){const n=this.model.schema;let r;const o=this;if(this._castConditions(),N(this),null!=this.error())return e(this.error()),null;e=B(this,e);const i=this._conditions;let s;const u=this._optionsForExec(this.model);++this._executionCount,this._update=A.clone(this._update,u);const c=this.options.overwrite&&!m(this._update);if(c)s=new this.model(this._update,null,!0);else{if((s=L(this,u.overwrite))instanceof Error)return e(s),null;if(null==s||0===Object.keys(s).length)return e(null,0),null;s=w(this._conditions,this.model.schema,s,u)}if(M(this,"runValidators",!1)){r=c?function(t){s.validate(t)}:O(this,n,s,u);const a=function(n){if(n)return e(n);s.toBSON&&(s=s.toBSON()),o._collection[t](i,s,u,e)};try{r(a)}catch(t){process.nextTick(function(){e(t)})}return null}return s.toBSON&&(s=s.toBSON()),this._collection[t](i,s,u,e),null}
/*!
 * Internal thunk for .update()
 *
 * @param {Function} callback
 * @see Model.update #model_Model.update
 * @api private
 */
/*!
 * Internal helper for update, updateMany, updateOne, replaceOne
 */
function j(t,e,n,r,o,i){t.op=e,n=A.toObject(n),r=r||{};const u=i;if(u){if("function"!=typeof u)throw new Error("Invalid callback() argument.");i=function(t,e){u(t,e?e.result:{ok:0,n:0,nModified:0})}}return o&&"strict"in o&&(t._mongooseOptions.strict=o.strict),n instanceof T||null==n||"[object Object]"===n.toString()?t.merge(n):t.error(new s(n,"filter",e)),A.isObject(o)&&t.setOptions(o),t._mergeUpdate(r),i?"update"===e?(t._execUpdate(i),t):(t["_"+e](i),t):T.base[e].call(t,n,r,o,i)}
/*!
 * Get the error to throw for `orFail()`
 */
function D(t,e){return"function"==typeof t&&(t=t.call(e)),null==t&&(t=new o(e.getQuery())),t}
/*!
 * ignore
 */
function B(t,e){return function(n,r){if(null!=n)return e(n);for(const o of t._transforms)try{r=o(r)}catch(n){return e(n)}return e(null,r)}}
/*!
 * castDoc
 * @api private
 */
function L(t,e){try{return t._castUpdate(t._update,e)}catch(t){return t}}T.prototype.lean=function(t){return this._mongooseOptions.lean=!arguments.length||t,this},T.prototype.set=function(t,e){if("object"==typeof t){const e=Object.keys(t);for(const n of e)this.set(n,t[n]);return this}return this._update=this._update||{},this._update.$set=this._update.$set||{},this._update.$set[t]=e,this},T.prototype.error=function(t){return 0===arguments.length?this._error:(this._error=t,this)},
/*!
 * ignore
 */
T.prototype._unsetCastError=function(){if(null==this._error||this._error instanceof r)return this.error(null)},T.prototype.mongooseOptions=function(t){return arguments.length>0&&(this._mongooseOptions=t),this._mongooseOptions},
/*!
 * ignore
 */
T.prototype._castConditions=function(){try{this.cast(this.model),this._unsetCastError()}catch(t){this.error(t)}},T.prototype._find=C(function(t){if(this._castConditions(),null!=this.error())return t(this.error()),null;t=B(this,t),this._applyPaths(),this._fields=this._castFields(this._fields);const e=this._fieldsForExec(),n=this._mongooseOptions,r=this,o=r._userProvidedFields||{},i=Object.assign({},{session:d(this,"options.session",null)}),s=this._optionsForExec();s.projection=this._fieldsForExec();const u=this._conditions;return this._collection.find(u,s,(s,u)=>{if(s)return t(s);if(0===u.length)return t(null,u);if(this.options.explain)return t(null,u);if(!n.populate)return n.lean?t(null,u):f(r.model,u,e,o,i,t);const c=g.preparePopulationOptionsMQ(r,n);i.populated=c,r.model.populate(u,c,function(s,u){return s?t(s):n.lean?t(null,u):f(r.model,u,e,o,i,t)})}),null}),T.prototype.find=function(t,e){return"function"==typeof t&&(e=t,t={}),t=A.toObject(t),_.canMerge(t)?(this.merge(t),I(this)):null!=t&&this.error(new s(t,"filter","find")),e?(this._find(e),this):T.base.find.call(this)},T.prototype.merge=function(t){if(!t)return this;const e={overwrite:!0};return t instanceof T?(t._conditions&&A.merge(this._conditions,t._conditions,e),t._fields&&(this._fields||(this._fields={}),A.merge(this._fields,t._fields,e)),t.options&&(this.options||(this.options={}),A.merge(this.options,t.options,e)),t._update&&(this._update||(this._update={}),A.mergeClone(this._update,t._update)),t._distinct&&(this._distinct=t._distinct),this):(A.merge(this._conditions,t,e),this)},T.prototype.collation=function(t){return null==this.options&&(this.options={}),this.options.collation=t,this},T.prototype._completeOne=function(t,e,n){if(!t)return n(null,null);const r=this.model,o=A.clone(this._fields),i=this._userProvidedFields||{},s=this._mongooseOptions,u=this.options;if(u.explain)return n(null,t);if(!s.populate)return s.lean?R(t,e,u,n):$(r,t,e,u,o,i,null,n);const c=g.preparePopulationOptionsMQ(this,this._mongooseOptions);r.populate(t,c,(t,a)=>t?n(t):s.lean?R(a,e,u,n):$(r,a,e,u,o,i,c,n))},T.prototype._findOne=C(function(t){if(this._castConditions(),this.error())return t(this.error()),null;this._applyPaths(),this._fields=this._castFields(this._fields),T.base.findOne.call(this,{},(e,n)=>{if(e)return t(e),null;this._completeOne(n,null,B(this,t))})}),T.prototype.findOne=function(t,e,n,r){return"function"==typeof t?(r=t,t=null,e=null,n=null):"function"==typeof e?(r=e,n=null,e=null):"function"==typeof n&&(r=n,n=null),t=A.toObject(t),this.op="findOne",n&&this.setOptions(n),e&&this.select(e),_.canMerge(t)?(this.merge(t),I(this)):null!=t&&this.error(new s(t,"filter","findOne")),r?(this._findOne(r),this):T.base.findOne.call(this)},T.prototype._count=C(function(t){try{this.cast(this.model)}catch(t){this.error(t)}if(this.error())return t(this.error());const e=this._conditions,n=this._optionsForExec();this._collection.count(e,n,A.tick(t))}),T.prototype._countDocuments=C(function(t){try{this.cast(this.model)}catch(t){this.error(t)}if(this.error())return t(this.error());const e=this._conditions,n=this._optionsForExec();this._collection.collection.countDocuments(e,n,A.tick(t))}),T.prototype._estimatedDocumentCount=C(function(t){if(this.error())return t(this.error());const e=this._optionsForExec();this._collection.collection.estimatedDocumentCount(e,A.tick(t))}),T.prototype.count=function(t,e){return"function"==typeof t&&(e=t,t=void 0),t=A.toObject(t),_.canMerge(t)&&this.merge(t),this.op="count",e?(this._count(e),this):this},T.prototype.estimatedDocumentCount=function(t,e){return"function"==typeof t&&(e=t,t=void 0),"object"==typeof t&&null!=t&&this.setOptions(t),this.op="estimatedDocumentCount",e?(this._estimatedDocumentCount(e),this):this},T.prototype.countDocuments=function(t,e){return"function"==typeof t&&(e=t,t=void 0),t=A.toObject(t),_.canMerge(t)&&this.merge(t),this.op="countDocuments",e?(this._countDocuments(e),this):this},T.prototype.distinct=function(t,e,n){return n||("function"==typeof e?(n=e,e=void 0):"function"==typeof t&&(n=t,t=void 0,e=void 0)),e=A.toObject(e),_.canMerge(e)?(this.merge(e),I(this)):null!=e&&this.error(new s(e,"filter","distinct")),null!=n&&(this._castConditions(),null!=this.error())?(n(this.error()),this):T.base.distinct.call(this,{},t,n)},T.prototype.sort=function(t){if(arguments.length>1)throw new Error("sort() only takes 1 Argument");return T.base.sort.call(this,t)},T.prototype.remove=function(t,e){return"function"==typeof t&&(e=t,t=null),t=A.toObject(t),_.canMerge(t)?(this.merge(t),I(this)):null!=t&&this.error(new s(t,"filter","remove")),e?(this._remove(e),this):T.base.remove.call(this)},
/*!
 * ignore
 */
T.prototype._remove=C(function(t){return this._castConditions(),null!=this.error()?(t(this.error()),this):(t=B(this,t),T.base.remove.call(this,g.handleDeleteWriteOpResult(t)))}),T.prototype.deleteOne=function(t,e){return"function"==typeof t&&(e=t,t=null),t=A.toObject(t),_.canMerge(t)?(this.merge(t),I(this)):null!=t&&this.error(new s(t,"filter","deleteOne")),e?(this._deleteOne.call(this,e),this):T.base.deleteOne.call(this)},
/*!
 * Internal thunk for `deleteOne()`
 */
T.prototype._deleteOne=C(function(t){return this._castConditions(),null!=this.error()?(t(this.error()),this):(t=B(this,t),T.base.deleteOne.call(this,g.handleDeleteWriteOpResult(t)))}),T.prototype.deleteMany=function(t,e){return"function"==typeof t&&(e=t,t=null),t=A.toObject(t),_.canMerge(t)?(this.merge(t),I(this)):null!=t&&this.error(new s(t,"filter","deleteMany")),e?(this._deleteMany.call(this,e),this):T.base.deleteMany.call(this)},
/*!
 * Internal thunk around `deleteMany()`
 */
T.prototype._deleteMany=C(function(t){return this._castConditions(),null!=this.error()?(t(this.error()),this):(t=B(this,t),T.base.deleteMany.call(this,g.handleDeleteWriteOpResult(t)))}),T.prototype.findOneAndUpdate=function(t,e,n,r){switch(this.op="findOneAndUpdate",this._validate(),arguments.length){case 3:"function"==typeof n&&(r=n,n={});break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0),n=void 0;break;case 1:"function"==typeof t?(r=t,t=n=e=void 0):(e=t,t=n=void 0)}return _.canMerge(t)&&this.merge(t),e&&this._mergeUpdate(e),n&&((n=A.clone(n)).projection&&(this.select(n.projection),delete n.projection),n.fields&&(this.select(n.fields),delete n.fields),this.setOptions(n)),r?(this._findOneAndUpdate(r),this):this},
/*!
 * Thunk around findOneAndUpdate()
 *
 * @param {Function} [callback]
 * @api private
 */
T.prototype._findOneAndUpdate=C(function(t){if(null!=this.error())return t(this.error());this._findAndModify("update",t)}),T.prototype.findOneAndRemove=function(t,e,n){switch(this.op="findOneAndRemove",this._validate(),arguments.length){case 2:"function"==typeof e&&(n=e,e={});break;case 1:"function"==typeof t&&(n=t,t=void 0,e=void 0)}return _.canMerge(t)&&this.merge(t),e&&this.setOptions(e),n?(this._findOneAndRemove(n),this):this},T.prototype.findOneAndDelete=function(t,e,n){switch(this.op="findOneAndDelete",this._validate(),arguments.length){case 2:"function"==typeof e&&(n=e,e={});break;case 1:"function"==typeof t&&(n=t,t=void 0,e=void 0)}return _.canMerge(t)&&this.merge(t),e&&this.setOptions(e),n?(this._findOneAndDelete(n),this):this},
/*!
 * Thunk around findOneAndDelete()
 *
 * @param {Function} [callback]
 * @return {Query} this
 * @api private
 */
T.prototype._findOneAndDelete=C(function(t){if(this._castConditions(),null!=this.error())return t(this.error()),null;const e=this._conditions,n=this._optionsForExec();let r=null;if(null!=this._fields&&(n.projection=this._castFields(A.clone(this._fields)),(r=n.projection)instanceof Error))return t(r),null;this._collection.collection.findOneAndDelete(e,n,B(this,(e,n)=>{if(e)return t(e);const r=n.value;return this._completeOne(r,n,t)}))}),T.prototype.findOneAndReplace=function(t,e,n){switch(this.op="findOneAndReplace",this._validate(),arguments.length){case 2:"function"==typeof e&&(n=e,e={});break;case 1:"function"==typeof t&&(n=t,t=void 0,e=void 0)}return _.canMerge(t)&&this.merge(t),e&&this.setOptions(e),n?(this._findOneAndReplace(n),this):this},
/*!
 * Thunk around findOneAndReplace()
 *
 * @param {Function} [callback]
 * @return {Query} this
 * @api private
 */
T.prototype._findOneAndReplace=C(function(t){if(this._castConditions(),null!=this.error())return t(this.error()),null;const e=this._conditions,n=this._optionsForExec();let r=null;if(null!=this._fields&&(n.projection=this._castFields(A.clone(this._fields)),(r=n.projection)instanceof Error))return t(r),null;this._collection.collection.findOneAndReplace(e,n,(e,n)=>{if(e)return t(e);const r=n.value;return this._completeOne(r,n,t)})}),
/*!
 * Thunk around findOneAndRemove()
 *
 * @param {Function} [callback]
 * @return {Query} this
 * @api private
 */
T.prototype._findOneAndRemove=C(function(t){null==this.error()?this._findAndModify("remove",t):t(this.error())}),T.prototype._findAndModify=function(t,e){if("function"!=typeof e)throw new Error("Expected callback in _findAndModify");const n=this.model,r=n.schema,o=this;let i,s,u=this._update;const c=
/*!
 * castQuery
 * @api private
 */
function(t){try{return t.cast(t.model)}catch(t){return t}}(this);if(c instanceof Error)return e(c);N(this);const a=this._optionsForExec(n);"strict"in a&&(this._mongooseOptions.strict=a.strict);const l=this.options.overwrite&&!m(u);if(l&&(u=new this.model(u,null,!0)),"remove"===t)a.remove=!0;else if("new"in a||(a.new=!1),"upsert"in a||(a.upsert=!1),(a.upsert||a.new)&&(a.remove=!1),l)s=function(t){u.validate(t)};else{if(u=L(this,a.overwrite),u=w(this._conditions,r,u,a)){if(u instanceof Error)return e(u);u.$set&&0===Object.keys(u.$set).length&&delete u.$set}else{if(!a.upsert)return this.findOne(e),this;{const t=A.clone(c);delete t._id,u={$set:t}}}s=O(this,r,u,a)}this._applyPaths();const h=this._mongooseOptions;if(this._fields&&(i=A.clone(this._fields),a.projection=this._castFields(i),a.projection instanceof Error))return e(a.projection);a.sort&&
/*!
 * The mongodb driver 1.3.23 only supports the nested array sort
 * syntax. We must convert it or sorting findAndModify will not work.
 */
function(t){if(Array.isArray(t.sort))return;if(!A.isObject(t.sort))return;const e=[];for(const n in t.sort)A.object.hasOwnProperty(t.sort,n)&&e.push([n,t.sort[n]]);t.sort=e}(a);const p=function(t,n,r){if(t)return e(t);o._completeOne(n,r,e)};let f,g=!0;const y=M(this,"runValidators",!1),_=o.model&&o.model.base,v=d(n,"collection.conn",{});if("useFindAndModify"in _.options&&(g=_.get("useFindAndModify")),"useFindAndModify"in v.config&&(g=v.config.useFindAndModify),"useFindAndModify"in h&&(g=h.useFindAndModify),!1===g){const n=o._collection.collection;if("new"in a&&(a.returnOriginal=!a.new,delete a.new),"remove"===t)return n.findOneAndDelete(c,a,B(o,function(t,e){return p(t,e?e.value:e,e)})),this;const r=l?"findOneAndReplace":"findOneAndUpdate";if(y&&s){f=function(t){if(t)return e(t);u&&u.toBSON&&(u=u.toBSON()),n[r](c,u,a,B(o,function(t,e){return p(t,e?e.value:e,e)}))};try{s(f)}catch(t){e(t)}}else u&&u.toBSON&&(u=u.toBSON()),n[r](c,u,a,B(o,function(t,e){return p(t,e?e.value:e,e)}));return this}if(y&&s){f=function(t){if(t)return e(t);u&&u.toBSON&&(u=u.toBSON()),o._collection.findAndModify(c,u,a,B(o,function(t,e){return p(t,e?e.value:e,e)}))};try{s(f)}catch(t){e(t)}}else u&&u.toBSON&&(u=u.toBSON()),this._collection.findAndModify(c,u,a,B(o,function(t,e){return p(t,e?e.value:e,e)}));return this},T.prototype._mergeUpdate=function(t){this._update||(this._update={}),t instanceof T?t._update&&A.mergeClone(this._update,t._update):A.mergeClone(this._update,t)},T.prototype._execUpdate=C(function(t){return P.call(this,"update",t)}),
/*!
 * Internal thunk for .updateMany()
 *
 * @param {Function} callback
 * @see Model.update #model_Model.update
 * @api private
 */
T.prototype._updateMany=C(function(t){return P.call(this,"updateMany",t)}),
/*!
 * Internal thunk for .updateOne()
 *
 * @param {Function} callback
 * @see Model.update #model_Model.update
 * @api private
 */
T.prototype._updateOne=C(function(t){return P.call(this,"updateOne",t)}),
/*!
 * Internal thunk for .replaceOne()
 *
 * @param {Function} callback
 * @see Model.replaceOne #model_Model.replaceOne
 * @api private
 */
T.prototype._replaceOne=C(function(t){return P.call(this,"replaceOne",t)}),T.prototype.update=function(t,e,n,r){return"function"==typeof n?(r=n,n=null):"function"==typeof e?(r=e,e=t,t={},n=null):"function"==typeof t?(r=t,t=void 0,e=void 0,n=void 0):"object"!=typeof t||e||n||r||(e=t,t=void 0,n=void 0,r=void 0),j(this,"update",t,e,n,r)},T.prototype.updateMany=function(t,e,n,r){return"function"==typeof n?(r=n,n=null):"function"==typeof e?(r=e,e=t,t={},n=null):"function"==typeof t?(r=t,t=void 0,e=void 0,n=void 0):"object"!=typeof t||e||n||r||(e=t,t=void 0,n=void 0,r=void 0),j(this,"updateMany",t,e,n,r)},T.prototype.updateOne=function(t,e,n,r){return"function"==typeof n?(r=n,n=null):"function"==typeof e?(r=e,e=t,t={},n=null):"function"==typeof t?(r=t,t=void 0,e=void 0,n=void 0):"object"!=typeof t||e||n||r||(e=t,t=void 0,n=void 0,r=void 0),j(this,"updateOne",t,e,n,r)},T.prototype.replaceOne=function(t,e,n,r){return"function"==typeof n?(r=n,n=null):"function"==typeof e?(r=e,e=t,t={},n=null):"function"==typeof t?(r=t,t=void 0,e=void 0,n=void 0):"object"!=typeof t||e||n||r||(e=t,t=void 0,n=void 0,r=void 0),this.setOptions({overwrite:!0}),j(this,"replaceOne",t,e,n,r)},T.prototype.map=function(t){return this._transforms.push(t),this},T.prototype.orFail=function(t){return this.map(e=>{switch(this.op){case"find":if(0===e.length)throw D(t,this);break;case"findOne":if(null==e)throw D(t,this);break;case"update":case"updateMany":case"updateOne":if(0===d(e,"result.nModified"))throw D(t,this);break;case"findOneAndDelete":if(0===d(e,"lastErrorObject.n"))throw D(t,this);break;case"findOneAndUpdate":if(!1===d(e,"lastErrorObject.updatedExisting"))throw D(t,this);break;case"deleteMany":case"deleteOne":case"remove":if(0===e.n)throw D(t,this)}return e}),this},T.prototype.exec=function(t,e){const n=this;return"function"==typeof t?(e=t,t=null):"string"==typeof t&&(this.op=t),null!=e&&(e=this.model.$wrapCallback(e)),A.promiseOrCallback(e,t=>{n.op?this._hooks.execPre("exec",this,[],e=>{if(e)return t(e);this[this.op].call(this,(e,n)=>{if(e)return t(e);this._hooks.execPost("exec",this,[],{},e=>{if(e)return t(e);t(null,n)})})}):t()},this.model.events)},T.prototype.then=function(t,e){return this.exec().then(t,e)},T.prototype.catch=function(t){return this.exec().then(null,t)},
/*!
 * ignore
 */
T.prototype._pre=function(t){return this._hooks.pre("exec",t),this},
/*!
 * ignore
 */
T.prototype._post=function(t){return this._hooks.post("exec",t),this},
/*!
 * Casts obj for an update command.
 *
 * @param {Object} obj
 * @return {Object} obj after casting its values
 * @api private
 */
T.prototype._castUpdate=function(t,e){let n;n="strict"in this._mongooseOptions?this._mongooseOptions.strict:!this.schema||!this.schema.options||this.schema.options.strict;let r,o=!1;return"omitUndefined"in this._mongooseOptions&&(o=this._mongooseOptions.omitUndefined),"useNestedStrict"in this.options&&(r=this.options.useNestedStrict),p(this.schema,t,{overwrite:e,strict:n,omitUndefined:o,useNestedStrict:r},this,this._conditions)},T.prototype.populate=function(){if(0===arguments.length)return this;const t=A.populate.apply(null,arguments);if(null!=this.options){const e=this.options.readConcern,n=this.options.readPreference;for(let r=0;r<t.length;++r)null!=e&&null==d(t[r],"options.readConcern")&&(t[r].options=t[r].options||{},t[r].options.readConcern=e),null!=n&&null==d(t[r],"options.readPreference")&&(t[r].options=t[r].options||{},t[r].options.readPreference=n)}const e=this._mongooseOptions;if(null!=e.lean){const n=e.lean;for(let e=0;e<t.length;++e)null==d(t[e],"options.lean")&&(t[e].options=t[e].options||{},t[e].options.lean=n)}A.isObject(e.populate)||(e.populate={});const n=e.populate;for(let e=0;e<t.length;++e){const r=t[e].path;n[r]&&n[r].populate&&t[e].populate&&(t[e].populate=n[r].populate.concat(t[e].populate)),n[t[e].path]=t[e]}return this},T.prototype.getPopulatedPaths=function(){const t=this._mongooseOptions.populate||{};return Object.keys(t)},T.prototype.cast=function(t,e){e||(e=this._conditions),t=t||this.model;try{return l(t.schema,e,{upsert:this.options&&this.options.upsert,strict:this.options&&"strict"in this.options?this.options.strict:d(t,"schema.options.strict",null),strictQuery:this.options&&this.options.strictQuery||d(t,"schema.options.strictQuery",null)},this)}catch(e){throw"function"==typeof e.setModel&&e.setModel(t),e}},T.prototype._castFields=function(t){let e,n,r,o,i,s;if(t)for(n=[],s=(r=Object.keys(t)).length;s--;)t[o=r[s]].$elemMatch&&(e||(e={}),e[o]=t[o],n.push(o));if(e){try{i=this.cast(this.model,e)}catch(t){return t}for(s=n.length;s--;)t[o=n[s]]=i[o]}return t},T.prototype._applyPaths=function(){this._fields=this._fields||{},g.applyPaths(this._fields,this.model.schema);let t=!0;"selectPopulatedPaths"in this.model.base.options&&(t=this.model.base.options.selectPopulatedPaths),"selectPopulatedPaths"in this.model.schema.options&&(t=this.model.schema.options.selectPopulatedPaths),t&&v(this)},T.prototype.cursor=function(t){this._applyPaths(),this._fields=this._castFields(this._fields),this.setOptions({projection:this._fieldsForExec()}),t&&this.setOptions(t);try{this.cast(this.model)}catch(t){return new u(this,this.options)._markError(t)}return new u(this,this.options)},T.prototype.maxscan=T.base.maxScan,T.prototype.tailable=function(t,e){if(t&&"Object"===t.constructor.name&&(e=t,t=!0),void 0===t&&(t=!0),e&&"object"==typeof e)for(const t in e)this.options[t]="awaitdata"===t?!!e[t]:e[t];return T.base.tailable.call(this,t)},
/*!
 * Overwriting mquery is needed to support a couple different near() forms found in older
 * versions of mongoose
 * near([1,1])
 * near(1,1)
 * near(field, [1,2])
 * near(field, 1, 2)
 * In addition to all of the normal forms supported by mquery
 */
T.prototype.near=function(){const t=[],e=this._mongooseOptions.nearSphere;if(1===arguments.length)if(Array.isArray(arguments[0]))t.push({center:arguments[0],spherical:e});else if("string"==typeof arguments[0])t.push(arguments[0]);else{if(!A.isObject(arguments[0]))throw new TypeError("invalid argument");"boolean"!=typeof arguments[0].spherical&&(arguments[0].spherical=e),t.push(arguments[0])}else if(2===arguments.length)if("number"==typeof arguments[0]&&"number"==typeof arguments[1])t.push({center:[arguments[0],arguments[1]],spherical:e});else if("string"==typeof arguments[0]&&Array.isArray(arguments[1]))t.push(arguments[0]),t.push({center:arguments[1],spherical:e});else{if("string"!=typeof arguments[0]||!A.isObject(arguments[1]))throw new TypeError("invalid argument");t.push(arguments[0]),"boolean"!=typeof arguments[1].spherical&&(arguments[1].spherical=e),t.push(arguments[1])}else{if(3!==arguments.length)throw new TypeError("invalid argument");if("string"!=typeof arguments[0]||"number"!=typeof arguments[1]||"number"!=typeof arguments[2])throw new TypeError("invalid argument");t.push(arguments[0]),t.push({center:[arguments[1],arguments[2]],spherical:e})}return T.base.near.apply(this,t)},T.prototype.nearSphere=function(){return this._mongooseOptions.nearSphere=!0,this.near.apply(this,arguments),this},null!=Symbol.asyncIterator&&(T.prototype[Symbol.asyncIterator]=function(){return this.cursor().transformNull().map(t=>null==t?{done:!0}:{value:t,done:!1})})
/*!
 * this is needed to support the mongoose syntax of:
 * box(field, { ll : [x,y], ur : [x2,y2] })
 * box({ ll : [x,y], ur : [x2,y2] })
 */,T.prototype.box=function(t,e){return!Array.isArray(t)&&A.isObject(t)&&(e=t.ur,t=t.ll),T.base.box.call(this,t,e)},T.prototype.center=T.base.circle,T.prototype.centerSphere=function(){arguments[0]&&"Object"===arguments[0].constructor.name&&(arguments[0].spherical=!0),arguments[1]&&"Object"===arguments[1].constructor.name&&(arguments[1].spherical=!0),T.base.circle.apply(this,arguments)},T.prototype.selectedInclusively=function(){return y(this._fields)},T.prototype.selectedExclusively=function(){if(!this._fields)return!1;const t=Object.keys(this._fields);if(0===t.length)return!1;for(let e=0;e<t.length;++e){const n=t[e];if("_id"!==n&&(0===this._fields[n]||!1===this._fields[n]))return!0}return!1},
/*!
 * Export
 */
t.exports=T},function(t,e,n){var r=n(196),o=n(344),i=n(345),s="[object Null]",u="[object Undefined]",c=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?u:s:c&&c in Object(t)?o(t):i(t)}},function(t,e){t.exports=function(){}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){e|=0;for(var n=Math.max(t.length-e,0),r=Array(n),o=0;o<n;o++)r[o]=t[e+o];return r},t.exports=e.default},,,,,,,,,function(t,e){t.exports=require("tls")},,,,,,,,function(t,e,n){"use strict";t.exports=n(227)},function(t,e,n){var r=n(231),o=n(52),i=n(70),s=n(73),u=n(71),c=n(65),a=n(95),l=n(42),h=n(94),p=n(72),f=n(51),d=n(67),m=n(68),g=n(69),y=n(66);r.BSON_INT32_MAX=2147483647,r.BSON_INT32_MIN=-2147483648,r.BSON_INT64_MAX=Math.pow(2,63)-1,r.BSON_INT64_MIN=-Math.pow(2,63),r.JS_INT_MAX=9007199254740992,r.JS_INT_MIN=-9007199254740992,r.Binary=o,r.Code=i,r.DBRef=s,r.Decimal128=u,r.Double=c,r.Int32=a,r.Long=l,r.Map=h,r.MaxKey=p,r.MinKey=f,r.ObjectId=d,r.ObjectID=d,r.BSONRegExp=m,r.Symbol=g,r.Timestamp=y,t.exports=r},function(t,e,n){"use strict";t.exports={normalizedFunctionString:function(t){return t.toString().replace(/function *\(/,"function (")}}},function(t,e,n){"use strict";var r=n(0).inherits,o=n(10).EventEmitter,i=n(92),s=n(134),u=n(11),c=n(0).format,a=n(20).debugOptions,l=n(32).parseHeader,h=n(74).decompress,p=n(18).Response,f=n(4).MongoNetworkError,d=n(34),m=n(32).opcodes.OP_COMPRESSED,g=n(32).MESSAGE_HEADER_SIZE,y=n(14).Buffer,_=0,v=["host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","socketTimeout","singleBufferSerializtion","ssl","ca","crl","cert","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","checkServerIdentity"],w=void 0,b=!1,O={},S=function(t,e){if(o.call(this),this.options=e||{},this.id=_++,this.logger=d("Connection",e),!e.bson)throw new Error("must pass in valid bson parser");this.bson=e.bson,this.tag=e.tag,this.messageHandler=t,this.maxBsonMessageSize=e.maxBsonMessageSize||67108864,this.logger.isDebug()&&this.logger.debug(c("creating connection %s with options [%s]",this.id,JSON.stringify(a(v,e)))),this.port=e.port||27017,this.host=e.host||"localhost",this.family="number"==typeof e.family?e.family:void 0,this.keepAlive="boolean"!=typeof e.keepAlive||e.keepAlive,this.keepAliveInitialDelay="number"==typeof e.keepAliveInitialDelay?e.keepAliveInitialDelay:3e5,this.noDelay="boolean"!=typeof e.noDelay||e.noDelay,this.connectionTimeout="number"==typeof e.connectionTimeout?e.connectionTimeout:3e4,this.socketTimeout="number"==typeof e.socketTimeout?e.socketTimeout:36e4,this.keepAliveInitialDelay>this.socketTimeout&&(this.keepAliveInitialDelay=Math.round(this.socketTimeout/2)),this.destroyed=!1,this.domainSocket=-1!==this.host.indexOf("/"),this.singleBufferSerializtion="boolean"!=typeof e.singleBufferSerializtion||e.singleBufferSerializtion,this.serializationFunction=this.singleBufferSerializtion?"toBinUnified":"toBin",this.ca=e.ca||null,this.crl=e.crl||null,this.cert=e.cert||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.ciphers=e.ciphers||null,this.ecdhCurve=e.ecdhCurve||null,this.ssl="boolean"==typeof e.ssl&&e.ssl,this.rejectUnauthorized="boolean"!=typeof e.rejectUnauthorized||e.rejectUnauthorized,this.checkServerIdentity="boolean"!=typeof e.checkServerIdentity&&"function"!=typeof e.checkServerIdentity||e.checkServerIdentity,this.ssl||(this.rejectUnauthorized=!1),this.responseOptions={promoteLongs:"boolean"!=typeof e.promoteLongs||e.promoteLongs,promoteValues:"boolean"!=typeof e.promoteValues||e.promoteValues,promoteBuffers:"boolean"==typeof e.promoteBuffers&&e.promoteBuffers},this.flushing=!1,this.queue=[],this.connection=null,this.writeStream=null;var n=u.createHash("sha1");n.update(c("%s:%s",this.host,this.port)),this.hashedName=n.digest("hex"),this.workItems=[]};function A(t){delete O[t],w&&w.deleteConnection(t)}r(S,o),S.prototype.setSocketTimeout=function(t){this.connection&&this.connection.setTimeout(t)},S.prototype.resetSocketTimeout=function(){this.connection&&this.connection.setTimeout(this.socketTimeout)},S.enableConnectionAccounting=function(t){t&&(w=t),b=!0,O={}},S.disableConnectionAccounting=function(){b=!1,w=void 0},S.connections=function(){return O};var C=function(t){return function(){b&&A(t.id),t.logger.isDebug()&&t.logger.debug(c("connection %s for [%s:%s] timed out",t.id,t.host,t.port)),t.emit("timeout",new f(c("connection %s to %s:%s timed out",t.id,t.host,t.port)),t)}},T=function(t){return function(e){b&&A(t.id),t.logger.isDebug()&&t.logger.debug(c("connection %s with for [%s:%s] closed",t.id,t.host,t.port)),e||t.emit("close",new f(c("connection %s to %s:%s closed",t.id,t.host,t.port)),t)}},E=function(t,e){var n=l(e);if(n.opCode===m){n.fromCompressed=!0;var r=g;n.opCode=e.readInt32LE(r),r+=4,n.length=e.readInt32LE(r);var o=e[r+=4];r++,h(o,e.slice(r),function(r,o){if(r)throw r;if(o.length!==n.length)throw new Error("Decompressing a compressed message from the server failed. The message is corrupt.");t.messageHandler(new p(t.bson,e,n,o,t.responseOptions),t)})}else t.messageHandler(new p(t.bson,e,n,e.slice(g),t.responseOptions),t)},N=function(t){return function(e){for(;e.length>0;)if(t.bytesRead>0&&t.sizeOfMessage>0){var n=t.sizeOfMessage-t.bytesRead;if(n>e.length)e.copy(t.buffer,t.bytesRead),t.bytesRead=t.bytesRead+e.length,e=y.alloc(0);else{e.copy(t.buffer,t.bytesRead,0,n),e=e.slice(n);try{var r=t.buffer;t.buffer=null,t.sizeOfMessage=0,t.bytesRead=0,t.stubBuffer=null,E(t,r)}catch(e){var o={err:"socketHandler",trace:e,bin:t.buffer,parseState:{sizeOfMessage:t.sizeOfMessage,bytesRead:t.bytesRead,stubBuffer:t.stubBuffer}};t.emit("parseError",o,t)}}}else if(null!=t.stubBuffer&&t.stubBuffer.length>0)if(t.stubBuffer.length+e.length>4){var i=y.alloc(t.stubBuffer.length+e.length);t.stubBuffer.copy(i,0),e.copy(i,t.stubBuffer.length),e=i,t.buffer=null,t.sizeOfMessage=0,t.bytesRead=0,t.stubBuffer=null}else{var s=y.alloc(t.stubBuffer.length+e.length);t.stubBuffer.copy(s,0),e.copy(s,t.stubBuffer.length),e=y.alloc(0)}else if(e.length>4){var u=e[0]|e[1]<<8|e[2]<<16|e[3]<<24;if(u<0||u>t.maxBsonMessageSize)return o={err:"socketHandler",trace:"",bin:t.buffer,parseState:{sizeOfMessage:u,bytesRead:t.bytesRead,stubBuffer:t.stubBuffer}},void t.emit("parseError",o,t);if(u>4&&u<t.maxBsonMessageSize&&u>e.length)t.buffer=y.alloc(u),e.copy(t.buffer,0),t.bytesRead=e.length,t.sizeOfMessage=u,t.stubBuffer=null,e=y.alloc(0);else if(u>4&&u<t.maxBsonMessageSize&&u===e.length)try{r=e,t.buffer=null,t.sizeOfMessage=0,t.bytesRead=0,t.stubBuffer=null,e=y.alloc(0),E(t,r)}catch(e){t.emit("parseError",e,t)}else u<=4||u>t.maxBsonMessageSize?(o={err:"socketHandler",trace:null,bin:e,parseState:{sizeOfMessage:u,bytesRead:0,buffer:null,stubBuffer:null}},t.emit("parseError",o,t),t.buffer=null,t.sizeOfMessage=0,t.bytesRead=0,t.stubBuffer=null,e=y.alloc(0)):(r=e.slice(0,u),t.buffer=null,t.sizeOfMessage=0,t.bytesRead=0,t.stubBuffer=null,e=e.slice(u),E(t,r))}else t.stubBuffer=y.alloc(e.length),e.copy(t.stubBuffer,0),e=y.alloc(0)}},$=["pfx","key","passphrase","cert","ca","ciphers","NPNProtocols","ALPNProtocols","servername","ecdhCurve","secureProtocol","secureContext","session","minDHSize"];function I(t,e){for(var n in e)null!=e[n]&&-1!==$.indexOf(n)&&(t[n]=e[n])}function M(t,e,n,r){t.connection=t.ssl?function(t,e){let n={socket:t.connection,rejectUnauthorized:t.rejectUnauthorized};I(n,t.options),I(n,e),t.ca&&(n.ca=t.ca),t.crl&&(n.crl=t.crl),t.cert&&(n.cert=t.cert),t.key&&(n.key=t.key),t.passphrase&&(n.passphrase=t.passphrase),!1===t.checkServerIdentity?n.checkServerIdentity=function(){}:"function"==typeof t.checkServerIdentity&&(n.checkServerIdentity=t.checkServerIdentity),null==n.servername&&(n.servername=t.host);const r=s.connect(t.port,t.host,n,function(){if(r.authorizationError&&t.rejectUnauthorized)return t.emit("error",r.authorizationError,t,{ssl:!0});r.setTimeout(t.socketTimeout),t.emit("connect",t)});return r.setKeepAlive(t.keepAlive,t.keepAliveInitialDelay),r.setTimeout(t.connectionTimeout),r.setNoDelay(t.noDelay),r}(t,n):function(t,e){let n;t.domainSocket?n={path:t.host}:(n={port:t.port,host:t.host}).family=e;const r=i.createConnection(n);return r.setKeepAlive(t.keepAlive,t.keepAliveInitialDelay),r.setTimeout(t.connectionTimeout),r.setNoDelay(t.noDelay),r.once("connect",function(){r.setTimeout(t.socketTimeout),t.emit("connect",t)}),r}(t,e),t.connection.once("error",r),t.connection.once("timeout",C(t)),t.connection.once("close",T(t)),t.connection.on("data",N(t))}S.prototype.connect=function(t){var e,n;t=t||{},b&&(e=this.id,n=this,O[e]=n,w&&w.addConnection(e,n)),"boolean"==typeof t.promoteLongs&&(this.responseOptions.promoteLongs=t.promoteLongs,this.responseOptions.promoteValues=t.promoteValues,this.responseOptions.promoteBuffers=t.promoteBuffers);const r=(o=this,function(t){b&&A(o.id),o.logger.isDebug()&&o.logger.debug(c("connection %s for [%s:%s] errored out with [%s]",o.id,o.host,o.port,JSON.stringify(t))),o.listeners("error").length>0&&o.emit("error",new f(t),o)});var o;return void 0!==this.family?M(this,this.family,t,r):M(this,6,t,e=>(this.logger.isDebug()&&this.logger.debug(c("connection %s for [%s:%s] errored out with [%s]",this.id,this.host,this.port,JSON.stringify(e))),this.connection.removeAllListeners("error"),this.connection.removeAllListeners("timeout"),this.connection.removeAllListeners("close"),this.connection.removeAllListeners("data"),this.connection=void 0,M(this,4,t,r)))},S.prototype.unref=function(){if(this.connection)this.connection.unref();else{var t=this;this.once("connect",function(){t.connection.unref()})}},S.prototype.destroy=function(){if(b&&A(this.id),this.connection){try{this.connection.end()}catch(t){}this.connection.destroy()}this.destroyed=!0},S.prototype.write=function(t){var e;if(this.logger.isDebug())if(Array.isArray(t))for(e=0;e<t.length;e++)this.logger.debug(c("writing buffer [%s] to %s:%s",t[e].toString("hex"),this.host,this.port));else this.logger.debug(c("writing buffer [%s] to %s:%s",t.toString("hex"),this.host,this.port));if(!1===this.connection.destroyed){if(!Array.isArray(t))return this.connection.write(t,"binary"),!0;for(e=0;e<t.length;e++)this.connection.write(t[e],"binary");return!0}return!1},S.prototype.toString=function(){return""+this.id},S.prototype.toJSON=function(){return{id:this.id,host:this.host,port:this.port}},S.prototype.isConnected=function(){return!this.destroyed&&(!this.connection.destroyed&&this.connection.writable)},t.exports=S},function(t,e,n){"use strict";var r=n(0).format,o=n(11),i=n(18).Query,s=n(4).MongoError,u=function(t,e,n){this.db=t,this.username=e,this.password=n};u.prototype.equal=function(t){return t.db===this.db&&t.username===this.username&&t.password===this.password};var c=function(t){this.bson=t,this.authStore=[]},a=function(t,e){for(var n=!1,r=0;r<t.length;r++)if(t[r].equal(e)){n=!0;break}n||t.push(e)};c.prototype.auth=function(t,e,n,c,l,h){var p=this,f=e.length;if(0===f)return h(null,null);for(var d=0,m=null;e.length>0;){!function(e){process.nextTick(function(){var g;t(g=e,new i(p.bson,r("%s.$cmd",n),{getnonce:1},{numberToSkip:0,numberToReturn:1}),function(e,y){var _=null,v=null;if(null==e){_=y.result.nonce;var w=o.createHash("md5");w.update(c+":mongo:"+l,"utf8");var b=w.digest("hex");(w=o.createHash("md5")).update(_+c+b,"utf8"),v=w.digest("hex")}t(g,new i(p.bson,r("%s.$cmd",n),{authenticate:1,user:c,nonce:_,key:v},{numberToSkip:0,numberToReturn:1}),function(t,e){f-=1,t?m=t:e.result.$err?m=e.result:e.result.errmsg?m=e.result:d+=1,0===f&&d>0?(a(p.authStore,new u(n,c,l)),h(null,!0)):0===f&&(null==m&&(m=new s(r("failed to authenticate using mongocr"))),h(m,!1))})})})}(e.shift())}},c.prototype.logout=function(t){this.authStore=this.authStore.filter(function(e){return e.db!==t})},c.prototype.reauthenticate=function(t,e,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(t,e,r[i].db,r[i].username,r[i].password,function(t){0===(o-=1)&&n(t,null)})},t.exports=c},function(t,e,n){"use strict";var r=n(0).format,o=n(18).Query,i=n(4).MongoError,s=function(t,e,n){this.db=t,this.username=e,this.password=n};s.prototype.equal=function(t){return t.db===this.db&&t.username===this.username&&t.password===this.password};var u=function(t){this.bson=t,this.authStore=[]};u.prototype.auth=function(t,e,n,u,a,l){var h=this,p=e.length;if(0===p)return l(null,null);for(var f=0,d=null;e.length>0;){!function(e){process.nextTick(function(){var m,g;m=e,g={authenticate:1,mechanism:"MONGODB-X509"},u&&(g.user=u),t(m,new o(h.bson,"$external.$cmd",g,{numberToSkip:0,numberToReturn:1}),function(t,e){p-=1,t?d=t:e.result.$err?d=e.result:e.result.errmsg?d=e.result:f+=1,0===p&&f>0?(c(h.authStore,new s(n,u,a)),l(null,!0)):0===p&&(null==d&&(d=new i(r("failed to authenticate using mongocr"))),l(d,!1))})})}(e.shift())}};var c=function(t,e){for(var n=!1,r=0;r<t.length;r++)if(t[r].equal(e)){n=!0;break}n||t.push(e)};u.prototype.logout=function(t){this.authStore=this.authStore.filter(function(e){return e.db!==t})},u.prototype.reauthenticate=function(t,e,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(t,e,r[i].db,r[i].username,r[i].password,function(t){0===(o-=1)&&n(t,null)})},t.exports=u},function(t,e,n){"use strict";var r=n(0).format,o=n(20).retrieveBSON,i=n(18).Query,s=n(4).MongoError,u=o().Binary,c=function(t,e,n){this.db=t,this.username=e,this.password=n};c.prototype.equal=function(t){return t.db===this.db&&t.username===this.username&&t.password===this.password};var a=function(t){this.bson=t,this.authStore=[]};a.prototype.auth=function(t,e,n,o,a,h){var p=this,f=e.length;if(0===f)return h(null,null);for(var d=0,m=null;e.length>0;){!function(e){process.nextTick(function(){var g,y;g=e,y={saslStart:1,mechanism:"PLAIN",payload:new u(r("\0%s\0%s",o,a)),autoAuthorize:1},t(g,new i(p.bson,"$external.$cmd",y,{numberToSkip:0,numberToReturn:1}),function(t,e){f-=1,t?m=t:e.result.$err?m=e.result:e.result.errmsg?m=e.result:d+=1,0===f&&d>0?(l(p.authStore,new c(n,o,a)),h(null,!0)):0===f&&(null==m&&(m=new s(r("failed to authenticate using mongocr"))),h(m,!1))})})}(e.shift())}};var l=function(t,e){for(var n=!1,r=0;r<t.length;r++)if(t[r].equal(e)){n=!0;break}n||t.push(e)};a.prototype.logout=function(t){this.authStore=this.authStore.filter(function(e){return e.db!==t})},a.prototype.reauthenticate=function(t,e,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(t,e,r[i].db,r[i].username,r[i].password,function(t){0===(o-=1)&&n(t,null)})},t.exports=a},function(t,e,n){"use strict";const r=n(0).format,o=n(18).Query,i=n(4).MongoError,s=n(27).retrieveKerberos;var u=function(t,e,n,r){this.db=t,this.username=e,this.password=n,this.options=r};u.prototype.equal=function(t){return t.db===this.db&&t.username===this.username&&t.password===this.password};var c=function(t){this.bson=t,this.authStore=[]};c.prototype.auth=function(t,e,n,o,c,l,h){var p=this;let d;try{d=s()}catch(t){return h(t,null)}var m=l.gssapiservicename||l.gssapiServiceName||"mongodb",g=e.length;if(0===g)return h(null,null);for(var y=0,_=null;e.length>0;){!function(e){process.nextTick(function(){var s;s=e,a(p,d.processes.MongoAuthProcess,n,o,c,n,m,t,s,l,function(t,e){g-=1,t?_=t:e.result.$err?_=e.result:e.result.errmsg?_=e.result:y+=1,0===g&&y>0?(f(p.authStore,new u(n,o,c,l)),h(null,!0)):0===g&&(null==_&&(_=new i(r("failed to authenticate using mongocr"))),h(_,!1))})})}(e.shift())}};var a=function(t,e,n,r,o,i,s,u,c,a,h){var p=new e(c.host,c.port,s,a);p.init(r,o,function(e){if(e)return h(e,!1);p.transition("",function(e,s){if(e)return h(e,!1);l(t,p,s,n,r,o,i,u,c,h)})})},l=function(t,e,n,r,i,s,u,c,a,l){var p={saslStart:1,mechanism:"GSSAPI",payload:n,autoAuthorize:1};c(a,new o(t.bson,"$external.$cmd",p,{numberToSkip:0,numberToReturn:1}),function(n,o){if(n)return l(n,!1);var p=o.result;e.transition(o.result.payload,function(n,o){if(n)return l(n,!1);h(t,e,o,p,r,i,s,u,c,a,l)})})},h=function(t,e,n,r,i,s,u,c,a,l,h){var f={saslContinue:1,conversationId:r.conversationId,payload:n};a(l,new o(t.bson,"$external.$cmd",f,{numberToSkip:0,numberToReturn:1}),function(n,r){if(n)return h(n,!1);var o=r.result;e.transition(o.payload,function(n,r){if(n)return h(n,!1);p(t,e,r,o,i,s,u,c,a,l,h)})})},p=function(t,e,n,r,i,s,u,c,a,l,h){var p={saslContinue:1,conversationId:r.conversationId,payload:n};a(l,new o(t.bson,"$external.$cmd",p,{numberToSkip:0,numberToReturn:1}),function(t,n){if(t)return h(t,!1);e.transition(null,function(t){if(t)return h(t,null);h(null,n)})})},f=function(t,e){for(var n=!1,r=0;r<t.length;r++)if(t[r].equal(e)){n=!0;break}n||t.push(e)};c.prototype.logout=function(t){this.authStore=this.authStore.filter(function(e){return e.db!==t})},c.prototype.reauthenticate=function(t,e,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(t,e,r[i].db,r[i].username,r[i].password,r[i].options,function(t){0===(o-=1)&&n(t,null)})},t.exports=c},function(t,e){t.exports=require("dns")},function(t,e,n){"use strict";const r=n(0).inherits,o=n(2).MongoError,i=n(15).Readable,s=n(28);var u=function(t,e,n,r,o,c){s.apply(this,Array.prototype.slice.call(arguments,0));var a=u.INIT,l=r.promiseLibrary||Promise;i.call(this,{objectMode:!0}),this.s={maxTimeMS:null,state:a,streamOptions:{},bson:t,ns:e,cmd:n,options:r,topology:o,topologyOptions:c,promiseLibrary:l,session:r.session}};for(var c in r(u,i),s.prototype)u.prototype[c]=s.prototype[c];u.prototype.batchSize=function(t){if(this.s.state===u.CLOSED||this.isDead())throw o.create({message:"Cursor is closed",driver:!0});if("number"!=typeof t)throw o.create({message:"batchSize requires an integer",drvier:!0});return this.s.cmd.cursor&&(this.s.cmd.cursor.batchSize=t),this.setCursorBatchSize(t),this},u.prototype.geoNear=function(t){return this.s.cmd.pipeline.push({$geoNear:t}),this},u.prototype.group=function(t){return this.s.cmd.pipeline.push({$group:t}),this},u.prototype.limit=function(t){return this.s.cmd.pipeline.push({$limit:t}),this},u.prototype.match=function(t){return this.s.cmd.pipeline.push({$match:t}),this},u.prototype.maxTimeMS=function(t){return this.s.topology.lastIsMaster().minWireVersion>2&&(this.s.cmd.maxTimeMS=t),this},u.prototype.out=function(t){return this.s.cmd.pipeline.push({$out:t}),this},u.prototype.project=function(t){return this.s.cmd.pipeline.push({$project:t}),this},u.prototype.lookup=function(t){return this.s.cmd.pipeline.push({$lookup:t}),this},u.prototype.redact=function(t){return this.s.cmd.pipeline.push({$redact:t}),this},u.prototype.skip=function(t){return this.s.cmd.pipeline.push({$skip:t}),this},u.prototype.sort=function(t){return this.s.cmd.pipeline.push({$sort:t}),this},u.prototype.unwind=function(t){return this.s.cmd.pipeline.push({$unwind:t}),this},u.prototype.getLogger=function(){return this.logger},u.prototype.get=u.prototype.toArray,u.INIT=0,u.OPEN=1,u.CLOSED=2,t.exports=u},function(t,e,n){"use strict";t.exports={SYSTEM_NAMESPACE_COLLECTION:"system.namespaces",SYSTEM_INDEX_COLLECTION:"system.indexes",SYSTEM_PROFILE_COLLECTION:"system.profile",SYSTEM_USER_COLLECTION:"system.users",SYSTEM_COMMAND_COLLECTION:"$cmd",SYSTEM_JS_COLLECTION:"system.js"}},function(t,e,n){"use strict";const r=n(1).executeOperation,o=n(1).applyWriteConcern,i=n(6).addUser,s=n(6).executeDbAdminCommand,u=n(6).removeUser,c=n(104).replSetGetStatus,a=n(104).serverStatus,l=n(104).validateCollection;function h(t,e,n){if(!(this instanceof h))return new h(t,e);this.s={db:t,topology:e,promiseLibrary:n}}h.prototype.command=function(t,e,n){const o=Array.prototype.slice.call(arguments,1);return n="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length?o.shift():{},r(this.s.db.s.topology,s.bind(this.s.db),[this.s.db,t,e,n])},h.prototype.buildInfo=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};return r(this.s.db.s.topology,s.bind(this.s.db),[this.s.db,{buildinfo:1},t,e])},h.prototype.serverInfo=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};return r(this.s.db.s.topology,s.bind(this.s.db),[this.s.db,{buildinfo:1},t,e])},h.prototype.serverStatus=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},r(this.s.db.s.topology,a,[this,t,e])},h.prototype.ping=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};return r(this.s.db.s.topology,s.bind(this.s.db),[this.s.db,{ping:1},t,e])},h.prototype.addUser=function(t,e,n,s){const u=Array.prototype.slice.call(arguments,2);return s="function"==typeof u[u.length-1]?u.pop():void 0,n=u.length?u.shift():{},n=Object.assign({},n),(n=o(n,{db:this.s.db})).dbName="admin",r(this.s.db.s.topology,i,[this.s.db,t,e,n,s])},h.prototype.removeUser=function(t,e,n){const i=Array.prototype.slice.call(arguments,1);return n="function"==typeof i[i.length-1]?i.pop():void 0,e=i.length?i.shift():{},e=Object.assign({},e),(e=o(e,{db:this.s.db})).dbName="admin",r(this.s.db.s.topology,u,[this.s.db,t,e,n])},h.prototype.validateCollection=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},r(this.s.db.s.topology,l,[this,t,e,n])},h.prototype.listDatabases=function(t,e){"function"==typeof t&&(e=t,t={});const n={listDatabases:1};return(t=t||{}).nameOnly&&(n.nameOnly=Number(n.nameOnly)),r(this.s.db.s.topology,s.bind(this.s.db),[this.s.db,n,t,e])},h.prototype.replSetGetStatus=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},r(this.s.db.s.topology,c,[this,t,e])},t.exports=h},function(t,e,n){"use strict";const r=n(45).TopologyBase,o=n(2).MongoError,i=n(2).Mongos,s=n(28),u=n(80),c=n(45).Store,a=n(1).MAX_JS_INT,l=n(1).translateOptions,h=n(1).filterOptions,p=n(1).mergeOptions;var f=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","promiseLibrary","monitorCommands"];class d extends r{constructor(t,e){super();e=h(e=e||{},f);for(var n=0;n<t.length;n++)if(!(t[n]instanceof u))throw o.create({message:"all seed list instances must be of the Server type",driver:!0});var r={force:!1,bufferMaxEntries:"number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:a},d=e.store||new c(this,r),m=t.map(function(t){return{host:t.host,port:t.port}}),g="boolean"!=typeof e.auto_reconnect||e.auto_reconnect;g="boolean"==typeof e.autoReconnect?e.autoReconnect:g;var y=p({},{disconnectHandler:d,cursorFactory:s,reconnect:g,emitError:"boolean"!=typeof e.emitError||e.emitError,size:"number"==typeof e.poolSize?e.poolSize:5,monitorCommands:"boolean"==typeof e.monitorCommands&&e.monitorCommands});y=l(y,e);var _=e.socketOptions&&Object.keys(e.socketOptions).length>0?e.socketOptions:e;(y=l(y,_)).clientInfo=this.clientInfo,e.appname&&(y.clientInfo.application={name:e.appname}),this.s={coreTopology:new i(m,y),sCapabilities:null,debug:y.debug,storeOptions:r,clonedOptions:y,store:d,options:e,sessionPool:null,sessions:[],promiseLibrary:e.promiseLibrary||Promise}}connect(t,e){var n=this;"function"==typeof t&&(e=t,t={}),null==t&&(t={}),"function"!=typeof e&&(e=null),t=Object.assign({},this.s.clonedOptions,t),n.s.options=t,n.s.storeOptions.bufferMaxEntries="number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:-1;var r=function(){return function(t){["timeout","error","close"].forEach(function(t){n.removeListener(t,r)}),n.s.coreTopology.removeListener("connect",r),n.close(!0);try{e(t)}catch(t){process.nextTick(function(){throw t})}}},o=function(t){return function(e){"error"!==t&&n.emit(t,e)}},i=function(t){return function(e,r){n.emit(t,e,r)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach(function(t){n.s.coreTopology.removeAllListeners(t)}),n.s.coreTopology.on("serverDescriptionChanged",i("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",i("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",i("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",i("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",i("serverOpening")),n.s.coreTopology.on("serverClosed",i("serverClosed")),n.s.coreTopology.on("topologyOpening",i("topologyOpening")),n.s.coreTopology.on("topologyClosed",i("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",i("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",i("commandStarted")),n.s.coreTopology.on("commandSucceeded",i("commandSucceeded")),n.s.coreTopology.on("commandFailed",i("commandFailed")),n.s.coreTopology.once("timeout",r("timeout")),n.s.coreTopology.once("error",r("error")),n.s.coreTopology.once("close",r("close")),n.s.coreTopology.once("connect",function(){["timeout","error","close","fullsetup"].forEach(function(t){n.s.coreTopology.removeAllListeners(t)}),n.s.coreTopology.on("timeout",o("timeout")),n.s.coreTopology.on("error",o("error")),n.s.coreTopology.on("close",o("close")),n.s.coreTopology.on("fullsetup",function(){n.emit("fullsetup",n)}),n.emit("open",null,n);try{e(null,n)}catch(t){process.nextTick(function(){throw t})}}),n.s.coreTopology.on("joined",i("joined")),n.s.coreTopology.on("left",i("left")),n.s.coreTopology.on("reconnect",function(){n.emit("reconnect"),n.s.store.execute()}),n.s.coreTopology.connect(t)}}Object.defineProperty(d.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),t.exports=d},function(t,e,n){"use strict";const r=n(80),o=n(28),i=n(2).MongoError,s=n(45).TopologyBase,u=n(45).Store,c=n(2).ReplSet,a=n(1).MAX_JS_INT,l=n(1).translateOptions,h=n(1).filterOptions,p=n(1).mergeOptions;var f=["ha","haInterval","replicaSet","rs_name","secondaryAcceptableLatencyMS","connectWithNoPrimary","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCert","ciphers","ecdhCurve","sslCRL","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","strategy","debug","family","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","maxStalenessSeconds","promiseLibrary","minSize","monitorCommands"];class d extends s{constructor(t,e){super();var n=this;e=h(e=e||{},f);for(var s=0;s<t.length;s++)if(!(t[s]instanceof r))throw i.create({message:"all seed list instances must be of the Server type",driver:!0});var d={force:!1,bufferMaxEntries:"number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:a},m=e.store||new u(n,d),g=t.map(function(t){return{host:t.host,port:t.port}}),y=p({},{disconnectHandler:m,cursorFactory:o,reconnect:!1,emitError:"boolean"!=typeof e.emitError||e.emitError,size:"number"==typeof e.poolSize?e.poolSize:5,monitorCommands:"boolean"==typeof e.monitorCommands&&e.monitorCommands});y=l(y,e);var _=e.socketOptions&&Object.keys(e.socketOptions).length>0?e.socketOptions:e;(y=l(y,_)).clientInfo=this.clientInfo,e.appname&&(y.clientInfo.application={name:e.appname});var v=new c(g,y);v.on("reconnect",function(){n.emit("reconnect"),m.execute()}),this.s={coreTopology:v,sCapabilities:null,tag:e.tag,storeOptions:d,clonedOptions:y,store:m,options:e,sessionPool:null,sessions:[],promiseLibrary:e.promiseLibrary||Promise},y.debug&&Object.defineProperty(this,"replset",{enumerable:!0,get:function(){return v}})}connect(t,e){var n=this;"function"==typeof t&&(e=t,t={}),null==t&&(t={}),"function"!=typeof e&&(e=null),t=Object.assign({},this.s.clonedOptions,t),n.s.options=t,n.s.storeOptions.bufferMaxEntries="number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:-1;var r=function(t){return function(e){"error"!==t&&n.emit(t,e)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"].forEach(function(t){n.s.coreTopology.removeAllListeners(t)});var o,i=function(t){return function(e,r){n.emit(t,e,r)}};n.s.coreTopology.on("joined",(o="joined",function(t,e){n.emit(o,t,e.lastIsMaster(),e)})),n.s.coreTopology.on("left",i("left")),n.s.coreTopology.on("ping",i("ping")),n.s.coreTopology.on("ha",function(t,e){n.emit("ha",t,e),"start"===t?n.emit("ha_connect",t,e):"end"===t&&n.emit("ha_ismaster",t,e)}),n.s.coreTopology.on("serverDescriptionChanged",i("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",i("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",i("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",i("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",i("serverOpening")),n.s.coreTopology.on("serverClosed",i("serverClosed")),n.s.coreTopology.on("topologyOpening",i("topologyOpening")),n.s.coreTopology.on("topologyClosed",i("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",i("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",i("commandStarted")),n.s.coreTopology.on("commandSucceeded",i("commandSucceeded")),n.s.coreTopology.on("commandFailed",i("commandFailed")),n.s.coreTopology.on("fullsetup",function(){n.emit("fullsetup",n,n)}),n.s.coreTopology.on("all",function(){n.emit("all",null,n)});var s=function(){return function(t){["timeout","error","close"].forEach(function(t){n.s.coreTopology.removeListener(t,s)}),n.s.coreTopology.removeListener("connect",s),n.s.coreTopology.destroy();try{e(t)}catch(t){n.s.coreTopology.isConnected()||process.nextTick(function(){throw t})}}};n.s.coreTopology.once("timeout",s("timeout")),n.s.coreTopology.once("error",s("error")),n.s.coreTopology.once("close",s("close")),n.s.coreTopology.once("connect",function(){n.s.coreTopology.once("timeout",r("timeout")),n.s.coreTopology.once("error",r("error")),n.s.coreTopology.once("close",r("close")),n.emit("open",null,n);try{e(null,n)}catch(t){process.nextTick(function(){throw t})}}),n.s.coreTopology.connect(t)}close(t){super.close(t),["timeout","error","close","joined","left"].forEach(t=>this.removeAllListeners(t))}}Object.defineProperty(d.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),t.exports=d},function(t,e,n){"use strict";var r=n(2).BSON.Binary,o=n(2).BSON.ObjectID,i=n(14).Buffer,s=function(t,e,n){if(!(this instanceof s))return new s(t,e);this.file=t;var u=null==e?{}:e;if(this.writeConcern=n||{w:1},this.objectId=null==u._id?new o:u._id,this.chunkNumber=null==u.n?0:u.n,this.data=new r,"string"==typeof u.data){var c=i.alloc(u.data.length);c.write(u.data,0,u.data.length,"binary"),this.data=new r(c)}else if(Array.isArray(u.data)){c=i.alloc(u.data.length);var a=u.data.join("");c.write(a,0,a.length,"binary"),this.data=new r(c)}else if(u.data&&"Binary"===u.data._bsontype)this.data=u.data;else if(!i.isBuffer(u.data)&&null!=u.data)throw Error("Illegal chunk format");this.internalPosition=0};s.prototype.write=function(t,e){return this.data.write(t,this.internalPosition,t.length,"binary"),this.internalPosition=this.data.length(),null!=e?e(null,this):this},s.prototype.read=function(t){if(t=null==t||0===t?this.length():t,this.length()-this.internalPosition+1>=t){var e=this.data.read(this.internalPosition,t);return this.internalPosition=this.internalPosition+t,e}return""},s.prototype.readSlice=function(t){if(this.length()-this.internalPosition>=t){var e=null;return null!=this.data.buffer?e=this.data.buffer.slice(this.internalPosition,this.internalPosition+t):(e=i.alloc(t),t=this.data.readInto(e,this.internalPosition)),this.internalPosition=this.internalPosition+t,e}return null},s.prototype.eof=function(){return this.internalPosition===this.length()},s.prototype.getc=function(){return this.read(1)},s.prototype.rewind=function(){this.internalPosition=0,this.data=new r},s.prototype.save=function(t,e){var n=this;"function"==typeof t&&(e=t,t={}),n.file.chunkCollection(function(r,o){if(r)return e(r);var i={upsert:!0};for(var s in t)i[s]=t[s];for(s in n.writeConcern)i[s]=n.writeConcern[s];n.data.length()>0?n.buildMongoObject(function(t){var r={forceServerObjectId:!0};for(var s in n.writeConcern)r[s]=n.writeConcern[s];o.replaceOne({_id:n.objectId},t,i,function(t){e(t,n)})}):e(null,n)})},s.prototype.buildMongoObject=function(t){var e={files_id:this.file.fileId,n:this.chunkNumber,data:this.data};null!=this.objectId&&(e._id=this.objectId),t(e)},s.prototype.length=function(){return this.data.length()},Object.defineProperty(s.prototype,"position",{enumerable:!0,get:function(){return this.internalPosition},set:function(t){this.internalPosition=t}}),s.DEFAULT_CHUNK_SIZE=261120,t.exports=s},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(158),o=n(37).Collection,i=n(8),s=n(82),u=n(15),c=n(0);function a(){this.collection=null,r.apply(this,arguments)}
/*!
 * Inherit from abstract Collection.
 */a.prototype.__proto__=r.prototype,a.prototype.onOpen=function(){const t=this;return t.opts.capped.size?t.conn.db.collection(t.name,function(n,r){if(n)return e(n);t.conn.db.listCollections({name:t.name}).toArray(function(n,o){if(n)return e(n);const i=o[0];if(!!i)if(i.options&&i.options.capped)e(null,r);else{const r="A non-capped collection exists with the name: "+t.name+"\n\n To use this collection as a capped collection, please first convert it.\n http://www.mongodb.org/display/DOCS/Capped+Collections#CappedCollections-Convertingacollectiontocapped";e(n=new Error(r))}else{const n=Object.assign({},t.opts.capped);n.capped=!0,t.conn.db.createCollection(t.name,n,e)}})}):(e(null,t.conn.db.collection(t.name)),t.collection);function e(e,n){e?t.conn.emit("error",e):(t.collection=n,r.prototype.onOpen.call(t))}},a.prototype.onClose=function(t){r.prototype.onClose.call(this,t)};
/*!
 * ignore
 */
const l={watch:!0};
/*!
 * Copy the collection methods and make them subject to queues
 */function h(t){a.prototype[t]=function(){const e=this.collection,n=arguments,r=this,o=i(r,"conn.base.options.debug");if(this.opts.$wasForceClosed)return this.conn.db.collection(this.name)[t].apply(e,n);if(this.buffer){if(l[t])throw new Error("Collection method "+t+" is synchronous");this.addQueue(t,arguments)}else{o&&("function"==typeof o?o.apply(r,[r.name,t].concat(s(n,0,n.length-1))):o instanceof u.Writable?this.$printToStream(r.name,t,n,o):this.$print(r.name,t,n));try{return e[t].apply(e,n)}catch(t){if(!(n.length>0&&"function"==typeof n[n.length-1]))throw t;n[n.length-1](t)}}}}for(const t in o.prototype){try{if("function"!=typeof o.prototype[t])continue}catch(t){continue}h(t)}
/*!
 * Debug print helper
 */
function p(t){const e={inspect:function(){return t}};return c.inspect.custom&&(e[c.inspect.custom]=e.inspect),e}function f(t){return g(t,!0)}function d(t,e){t[e]=p('ObjectId("'+t[e].toHexString()+'")')}function m(t,e){t[e]=p('new Date("'+t[e].toUTCString()+'")')}function g(t,e){if(t&&"function"==typeof t.toBSON&&(t=t.toBSON()),null==t)return t;let r=n(5).clone(t,{transform:!1});if("Binary"===r.constructor.name)r="BinData("+r.sub_type+', "'+r.toString("base64")+'")';else if("ObjectID"===r.constructor.name)r=p('ObjectId("'+r.toHexString()+'")');else if("Date"===r.constructor.name)r=p('new Date("'+r.toUTCString()+'")');else if("Object"===r.constructor.name){const t=Object.keys(r),e=t.length;let n;for(let o=0;o<e;++o)if(r[n=t[o]]){let t;if("function"==typeof r[n].toBSON)try{r[n]=r[n].toBSON()}catch(e){t=e}if("Binary"===r[n].constructor.name)r[n]="BinData("+r[n].sub_type+', "'+r[n].buffer.toString("base64")+'")';else if("Object"===r[n].constructor.name)r[n]=g(r[n],!0);else if("ObjectID"===r[n].constructor.name)d(r,n);else if("Date"===r[n].constructor.name)m(r,n);else if("ClientSession"===r[n].constructor.name)r[n]=p('ClientSession("'+i(r[n],"id.id.buffer","").toString("hex")+'")');else if(Array.isArray(r[n]))r[n]=r[n].map(f);else if(null!=t)throw t}}return e?r:c.inspect(r,!1,10,!0).replace(/\n/g,"").replace(/\s{2,}/g," ")}a.prototype.$print=function(t,e,n){const r=[t,e].join("."),o=[];for(let t=n.length-1;t>=0;--t)(this.$format(n[t])||o.length)&&o.unshift(this.$format(n[t]));const i="("+o.join(", ")+")";console.info("[0;36mMongoose:[0m "+r+i)},a.prototype.$printToStream=function(t,e,n,r){const o=[t,e].join("."),i=[];for(let t=n.length-1;t>=0;--t)(this.$format(n[t])||i.length)&&i.unshift(this.$format(n[t]));const s="("+i.join(", ")+")";r.write(o+s,"utf8")},a.prototype.$format=function(t){const e=typeof t;return"function"===e||"undefined"===e?"":g(t)},a.prototype.getIndexes=a.prototype.indexInformation,
/*!
 * Module exports.
 */
t.exports=a},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(10).EventEmitter,o=n(81),i=n(55);function s(t,e,n){void 0===n&&(n={}),void 0===n.capped&&(n.capped={}),n.bufferCommands=void 0===n.bufferCommands||n.bufferCommands,"number"==typeof n.capped&&(n.capped={size:n.capped}),this.opts=n,this.name=t,this.collectionName=t,this.conn=e,this.queue=[],this.buffer=this.opts.bufferCommands,this.emitter=new r,o.connected===this.conn.readyState&&this.onOpen()}s.prototype.name,s.prototype.collectionName,s.prototype.conn,s.prototype.onOpen=function(){this.buffer=!1,i(()=>this.doQueue())},s.prototype.onClose=function(t){this.opts.bufferCommands&&!t&&(this.buffer=!0)},s.prototype.addQueue=function(t,e){return this.queue.push([t,e]),this},s.prototype.doQueue=function(){for(let t=0,e=this.queue.length;t<e;t++)"function"==typeof this.queue[t][0]?this.queue[t][0].apply(this,this.queue[t][1]):this[this.queue[t][0]].apply(this,this.queue[t][1]);this.queue=[];const t=this;return process.nextTick(function(){t.emitter.emit("queue")}),this},s.prototype.ensureIndex=function(){throw new Error("Collection#ensureIndex unimplemented by driver")},s.prototype.createIndex=function(){throw new Error("Collection#ensureIndex unimplemented by driver")},s.prototype.findAndModify=function(){throw new Error("Collection#findAndModify unimplemented by driver")},s.prototype.findOneAndUpdate=function(){throw new Error("Collection#findOneAndUpdate unimplemented by driver")},s.prototype.findOneAndDelete=function(){throw new Error("Collection#findOneAndDelete unimplemented by driver")},s.prototype.findOneAndReplace=function(){throw new Error("Collection#findOneAndReplace unimplemented by driver")},s.prototype.findOne=function(){throw new Error("Collection#findOne unimplemented by driver")},s.prototype.find=function(){throw new Error("Collection#find unimplemented by driver")},s.prototype.insert=function(){throw new Error("Collection#insert unimplemented by driver")},s.prototype.insertOne=function(){throw new Error("Collection#insertOne unimplemented by driver")},s.prototype.insertMany=function(){throw new Error("Collection#insertMany unimplemented by driver")},s.prototype.save=function(){throw new Error("Collection#save unimplemented by driver")},s.prototype.update=function(){throw new Error("Collection#update unimplemented by driver")},s.prototype.getIndexes=function(){throw new Error("Collection#getIndexes unimplemented by driver")},s.prototype.mapReduce=function(){throw new Error("Collection#mapReduce unimplemented by driver")},s.prototype.watch=function(){throw new Error("Collection#watch unimplemented by driver")},
/*!
 * Module exports.
 */
t.exports=s},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */var r=n(14).Buffer,o=n(160),i=e.clone=function t(n,r){if(null==n)return n;if(Array.isArray(n))return e.cloneArray(n,r);if(n.constructor){if(/ObjectI[dD]$/.test(n.constructor.name))return"function"==typeof n.clone?n.clone():new n.constructor(n.id);if("ReadPreference"===n.constructor.name)return new n.constructor(n.mode,t(n.tags,r));if("Binary"==n._bsontype&&n.buffer&&n.value)return"function"==typeof n.clone?n.clone():new n.constructor(n.value(!0),n.sub_type);if("Date"===n.constructor.name||"Function"===n.constructor.name)return new n.constructor(+n);if("RegExp"===n.constructor.name)return o(n);if("Buffer"===n.constructor.name)return e.cloneBuffer(n)}return u(n)?e.cloneObject(n,r):n.valueOf?n.valueOf():void 0};
/*!
 * ignore
 */
e.cloneObject=function(t,e){var n,r,o,s=e&&e.minimize,u={};for(o in t)r=i(t[o],e),s&&void 0===r||(n||(n=!0),u[o]=r);return s?n&&u:u},e.cloneArray=function(t,e){for(var n=[],r=0,o=t.length;r<o;r++)n.push(i(t[r],e));return n},e.tick=function(t){if("function"==typeof t)return function(){var e=arguments;c(function(){t.apply(this,e)})}},e.merge=function t(n,r){for(var o,i=Object.keys(r),s=i.length;s--;)void 0===n[o=i[s]]?n[o]=r[o]:e.isObject(r[o])?t(n[o],r[o]):n[o]=r[o]},e.mergeClone=function t(n,r){for(var o,s=Object.keys(r),u=s.length;u--;)void 0===n[o=s[u]]?n[o]=i(r[o]):e.isObject(r[o])?t(n[o],r[o]):n[o]=i(r[o])},e.readPref=function(t){switch(t){case"p":t="primary";break;case"pp":t="primaryPreferred";break;case"s":t="secondary";break;case"sp":t="secondaryPreferred";break;case"n":t="nearest"}return t},e.readConcern=function(t){if("string"==typeof t){switch(t){case"l":t="local";break;case"a":t="available";break;case"m":t="majority";break;case"lz":t="linearizable";break;case"s":t="snapshot"}t={level:t}}return t};var s=Object.prototype.toString;e.toString=function(t){return s.call(t)};var u=e.isObject=function(t){return"[object Object]"==e.toString(t)};e.isArray=function(t){return Array.isArray(t)||"object"==typeof t&&"[object Array]"==e.toString(t)},e.keys=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},e.create="function"==typeof Object.create?Object.create:function(t){if(arguments.length>1)throw new Error("Adding properties is not supported");function e(){}return e.prototype=t,new e},e.inherits=function(t,n){t.prototype=e.create(n.prototype),t.prototype.constructor=t};var c=e.soon="function"==typeof setImmediate?setImmediate:process.nextTick;e.cloneBuffer=function(t){var e=r.alloc(t.length);return t.copy(e,0,0,t.length),e},e.isArgumentsObject=function(t){return"[object Arguments]"===Object.prototype.toString.call(t)}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){if("object"!=typeof(e=t)||"[object RegExp]"!=n.call(e))throw new TypeError("Not a RegExp");var e,r=[];return t.global&&r.push("g"),t.multiline&&r.push("m"),t.ignoreCase&&r.push("i"),new RegExp(t.source,r.join(""))}},function(t,e,n){function r(t){var n;function r(){if(r.enabled){var t=r,o=+new Date,i=o-(n||o);t.diff=i,t.prev=n,t.curr=o,n=o;for(var s=new Array(arguments.length),u=0;u<s.length;u++)s[u]=arguments[u];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var o=e.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(t,i),s.splice(c,1),c--}return n}),e.formatArgs.call(t,s),(r.log||e.log||console.log.bind(console)).apply(t,s)}}return r.namespace=t,r.enabled=e.enabled(t),r.useColors=e.useColors(),r.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),r.destroy=o,"function"==typeof e.init&&e.init(r),e.instances.push(r),r}function o(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=r.debug=r.default=r).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var r=("string"==typeof t?t:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(n=0;n<e.instances.length;n++){var i=e.instances[n];i.enabled=e.enabled(i.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(268),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e,n){"use strict";e.isNode="undefined"!=typeof process&&"object"==typeof t&&"object"==typeof global&&"function"==typeof Buffer&&process.argv,e.isMongo=!e.isNode&&"function"==typeof printjson&&"function"==typeof ObjectId&&"function"==typeof rs&&"function"==typeof sh,e.isBrowser=!e.isNode&&!e.isMongo&&"undefined"!=typeof window,e.type=e.isNode?"node":e.isMongo?"mongo":e.isBrowser?"browser":"unknown"},function(t,e,n){"use strict";t.exports=function(t){var e=n(7),r=n(46).keys,o=e.tryCatch,i=e.errorObj;return function(n,s,u){return function(c){var a=u._boundValue();t:for(var l=0;l<n.length;++l){var h=n[l];if(h===Error||null!=h&&h.prototype instanceof Error){if(c instanceof h)return o(s).call(a,c)}else if("function"==typeof h){var p=o(h).call(a,c);if(p===i)return p;if(p)return o(s).call(a,c)}else if(e.isObject(c)){for(var f=r(h),d=0;d<f.length;++d){var m=f[d];if(h[m]!=c[m])continue t}return o(s).call(a,c)}}return t}}}},function(t,e,n){"use strict";var r=n(7),o=r.maybeWrapAsError,i=n(35).OperationalError,s=n(46);var u=/^(?:name|message|stack|cause)$/;function c(t){var e;if(function(t){return t instanceof Error&&s.getPrototypeOf(t)===Error.prototype}(t)){(e=new i(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var n=s.keys(t),o=0;o<n.length;++o){var c=n[o];u.test(c)||(e[c]=t[c])}return e}return r.markAsOriginatingFromRejection(t),t}t.exports=function(t,e){return function(n,r){if(null!==t){if(n){var i=c(o(n));t._attachExtraTrace(i),t._reject(i)}else if(e){for(var s=arguments.length,u=new Array(Math.max(s-1,0)),a=1;a<s;++a)u[a-1]=arguments[a];t._fulfill(u)}else t._fulfill(r);t=null}}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(9),o=n(0);
/*!
 * OverwriteModel Error constructor.
 *
 * @inherits MongooseError
 */
function i(t){let e;const n=r.messages;e=null!=n.DocumentNotFoundError?"function"==typeof n.DocumentNotFoundError?n.DocumentNotFoundError(t):n.DocumentNotFoundError:'No document found for query "'+o.inspect(t)+'"',r.call(this,e),this.name="DocumentNotFoundError",Error.captureStackTrace?Error.captureStackTrace(this):this.stack=(new Error).stack,this.filter=t,this.query=t}
/*!
 * Inherits from MongooseError.
 */i.prototype=Object.create(r.prototype),i.prototype.constructor=r,
/*!
 * exports
 */
t.exports=i},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t){if("number"!=typeof t&&"string"!=typeof t)throw new Error("$type parameter must be number or string");return t}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(9);function o(t,e){r.call(this,"Tried to set nested object field `"+t+"` to primitive value `"+e+"` and strict mode is set to throw."),this.name="ObjectExpectedError",Error.captureStackTrace?Error.captureStackTrace(this):this.stack=(new Error).stack,this.path=t}
/*!
 * Inherits from MongooseError.
 */o.prototype=Object.create(r.prototype),o.prototype.constructor=r,t.exports=o},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(9);function o(t,e,n){r.call(this,'Parameter "'+e+'" to '+n+"() must be an object, got "+t.toString()),this.name="ObjectParameterError",Error.captureStackTrace?Error.captureStackTrace(this):this.stack=(new Error).stack}
/*!
 * Inherits from MongooseError.
 */o.prototype=Object.create(r.prototype),o.prototype.constructor=r,t.exports=o},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t,e,n){const r=(n=n||{}).skipDocArrays;let o=0;for(const n of Object.keys(t.$__.activePaths.states.modify)){if(r){const e=t.schema.path(n);if(e&&e.$isMongooseDocumentArray)continue}0===n.indexOf(e+".")&&(delete t.$__.activePaths.states.modify[n],++o)}return o}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(16),o=n(320);let i=!1;t.exports=function(){return i?o:r},
/*!
 * ignore
 */
t.exports.setBrowser=function(t){i=t}},function(t,e,n){"use strict";function r(){this._pres=new Map,this._posts=new Map}function o(t,e,n,r,o,i,s){if(i.useErrorHandlers){var u={error:e};return t.execPost(n,r,o,u,function(t){return"function"==typeof s&&s(t)})}return"function"==typeof s?s(e):void 0}function i(t,e,n){return t.has(e)?t.get(e):n}function s(t,e,n,r){let o;try{o=t.apply(e,n)}catch(t){return r(t)}u(o)&&o.then(()=>r(),t=>r(t))}function u(t){return null!=t&&"function"==typeof t.then}function c(t){var e=!1,n=this;return function(){if(!e)return e=!0,process.nextTick(()=>t.apply(n,arguments))}}r.prototype.execPre=function(t,e,n,r){3===arguments.length&&(r=n,n=[]);var o=i(this._pres,t,[]),a=o.length,l=o.numAsync||0,h=0,p=l,f=!1,d=n;if(!a)return process.nextTick(function(){r(null)});var m=function(){if(!(h>=a)){var t=o[h];if(t.isAsync){var n=[c(g),c(function(t){if(t){if(f)return;return f=!0,r(t)}if(0==--p&&h>=a)return r(null)})];s(t.fn,e,n,n[0])}else if(t.fn.length>0){n=[c(g)];for(var i=arguments.length>=2?arguments:[null].concat(d),l=1;l<i.length;++l)n.push(i[l]);s(t.fn,e,n,n[0])}else{let n=null,o=null;try{o=t.fn.call(e)}catch(t){n=t}if(u(o))o.then(()=>g(),t=>g(t));else{if(++h>=a)return p>0?void 0:process.nextTick(function(){r(n)});m(n)}}}};function g(t){if(t){if(f)return;return f=!0,r(t)}if(++h>=a)return p>0?void 0:r(null);m.apply(e,arguments)}m.apply(null,[null].concat(n))},r.prototype.execPreSync=function(t,e,n){for(var r=i(this._pres,t,[]),o=r.length,s=0;s<o;++s)r[s].fn.apply(e,n||[])},r.prototype.execPost=function(t,e,n,r,o){arguments.length<5&&(o=r,r=null);var a=i(this._posts,t,[]),l=a.length,h=0,p=null;if(r&&r.error&&(p=r.error),!l)return process.nextTick(function(){o.apply(null,[p].concat(n))});var f=function(){for(var t=a[h].fn,r=0,i=n.length,d=[],m=0;m<i;++m)r+=n[m]&&n[m]._kareemIgnore?0:1,n[m]&&n[m]._kareemIgnore||d.push(n[m]);if(p)if(t.length===r+2){var g=c(function(t){if(t&&(p=t),++h>=l)return o.call(null,p);f()});s(t,e,[p].concat(d).concat([g]),g)}else{if(++h>=l)return o.call(null,p);f()}else{const i=c(function(t){return t?(p=t,f()):++h>=l?o.apply(null,[null].concat(n)):void f()});if(t.length===r+2)return++h>=l?o.apply(null,[null].concat(n)):f();if(t.length===r+1)s(t,e,d.concat([i]),i);else{let r,s;try{s=t.apply(e,d)}catch(t){r=t,p=t}if(u(s))return s.then(()=>i(),t=>i(t));if(++h>=l)return o.apply(null,[r].concat(n));f(r)}}};f()},r.prototype.execPostSync=function(t,e,n){const r=i(this._posts,t,[]),o=r.length;for(let t=0;t<o;++t)r[t].fn.apply(e,n||[])},r.prototype.createWrapperSync=function(t,e){var n=this;return function(){n.execPreSync(t,this,arguments);var r=e.apply(this,arguments);return n.execPostSync(t,this,[r]),r}},r.prototype.wrap=function(t,e,n,r,i){const s=r.length>0?r[r.length-1]:null,u=("function"==typeof s&&r.slice(0,r.length-1),this),c=(i=i||{}).checkForPromise;this.execPre(t,n,r,function(a){if(a){const e=i.numCallbackParams||0,r=i.contextParameter?[n]:[];for(var l=r.length;l<e;++l)r.push(null);return o(u,a,t,n,r,i,s)}const h="function"==typeof s?r.length-1:r.length,p=e.length,f=e.apply(n,r.slice(0,h).concat(d));if(c){if(null!=f&&"function"==typeof f.then)return f.then(t=>d(null,t),t=>d(t));if(p<h+1)return d(null,f)}function d(){const e=Array.prototype.slice.call(arguments,1);if(i.nullResultByDefault&&0===e.length&&e.push(null),arguments[0])return o(u,arguments[0],t,n,e,i,s);u.execPost(t,n,e,function(){return arguments[0]?"function"==typeof s?s(arguments[0]):void 0:"function"==typeof s?s.apply(n,arguments):void 0})}})},r.prototype.filter=function(t){const e=this.clone(),n=Array.from(e._pres.keys());for(const r of n){const n=this._pres.get(r).map(t=>Object.assign({},t,{name:r})).filter(t);0!==n.length?(n.numAsync=n.filter(t=>t.isAsync).length,e._pres.set(r,n)):e._pres.delete(r)}const r=Array.from(e._posts.keys());for(const n of r){const r=this._posts.get(n).map(t=>Object.assign({},t,{name:n})).filter(t);0!==r.length?e._posts.set(n,r):e._posts.delete(n)}return e},r.prototype.hasHooks=function(t){return this._pres.has(t)||this._posts.has(t)},r.prototype.createWrapper=function(t,e,n,r){var o=this;return this.hasHooks(t)?function(){var i=n||this,s=Array.prototype.slice.call(arguments);o.wrap(t,e,i,s,r)}:function(){process.nextTick(()=>e.apply(this,arguments))}},r.prototype.pre=function(t,e,n,r,o){let s={};"object"==typeof e&&null!=e?e=(s=e).isAsync:"boolean"!=typeof arguments[1]&&(r=n,n=e,e=!1);const u=i(this._pres,t,[]);return this._pres.set(t,u),e&&(u.numAsync=u.numAsync||0,++u.numAsync),o?u.unshift(Object.assign({},s,{fn:n,isAsync:e})):u.push(Object.assign({},s,{fn:n,isAsync:e})),this},r.prototype.post=function(t,e,n,r){const o=i(this._posts,t,[]);return"function"==typeof e&&(r=!!n,n=e,e={}),r?o.unshift(Object.assign({},e,{fn:n})):o.push(Object.assign({},e,{fn:n})),this._posts.set(t,o),this},r.prototype.clone=function(){const t=new r;for(let e of this._pres.keys()){const n=this._pres.get(e).slice();n.numAsync=this._pres.get(e).numAsync,t._pres.set(e,n)}for(let e of this._posts.keys())t._posts.set(e,this._posts.get(e).slice());return t},r.prototype.merge=function(t,e){var n=(e=1===arguments.length||e)?this.clone():this;for(let e of t._pres.keys()){const r=i(n._pres,e,[]),o=t._pres.get(e).filter(t=>-1===r.map(t=>t.fn).indexOf(t.fn)),s=r.concat(o);s.numAsync=r.numAsync||0,s.numAsync+=o.filter(t=>t.isAsync).length,n._pres.set(e,s)}for(let e of t._posts.keys()){const r=i(n._posts,e,[]),o=t._posts.get(e).filter(t=>-1===r.indexOf(t));n._posts.set(e,r.concat(o))}return n},t.exports=r},function(t,e,n){"use strict";const r=n(173);function o(t,e,n){const o=e.schema.options.timestamps;if(!o)return;const i=t.length,s=r(o,"createdAt"),u=r(o,"updatedAt");for(let e=0;e<i;++e)null!=u&&(t[e][u]=n),null!=s&&(t[e][s]=n)}function i(t,e,n){const o=e.schema.options.timestamps;if(!o)return;const i=r(o,"createdAt"),s=r(o,"updatedAt");null!=s&&(t[s]=n),null!=i&&(t[i]=n)}t.exports=
/*!
 * ignore
 */
function(t,e,n){if(null==e)return;const s=Object.keys(e);let u,c,a,l,h;if(s.length&&"$"===s[0].charAt(0)){if(e.$push)for(u in e.$push){const o=n.path(u);e.$push[u]&&o&&o.$isMongooseDocumentArray&&o.schema.options.timestamps&&(l=o.schema.options.timestamps,c=r(l,"createdAt"),a=r(l,"updatedAt"),e.$push[u].$each?e.$push[u].$each.forEach(function(e){null!=a&&(e[a]=t),null!=c&&(e[c]=t)}):(null!=a&&(e.$push[u][a]=t),null!=c&&(e.$push[u][c]=t)))}if(null!=e.$set){const s=Object.keys(e.$set);for(u of s){const s=u.replace(/\.\$(\[[^\]]*\])?\./g,".0.").replace(/\.(\[[^\]]*\])?\$$/,".0");if(h=n.path(s))if(Array.isArray(e.$set[u])&&h.$isMongooseDocumentArray)o(e.$set[u],h,t);else if(e.$set[u]&&h.$isSingleNested)i(e.$set[u],h,t);else if(h.$parentSchema!==n&&null!=h.$parentSchema){const n=h.$parentSchema.$schemaType;if(null==n)continue;if(l=n.schema.options.timestamps,c=r(l,"createdAt"),null==(a=r(l,"updatedAt")))continue;if(n.$isSingleNested){e.$set[n.path+"."+a]=t;continue}let o=u.substr(n.path.length+1);const i=o.indexOf(".");if(-1===i)continue;o=o.substr(0,i),e.$set[n.path+"."+o+"."+a]=t}else null!=h.schema&&h.schema!=n&&(l=h.schema.options.timestamps,c=r(l,"createdAt"),null!=(a=r(l,"updatedAt"))&&(e.$set[u][a]=t),null!=c&&(e.$set[u][c]=t))}}}else{const r=Object.keys(e).filter(t=>!t.startsWith("$"));for(u of r){const r=u.replace(/\.\$(\[[^\]]*\])?\./g,".0.").replace(/\.(\[[^\]]*\])?\$$/,".0");(h=n.path(r))&&(Array.isArray(e[u])&&h.$isMongooseDocumentArray?o(e[u],h,t):null!=e[u]&&h.$isSingleNested&&i(e[u],h,t))}}}},function(t,e,n){"use strict";t.exports=
/*!
 * ignore
 */
function(t,e){if(null==t)return null;if("boolean"==typeof t)return e;if("boolean"==typeof t[e])return t[e]?e:null;if(!(e in t))return e;return t[e]}},function(t,e,n){"use strict";
/*!
 * ignore
 */const r=n(8);t.exports=
/*!
 * ignore
 */
function(t,e,n,o,i){const s=o;let u=s;const c=r(i,"overwrite",!1);if(!r(i,"timestamps",!0)||null==s)return o;if(c)return o&&o.$set&&(o=o.$set,s.$set={},u=s.$set),n&&!o[n]&&(u[n]=t),e&&!o[e]&&(u[e]=t),s;s.$set=s.$set||{},o=o||{},!n||o.$currentDate&&o.$currentDate[n]||(s.$set[n]=t);e&&(o[e]&&delete o[e],o.$set&&o.$set[e]&&delete o.$set[e],s.$setOnInsert=s.$setOnInsert||{},s.$setOnInsert[e]=t);0===Object.keys(s.$set).length&&delete s.$set;return s}},function(t,e,n){"use strict";
/*!
 * ignore
 */
/*!
 * Apply query middleware
 *
 * @param {Query} query constructor
 * @param {Model} model
 */
function r(t,e){const n={useErrorHandlers:!0,numCallbackParams:1,nullResultByDefault:!0},o=e.hooks.filter(t=>"updateOne"===t.name?null==t.query||!!t.query:"remove"!==t.name||!!t.query);t.prototype._execUpdate=o.createWrapper("update",t.prototype._execUpdate,null,n),r.middlewareFunctions.filter(t=>"update"!==t).forEach(e=>{t.prototype[`_${e}`]=o.createWrapper(e,t.prototype[`_${e}`],null,n)})}t.exports=r,
/*!
 * ignore
 */
r.middlewareFunctions=["count","countDocuments","deleteMany","deleteOne","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndRemove","findOneAndReplace","findOneAndUpdate","remove","replaceOne","update","updateMany","updateOne"]},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(19),o=r.CastError,i=n(9),s=n(177),u=n(5);let c;function a(t,e){this.enumValues=[],this.regExp=null,r.call(this,t,e,"String")}
/*!
 * ignore
 */
function l(t){return this.castForQuery(t)}a.schemaName="String",
/*!
 * Inherits from SchemaType.
 */
a.prototype=Object.create(r.prototype),a.prototype.constructor=a,
/*!
 * ignore
 */
a._cast=s,a.cast=function(t){return 0===arguments.length?this._cast:(!1===t&&(t=(t=>{if(null!=t&&"string"!=typeof t)throw new Error;return t})),this._cast=t,this._cast)},a.get=r.get,
/*!
 * ignore
 */
a._checkRequired=(t=>(t instanceof String||"string"==typeof t)&&t.length),a.checkRequired=r.checkRequired,a.prototype.enum=function(){if(this.enumValidator&&(this.validators=this.validators.filter(function(t){return t.validator!==this.enumValidator},this),this.enumValidator=!1),void 0===arguments[0]||!1===arguments[0])return this;let t,e;u.isObject(arguments[0])?(t=arguments[0].values,e=arguments[0].message):(t=arguments,e=i.messages.String.enum);for(let e=0;e<t.length;e++)void 0!==t[e]&&this.enumValues.push(this.cast(t[e]));const n=this.enumValues;return this.enumValidator=function(t){return void 0===t||~n.indexOf(t)},this.validators.push({validator:this.enumValidator,message:e,type:"enum",enumValues:n}),this},a.prototype.lowercase=function(t){return arguments.length>0&&!t?this:this.set(function(t,e){return"string"!=typeof t&&(t=e.cast(t)),t?t.toLowerCase():t})},a.prototype.uppercase=function(t){return arguments.length>0&&!t?this:this.set(function(t,e){return"string"!=typeof t&&(t=e.cast(t)),t?t.toUpperCase():t})},a.prototype.trim=function(t){return arguments.length>0&&!t?this:this.set(function(t,e){return"string"!=typeof t&&(t=e.cast(t)),t?t.trim():t})},a.prototype.minlength=function(t,e){if(this.minlengthValidator&&(this.validators=this.validators.filter(function(t){return t.validator!==this.minlengthValidator},this)),null!=t){let n=e||i.messages.String.minlength;n=n.replace(/{MINLENGTH}/,t),this.validators.push({validator:this.minlengthValidator=function(e){return null===e||e.length>=t},message:n,type:"minlength",minlength:t})}return this},a.prototype.maxlength=function(t,e){if(this.maxlengthValidator&&(this.validators=this.validators.filter(function(t){return t.validator!==this.maxlengthValidator},this)),null!=t){let n=e||i.messages.String.maxlength;n=n.replace(/{MAXLENGTH}/,t),this.validators.push({validator:this.maxlengthValidator=function(e){return null===e||e.length<=t},message:n,type:"maxlength",maxlength:t})}return this},a.prototype.match=function(t,e){const n=e||i.messages.String.match;return this.validators.push({validator:function(e){if(!t)return!1;return null==e||""===e||t.test(e)},message:n,type:"regexp",regexp:t}),this},a.prototype.checkRequired=function(t,e){return r._isRef(this,t,e,!0)?!!t:this.constructor._checkRequired(t,e)},a.prototype.cast=function(t,e,i){if(r._isRef(this,t,e,i)){if(null==t)return t;if(c||(c=n(16)),t instanceof c)return t.$__.wasPopulated=!0,t;if("string"==typeof t)return t;if(Buffer.isBuffer(t)||!u.isObject(t))throw new o("string",t,this.path);const r=e.$__fullPath(this.path),i=new((e.ownerDocument?e.ownerDocument():e).populated(r,!0).options.model)(t);return i.$__.wasPopulated=!0,i}try{return this.constructor.cast()(t)}catch(e){throw new o("string",t,this.path)}},a.prototype.$conditionalHandlers=u.options(r.prototype.$conditionalHandlers,{$all:function(t){const e=this;return Array.isArray(t)?t.map(function(t){return e.castForQuery(t)}):[this.castForQuery(t)]},$gt:l,$gte:l,$lt:l,$lte:l,$options:l,$regex:l,$not:l}),a.prototype.castForQuery=function(t,e){let n;if(2===arguments.length){if(!(n=this.$conditionalHandlers[t]))throw new Error("Can't use "+t+" with String.");return n.call(this,e)}return e=t,"[object RegExp]"===Object.prototype.toString.call(e)?e:this._castForQuery(e)},
/*!
 * Module exports.
 */
t.exports=a},function(t,e,n){"use strict";const r=n(24);
/*!
 * Given a value, cast it to a string, or throw a `CastError` if the value
 * cannot be casted. `null` and `undefined` are considered valid.
 *
 * @param {Any} value
 * @param {String} [path] optional the path to set on the CastError
 * @return {string|null|undefined}
 * @throws {CastError}
 * @api private
 */t.exports=function(t,e){if(null==t)return t;if(t._id&&"string"==typeof t._id)return t._id;if(t.toString&&t.toString!==Object.prototype.toString)return t.toString();throw new r("string",t,e)}},function(t,e,n){"use strict";const r=n(29);
/*!
 * Given a value, cast it to a number, or throw a `CastError` if the value
 * cannot be casted. `null` and `undefined` are considered valid.
 *
 * @param {Any} value
 * @param {String} [path] optional the path to set on the CastError
 * @return {Boolean|null|undefined}
 * @throws {Error} if `value` is not one of the allowed values
 * @api private
 */t.exports=function(t){return r.ok(!isNaN(t)),null==t?t:""===t?null:("string"!=typeof t&&"boolean"!=typeof t||(t=Number(t)),r.ok(!isNaN(t)),t instanceof Number?t:"number"==typeof t?t:Array.isArray(t)||"function"!=typeof t.valueOf?t.toString&&!Array.isArray(t)&&t.toString()==Number(t)?new Number(t):void r.ok(!1):Number(t.valueOf()))}},function(t,e,n){"use strict";
/*!
 * Module requirements.
 */const r=n(24);
/*!
 * ignore
 */
/*!
 * ignore
 */
function o(t,e){const n=Number(e);if(isNaN(n))throw new r("number",e,t);return n}t.exports=function(t){const e=this;return Array.isArray(t)?t.map(function(t){return o(e.path,t)}):Buffer.isBuffer(t)?t:o(e.path,t)}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(24),o=n(19),i=n(109),s=n(5);function u(t,e){o.call(this,t,e,"Boolean")}u.schemaName="Boolean",
/*!
 * Inherits from SchemaType.
 */
u.prototype=Object.create(o.prototype),u.prototype.constructor=u,
/*!
 * ignore
 */
u._cast=i,u.cast=function(t){return 0===arguments.length?this._cast:(!1===t&&(t=(t=>{if(null!=t&&"boolean"!=typeof t)throw new Error;return t})),this._cast=t,this._cast)},
/*!
 * ignore
 */
u._checkRequired=(t=>!0===t||!1===t),u.checkRequired=o.checkRequired,u.prototype.checkRequired=function(t){return this.constructor._checkRequired(t)},Object.defineProperty(u,"convertToTrue",{get:()=>i.convertToTrue,set:t=>{i.convertToTrue=t}}),Object.defineProperty(u,"convertToFalse",{get:()=>i.convertToFalse,set:t=>{i.convertToFalse=t}}),u.prototype.cast=function(t){try{return this.constructor.cast()(t)}catch(e){throw new r("Boolean",t,this.path)}},u.$conditionalHandlers=s.options(o.prototype.$conditionalHandlers,{}),u.prototype.castForQuery=function(t,e){let n;return 2===arguments.length?(n=u.$conditionalHandlers[t])?n.call(this,e):this._castForQuery(e):this._castForQuery(t)},
/*!
 * Module exports.
 */
t.exports=u},function(t,e,n){"use strict";
/*!
 * Module requirements.
 */const r=n(9),o=n(325),i=n(5),s=n(19),u=s.CastError;function c(t,e){s.call(this,t,e,"Date")}
/*!
 * Date Query casting.
 *
 * @api private
 */
function a(t){return this.cast(t)}c.schemaName="Date",
/*!
 * Inherits from SchemaType.
 */
c.prototype=Object.create(s.prototype),c.prototype.constructor=c,
/*!
 * ignore
 */
c._cast=o,c.cast=function(t){return 0===arguments.length?this._cast:(!1===t&&(t=(t=>{if(null!=t&&!(t instanceof Date))throw new Error;return t})),this._cast=t,this._cast)},c.prototype.expires=function(t){return this._index&&"Object"===this._index.constructor.name||(this._index={}),this._index.expires=t,i.expires(this._index),this},
/*!
 * ignore
 */
c._checkRequired=(t=>t instanceof Date),c.checkRequired=s.checkRequired,c.prototype.checkRequired=function(t,e){return s._isRef(this,t,e,!0)?!!t:this.constructor._checkRequired(t)},c.prototype.min=function(t,e){if(this.minValidator&&(this.validators=this.validators.filter(function(t){return t.validator!==this.minValidator},this)),t){let n=e||r.messages.Date.min;n=n.replace(/{MIN}/,t===Date.now?"Date.now()":this.cast(t).toString());const o=this;this.validators.push({validator:this.minValidator=function(e){const n=t===Date.now?t():o.cast(t);return null===e||e.valueOf()>=n.valueOf()},message:n,type:"min",min:t})}return this},c.prototype.max=function(t,e){if(this.maxValidator&&(this.validators=this.validators.filter(function(t){return t.validator!==this.maxValidator},this)),t){let n=e||r.messages.Date.max;n=n.replace(/{MAX}/,t===Date.now?"Date.now()":this.cast(t).toString());const o=this;this.validators.push({validator:this.maxValidator=function(e){const n=t===Date.now?t():o.cast(t);return null===e||e.valueOf()<=n.valueOf()},message:n,type:"max",max:t})}return this},c.prototype.cast=function(t){const e=this.constructor.cast();try{return e(t)}catch(e){throw new u("date",t,this.path)}},c.prototype.$conditionalHandlers=i.options(s.prototype.$conditionalHandlers,{$gt:a,$gte:a,$lt:a,$lte:a}),c.prototype.castForQuery=function(t,e){if(2!==arguments.length)return this._castForQuery(t);const n=this.$conditionalHandlers[t];if(!n)throw new Error("Can't use "+t+" with Date.");return n.call(this,e)},
/*!
 * Module exports.
 */
t.exports=c},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(183),o=n(19),i=n(38),s=n(5),u=o.CastError;let c;function a(t,e){const n="string"==typeof t&&24===t.length&&/^[a-f0-9]+$/i.test(t),r=e&&e.suppressWarning;!n&&void 0!==t||r||(console.warn("mongoose: To create a new ObjectId please try `Mongoose.Types.ObjectId` instead of using `Mongoose.Schema.ObjectId`. Set the `suppressWarning` option if you're trying to create a hex char path in your schema."),console.trace()),o.call(this,t,e,"ObjectID")}
/*!
 * ignore
 */
function l(t){return this.cast(t)}
/*!
 * ignore
 */
function h(){return new i}function p(t){if(c||(c=n(16)),this instanceof c){if(void 0===t){const t=new i;return this.$__._id=t,t}this.$__._id=t}return t}
/*!
 * Module exports.
 */a.schemaName="ObjectId",
/*!
 * Inherits from SchemaType.
 */
a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.get=o.get,a.prototype.auto=function(t){return t&&(this.default(h),this.set(p)),this},
/*!
 * ignore
 */
a._checkRequired=(t=>t instanceof i),
/*!
 * ignore
 */
a._cast=r,a.cast=function(t){return 0===arguments.length?this._cast:(!1===t&&(t=(t=>{if(!(t instanceof i))throw new Error;return t})),this._cast=t,this._cast)},a.checkRequired=o.checkRequired,a.prototype.checkRequired=function(t,e){return o._isRef(this,t,e,!0)?!!t:this.constructor._checkRequired(t)},a.prototype.cast=function(t,e,r){if(o._isRef(this,t,e,r)){if(null==t)return t;if(c||(c=n(16)),t instanceof c)return t.$__.wasPopulated=!0,t;if(t instanceof i)return t;if("objectid"===(t.constructor.name||"").toLowerCase())return new i(t.toHexString());if(Buffer.isBuffer(t)||!s.isObject(t))throw new u("ObjectId",t,this.path);const r=e.$__fullPath(this.path),o=(e.ownerDocument?e.ownerDocument():e).populated(r,!0);let a=t;return e.$__.populated&&e.$__.populated[r]&&e.$__.populated[r].options&&e.$__.populated[r].options.options&&e.$__.populated[r].options.options.lean||((a=new o.options.model(t)).$__.wasPopulated=!0),a}try{return this.constructor.cast()(t)}catch(e){throw new u("ObjectId",t,this.path)}},a.prototype.$conditionalHandlers=s.options(o.prototype.$conditionalHandlers,{$gt:l,$gte:l,$lt:l,$lte:l}),h.$runBeforeSetters=!0,t.exports=a},function(t,e,n){"use strict";const r=n(30).get().ObjectId,o=n(29);t.exports=function(t){if(null==t)return t;if(t instanceof r)return t;if(t._id){if(t._id instanceof r)return t._id;if(t._id.toString instanceof Function)return new r(t._id.toString())}if(t.toString instanceof Function)return new r(t.toString());o.ok(!1)}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(179),o=n(5),i=n(185),s=n(19),u=i.Binary,c=s.CastError;let a;function l(t,e){s.call(this,t,e,"Buffer")}
/*!
 * ignore
 */
function h(t){return this.castForQuery(t)}l.schemaName="Buffer",
/*!
 * Inherits from SchemaType.
 */
l.prototype=Object.create(s.prototype),l.prototype.constructor=l,
/*!
 * ignore
 */
l._checkRequired=(t=>!(!t||!t.length)),l.checkRequired=s.checkRequired,l.prototype.checkRequired=function(t,e){return s._isRef(this,t,e,!0)?!!t:this.constructor._checkRequired(t)},l.prototype.cast=function(t,e,r){let l;if(s._isRef(this,t,e,r)){if(null==t)return t;if(a||(a=n(16)),t instanceof a)return t.$__.wasPopulated=!0,t;if(Buffer.isBuffer(t))return t;if(!o.isObject(t))throw new c("buffer",t,this.path);const r=e.$__fullPath(this.path);return(l=new((e.ownerDocument?e.ownerDocument():e).populated(r,!0).options.model)(t)).$__.wasPopulated=!0,l}if(t&&t._id&&(t=t._id),t&&t.isMongooseBuffer)return t;if(Buffer.isBuffer(t))return t&&t.isMongooseBuffer||(t=new i(t,[this.path,e]),null!=this.options.subtype&&(t._subtype=this.options.subtype)),t;if(t instanceof u){if(l=new i(t.value(!0),[this.path,e]),"number"!=typeof t.sub_type)throw new c("buffer",t,this.path);return l._subtype=t.sub_type,l}if(null===t)return t;const h=typeof t;if("string"===h||"number"===h||Array.isArray(t)||"object"===h&&"Buffer"===t.type&&Array.isArray(t.data))return"number"===h&&(t=[t]),l=new i(t,[this.path,e]),null!=this.options.subtype&&(l._subtype=this.options.subtype),l;throw new c("buffer",t,this.path)},l.prototype.subtype=function(t){return this.options.subtype=t,this},l.prototype.$conditionalHandlers=o.options(s.prototype.$conditionalHandlers,{$bitsAllClear:r,$bitsAnyClear:r,$bitsAllSet:r,$bitsAnySet:r,$gt:h,$gte:h,$lt:h,$lte:h}),l.prototype.castForQuery=function(t,e){let n;if(2===arguments.length){if(!(n=this.$conditionalHandlers[t]))throw new Error("Can't use "+t+" with Buffer.");return n.call(this,e)}e=t;const r=this._castForQuery(e);return r?r.toObject({transform:!1,virtuals:!1}):r},
/*!
 * Module exports.
 */
t.exports=l},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(30).get().Binary,o=n(5),i=n(14).Buffer,s=i.from("").constructor.prototype;function u(t,e,n){let r,s,c,a,l;return r=0===arguments.length||null===arguments[0]||void 0===arguments[0]?0:t,Array.isArray(e)?(c=e[0],a=e[1]):s=e,l="number"==typeof r||r instanceof Number?i.alloc(r):i.from(r,s,n),o.decorate(l,u.mixin),l.isMongooseBuffer=!0,Object.defineProperties(l,{validators:{value:[],enumerable:!1},_path:{value:c,enumerable:!1},_parent:{value:a,enumerable:!1}}),a&&"string"==typeof c&&Object.defineProperty(l,"_schema",{value:a.schema.path(c)}),l._subtype=0,l}
/*!
 * Inherit from Buffer.
 */u.mixin={_parent:void 0,_subtype:void 0,_markModified:function(){const t=this._parent;return t&&t.markModified(this._path),this},write:function(){const t=s.write.apply(this,arguments);return t>0&&this._markModified(),t},copy:function(t){const e=s.copy.apply(this,arguments);return t&&t.isMongooseBuffer&&t._markModified(),e}},
/*!
 * Compile other Buffer methods marking this buffer as modified.
 */
"writeUInt8 writeUInt16 writeUInt32 writeInt8 writeInt16 writeInt32 writeFloat writeDouble fill utf8Write binaryWrite asciiWrite set writeUInt16LE writeUInt16BE writeUInt32LE writeUInt32BE writeInt16LE writeInt16BE writeInt32LE writeInt32BE writeFloatLE writeFloatBE writeDoubleLE writeDoubleBE".split(" ").forEach(function(t){s[t]&&(u.mixin[t]=function(){const e=s[t].apply(this,arguments);return this._markModified(),e})}),u.mixin.toObject=function(t){const e="number"==typeof t?t:this._subtype||0;return new r(this,e)},u.mixin.toBSON=function(){return new r(this,this._subtype||0)},u.mixin.equals=function(t){if(!i.isBuffer(t))return!1;if(this.length!==t.length)return!1;for(let e=0;e<this.length;++e)if(this[e]!==t[e])return!1;return!0},u.mixin.subtype=function(t){if("number"!=typeof t)throw new TypeError("Invalid subtype. Expected a number");this._subtype!==t&&this._markModified(),this._subtype=t},
/*!
 * Module exports.
 */
u.Binary=r,t.exports=u},function(t,e,n){"use strict";
/*!
 * ignore
 */const r=n(117),o=n(19);t.exports=
/*!
 * ignore
 */
class extends o{constructor(t,e){super(t,e,"Map"),this.$isSchemaMap=!0}cast(t,e,n){if(t instanceof r)return t;if(n){const n=new r({},this.path,e,this.$__schemaType);for(const r of Object.keys(t))n.$init(r,this.$__schemaType.cast(t[r],e,!0));return n}return new r(t,this.path,e,this.$__schemaType)}}},function(t,e,n){"use strict";
/*!
 * Module requirements.
 */const r=n(89).castArraysOfNumbers,o=n(89).castToNumber;function i(t,e){switch(t.$geometry.type){case"Polygon":case"LineString":case"Point":r(t.$geometry.coordinates,e)}return s(e,t),t}function s(t,e){e.$maxDistance&&(e.$maxDistance=o.call(t,e.$maxDistance)),e.$minDistance&&(e.$minDistance=o.call(t,e.$minDistance))}
/*!
 * ignore
 */
e.cast$geoIntersects=function(t){if(!t.$geometry)return;return i(t,this),t},e.cast$near=function(t){const e=n(116);if(Array.isArray(t))return r(t,this),t;if(s(this,t),t&&t.$geometry)return i(t,this);return e.prototype.castForQuery.call(this,t)},e.cast$within=function(t){if(s(this,t),t.$box||t.$polygon){const e=t.$box?"$box":"$polygon";t[e].forEach(t=>{if(!Array.isArray(t)){const e="Invalid $within $box argument. Expected an array, received "+t;throw new TypeError(e)}t.forEach((e,n)=>{t[n]=o.call(this,e)})})}else if(t.$center||t.$centerSphere){const e=t.$center?"$center":"$centerSphere";t[e].forEach((n,r)=>{Array.isArray(n)?n.forEach((t,e)=>{n[e]=o.call(this,t)}):t[e][r]=o.call(this,n)})}else t.$geometry&&i(t,this);return t}},function(t,e,n){"use strict";const r=n(16),o=n(55),i=n(39).internalToObjectOptions,s=n(5),u=n(23).documentArrayParent;function c(t,e,n,o,i){this.$isSingleNested=!0,null!=n&&(i=Object.assign({},i,{isNew:n.isNew})),r.call(this,t,e,o,i),delete this.$__.$options.priorDoc}t.exports=c,c.prototype=Object.create(r.prototype),c.prototype.toBSON=function(){return this.toObject(i)},c.prototype.save=function(t,e){return"function"==typeof t&&(e=t,t={}),(t=t||{}).suppressWarning||console.warn("mongoose: calling `save()` on a subdoc does **not** save the document to MongoDB, it only runs save middleware. Use `subdoc.save({ suppressWarning: true })` to hide this warning if you're sure this behavior is right for your app."),s.promiseOrCallback(e,t=>{this.$__save(t)})},c.prototype.$__save=function(t){return o(()=>t(null,this))},c.prototype.$isValid=function(t){return this.$parent&&this.$basePath?this.$parent.$isValid([this.$basePath,t].join(".")):r.prototype.$isValid.call(this,t)},c.prototype.markModified=function(t){if(r.prototype.markModified.call(this,t),this.$parent&&this.$basePath){if(this.$parent.isDirectModified(this.$basePath))return;this.$parent.markModified([this.$basePath,t].join("."),this)}},c.prototype.$markValid=function(t){r.prototype.$markValid.call(this,t),this.$parent&&this.$basePath&&this.$parent.$markValid([this.$basePath,t].join("."))},
/*!
 * ignore
 */
c.prototype.invalidate=function(t,e,n){if(e!==this.ownerDocument().$__.validationError&&r.prototype.invalidate.call(this,t,e,n),this.$parent&&this.$basePath)this.$parent.invalidate([this.$basePath,t].join("."),e,n);else if("cast"===e.kind||"CastError"===e.name)throw e},
/*!
 * ignore
 */
c.prototype.$ignore=function(t){r.prototype.$ignore.call(this,t),this.$parent&&this.$basePath&&this.$parent.$ignore([this.$basePath,t].join("."))},c.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;let t=this.$parent;if(!t)return this;for(;t.$parent||t[u];)t=t.$parent||t[u];return this.$__.ownerDocument=t,this.$__.ownerDocument},c.prototype.parent=function(){return this.$parent},
/*!
 * no-op for hooks
 */
c.prototype.$__remove=function(t){return t(null,this)},c.prototype.remove=function(t,e){"function"==typeof t&&(e=t,t=null),
/*!
 * Registers remove event listeners for triggering
 * on subdocuments.
 *
 * @param {EmbeddedDocument} sub
 * @api private
 */
function(t){let e=t.ownerDocument();function n(){e.removeListener("save",n),e.removeListener("remove",n),t.emit("remove",t),t.constructor.emit("remove",t),e=t=null}e.on("save",n),e.on("remove",n)}(this),t&&t.noop||this.$parent.set(this.$basePath,null),"function"==typeof e&&e(null)},
/*!
 * ignore
 */
c.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.nested.populate("path")`, use `doc.populate("nested.path")`')}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(334),o=n(5);t.exports=function(t,e,n,i){const s=n.parallel||1,u=function(n){let o=!1;const i=r.queue(function(e,n){if(o)return n();t(function(t,e){if(t)return n(t);e||(o=!0),n(null,e)})},1),u=function(t){i.push({},function(n,r){return n?t(n):r?void function(t,n){const r=e(t);r&&"function"==typeof r.then?r.then(function(){n(null)},function(t){n(t||new Error("`eachAsync()` promise rejected without error"))}):n(null)}(r,function(e){if(e)return t(e);setTimeout(function(){u(t)},0)}):t()})};r.times(s,function(t,e){u(e)},n)};return o.promiseOrCallback(i,t=>{u(t)})}},function(t,e,n){"use strict";const r=n(8);t.exports=function(t,e){const n=r(t,"options.writeConcern",{});"w"in e||null==n.w||(e.w=n.w),"j"in e||null==n.j||(e.j=n.j),"wtimeout"in e||null==n.wtimeout||(e.wtimeout=n.wtimeout)}},function(t,e,n){"use strict";const r=n(57).modifiedPaths;t.exports=function(t){const e=Object.keys(t),n={},o={};for(const i of e)i.startsWith("$")?r(t[i],"",n):o[i]=t[i];return r(o,"",n),n}},function(t,e,n){"use strict";const r=n(24),o=n(110),i=n(107),s=n(178),u=n(337),c=n(5);
/*!
 * Walk each path of obj and cast its values
 * according to its schema.
 *
 * @param {Schema} schema
 * @param {Object} obj - part of a query
 * @param {String} op - the atomic operator ($pull, $set, etc)
 * @param {Object} options
 * @param {Boolean|String} [options.strict]
 * @param {Boolean} [options.omitUndefined]
 * @param {Query} context
 * @param {String} pref - path prefix (internal only)
 * @return {Bool} true if this path has keys to update
 * @api private
 */
function a(t,e,n,r,i,s,h){const p=r.strict,d=h?h+".":"",g=Object.keys(e);let y,_,v,w,b=g.length,O=!1,S=null;for(w=void 0===r.useNestedStrict?t.options.useNestedStrict:r.useNestedStrict;b--;)if((v=e[_=g[b]])&&"Object"===v.constructor.name)if((y=t._getSchema(d+_))&&y.caster&&n in f)if("$each"in v){O=!0;try{e[_]={$each:m(y,v.$each,n,_,i,d+_)}}catch(t){S=l(t,i,_,S)}null!=v.$slice&&(e[_].$slice=0|v.$slice),v.$sort&&(e[_].$sort=v.$sort),(v.$position||0===v.$position)&&(e[_].$position=v.$position)}else{try{e[_]=m(y,v,n,_,i,d+_)}catch(t){S=l(t,i,_,S)}if(r.omitUndefined&&void 0===e[_]){delete e[_];continue}O=!0}else if("$currentDate"===n||n in f&&y){try{e[_]=m(y,v,n,_,i,d+_)}catch(t){S=l(t,i,_,S)}if(r.omitUndefined&&void 0===e[_]){delete e[_];continue}O=!0}else{const u=d+_,l=t._getPathType(u);let h=p;if(w&&l&&l.schema&&"strict"in l.schema.options&&(h=l.schema.options.strict),"undefined"===l.pathType){if("throw"===h)throw new o(u);if(h){delete e[_];continue}}O|=a(t,v,n,r,i,s,d+_)||c.isObject(v)&&0===Object.keys(v).length}else{const c="$each"===_||"$or"===_||"$and"===_||"$in"===_?h:d+_;y=t._getSchema(c);let a=t._getPathType(c);if(null==y){const n=u(t,e,s,c);null!=n.schematype&&(y=n.schematype,a=n.type)}let f=p;if(w&&a&&a.schema&&"strict"in a.schema.options&&(f=a.schema.options.strict),f&&!y&&!/real|nested/.test(a.pathType)){if("throw"===f&&null==t.virtuals[c])throw new o(d+_);delete e[_]}else{if("$rename"===n){O=!0;continue}try{e[_]=m(y,v,n,_,i,d+_)}catch(t){S=l(t,i,_,S)}if(!Array.isArray(e[_])||"$addToSet"!==n&&"$push"!==n||"$each"===_||y&&y.caster&&!y.caster.$isMongooseArray&&(e[_]={$each:e[_]}),r.omitUndefined&&void 0===e[_]){delete e[_];continue}O=!0}}if(null!=S)throw S;return O}
/*!
 * ignore
 */function l(t,e,n,r){if("object"!=typeof e||!e.options.multipleCastError)throw t;return(r=r||new i).addError(n,t),r}
/*!
 * These operators should be cast to numbers instead
 * of their path schema type.
 */
/*!
 * Casts an update op based on the given schema
 *
 * @param {Schema} schema
 * @param {Object} obj
 * @param {Object} options
 * @param {Boolean} [options.overwrite] defaults to false
 * @param {Boolean|String} [options.strict] defaults to true
 * @param {Query} context passed to setters
 * @return {Boolean} true iff the update is non-empty
 */
t.exports=function(t,e,n,r,o){if(!e)return;const i=Object.keys(e);let s=i.length;const u={};let c,l,h=!1;const p=n.overwrite;for(o=o||{};s--;){const t=i[s];"$"===t[0]||p?"$set"===t&&u.$set||(u[t]=e[t]):(u.$set||(e.$set?u.$set=e.$set:u.$set={}),u.$set[t]=e[t],i.splice(s,1),~i.indexOf("$set")||i.push("$set"))}for(s=i.length,p&&(c=!0);s--;){const e=i[s];if(l=u[e],h=h||"$"===e.charAt(0),!l||"object"!=typeof l||Buffer.isBuffer(l)||p&&!h){if(!p||!u||"object"!=typeof u){throw new Error("Invalid atomic update value for "+e+". Expected an object, received "+typeof l)}a(t,u,"$set",n,r,o)}else c|=a(t,l,e,n,r,o)}return c&&u};const h={$pop:1,$inc:1},p={$unset:1},f={$push:1,$addToSet:1,$set:1,$setOnInsert:1},d={$set:1,$setOnInsert:1};
/*!
 * These ops require no casting because the RHS doesn't do anything.
 */
/*!
 * Casts `val` according to `schema` and atomic `op`.
 *
 * @param {SchemaType} schema
 * @param {Object} val
 * @param {String} op - the atomic operator ($pull, $set, etc)
 * @param {String} $conditional
 * @param {Query} context
 * @api private
 */
function m(t,e,n,o,i,u){if(!t){if(n in h)try{return s(e)}catch(t){throw new r("number",e,u)}return e}const a=t.caster&&n in f&&(c.isObject(e)||Array.isArray(e));if(a&&"$set"!==n){const n=t.cast(e);return e=Array.isArray(e)?n:Array.isArray(n)?n[0]:n}if(a&&"$set"===n)return t.cast(e);if(n in p)return e;if(n in h){if(null==e)throw new r("number",e,t.path);if("$inc"===n)return t.castForQueryWrapper({val:e,context:i});try{return s(e)}catch(n){throw new r("number",e,t.path)}}return"$currentDate"===n?"object"==typeof e?{$type:e.$type}:Boolean(e):/^\$/.test(o)?t.castForQueryWrapper({$conditional:o,val:e,context:i}):d[n]?t.castForQueryWrapper({val:e,context:i,$skipQueryCastForUpdate:null!=e&&t.$isMongooseArray&&t.$parentSchema}):t.castForQueryWrapper({val:e,context:i})}},function(t,e,n){"use strict";const r=n(57).modifiedPaths;function o(t,e){if(t[e])return!0;const n=e.split(".");let r=n[0];for(let e=1;e<n.length;++e){if(t[r])return!0;r+="."+n[e]}return!1}t.exports=function(t,e,n,i){const s=Object.keys(n||{}),u={},c={},a=s.length,l={};let h=!1;if(!(i=i||{}).upsert||!i.setDefaultsOnInsert)return n;for(let t=0;t<a;++t)"$"===s[t].charAt(0)&&(r(n[s[t]],"",l),h=!0);h||r(n,"",l);const p=Object.keys(t),f=p.length;for(let e=0;e<f;++e){const n=p[e],r=t[n];if(r&&"object"==typeof r){const t=Object.keys(r),e=t.length;let n=!1;for(let r=0;r<e;++r)if("$"===t[r].charAt(0)){n=!0;break}if(n)continue}u[n]=!0,l[n]=!0}return i&&i.overwrite&&!h?n:(e.eachPath(function(t,e){if(e.$isSingleNested)e.schema.eachPath(function(e,r){if("_id"===e&&r.auto)return;const i=r.getDefault(null,!0);o(l,t+"."+e)||void 0===i||((n=n||{}).$setOnInsert=n.$setOnInsert||{},n.$setOnInsert[t+"."+e]=i,c[t+"."+e]=i)});else{const r=e.getDefault(null,!0);o(l,t)||void 0===r||((n=n||{}).$setOnInsert=n.$setOnInsert||{},n.$setOnInsert[t]=r,c[t]=r)}}),n)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){(0,o.default)(r.default,t,e)};var r=i(n(195)),o=i(n(205));function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){((0,r.default)(t)?p:f)(t,(0,l.default)(e),n)};var r=h(n(90)),o=h(n(201)),i=h(n(346)),s=h(n(369)),u=h(n(123)),c=h(n(203)),a=h(n(204)),l=h(n(91));function h(t){return t&&t.__esModule?t:{default:t}}function p(t,e,n){n=(0,c.default)(n||u.default);var r=0,i=0,s=t.length;function l(t,e){t?n(t):++i!==s&&e!==o.default||n(null)}for(0===s&&n(null);r<s;r++)e(t[r],r,(0,a.default)(l))}var f=(0,s.default)(i.default,1/0);t.exports=e.default},function(t,e,n){var r=n(197).Symbol;t.exports=r},function(t,e,n){var r=n(198),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();t.exports=i},function(t,e){var n="object"==typeof global&&global&&global.Object===Object&&global;t.exports=n},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e){var n=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(e,n,c){if(c=(0,o.default)(c||r.default),t<=0||!e)return c(null);var a=(0,i.default)(e),l=!1,h=0,p=!1;function f(t,e){if(h-=1,t)l=!0,c(t);else{if(e===u.default||l&&h<=0)return l=!0,c(null);p||d()}}function d(){for(p=!0;h<t&&!l;){var e=a();if(null===e)return l=!0,void(h<=0&&c(null));h+=1,n(e.value,e.key,(0,s.default)(f))}p=!1}d()}};var r=c(n(123)),o=c(n(203)),i=c(n(347)),s=c(n(204)),u=c(n(201));function c(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){if(null!==t){var e=t;t=null,e.apply(this,arguments)}}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){n=n||r.default;var u=(0,o.default)(e)?[]:{};t(e,function(t,e,n){(0,s.default)(t)(function(t,r){arguments.length>2&&(r=(0,i.default)(arguments,1)),u[e]=r,n(t)})},function(t){n(t,u)})};var r=u(n(123)),o=u(n(90)),i=u(n(125)),s=u(n(91));function u(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e,n){"use strict";
/*!
 * Module dependencies
 */const r=n(372),o=n(121),i=n(0),s=n(5),u=o.prototype.read,c=o.prototype.readConcern;function a(t){this._pipeline=[],this._model=void 0,this.options={},1===arguments.length&&i.isArray(t)&&this.append.apply(this,t)}
/*!
 * Helpers
 */
function l(t){if("object"!=typeof t)return!1;const e=Object.keys(t);return 1===e.length&&e.some(t=>"$"===t[0])}
/*!
 * Adds the appropriate `$match` pipeline step to the top of an aggregate's
 * pipeline, should it's model is a non-root discriminator type. This is
 * analogous to the `prepareDiscriminatorCriteria` function in `lib/query.js`.
 *
 * @param {Aggregate} aggregate Aggregate to prepare
 */function h(t){const e=t._model.schema,n=e&&e.discriminatorMapping;if(n&&!n.isRoot){const e=t._pipeline,r=n.key,o=n.value;if(e[0]&&e[0].$match&&!e[0].$match[r])e[0].$match[r]=o;else if(e[0]&&e[0].$geoNear)e[0].$geoNear.query=e[0].$geoNear.query||{},e[0].$geoNear.query[r]=o;else{const e={};e[r]=o,t._pipeline.unshift({$match:e})}}}
/*!
 * Exports
 */a.prototype.options,a.prototype.model=function(t){return this._model=t,null!=t.schema&&(null==this.options.readPreference&&null!=t.schema.options.read&&(this.options.readPreference=t.schema.options.read),null==this.options.collation&&null!=t.schema.options.collation&&(this.options.collation=t.schema.options.collation)),this},a.prototype.append=function(){const t=1===arguments.length&&i.isArray(arguments[0])?arguments[0]:s.args(arguments);if(!t.every(l))throw new Error("Arguments must be aggregate pipeline operators");return this._pipeline=this._pipeline.concat(t),this},a.prototype.addFields=function(t){const e={};if("object"!=typeof t||i.isArray(t))throw new Error("Invalid addFields() argument. Must be an object");return Object.keys(t).forEach(function(n){e[n]=t[n]}),this.append({$addFields:e})},a.prototype.project=function(t){const e={};if("object"!=typeof t||i.isArray(t)){if(1!==arguments.length||"string"!=typeof t)throw new Error("Invalid project() argument. Must be string or object");t.split(/\s+/).forEach(function(t){if(!t)return;const n="-"===t[0]?0:1;0===n&&(t=t.substring(1)),e[t]=n})}else Object.keys(t).forEach(function(n){e[n]=t[n]});return this.append({$project:e})},a.prototype.near=function(t){const e={};return e.$geoNear=t,this.append(e)},
/*!
 * define methods
 */
"group match skip limit out".split(" ").forEach(function(t){a.prototype[t]=function(e){const n={};return n["$"+t]=e,this.append(n)}}),a.prototype.unwind=function(){const t=s.args(arguments),e=[];for(let n=0;n<t.length;++n){const r=t[n];if(r&&"object"==typeof r)e.push({$unwind:r});else{if("string"!=typeof r)throw new Error('Invalid arg "'+r+'" to unwind(), must be string or object');e.push({$unwind:r&&"$"===r.charAt(0)?r:"$"+r})}}return this.append.apply(this,e)},a.prototype.replaceRoot=function(t){let e;return e="string"==typeof t?t.startsWith("$")?t:"$"+t:t,this.append({$replaceRoot:{newRoot:e}})},a.prototype.count=function(t){return this.append({$count:t})},a.prototype.sortByCount=function(t){if(t&&"object"==typeof t)return this.append({$sortByCount:t});if("string"==typeof t)return this.append({$sortByCount:t&&"$"===t.charAt(0)?t:"$"+t});throw new TypeError('Invalid arg "'+t+'" to sortByCount(), must be string or object')},a.prototype.lookup=function(t){return this.append({$lookup:t})},a.prototype.graphLookup=function(t){const e={};if(t){if(!s.isObject(t))throw new TypeError("Invalid graphLookup() argument. Must be an object.");s.mergeClone(e,t);const n=e.startWith;n&&"string"==typeof n&&(e.startWith="$"===e.startWith.charAt(0)?e.startWith:"$"+e.startWith)}return this.append({$graphLookup:e})},a.prototype.sample=function(t){return this.append({$sample:{size:t}})},a.prototype.sort=function(t){const e={};if("Object"===t.constructor.name){const n=["desc","descending",-1];Object.keys(t).forEach(function(r){t[r]instanceof Object&&t[r].$meta?e[r]=t[r]:e[r]=-1===n.indexOf(t[r])?1:-1})}else{if(1!==arguments.length||"string"!=typeof t)throw new TypeError("Invalid sort() argument. Must be a string or object.");t.split(/\s+/).forEach(function(t){if(!t)return;const n="-"===t[0]?-1:1;-1===n&&(t=t.substring(1)),e[t]=n})}return this.append({$sort:e})},a.prototype.read=function(t,e){return this.options||(this.options={}),u.call(this,t,e),this},a.prototype.readConcern=function(t){return this.options||(this.options={}),c.call(this,t),this},a.prototype.redact=function(t,e,n){if(3===arguments.length){if("string"==typeof e&&!e.startsWith("$$")||"string"==typeof n&&!n.startsWith("$$"))throw new Error("If thenExpr or elseExpr is string, it must start with $$. e.g. $$DESCEND, $$PRUNE, $$KEEP");t={$cond:{if:t,then:e,else:n}}}else if(1!==arguments.length)throw new TypeError("Invalid arguments");return this.append({$redact:t})},a.prototype.explain=function(t){return s.promiseOrCallback(t,t=>{if(!this._pipeline.length){const e=new Error("Aggregate has empty pipeline");return t(e)}h(this),this._model.collection.aggregate(this._pipeline,this.options||{}).explain(function(e,n){if(e)return t(e);t(null,n)})},this._model.events)},a.prototype.allowDiskUse=function(t){return this.options.allowDiskUse=t,this},a.prototype.hint=function(t){return this.options.hint=t,this},a.prototype.session=function(t){return null==t?delete this.options.session:this.options.session=t,this},a.prototype.option=function(t){for(const e in t)this.options[e]=t[e];return this},a.prototype.cursor=function(t){return this.options||(this.options={}),this.options.cursor=t||{},this},a.prototype.addCursorFlag=i.deprecate(function(t,e){return this.options||(this.options={}),this.options[t]=e,this},"Mongoose: `Aggregate#addCursorFlag()` is deprecated, use `option()` instead"),a.prototype.collation=function(t){return this.options||(this.options={}),this.options.collation=t,this},a.prototype.facet=function(t){return this.append({$facet:t})},a.prototype.pipeline=function(){return this._pipeline},a.prototype.exec=function(t){if(!this._model)throw new Error("Aggregate not bound to any Model");const e=this._model,n=s.clone(this.options||{}),o=this._pipeline,i=this._model.collection;return n&&n.cursor?new r(this):s.promiseOrCallback(t,t=>{if(!o.length){const e=new Error("Aggregate has empty pipeline");return t(e)}h(this),e.hooks.execPre("aggregate",this,r=>{if(r){const n={error:r};return e.hooks.execPost("aggregate",this,[null],n,e=>{t(e)})}i.aggregate(o,n,(n,r)=>{if(n){const r={error:n};return e.hooks.execPost("aggregate",this,[null],r,e=>t(e||null))}r.toArray((n,r)=>{const o={error:n};e.hooks.execPost("aggregate",this,[r],o,(e,n)=>{if(e)return t(e);t(null,n)})})})})},e.events)},a.prototype.then=function(t,e){return this.exec().then(t,e)},a.prototype.catch=function(t){return this.exec().then(null,t)},null!=Symbol.asyncIterator&&(a.prototype[Symbol.asyncIterator]=function(){return this.cursor({useMongooseAggCursor:!0}).exec().transformNull().map(t=>null==t?{done:!0}:{value:t,done:!1})}),a._prepareDiscriminatorPipeline=h,t.exports=a},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=new WeakMap},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){(0,r.default)(t,(0,o.default)((0,i.default)(e)),n)};var r=s(n(195)),o=s(n(388)),i=s(n(91));function s(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(10).EventEmitter,o=n(88),i=n(30).get().Collection,s=n(81),u=n(9),c=n(84),a=n(8),l=n(37),h=n(5),p=n(2).parseConnectionString,f=["MONGODB-X509"];function d(t){this.base=t,this.collections={},this.models={},this.config={autoIndex:!0},this.replica=!1,this.options=null,this.otherDbs=[],this.relatedDbs={},this.states=s,this._readyState=s.disconnected,this._closeCalled=!1,this._hasOpened=!1,this.$internalEmitter=new r,this.$internalEmitter.setMaxListeners(0)}
/*!
 * Inherit from EventEmitter
 */
/*!
 * ignore
 */
function m(t){return function(){const e=arguments.length>0?arguments[arguments.length-1]:null,n="function"==typeof e?Array.prototype.slice.call(arguments,0,arguments.length-1):Array.prototype.slice.call(arguments);return h.promiseOrCallback(e,e=>{this.readyState!==s.connected?this.once("open",function(){t.apply(this,n.concat([e]))}):t.apply(this,n.concat([e]))})}}d.prototype.__proto__=r.prototype,Object.defineProperty(d.prototype,"readyState",{get:function(){return this._readyState},set:function(t){if(!(t in s))throw new Error("Invalid connection state: "+t);if(this._readyState!==t){this._readyState=t;for(let e=0;e<this.otherDbs.length;e++)this.otherDbs[e].readyState=t;for(const e in this.relatedDbs)this.relatedDbs[e].readyState=t;s.connected===t&&(this._hasOpened=!0),this.emit(s[t])}}}),d.prototype.collections,d.prototype.name,Object.defineProperty(d.prototype,"host",{configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(d.prototype,"port",{configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(d.prototype,"user",{configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(d.prototype,"pass",{configurable:!0,enumerable:!0,writable:!0}),d.prototype.db,d.prototype.config,d.prototype.createCollection=m(function(t,e,n){"function"==typeof e&&(n=e,e={}),this.db.createCollection(t,e,n)}),d.prototype.startSession=m(function(t,e){"function"==typeof t&&(e=t,t=null),e(null,this.client.startSession(t))}),d.prototype.dropCollection=m(function(t,e){this.db.dropCollection(t,e)}),d.prototype.dropDatabase=m(function(t){this.$internalEmitter.emit("dropDatabase"),this.db.dropDatabase(t)}),d.prototype.error=function(t,e){return e?(e(t),null):(this.listeners("error").length>0&&this.emit("error",t),Promise.reject(t))},d.prototype.onOpen=function(){this.readyState=s.connected;for(const t in this.collections)h.object.hasOwnProperty(this.collections,t)&&this.collections[t].onOpen();this.emit("open")},d.prototype.openUri=function(t,e,n){if(this.readyState=s.connecting,this._closeCalled=!1,"function"==typeof e&&(n=e,e=null),-1!==["string","number"].indexOf(typeof e))throw new u("Mongoose 5.x no longer supports `mongoose.connect(host, dbname, port)` or `mongoose.createConnection(host, dbname, port)`. See http://mongoosejs.com/docs/connections.html for supported connection syntax");if("string"!=typeof t)throw new u("The `uri` parameter to `openUri()` must be a "+`string, got "${typeof t}". Make sure the first parameter to `+"`mongoose.connect()` or `mongoose.createConnection()` is a string.");const r=c.get(),o=this;if(e){const t=(e=h.clone(e)).config&&null!=e.config.autoIndex?e.config.autoIndex:e.autoIndex;null!=t&&(this.config.autoIndex=!1!==t,delete e.config,delete e.autoIndex),"autoCreate"in e&&(this.config.autoCreate=!!e.autoCreate,delete e.autoCreate),"useCreateIndex"in e&&(this.config.useCreateIndex=!!e.useCreateIndex,delete e.useCreateIndex),"useFindAndModify"in e&&(this.config.useFindAndModify=!!e.useFindAndModify,delete e.useFindAndModify),(e.user||e.pass)&&(e.auth=e.auth||{},e.auth.user=e.user,e.auth.password=e.pass,this.user=e.user,this.pass=e.pass),delete e.user,delete e.pass,null!=e.bufferCommands&&(e.bufferMaxEntries=0,this.config.bufferCommands=e.bufferCommands,delete e.bufferCommands),null!=e.useMongoClient&&g(e)}else e={};this._connectionOptions=e;const i=e.dbName;null!=i&&(this.$dbName=i),delete e.dbName,"promiseLibrary"in e||(e.promiseLibrary=c.get()),"useNewUrlParser"in e||("useNewUrlParser"in this.base.options?e.useNewUrlParser=this.base.options.useNewUrlParser:e.useNewUrlParser=!1);const f=new r((n,r)=>{p(t,e,(t,e)=>{if(t)return r(t);this.name=null!=i?i:a(e,"auth.db",null),this.host=a(e,"hosts.0.host","localhost"),this.port=a(e,"hosts.0.port",27017),this.user=this.user||a(e,"auth.username"),this.pass=this.pass||a(e,"auth.password"),n()})}),d=new r((n,r)=>{const u=new l.MongoClient(t,e);o.client=u,u.connect(function(t){if(t)return o.readyState=s.disconnected,r(t);const e=null!=i?u.db(i):u.db();o.db=e,e.on("reconnect",function(){o.readyState=s.connected,o.emit("reconnect"),o.emit("reconnected")}),e.s.topology.on("reconnectFailed",function(){o.emit("reconnectFailed")}),e.s.topology.on("left",function(t){o.emit("left",t)}),e.s.topology.on("joined",function(t){o.emit("joined",t)}),e.s.topology.on("fullsetup",function(t){o.emit("fullsetup",t)}),e.on("close",function(){o.readyState=s.disconnected}),u.on("left",function(){o.readyState===s.connected&&"ReplicaSetNoPrimary"===a(e,"s.topology.s.coreTopology.s.replicaSetState.topologyType")&&(o.readyState=s.disconnected)}),e.on("timeout",function(){o.emit("timeout")}),delete o.then,delete o.catch,o.readyState=s.connected;for(const t in o.collections)h.object.hasOwnProperty(o.collections,t)&&o.collections[t].onOpen();n(o),o.emit("open")})});return this.$initialConnection=r.all([d,f]).then(t=>t[0]).catch(t=>{if(!(this.listeners("error").length>0))throw t;process.nextTick(()=>this.emit("error",t))}),this.then=function(t,e){return this.$initialConnection.then(t,e)},this.catch=function(t){return this.$initialConnection.catch(t)},null!=n&&(this.$initialConnection=this.$initialConnection.then(()=>n(null,this),t=>n(t))),this};
/*!
 * ignore
 */
const g=function(t){console.warn("WARNING: The `useMongoClient` option is no longer necessary in mongoose 5.x, please remove it.");const e=(new Error).stack;console.warn(e.substr(e.indexOf("\n")+1)),delete t.useMongoClient};d.prototype.close=function(t,e){return"function"==typeof t&&(e=t,t=!1),this.$wasForceClosed=!!t,h.promiseOrCallback(e,e=>{this._close(t,e)})},d.prototype._close=function(t,e){const n=this;switch(this._closeCalled=!0,this.readyState){case 0:e();break;case 1:this.readyState=s.disconnecting,this.doClose(t,function(r){if(r)return e(r);n.onClose(t),e(null)});break;case 2:this.once("open",function(){n.close(e)});break;case 3:this.once("close",function(){e()})}return this},d.prototype.onClose=function(t){this.readyState=s.disconnected;for(const e in this.collections)h.object.hasOwnProperty(this.collections,e)&&this.collections[e].onClose(t);this.emit("close",t)},d.prototype.collection=function(t,e){return(e=e?h.clone(e):{}).$wasForceClosed=this.$wasForceClosed,t in this.collections||(this.collections[t]=new i(t,this,e)),this.collections[t]},d.prototype.model=function(t,e,n){if(!(this instanceof d))throw new u("`connection.model()` should not be run with `new`. If you are doing `new db.model(foo)(bar)`, use `db.model(foo)(bar)` instead");let r;if("function"==typeof t&&(t=(r=t).name),"string"==typeof e&&(n=e,e=!1),h.isObject(e)&&!e.instanceOfSchema&&(e=new o(e)),e&&!e.instanceOfSchema)throw new Error("The 2nd parameter to `mongoose.model()` should be a schema or a POJO");if(this.models[t]&&!n){if(e&&e.instanceOfSchema&&e!==this.models[t].schema)throw new u.OverwriteModelError(t);return this.models[t]}const i={cache:!1,connection:this};let s;if(e&&e.instanceOfSchema)return s=this.base.model(r||t,e,n,i),this.models[t]||(this.models[t]=s),s.init(function(){}),s;if(this.models[t]&&n){return e=(s=this.models[t]).prototype.schema,s.__subclass(this,e,n)}if(!(s=this.base.models[t]))throw new u.MissingSchemaError(t);return this!==s.prototype.db||n&&n!==s.collection.name?(this.models[t]=s.__subclass(this,e,n),this.models[t]):(this.models[t]||(this.models[t]=s),s)},d.prototype.deleteModel=function(t){if("string"==typeof t){const e=this.model(t);if(null==e)return this;delete this.models[t],delete this.collections[e.collection.name],delete this.base.modelSchemas[t]}else{if(!(t instanceof RegExp))throw new Error('First parameter to `deleteModel()` must be a string or regexp, got "'+t+'"');{const e=t,n=this.modelNames();for(const t of n)e.test(t)&&this.deleteModel(t)}}return this},d.prototype.modelNames=function(){return Object.keys(this.models)},d.prototype.shouldAuthenticate=function(){return null!=this.user&&(null!=this.pass||this.authMechanismDoesNotRequirePassword())},d.prototype.authMechanismDoesNotRequirePassword=function(){return!this.options||!this.options.auth||f.indexOf(this.options.auth.authMechanism)>=0},d.prototype.optionsProvideAuthenticationData=function(t){return t&&t.user&&(t.pass||this.authMechanismDoesNotRequirePassword())},
/*!
 * Module exports.
 */
d.STATES=s,t.exports=d},function(t,e){t.exports=require("zlib")},function(t,e){t.exports=require("tty")},,,,,,,,,,,,,,,,function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */global.MONGOOSE_DRIVER_PATH?n(30).set(n(228)(global.MONGOOSE_DRIVER_PATH)):n(30).set(n(229));const r=n(88),o=n(19),i=n(114),s=n(111),u=n(81),c=n(60),a=n(121),l=n(371),h=n(16),p=n(8),f=n(385),d=n(5),m=n(386),g=n(387),y=n(389),_=n(390),v=n(206),w=n(84),b=n(391),O=Symbol.for("mongoose:default");function S(t){if(this.connections=[],this.models={},this.modelSchemas={},this.options={pluralization:!0},this.createConnection().models=this.models,this._pluralize=f,t&&t[O])for(const t of["Schema","model"])this[t]=S.prototype[t];else{const t=this;this.Schema=function(){return this.base=t,r.apply(this,arguments)},this.Schema.prototype=Object.create(r.prototype),Object.assign(this.Schema,r),this.Schema.base=this,this.Schema.Types=Object.assign({},r.Types)}this.Schema.prototype.base=this,Object.defineProperty(this,"plugins",{configurable:!1,enumerable:!0,writable:!1,value:[[y,{deduplicate:!0}],[_,{deduplicate:!0}],[b,{deduplicate:!0}],[g,{deduplicate:!0}]]})}n(392),S.prototype.STATES=u,S.prototype.set=function(t,e){return 1===arguments.length?this.options[t]:(this.options[t]=e,"objectIdGetter"===t&&(e?Object.defineProperty(E.Types.ObjectId.prototype,"_id",{enumerable:!1,configurable:!0,get:function(){return this}}):delete E.Types.ObjectId.prototype._id),this)},S.prototype.get=S.prototype.set,S.prototype.createConnection=function(t,e,n){const r=new C(this);return"function"==typeof e&&(n=e,e=null),this.connections.push(r),arguments.length>0?r.openUri(t,e,n):r},S.prototype.connect=function(){const t=this instanceof S?this:E;return t.connection.openUri(arguments[0],arguments[1],arguments[2]).then(()=>t)},S.prototype.disconnect=function(t){return d.promiseOrCallback(t,t=>{let e=this.connections.length;if(e<=0)return t(null);this.connections.forEach(n=>{n.close(function(n){if(n)return t(n);--e||t(null)})})})},S.prototype.startSession=function(){return this.connection.startSession.apply(this.connection,arguments)},S.prototype.pluralize=function(t){return arguments.length>0&&(this._pluralize=t),this._pluralize},S.prototype.model=function(t,e,n,o){const i=this instanceof S?this:E;let s,u;if("function"==typeof t&&(t=(s=t).name,!(s.prototype instanceof l)))throw new i.Error("The provided class "+t+" must extend Model");if("string"==typeof e&&(n=e,e=!1),d.isObject(e)&&!e.instanceOfSchema&&(e=new r(e)),e&&!e.instanceOfSchema)throw new Error("The 2nd parameter to `mongoose.model()` should be a schema or a POJO");if("boolean"==typeof n&&(o=n,n=null),o&&d.isObject(o)?(u=o,o=!0):u={},!i.modelSchemas[t]){if(!e)throw new E.Error.MissingSchemaError(t);i.modelSchemas[t]=e}const c=e;let a;if(e&&(i.get("cloneSchemas")&&(e=e.clone()),i._applyPlugins(e)),i.models[t]&&!1!==u.cache){if(c&&c.instanceOfSchema&&c!==i.models[t].schema)throw new i.Error.OverwriteModelError(t);return n&&n!==i.models[t].collection.name?(e=(s=i.models[t]).prototype.schema,a=s.__subclass(i.connection,e,n)):i.models[t]}if(!e&&!(e=this.modelSchemas[t]))throw new E.Error.MissingSchemaError(t);"pluralization"in e.options||(e.options.pluralization=i.options.pluralization),n||(n=e.get("collection")||d.toCollectionName(t,i.pluralize()));const h=u.connection||i.connection;return s=i.Model.compile(s||t,e,n,h,i),o||s.init(function(){}),!1===u.cache?s:(i.models[t]=s,i.models[t])},S.prototype.deleteModel=function(t){return this.connection.deleteModel(t),this},S.prototype.modelNames=function(){return Object.keys(this.models)},S.prototype._applyPlugins=function(t,e){if(t.$globalPluginsApplied)return;if(t.$globalPluginsApplied=!0,!e||!e.skipTopLevel)for(let e=0;e<this.plugins.length;++e)t.plugin(this.plugins[e][0],this.plugins[e][1]);for(let e=0;e<t.childSchemas.length;++e)this._applyPlugins(t.childSchemas[e].schema);const n=t.discriminators;if(null==n)return;const r=p(this,"options.applyPluginsToDiscriminators",!1),o=Object.keys(n);for(let t=0;t<o.length;++t){const e=n[o[t]];this._applyPlugins(e,{skipTopLevel:!r})}},S.prototype.plugin=function(t,e){return this.plugins.push([t,e]),this},S.prototype.__defineGetter__("connection",function(){return this.connections[0]}),S.prototype.__defineSetter__("connection",function(t){t instanceof C&&(this.connections[0]=t,this.models=t.models)}),S.prototype.connections;
/*!
 * Driver dependent APIs
 */
const A=global.MONGOOSE_DRIVER_PATH||"./drivers/node-mongodb-native",C=n(393)(A+"/connection"),T=n(395)(A+"/collection");
/*!
 * Connection
 */S.prototype.Aggregate=v,S.prototype.Collection=T,S.prototype.Connection=C,S.prototype.version=m.version,S.prototype.Mongoose=S,S.prototype.Schema=r,S.prototype.SchemaType=o,S.prototype.SchemaTypes=r.Types,S.prototype.VirtualType=s,S.prototype.Types=c,S.prototype.Query=a,Object.defineProperty(S.prototype,"Promise",{get:function(){return w.get()},set:function(t){w.set(t)}}),S.prototype.PromiseProvider=w,S.prototype.Model=l,S.prototype.Document=h,S.prototype.DocumentProvider=n(170),S.prototype.ObjectId=i.ObjectId,S.prototype.Decimal128=i.Decimal128,S.prototype.Mixed=i.Mixed,S.prototype.Number=i.Number,S.prototype.Error=n(9),S.prototype.now=function(){return new Date},S.prototype.CastError=n(24),S.prototype.mongo=n(37),S.prototype.mquery=n(106);
/*!
 * The exports object is an instance of Mongoose.
 *
 * @api public
 */
const E=t.exports=new S({[O]:!0})},function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=228},function(t,e,n){"use strict";
/*!
 * Module exports.
 */e.Binary=n(230),e.Collection=n(157),e.Decimal128=n(330),e.ObjectId=n(331),e.ReadPreference=n(332)},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(37).Binary;t.exports=r},function(t,e,n){"use strict";var r=n(94),o=n(42),i=n(65),s=n(66),u=n(67),c=n(68),a=n(69),l=n(95),h=n(70),p=n(71),f=n(51),d=n(72),m=n(73),g=n(52),y=n(232),_=n(233),v=n(235),w=new Buffer(17825792),b=function(){};b.prototype.serialize=function(t,e){var n="boolean"==typeof(e=e||{}).checkKeys&&e.checkKeys,r="boolean"==typeof e.serializeFunctions&&e.serializeFunctions,o="boolean"!=typeof e.ignoreUndefined||e.ignoreUndefined,i="number"==typeof e.minInternalBufferSize?e.minInternalBufferSize:17825792;w.length<i&&(w=new Buffer(i));var s=_(w,t,n,0,0,r,o,[]),u=new Buffer(s);return w.copy(u,0,0,u.length),u},b.prototype.serializeWithBufferAndIndex=function(t,e,n){var r="boolean"==typeof(n=n||{}).checkKeys&&n.checkKeys,o="boolean"==typeof n.serializeFunctions&&n.serializeFunctions,i="boolean"!=typeof n.ignoreUndefined||n.ignoreUndefined,s="number"==typeof n.index?n.index:0;return _(e,t,r,s||0,0,o,i)-1},b.prototype.deserialize=function(t,e){return y(t,e)},b.prototype.calculateObjectSize=function(t,e){var n="boolean"==typeof(e=e||{}).serializeFunctions&&e.serializeFunctions,r="boolean"!=typeof e.ignoreUndefined||e.ignoreUndefined;return v(t,n,r)},b.prototype.deserializeStream=function(t,e,n,r,o,i){i=null!=i?i:{};for(var s=e,u=0;u<n;u++){var c=t[s]|t[s+1]<<8|t[s+2]<<16|t[s+3]<<24;i.index=s,r[o+u]=this.deserialize(t,i),s+=c}return s},b.BSON_INT32_MAX=2147483647,b.BSON_INT32_MIN=-2147483648,b.BSON_INT64_MAX=Math.pow(2,63)-1,b.BSON_INT64_MIN=-Math.pow(2,63),b.JS_INT_MAX=9007199254740992,b.JS_INT_MIN=-9007199254740992,b.BSON_DATA_NUMBER=1,b.BSON_DATA_STRING=2,b.BSON_DATA_OBJECT=3,b.BSON_DATA_ARRAY=4,b.BSON_DATA_BINARY=5,b.BSON_DATA_OID=7,b.BSON_DATA_BOOLEAN=8,b.BSON_DATA_DATE=9,b.BSON_DATA_NULL=10,b.BSON_DATA_REGEXP=11,b.BSON_DATA_CODE=13,b.BSON_DATA_SYMBOL=14,b.BSON_DATA_CODE_W_SCOPE=15,b.BSON_DATA_INT=16,b.BSON_DATA_TIMESTAMP=17,b.BSON_DATA_LONG=18,b.BSON_DATA_MIN_KEY=255,b.BSON_DATA_MAX_KEY=127,b.BSON_BINARY_SUBTYPE_DEFAULT=0,b.BSON_BINARY_SUBTYPE_FUNCTION=1,b.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,b.BSON_BINARY_SUBTYPE_UUID=3,b.BSON_BINARY_SUBTYPE_MD5=4,b.BSON_BINARY_SUBTYPE_USER_DEFINED=128,t.exports=b,t.exports.Code=h,t.exports.Map=r,t.exports.Symbol=a,t.exports.BSON=b,t.exports.DBRef=m,t.exports.Binary=g,t.exports.ObjectID=u,t.exports.Long=o,t.exports.Timestamp=s,t.exports.Double=i,t.exports.Int32=l,t.exports.MinKey=f,t.exports.MaxKey=d,t.exports.BSONRegExp=c,t.exports.Decimal128=p},function(module,exports,__webpack_require__){"use strict";var Long=__webpack_require__(42).Long,Double=__webpack_require__(65).Double,Timestamp=__webpack_require__(66).Timestamp,ObjectID=__webpack_require__(67).ObjectID,Symbol=__webpack_require__(69).Symbol,Code=__webpack_require__(70).Code,MinKey=__webpack_require__(51).MinKey,MaxKey=__webpack_require__(72).MaxKey,Decimal128=__webpack_require__(71),Int32=__webpack_require__(95),DBRef=__webpack_require__(73).DBRef,BSONRegExp=__webpack_require__(68).BSONRegExp,Binary=__webpack_require__(52).Binary,deserialize=function(t,e,n){var r=(e=null==e?{}:e)&&e.index?e.index:0,o=t[r]|t[r+1]<<8|t[r+2]<<16|t[r+3]<<24;if(o<5||t.length<o||o+r>t.length)throw new Error("corrupt bson message");if(0!==t[r+o-1])throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return deserializeObject(t,r,e,n)},deserializeObject=function(t,e,n,r){var o=null!=n.evalFunctions&&n.evalFunctions,i=null!=n.cacheFunctions&&n.cacheFunctions,s=null!=n.cacheFunctionsCrc32&&n.cacheFunctionsCrc32;if(!s)var u=null;var c=null==n.fieldsAsRaw?null:n.fieldsAsRaw,a=null!=n.raw&&n.raw,l="boolean"==typeof n.bsonRegExp&&n.bsonRegExp,h=null!=n.promoteBuffers&&n.promoteBuffers,p=null==n.promoteLongs||n.promoteLongs,f=null==n.promoteValues||n.promoteValues,d=e;if(t.length<5)throw new Error("corrupt bson message < 5 bytes long");var m=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;if(m<5||m>t.length)throw new Error("corrupt bson message");for(var g=r?[]:{},y=0;;){var _=t[e++];if(0===_)break;for(var v=e;0!==t[v]&&v<t.length;)v++;if(v>=t.length)throw new Error("Bad BSON Document: illegal CString");var w=r?y++:t.toString("utf8",e,v);if(e=v+1,_===BSON.BSON_DATA_STRING){var b=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;if(b<=0||b>t.length-e||0!==t[e+b-1])throw new Error("bad string length in bson");g[w]=t.toString("utf8",e,e+b-1),e+=b}else if(_===BSON.BSON_DATA_OID){var O=new Buffer(12);t.copy(O,0,e,e+12),g[w]=new ObjectID(O),e+=12}else if(_===BSON.BSON_DATA_INT&&!1===f)g[w]=new Int32(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24);else if(_===BSON.BSON_DATA_INT)g[w]=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;else if(_===BSON.BSON_DATA_NUMBER&&!1===f)g[w]=new Double(t.readDoubleLE(e)),e+=8;else if(_===BSON.BSON_DATA_NUMBER)g[w]=t.readDoubleLE(e),e+=8;else if(_===BSON.BSON_DATA_DATE){var S=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,A=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;g[w]=new Date(new Long(S,A).toNumber())}else if(_===BSON.BSON_DATA_BOOLEAN){if(0!==t[e]&&1!==t[e])throw new Error("illegal boolean type value");g[w]=1===t[e++]}else if(_===BSON.BSON_DATA_OBJECT){var C=e,T=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24;if(T<=0||T>t.length-e)throw new Error("bad embedded document length in bson");g[w]=a?t.slice(e,e+T):deserializeObject(t,C,n,!1),e+=T}else if(_===BSON.BSON_DATA_ARRAY){C=e;var E=n,N=e+(T=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24);if(c&&c[w]){for(var $ in E={},n)E[$]=n[$];E.raw=!0}if(g[w]=deserializeObject(t,C,E,!0),0!==t[(e+=T)-1])throw new Error("invalid array terminator byte");if(e!==N)throw new Error("corrupted array bson")}else if(_===BSON.BSON_DATA_UNDEFINED)g[w]=void 0;else if(_===BSON.BSON_DATA_NULL)g[w]=null;else if(_===BSON.BSON_DATA_LONG){S=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,A=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;var I=new Long(S,A);g[w]=p&&!0===f&&I.lessThanOrEqual(JS_INT_MAX_LONG)&&I.greaterThanOrEqual(JS_INT_MIN_LONG)?I.toNumber():I}else if(_===BSON.BSON_DATA_DECIMAL128){var M=new Buffer(16);t.copy(M,0,e,e+16),e+=16;var R=new Decimal128(M);g[w]=R.toObject?R.toObject():R}else if(_===BSON.BSON_DATA_BINARY){var P=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,j=P,D=t[e++];if(P<0)throw new Error("Negative binary type element size found");if(P>t.length)throw new Error("Binary type size larger than document size");if(null!=t.slice){if(D===Binary.SUBTYPE_BYTE_ARRAY){if((P=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(P>j-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(P<j-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}g[w]=h&&f?t.slice(e,e+P):new Binary(t.slice(e,e+P),D)}else{var B="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(P)):new Array(P);if(D===Binary.SUBTYPE_BYTE_ARRAY){if((P=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(P>j-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(P<j-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}for(v=0;v<P;v++)B[v]=t[e+v];g[w]=h&&f?B:new Binary(B,D)}e+=P}else if(_===BSON.BSON_DATA_REGEXP&&!1===l){for(v=e;0!==t[v]&&v<t.length;)v++;if(v>=t.length)throw new Error("Bad BSON Document: illegal CString");var L=t.toString("utf8",e,v);for(v=e=v+1;0!==t[v]&&v<t.length;)v++;if(v>=t.length)throw new Error("Bad BSON Document: illegal CString");var F=t.toString("utf8",e,v);e=v+1;var U=new Array(F.length);for(v=0;v<F.length;v++)switch(F[v]){case"m":U[v]="m";break;case"s":U[v]="g";break;case"i":U[v]="i"}g[w]=new RegExp(L,U.join(""))}else if(_===BSON.BSON_DATA_REGEXP&&!0===l){for(v=e;0!==t[v]&&v<t.length;)v++;if(v>=t.length)throw new Error("Bad BSON Document: illegal CString");for(L=t.toString("utf8",e,v),v=e=v+1;0!==t[v]&&v<t.length;)v++;if(v>=t.length)throw new Error("Bad BSON Document: illegal CString");F=t.toString("utf8",e,v),e=v+1,g[w]=new BSONRegExp(L,F)}else if(_===BSON.BSON_DATA_SYMBOL){if((b=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||b>t.length-e||0!==t[e+b-1])throw new Error("bad string length in bson");g[w]=new Symbol(t.toString("utf8",e,e+b-1)),e+=b}else if(_===BSON.BSON_DATA_TIMESTAMP)S=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,A=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,g[w]=new Timestamp(S,A);else if(_===BSON.BSON_DATA_MIN_KEY)g[w]=new MinKey;else if(_===BSON.BSON_DATA_MAX_KEY)g[w]=new MaxKey;else if(_===BSON.BSON_DATA_CODE){if((b=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||b>t.length-e||0!==t[e+b-1])throw new Error("bad string length in bson");var q=t.toString("utf8",e,e+b-1);if(o)if(i){var x=s?u(q):q;g[w]=isolateEvalWithHash(functionCache,x,q,g)}else g[w]=isolateEval(q);else g[w]=new Code(q);e+=b}else if(_===BSON.BSON_DATA_CODE_W_SCOPE){var W=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;if(W<13)throw new Error("code_w_scope total size shorter minimum expected length");if((b=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||b>t.length-e||0!==t[e+b-1])throw new Error("bad string length in bson");q=t.toString("utf8",e,e+b-1),C=e+=b,T=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24;var V=deserializeObject(t,C,n,!1);if(e+=T,W<8+T+b)throw new Error("code_w_scope total size is to short, truncating scope");if(W>8+T+b)throw new Error("code_w_scope total size is to long, clips outer document");o?(i?(x=s?u(q):q,g[w]=isolateEvalWithHash(functionCache,x,q,g)):g[w]=isolateEval(q),g[w].scope=V):g[w]=new Code(q,V)}else{if(_!==BSON.BSON_DATA_DBPOINTER)throw new Error("Detected unknown BSON type "+_.toString(16)+' for fieldname "'+w+'", are you using the latest BSON parser');if((b=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||b>t.length-e||0!==t[e+b-1])throw new Error("bad string length in bson");var H=t.toString("utf8",e,e+b-1);e+=b;var Y=new Buffer(12);t.copy(Y,0,e,e+12),O=new ObjectID(Y),e+=12;var Q=H.split("."),z=Q.shift(),K=Q.join(".");g[w]=new DBRef(K,O,z)}}if(m!==e-d){if(r)throw new Error("corrupt array bson");throw new Error("corrupt object bson")}return null!=g.$id&&(g=new DBRef(g.$ref,g.$id,g.$db)),g},isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},BSON={},functionCache=BSON.functionCache={};BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_UNDEFINED=6,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_DBPOINTER=12,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_DECIMAL128=19,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);module.exports=deserialize},function(t,e,n){"use strict";var r=n(234).writeIEEE754,o=n(42).Long,i=n(51).MinKey,s=n(94),u=n(52).Binary,c=n(144).normalizedFunctionString,a=/\x00/,l=["$db","$ref","$id","$clusterTime"],h=function(t){return"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t)},p=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},f=function(t,e,n,r,o){t[r++]=j.BSON_DATA_STRING;var i=o?t.write(e,r,"ascii"):t.write(e,r,"utf8");t[(r=r+i+1)-1]=0;var s=t.write(n,r+4,"utf8");return t[r+3]=s+1>>24&255,t[r+2]=s+1>>16&255,t[r+1]=s+1>>8&255,t[r]=s+1&255,r=r+4+s,t[r++]=0,r},d=function(t,e,n,i,s){if(Math.floor(n)===n&&n>=j.JS_INT_MIN&&n<=j.JS_INT_MAX)if(n>=j.BSON_INT32_MIN&&n<=j.BSON_INT32_MAX){t[i++]=j.BSON_DATA_INT;var u=s?t.write(e,i,"ascii"):t.write(e,i,"utf8");i+=u,t[i++]=0,t[i++]=255&n,t[i++]=n>>8&255,t[i++]=n>>16&255,t[i++]=n>>24&255}else if(n>=j.JS_INT_MIN&&n<=j.JS_INT_MAX)t[i++]=j.BSON_DATA_NUMBER,i+=u=s?t.write(e,i,"ascii"):t.write(e,i,"utf8"),t[i++]=0,r(t,n,i,"little",52,8),i+=8;else{t[i++]=j.BSON_DATA_LONG,i+=u=s?t.write(e,i,"ascii"):t.write(e,i,"utf8"),t[i++]=0;var c=o.fromNumber(n),a=c.getLowBits(),l=c.getHighBits();t[i++]=255&a,t[i++]=a>>8&255,t[i++]=a>>16&255,t[i++]=a>>24&255,t[i++]=255&l,t[i++]=l>>8&255,t[i++]=l>>16&255,t[i++]=l>>24&255}else t[i++]=j.BSON_DATA_NUMBER,i+=u=s?t.write(e,i,"ascii"):t.write(e,i,"utf8"),t[i++]=0,r(t,n,i,"little",52,8),i+=8;return i},m=function(t,e,n,r,o){return t[r++]=j.BSON_DATA_NULL,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,r},g=function(t,e,n,r,o){return t[r++]=j.BSON_DATA_BOOLEAN,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,t[r++]=n?1:0,r},y=function(t,e,n,r,i){t[r++]=j.BSON_DATA_DATE,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var s=o.fromNumber(n.getTime()),u=s.getLowBits(),c=s.getHighBits();return t[r++]=255&u,t[r++]=u>>8&255,t[r++]=u>>16&255,t[r++]=u>>24&255,t[r++]=255&c,t[r++]=c>>8&255,t[r++]=c>>16&255,t[r++]=c>>24&255,r},_=function(t,e,n,r,o){if(t[r++]=j.BSON_DATA_REGEXP,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,n.source&&null!=n.source.match(a))throw Error("value "+n.source+" must not contain null bytes");return r+=t.write(n.source,r,"utf8"),t[r++]=0,n.global&&(t[r++]=115),n.ignoreCase&&(t[r++]=105),n.multiline&&(t[r++]=109),t[r++]=0,r},v=function(t,e,n,r,o){if(t[r++]=j.BSON_DATA_REGEXP,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,null!=n.pattern.match(a))throw Error("pattern "+n.pattern+" must not contain null bytes");return r+=t.write(n.pattern,r,"utf8"),t[r++]=0,r+=t.write(n.options.split("").sort().join(""),r,"utf8"),t[r++]=0,r},w=function(t,e,n,r,o){return t[r++]=null===n?j.BSON_DATA_NULL:n instanceof i?j.BSON_DATA_MIN_KEY:j.BSON_DATA_MAX_KEY,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,r},b=function(t,e,n,r,o){if(t[r++]=j.BSON_DATA_OID,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,"string"==typeof n.id)t.write(n.id,r,"binary");else{if(!n.id||!n.id.copy)throw new Error("object ["+JSON.stringify(n)+"] is not a valid ObjectId");n.id.copy(t,r,0,12)}return r+12},O=function(t,e,n,r,o){t[r++]=j.BSON_DATA_BINARY,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var i=n.length;return t[r++]=255&i,t[r++]=i>>8&255,t[r++]=i>>16&255,t[r++]=i>>24&255,t[r++]=j.BSON_BINARY_SUBTYPE_DEFAULT,n.copy(t,r,0,i),r+=i},S=function(t,e,n,r,o,i,s,u,c,a){for(var l=0;l<a.length;l++)if(a[l]===n)throw new Error("cyclic dependency detected");a.push(n),t[r++]=Array.isArray(n)?j.BSON_DATA_ARRAY:j.BSON_DATA_OBJECT,r+=c?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var h=P(t,n,o,r,i+1,s,u,a);return a.pop(),h},A=function(t,e,n,r,o){return t[r++]=j.BSON_DATA_DECIMAL128,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,n.bytes.copy(t,r,0,16),r+16},C=function(t,e,n,r,o){t[r++]="Long"===n._bsontype?j.BSON_DATA_LONG:j.BSON_DATA_TIMESTAMP,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var i=n.getLowBits(),s=n.getHighBits();return t[r++]=255&i,t[r++]=i>>8&255,t[r++]=i>>16&255,t[r++]=i>>24&255,t[r++]=255&s,t[r++]=s>>8&255,t[r++]=s>>16&255,t[r++]=s>>24&255,r},T=function(t,e,n,r,o){return t[r++]=j.BSON_DATA_INT,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,t[r++]=255&n,t[r++]=n>>8&255,t[r++]=n>>16&255,t[r++]=n>>24&255,r},E=function(t,e,n,o,i){return t[o++]=j.BSON_DATA_NUMBER,o+=i?t.write(e,o,"ascii"):t.write(e,o,"utf8"),t[o++]=0,r(t,n,o,"little",52,8),o+=8},N=function(t,e,n,r,o,i,s){t[r++]=j.BSON_DATA_CODE,r+=s?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var u=c(n),a=t.write(u,r+4,"utf8")+1;return t[r]=255&a,t[r+1]=a>>8&255,t[r+2]=a>>16&255,t[r+3]=a>>24&255,r=r+4+a-1,t[r++]=0,r},$=function(t,e,n,r,o,i,s,u,c){if(n.scope&&"object"==typeof n.scope){t[r++]=j.BSON_DATA_CODE_W_SCOPE;var a=c?t.write(e,r,"ascii"):t.write(e,r,"utf8");r+=a,t[r++]=0;var l=r,h="string"==typeof n.code?n.code:n.code.toString();r+=4;var p=t.write(h,r+4,"utf8")+1;t[r]=255&p,t[r+1]=p>>8&255,t[r+2]=p>>16&255,t[r+3]=p>>24&255,t[r+4+p-1]=0,r=r+p+4;var f=P(t,n.scope,o,r,i+1,s,u);r=f-1;var d=f-l;t[l++]=255&d,t[l++]=d>>8&255,t[l++]=d>>16&255,t[l++]=d>>24&255,t[r++]=0}else{t[r++]=j.BSON_DATA_CODE,r+=a=c?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,h=n.code.toString();var m=t.write(h,r+4,"utf8")+1;t[r]=255&m,t[r+1]=m>>8&255,t[r+2]=m>>16&255,t[r+3]=m>>24&255,r=r+4+m-1,t[r++]=0}return r},I=function(t,e,n,r,o){t[r++]=j.BSON_DATA_BINARY,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var i=n.value(!0),s=n.position;return n.sub_type===u.SUBTYPE_BYTE_ARRAY&&(s+=4),t[r++]=255&s,t[r++]=s>>8&255,t[r++]=s>>16&255,t[r++]=s>>24&255,t[r++]=n.sub_type,n.sub_type===u.SUBTYPE_BYTE_ARRAY&&(s-=4,t[r++]=255&s,t[r++]=s>>8&255,t[r++]=s>>16&255,t[r++]=s>>24&255),i.copy(t,r,0,n.position),r+=n.position},M=function(t,e,n,r,o){t[r++]=j.BSON_DATA_SYMBOL,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var i=t.write(n.value,r+4,"utf8")+1;return t[r]=255&i,t[r+1]=i>>8&255,t[r+2]=i>>16&255,t[r+3]=i>>24&255,r=r+4+i-1,t[r++]=0,r},R=function(t,e,n,r,o,i,s){t[r++]=j.BSON_DATA_OBJECT,r+=s?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var u,c=r,a=(u=null!=n.db?P(t,{$ref:n.namespace,$id:n.oid,$db:n.db},!1,r,o+1,i):P(t,{$ref:n.namespace,$id:n.oid},!1,r,o+1,i))-c;return t[c++]=255&a,t[c++]=a>>8&255,t[c++]=a>>16&255,t[c++]=a>>24&255,u},P=function(t,e,n,r,o,i,u,c){r=r||0,(c=c||[]).push(e);var P=r+4;if(Array.isArray(e))for(var j=0;j<e.length;j++){var D=""+j,B=e[j];if(B&&B.toBSON){if("function"!=typeof B.toBSON)throw new Error("toBSON is not a function");B=B.toBSON()}var L=typeof B;"string"===L?P=f(t,D,B,P,!0):"number"===L?P=d(t,D,B,P,!0):"boolean"===L?P=g(t,D,B,P,!0):B instanceof Date||h(B)?P=y(t,D,B,P,!0):void 0===B?P=m(t,D,0,P,!0):null===B?P=m(t,D,0,P,!0):"ObjectID"===B._bsontype?P=b(t,D,B,P,!0):Buffer.isBuffer(B)?P=O(t,D,B,P,!0):B instanceof RegExp||p(B)?P=_(t,D,B,P,!0):"object"===L&&null==B._bsontype?P=S(t,D,B,P,n,o,i,u,!0,c):"object"===L&&"Decimal128"===B._bsontype?P=A(t,D,B,P,!0):"Long"===B._bsontype||"Timestamp"===B._bsontype?P=C(t,D,B,P,!0):"Double"===B._bsontype?P=E(t,D,B,P,!0):"function"==typeof B&&i?P=N(t,D,B,P,0,0,i):"Code"===B._bsontype?P=$(t,D,B,P,n,o,i,u,!0):"Binary"===B._bsontype?P=I(t,D,B,P,!0):"Symbol"===B._bsontype?P=M(t,D,B,P,!0):"DBRef"===B._bsontype?P=R(t,D,B,P,o,i,!0):"BSONRegExp"===B._bsontype?P=v(t,D,B,P,!0):"Int32"===B._bsontype?P=T(t,D,B,P,!0):"MinKey"!==B._bsontype&&"MaxKey"!==B._bsontype||(P=w(t,D,B,P,!0))}else if(e instanceof s)for(var F=e.entries(),U=!1;!U;){var q=F.next();if(!(U=q.done)){if(D=q.value[0],L=typeof(B=q.value[1]),"string"==typeof D&&-1===l.indexOf(D)){if(null!=D.match(a))throw Error("key "+D+" must not contain null bytes");if(n){if("$"===D[0])throw Error("key "+D+" must not start with '$'");if(~D.indexOf("."))throw Error("key "+D+" must not contain '.'")}}"string"===L?P=f(t,D,B,P):"number"===L?P=d(t,D,B,P):"boolean"===L?P=g(t,D,B,P):B instanceof Date||h(B)?P=y(t,D,B,P):null===B||void 0===B&&!1===u?P=m(t,D,0,P):"ObjectID"===B._bsontype?P=b(t,D,B,P):Buffer.isBuffer(B)?P=O(t,D,B,P):B instanceof RegExp||p(B)?P=_(t,D,B,P):"object"===L&&null==B._bsontype?P=S(t,D,B,P,n,o,i,u,!1,c):"object"===L&&"Decimal128"===B._bsontype?P=A(t,D,B,P):"Long"===B._bsontype||"Timestamp"===B._bsontype?P=C(t,D,B,P):"Double"===B._bsontype?P=E(t,D,B,P):"Code"===B._bsontype?P=$(t,D,B,P,n,o,i,u):"function"==typeof B&&i?P=N(t,D,B,P,0,0,i):"Binary"===B._bsontype?P=I(t,D,B,P):"Symbol"===B._bsontype?P=M(t,D,B,P):"DBRef"===B._bsontype?P=R(t,D,B,P,o,i):"BSONRegExp"===B._bsontype?P=v(t,D,B,P):"Int32"===B._bsontype?P=T(t,D,B,P):"MinKey"!==B._bsontype&&"MaxKey"!==B._bsontype||(P=w(t,D,B,P))}}else{if(e.toBSON){if("function"!=typeof e.toBSON)throw new Error("toBSON is not a function");if(null!=(e=e.toBSON())&&"object"!=typeof e)throw new Error("toBSON function did not return an object")}for(D in e){if((B=e[D])&&B.toBSON){if("function"!=typeof B.toBSON)throw new Error("toBSON is not a function");B=B.toBSON()}if(L=typeof B,"string"==typeof D&&-1===l.indexOf(D)){if(null!=D.match(a))throw Error("key "+D+" must not contain null bytes");if(n){if("$"===D[0])throw Error("key "+D+" must not start with '$'");if(~D.indexOf("."))throw Error("key "+D+" must not contain '.'")}}"string"===L?P=f(t,D,B,P):"number"===L?P=d(t,D,B,P):"boolean"===L?P=g(t,D,B,P):B instanceof Date||h(B)?P=y(t,D,B,P):void 0===B?!1===u&&(P=m(t,D,0,P)):null===B?P=m(t,D,0,P):"ObjectID"===B._bsontype?P=b(t,D,B,P):Buffer.isBuffer(B)?P=O(t,D,B,P):B instanceof RegExp||p(B)?P=_(t,D,B,P):"object"===L&&null==B._bsontype?P=S(t,D,B,P,n,o,i,u,!1,c):"object"===L&&"Decimal128"===B._bsontype?P=A(t,D,B,P):"Long"===B._bsontype||"Timestamp"===B._bsontype?P=C(t,D,B,P):"Double"===B._bsontype?P=E(t,D,B,P):"Code"===B._bsontype?P=$(t,D,B,P,n,o,i,u):"function"==typeof B&&i?P=N(t,D,B,P,0,0,i):"Binary"===B._bsontype?P=I(t,D,B,P):"Symbol"===B._bsontype?P=M(t,D,B,P):"DBRef"===B._bsontype?P=R(t,D,B,P,o,i):"BSONRegExp"===B._bsontype?P=v(t,D,B,P):"Int32"===B._bsontype?P=T(t,D,B,P):"MinKey"!==B._bsontype&&"MaxKey"!==B._bsontype||(P=w(t,D,B,P))}}c.pop(),t[P++]=0;var x=P-r;return t[r++]=255&x,t[r++]=x>>8&255,t[r++]=x>>16&255,t[r++]=x>>24&255,P},j={BSON_DATA_NUMBER:1,BSON_DATA_STRING:2,BSON_DATA_OBJECT:3,BSON_DATA_ARRAY:4,BSON_DATA_BINARY:5,BSON_DATA_UNDEFINED:6,BSON_DATA_OID:7,BSON_DATA_BOOLEAN:8,BSON_DATA_DATE:9,BSON_DATA_NULL:10,BSON_DATA_REGEXP:11,BSON_DATA_CODE:13,BSON_DATA_SYMBOL:14,BSON_DATA_CODE_W_SCOPE:15,BSON_DATA_INT:16,BSON_DATA_TIMESTAMP:17,BSON_DATA_LONG:18,BSON_DATA_DECIMAL128:19,BSON_DATA_MIN_KEY:255,BSON_DATA_MAX_KEY:127,BSON_BINARY_SUBTYPE_DEFAULT:0,BSON_BINARY_SUBTYPE_FUNCTION:1,BSON_BINARY_SUBTYPE_BYTE_ARRAY:2,BSON_BINARY_SUBTYPE_UUID:3,BSON_BINARY_SUBTYPE_MD5:4,BSON_BINARY_SUBTYPE_USER_DEFINED:128,BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648};j.BSON_INT64_MAX=Math.pow(2,63)-1,j.BSON_INT64_MIN=-Math.pow(2,63),j.JS_INT_MAX=9007199254740992,j.JS_INT_MIN=-9007199254740992,t.exports=P},function(t,e){e.readIEEE754=function(t,e,n,r,o){var i,s,u="big"===n,c=8*o-r-1,a=(1<<c)-1,l=a>>1,h=-7,p=u?0:o-1,f=u?1:-1,d=t[e+p];for(p+=f,i=d&(1<<-h)-1,d>>=-h,h+=c;h>0;i=256*i+t[e+p],p+=f,h-=8);for(s=i&(1<<-h)-1,i>>=-h,h+=r;h>0;s=256*s+t[e+p],p+=f,h-=8);if(0===i)i=1-l;else{if(i===a)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),i-=l}return(d?-1:1)*s*Math.pow(2,i-r)},e.writeIEEE754=function(t,e,n,r,o,i){var s,u,c,a="big"===r,l=8*i-o-1,h=(1<<l)-1,p=h>>1,f=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,d=a?i-1:0,m=a?-1:1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),(e+=s+p>=1?f/c:f*Math.pow(2,1-p))*c>=2&&(s++,c/=2),s+p>=h?(u=0,s=h):s+p>=1?(u=(e*c-1)*Math.pow(2,o),s+=p):(u=e*Math.pow(2,p-1)*Math.pow(2,o),s=0));o>=8;t[n+d]=255&u,d+=m,u/=256,o-=8);for(s=s<<o|u,l+=o;l>0;t[n+d]=255&s,d+=m,s/=256,l-=8);t[n+d-m]|=128*g}},function(t,e,n){"use strict";var r=n(42).Long,o=n(65).Double,i=n(66).Timestamp,s=n(67).ObjectID,u=n(69).Symbol,c=n(68).BSONRegExp,a=n(70).Code,l=n(71),h=n(51).MinKey,p=n(72).MaxKey,f=n(73).DBRef,d=n(52).Binary,m=n(144).normalizedFunctionString,g=function(t){return"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t)},y=function(t,e,n){var r=5;if(Array.isArray(t))for(var o=0;o<t.length;o++)r+=_(o.toString(),t[o],e,!0,n);else for(var i in t.toBSON&&(t=t.toBSON()),t)r+=_(i,t[i],e,!1,n);return r};function _(t,e,n,_,w){switch(e&&e.toBSON&&(e=e.toBSON()),typeof e){case"string":return 1+Buffer.byteLength(t,"utf8")+1+4+Buffer.byteLength(e,"utf8")+1;case"number":return Math.floor(e)===e&&e>=v.JS_INT_MIN&&e<=v.JS_INT_MAX&&e>=v.BSON_INT32_MIN&&e<=v.BSON_INT32_MAX?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+5:(null!=t?Buffer.byteLength(t,"utf8")+1:0)+9;case"undefined":return _||!w?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1:0;case"boolean":return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+2;case"object":if(null==e||e instanceof h||e instanceof p||"MinKey"===e._bsontype||"MaxKey"===e._bsontype)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1;if(e instanceof s||"ObjectID"===e._bsontype)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+13;if(e instanceof Date||g(e))return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+9;if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+6+e.length;if(e instanceof r||e instanceof o||e instanceof i||"Long"===e._bsontype||"Double"===e._bsontype||"Timestamp"===e._bsontype)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+9;if(e instanceof l||"Decimal128"===e._bsontype)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+17;if(e instanceof a||"Code"===e._bsontype)return null!=e.scope&&Object.keys(e.scope).length>0?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+4+4+Buffer.byteLength(e.code.toString(),"utf8")+1+y(e.scope,n,w):(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+4+Buffer.byteLength(e.code.toString(),"utf8")+1;if(e instanceof d||"Binary"===e._bsontype)return e.sub_type===d.SUBTYPE_BYTE_ARRAY?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+(e.position+1+4+1+4):(null!=t?Buffer.byteLength(t,"utf8")+1:0)+(e.position+1+4+1);if(e instanceof u||"Symbol"===e._bsontype)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+Buffer.byteLength(e.value,"utf8")+4+1+1;if(e instanceof f||"DBRef"===e._bsontype){var b={$ref:e.namespace,$id:e.oid};return null!=e.db&&(b.$db=e.db),(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+y(b,n,w)}return e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+Buffer.byteLength(e.source,"utf8")+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1:e instanceof c||"BSONRegExp"===e._bsontype?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+Buffer.byteLength(e.pattern,"utf8")+1+Buffer.byteLength(e.options,"utf8")+1:(null!=t?Buffer.byteLength(t,"utf8")+1:0)+y(e,n,w)+1;case"function":if(e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)||"[object RegExp]"===String.call(e))return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+Buffer.byteLength(e.source,"utf8")+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1;if(n&&null!=e.scope&&Object.keys(e.scope).length>0)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+4+4+Buffer.byteLength(m(e),"utf8")+1+y(e.scope,n,w);if(n)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+4+Buffer.byteLength(m(e),"utf8")+1}return 0}var v={BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648,JS_INT_MAX:9007199254740992,JS_INT_MIN:-9007199254740992};t.exports=y},function(t,e,n){"use strict";var r=n(53),o=n(237);t.exports=function(t,e){if("string"!=typeof t||"string"!=typeof e)throw new TypeError("Expected `fromDir` and `moduleId` to be a string");t=r.resolve(t);var n=r.join(t,"noop.js");try{return o._resolveFilename(e,{id:n,filename:n,paths:o._nodeModulePaths(t)})}catch(t){return null}}},function(t,e){t.exports=require("module")},function(t,e){var n;e=t.exports=z,n="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("SEMVER"),console.log.apply(console,t)}:function(){},e.SEMVER_SPEC_VERSION="2.0.0";var r=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,i=e.re=[],s=e.src=[],u=0,c=u++;s[c]="0|[1-9]\\d*";var a=u++;s[a]="[0-9]+";var l=u++;s[l]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var h=u++;s[h]="("+s[c]+")\\.("+s[c]+")\\.("+s[c]+")";var p=u++;s[p]="("+s[a]+")\\.("+s[a]+")\\.("+s[a]+")";var f=u++;s[f]="(?:"+s[c]+"|"+s[l]+")";var d=u++;s[d]="(?:"+s[a]+"|"+s[l]+")";var m=u++;s[m]="(?:-("+s[f]+"(?:\\."+s[f]+")*))";var g=u++;s[g]="(?:-?("+s[d]+"(?:\\."+s[d]+")*))";var y=u++;s[y]="[0-9A-Za-z-]+";var _=u++;s[_]="(?:\\+("+s[y]+"(?:\\."+s[y]+")*))";var v=u++,w="v?"+s[h]+s[m]+"?"+s[_]+"?";s[v]="^"+w+"$";var b="[v=\\s]*"+s[p]+s[g]+"?"+s[_]+"?",O=u++;s[O]="^"+b+"$";var S=u++;s[S]="((?:<|>)?=?)";var A=u++;s[A]=s[a]+"|x|X|\\*";var C=u++;s[C]=s[c]+"|x|X|\\*";var T=u++;s[T]="[v=\\s]*("+s[C]+")(?:\\.("+s[C]+")(?:\\.("+s[C]+")(?:"+s[m]+")?"+s[_]+"?)?)?";var E=u++;s[E]="[v=\\s]*("+s[A]+")(?:\\.("+s[A]+")(?:\\.("+s[A]+")(?:"+s[g]+")?"+s[_]+"?)?)?";var N=u++;s[N]="^"+s[S]+"\\s*"+s[T]+"$";var $=u++;s[$]="^"+s[S]+"\\s*"+s[E]+"$";var I=u++;s[I]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var M=u++;s[M]="(?:~>?)";var R=u++;s[R]="(\\s*)"+s[M]+"\\s+",i[R]=new RegExp(s[R],"g");var P=u++;s[P]="^"+s[M]+s[T]+"$";var j=u++;s[j]="^"+s[M]+s[E]+"$";var D=u++;s[D]="(?:\\^)";var B=u++;s[B]="(\\s*)"+s[D]+"\\s+",i[B]=new RegExp(s[B],"g");var L=u++;s[L]="^"+s[D]+s[T]+"$";var F=u++;s[F]="^"+s[D]+s[E]+"$";var U=u++;s[U]="^"+s[S]+"\\s*("+b+")$|^$";var q=u++;s[q]="^"+s[S]+"\\s*("+w+")$|^$";var x=u++;s[x]="(\\s*)"+s[S]+"\\s*("+b+"|"+s[T]+")",i[x]=new RegExp(s[x],"g");var W=u++;s[W]="^\\s*("+s[T]+")\\s+-\\s+("+s[T]+")\\s*$";var V=u++;s[V]="^\\s*("+s[E]+")\\s+-\\s+("+s[E]+")\\s*$";var H=u++;s[H]="(<|>)?=?\\s*\\*";for(var Y=0;Y<35;Y++)n(Y,s[Y]),i[Y]||(i[Y]=new RegExp(s[Y]));function Q(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof z)return t;if("string"!=typeof t)return null;if(t.length>r)return null;if(!(e.loose?i[O]:i[v]).test(t))return null;try{return new z(t,e)}catch(t){return null}}function z(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof z){if(t.loose===e.loose)return t;t=t.version}else if("string"!=typeof t)throw new TypeError("Invalid Version: "+t);if(t.length>r)throw new TypeError("version is longer than "+r+" characters");if(!(this instanceof z))return new z(t,e);n("SemVer",t,e),this.options=e,this.loose=!!e.loose;var s=t.trim().match(e.loose?i[O]:i[v]);if(!s)throw new TypeError("Invalid Version: "+t);if(this.raw=t,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(function(t){if(/^[0-9]+$/.test(t)){var e=+t;if(e>=0&&e<o)return e}return t}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}e.parse=Q,e.valid=function(t,e){var n=Q(t,e);return n?n.version:null},e.clean=function(t,e){var n=Q(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null},e.SemVer=z,z.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},z.prototype.toString=function(){return this.version},z.prototype.compare=function(t){return n("SemVer.compare",this.version,this.options,t),t instanceof z||(t=new z(t,this.options)),this.compareMain(t)||this.comparePre(t)},z.prototype.compareMain=function(t){return t instanceof z||(t=new z(t,this.options)),G(this.major,t.major)||G(this.minor,t.minor)||G(this.patch,t.patch)},z.prototype.comparePre=function(t){if(t instanceof z||(t=new z(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var e=0;do{var r=this.prerelease[e],o=t.prerelease[e];if(n("prerelease compare",e,r,o),void 0===r&&void 0===o)return 0;if(void 0===o)return 1;if(void 0===r)return-1;if(r!==o)return G(r,o)}while(++e)},z.prototype.inc=function(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e),this.inc("pre",e);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);-1===n&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+t)}return this.format(),this.raw=this.version,this},e.inc=function(t,e,n,r){"string"==typeof n&&(r=n,n=void 0);try{return new z(t,n).inc(e,r).version}catch(t){return null}},e.diff=function(t,e){if(k(t,e))return null;var n=Q(t),r=Q(e);if(n.prerelease.length||r.prerelease.length){for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==r[o])return"pre"+o;return"prerelease"}for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==r[o])return o},e.compareIdentifiers=G;var K=/^[0-9]+$/;function G(t,e){var n=K.test(t),r=K.test(e);return n&&r&&(t=+t,e=+e),n&&!r?-1:r&&!n?1:t<e?-1:t>e?1:0}function J(t,e,n){return new z(t,n).compare(new z(e,n))}function X(t,e,n){return J(t,e,n)>0}function Z(t,e,n){return J(t,e,n)<0}function k(t,e,n){return 0===J(t,e,n)}function tt(t,e,n){return 0!==J(t,e,n)}function et(t,e,n){return J(t,e,n)>=0}function nt(t,e,n){return J(t,e,n)<=0}function rt(t,e,n,r){var o;switch(e){case"===":"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),o=t===n;break;case"!==":"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),o=t!==n;break;case"":case"=":case"==":o=k(t,n,r);break;case"!=":o=tt(t,n,r);break;case">":o=X(t,n,r);break;case">=":o=et(t,n,r);break;case"<":o=Z(t,n,r);break;case"<=":o=nt(t,n,r);break;default:throw new TypeError("Invalid operator: "+e)}return o}function ot(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof ot){if(t.loose===!!e.loose)return t;t=t.value}if(!(this instanceof ot))return new ot(t,e);n("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===it?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}e.rcompareIdentifiers=function(t,e){return G(e,t)},e.major=function(t,e){return new z(t,e).major},e.minor=function(t,e){return new z(t,e).minor},e.patch=function(t,e){return new z(t,e).patch},e.compare=J,e.compareLoose=function(t,e){return J(t,e,!0)},e.rcompare=function(t,e,n){return J(e,t,n)},e.sort=function(t,n){return t.sort(function(t,r){return e.compare(t,r,n)})},e.rsort=function(t,n){return t.sort(function(t,r){return e.rcompare(t,r,n)})},e.gt=X,e.lt=Z,e.eq=k,e.neq=tt,e.gte=et,e.lte=nt,e.cmp=rt,e.Comparator=ot;var it={};function st(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof st)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new st(t.raw,e);if(t instanceof ot)return new st(t.value,e);if(!(this instanceof st))return new st(t,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map(function(t){return this.parseRange(t.trim())},this).filter(function(t){return t.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+t);this.format()}function ut(t){return!t||"x"===t.toLowerCase()||"*"===t}function ct(t,e,n,r,o,i,s,u,c,a,l,h,p){return((e=ut(n)?"":ut(r)?">="+n+".0.0":ut(o)?">="+n+"."+r+".0":">="+e)+" "+(u=ut(c)?"":ut(a)?"<"+(+c+1)+".0.0":ut(l)?"<"+c+"."+(+a+1)+".0":h?"<="+c+"."+a+"."+l+"-"+h:"<="+u)).trim()}function at(t,e,r){for(var o=0;o<t.length;o++)if(!t[o].test(e))return!1;if(r||(r={}),e.prerelease.length&&!r.includePrerelease){for(o=0;o<t.length;o++)if(n(t[o].semver),t[o].semver!==it&&t[o].semver.prerelease.length>0){var i=t[o].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}function lt(t,e,n){try{e=new st(e,n)}catch(t){return!1}return e.test(t)}function ht(t,e,n,r){var o,i,s,u,c;switch(t=new z(t,r),e=new st(e,r),n){case">":o=X,i=nt,s=Z,u=">",c=">=";break;case"<":o=Z,i=et,s=X,u="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(lt(t,e,r))return!1;for(var a=0;a<e.set.length;++a){var l=e.set[a],h=null,p=null;if(l.forEach(function(t){t.semver===it&&(t=new ot(">=0.0.0")),h=h||t,p=p||t,o(t.semver,h.semver,r)?h=t:s(t.semver,p.semver,r)&&(p=t)}),h.operator===u||h.operator===c)return!1;if((!p.operator||p.operator===u)&&i(t,p.semver))return!1;if(p.operator===c&&s(t,p.semver))return!1}return!0}ot.prototype.parse=function(t){var e=this.options.loose?i[U]:i[q],n=t.match(e);if(!n)throw new TypeError("Invalid comparator: "+t);this.operator=n[1],"="===this.operator&&(this.operator=""),n[2]?this.semver=new z(n[2],this.options.loose):this.semver=it},ot.prototype.toString=function(){return this.value},ot.prototype.test=function(t){return n("Comparator.test",t,this.options.loose),this.semver===it||("string"==typeof t&&(t=new z(t,this.options)),rt(t,this.operator,this.semver,this.options))},ot.prototype.intersects=function(t,e){if(!(t instanceof ot))throw new TypeError("a Comparator is required");var n;if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),""===this.operator)return n=new st(t.value,e),lt(this.value,n,e);if(""===t.operator)return n=new st(this.value,e),lt(t.semver,n,e);var r=!(">="!==this.operator&&">"!==this.operator||">="!==t.operator&&">"!==t.operator),o=!("<="!==this.operator&&"<"!==this.operator||"<="!==t.operator&&"<"!==t.operator),i=this.semver.version===t.semver.version,s=!(">="!==this.operator&&"<="!==this.operator||">="!==t.operator&&"<="!==t.operator),u=rt(this.semver,"<",t.semver,e)&&(">="===this.operator||">"===this.operator)&&("<="===t.operator||"<"===t.operator),c=rt(this.semver,">",t.semver,e)&&("<="===this.operator||"<"===this.operator)&&(">="===t.operator||">"===t.operator);return r||o||i&&s||u||c},e.Range=st,st.prototype.format=function(){return this.range=this.set.map(function(t){return t.join(" ").trim()}).join("||").trim(),this.range},st.prototype.toString=function(){return this.range},st.prototype.parseRange=function(t){var e=this.options.loose;t=t.trim();var r=e?i[V]:i[W];t=t.replace(r,ct),n("hyphen replace",t),t=t.replace(i[x],"$1$2$3"),n("comparator trim",t,i[x]),t=(t=(t=t.replace(i[R],"$1~")).replace(i[B],"$1^")).split(/\s+/).join(" ");var o=e?i[U]:i[q],s=t.split(" ").map(function(t){return function(t,e){return n("comp",t,e),t=function(t,e){return t.trim().split(/\s+/).map(function(t){return function(t,e){n("caret",t,e),e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1});var r=e.loose?i[F]:i[L];return t.replace(r,function(e,r,o,i,s){var u;return n("caret",t,e,r,o,i,s),ut(r)?u="":ut(o)?u=">="+r+".0.0 <"+(+r+1)+".0.0":ut(i)?u="0"===r?">="+r+"."+o+".0 <"+r+"."+(+o+1)+".0":">="+r+"."+o+".0 <"+(+r+1)+".0.0":s?(n("replaceCaret pr",s),"-"!==s.charAt(0)&&(s="-"+s),u="0"===r?"0"===o?">="+r+"."+o+"."+i+s+" <"+r+"."+o+"."+(+i+1):">="+r+"."+o+"."+i+s+" <"+r+"."+(+o+1)+".0":">="+r+"."+o+"."+i+s+" <"+(+r+1)+".0.0"):(n("no pr"),u="0"===r?"0"===o?">="+r+"."+o+"."+i+" <"+r+"."+o+"."+(+i+1):">="+r+"."+o+"."+i+" <"+r+"."+(+o+1)+".0":">="+r+"."+o+"."+i+" <"+(+r+1)+".0.0"),n("caret return",u),u})}(t,e)}).join(" ")}(t,e),n("caret",t),t=function(t,e){return t.trim().split(/\s+/).map(function(t){return function(t,e){e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1});var r=e.loose?i[j]:i[P];return t.replace(r,function(e,r,o,i,s){var u;return n("tilde",t,e,r,o,i,s),ut(r)?u="":ut(o)?u=">="+r+".0.0 <"+(+r+1)+".0.0":ut(i)?u=">="+r+"."+o+".0 <"+r+"."+(+o+1)+".0":s?(n("replaceTilde pr",s),"-"!==s.charAt(0)&&(s="-"+s),u=">="+r+"."+o+"."+i+s+" <"+r+"."+(+o+1)+".0"):u=">="+r+"."+o+"."+i+" <"+r+"."+(+o+1)+".0",n("tilde return",u),u})}(t,e)}).join(" ")}(t,e),n("tildes",t),t=function(t,e){return n("replaceXRanges",t,e),t.split(/\s+/).map(function(t){return function(t,e){t=t.trim(),e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1});var r=e.loose?i[$]:i[N];return t.replace(r,function(e,r,o,i,s,u){n("xRange",t,e,r,o,i,s,u);var c=ut(o),a=c||ut(i),l=a||ut(s),h=l;return"="===r&&h&&(r=""),c?e=">"===r||"<"===r?"<0.0.0":"*":r&&h?(a&&(i=0),l&&(s=0),">"===r?(r=">=",a?(o=+o+1,i=0,s=0):l&&(i=+i+1,s=0)):"<="===r&&(r="<",a?o=+o+1:i=+i+1),e=r+o+"."+i+"."+s):a?e=">="+o+".0.0 <"+(+o+1)+".0.0":l&&(e=">="+o+"."+i+".0 <"+o+"."+(+i+1)+".0"),n("xRange return",e),e})}(t,e)}).join(" ")}(t,e),n("xrange",t),t=function(t,e){return n("replaceStars",t,e),t.trim().replace(i[H],"")}(t,e),n("stars",t),t}(t,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(s=s.filter(function(t){return!!t.match(o)})),s=s.map(function(t){return new ot(t,this.options)},this)},st.prototype.intersects=function(t,e){if(!(t instanceof st))throw new TypeError("a Range is required");return this.set.some(function(n){return n.every(function(n){return t.set.some(function(t){return t.every(function(t){return n.intersects(t,e)})})})})},e.toComparators=function(t,e){return new st(t,e).set.map(function(t){return t.map(function(t){return t.value}).join(" ").trim().split(" ")})},st.prototype.test=function(t){if(!t)return!1;"string"==typeof t&&(t=new z(t,this.options));for(var e=0;e<this.set.length;e++)if(at(this.set[e],t,this.options))return!0;return!1},e.satisfies=lt,e.maxSatisfying=function(t,e,n){var r=null,o=null;try{var i=new st(e,n)}catch(t){return null}return t.forEach(function(t){i.test(t)&&(r&&-1!==o.compare(t)||(o=new z(r=t,n)))}),r},e.minSatisfying=function(t,e,n){var r=null,o=null;try{var i=new st(e,n)}catch(t){return null}return t.forEach(function(t){i.test(t)&&(r&&1!==o.compare(t)||(o=new z(r=t,n)))}),r},e.validRange=function(t,e){try{return new st(t,e).range||"*"}catch(t){return null}},e.ltr=function(t,e,n){return ht(t,e,"<",n)},e.gtr=function(t,e,n){return ht(t,e,">",n)},e.outside=ht,e.prerelease=function(t,e){var n=Q(t,e);return n&&n.prerelease.length?n.prerelease:null},e.intersects=function(t,e,n){return t=new st(t,n),e=new st(e,n),t.intersects(e)},e.coerce=function(t){if(t instanceof z)return t;if("string"!=typeof t)return null;var e=t.match(i[I]);return null==e?null:Q((e[1]||"0")+"."+(e[2]||"0")+"."+(e[3]||"0"))}},function(t,e,n){"use strict";const r=n(0).inherits,o=n(10).EventEmitter,i=n(145),s=n(4).MongoError,u=n(4).MongoNetworkError,c=n(4).MongoWriteConcernError,a=n(34),l=n(0).format,h=n(18).Query,p=n(240),f=n(32).MESSAGE_HEADER_SIZE,d=n(32).opcodes,m=n(74).compress,g=n(74).compressorIDs,y=n(74).uncompressibleCommands,_=n(12).resolveClusterTime,v=n(242),w=n(75).defaultAuthProviders,b=n(14).Buffer;var O="disconnected",S="connecting",A="connected",C="destroying",T="destroyed",E=0;var N=function(t,e){if(o.call(this),this.topology=t,this.options=Object.assign({host:"localhost",port:27017,size:5,minSize:0,connectionTimeout:3e4,socketTimeout:36e4,keepAlive:!0,keepAliveInitialDelay:3e5,noDelay:!0,ssl:!1,checkServerIdentity:!0,ca:null,crl:null,cert:null,key:null,passPhrase:null,rejectUnauthorized:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,reconnect:!0,reconnectInterval:1e3,reconnectTries:30,domainsEnabled:!1},e),this.id=E++,this.retriesLeft=this.options.reconnectTries,this.reconnectId=null,!e.bson||e.bson&&("function"!=typeof e.bson.serialize||"function"!=typeof e.bson.deserialize))throw new Error("must pass in valid bson parser");this.logger=a("Pool",e),this.state=O,this.availableConnections=[],this.inUseConnections=[],this.connectingConnections=[],this.executing=!1,this.queue=[],this.authProviders=e.authProviders||w(e.bson),this.reconnectConnection=null,this.authenticating=!1,this.loggingout=!1,this.nonAuthenticatedConnections=[],this.authenticatingTimestamp=null,this.numberOfConsecutiveTimeouts=0,this.connectionIndex=0};function $(t,e){var n={disconnected:[S,C,O],connecting:[S,C,A,O],connected:[A,O,C],destroying:[C,T],destroyed:[T]}[t.state];n&&-1!==n.indexOf(e)?(t.emit("stateChanged",t.state,e),t.state=e):t.logger.error(l("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",t.id,t.state,e,n))}function I(t,e,n,r){if(void 0===e[0])return r(null);var o=e[0],i=e[1];if(!t.authProviders[o])throw new s(l("authMechanism %s not supported",o));var u=t.authProviders[o];u.auth.apply(u,[M(t),[n],i].concat(e.slice(2)).concat([r]))}function M(t){return function(e,n,r){if(t.state===T||t.state===C)return r(new s("pool destroyed"));e.workItems.push({cb:r,command:!0,requestId:n.requestId}),e.write(n.toBin())}}function R(t,e,n){!function t(e,n,r,o){if(0===r.length)return o();e.authProviders[r.pop()].reauthenticate(M(e),[n],function(i){if(i)return o(i);t(e,n,r,o)})}(t,e,Object.keys(t.authProviders),n)}function P(t,e){return function(n){if(this._connectionFailHandled)return;for(this._connectionFailHandled=!0,this.destroy(),W(t,this);this.workItems.length>0;){var r=this.workItems.shift();r.cb&&r.cb(n)}if("timeout"===e&&(t.numberOfConsecutiveTimeouts=t.numberOfConsecutiveTimeouts+1,t.numberOfConsecutiveTimeouts>t.options.reconnectTries))return t.numberOfConsecutiveTimeouts=0,t.destroy(!0),t.emit("close",t);0===t.socketCount()&&(t.state!==T&&t.state!==C&&$(t,O),e="error"===e?"close":e,t.emit(e,n)),!t.reconnectId&&t.options.reconnect&&(t.reconnectId=setTimeout(j(t),t.options.reconnectInterval)),t.availableConnections.length+t.connectingConnections.length+t.inUseConnections.length<t.minSize&&H(t)}}function j(t){return function(){function e(t){return function(){this._connectionFailHandled||(this._connectionFailHandled=!0,this.destroy(),t.retriesLeft=t.retriesLeft-1,t.retriesLeft<=0?(t.destroy(),t.emit("reconnectFailed",new u(l("failed to reconnect after %s attempts with interval %s ms",t.options.reconnectTries,t.options.reconnectInterval)))):t.reconnectId=setTimeout(j(t),t.options.reconnectInterval))}}t.emit("attemptReconnect",t),t.state!==T&&t.state!==C&&(t.isConnected()?t.reconnectId=null:(t.reconnectConnection=new i(B(t),t.options),t.reconnectConnection.on("close",e(t)),t.reconnectConnection.on("error",e(t)),t.reconnectConnection.on("timeout",e(t)),t.reconnectConnection.on("parseError",e(t)),t.reconnectConnection.on("connect",function(t){return function(){var e=this;if(t.state===T||t.state===C)return e.destroy();V.forEach(function(t){e.removeAllListeners(t)}),t.reconnectId=null,e.on("error",P(t,"error")),e.on("close",P(t,"close")),e.on("timeout",P(t,"timeout")),e.on("parseError",P(t,"parseError")),R(t,this,function(){t.retriesLeft=t.options.reconnectTries,t.availableConnections.push(e),t.reconnectConnection=null,t.emit("reconnect",t),Q(t)()})}}(t)),t.reconnectConnection.connect()))}}function D(t,e,n){var r=e.indexOf(t);-1!==r&&(e.splice(r,1),n.push(t))}function B(t){return function(e,n){for(var r=null,o=0;o<n.workItems.length;o++)n.workItems[o].requestId===e.responseTo&&(r=n.workItems[o],n.workItems.splice(o,1));function i(t,e,n,r){if(!t.options.domainsEnabled)return process.nextTick(function(){return e(n,r)});e(n,r)}t.numberOfConsecutiveTimeouts=0,r&&r.socketTimeout&&n.resetSocketTimeout(),t.logger.isDebug()&&t.logger.debug(l("message [%s] received from %s:%s",e.raw.toString("hex"),t.options.host,t.options.port)),function(t,e,n){var r=t.nonAuthenticatedConnections.slice(0),o=t.nonAuthenticatedConnections;if(t.nonAuthenticatedConnections=[],1===e.workItems.length&&(!0===e.workItems[0].authenticating||"number"==typeof e.workItems[0].authenticatingTimestamp&&e.workItems[0].authenticatingTimestamp!==t.authenticatingTimestamp)&&r.push(e),0===r.length)return D(e,t.inUseConnections,t.availableConnections),n();for(var i=r.length,s=0;s<i;s++)R(t,r[s],function(){0==(i-=1)&&(t.availableConnections=t.availableConnections.concat(o),D(e,t.inUseConnections,t.availableConnections),n())})}(t,n,function(){if(t.executing||process.nextTick(function(){Q(t)()}),r&&!r.immediateRelease){try{e.parse(r)}catch(e){return i(t,r.cb,new s(e))}if(e.documents[0]){if(e.documents[0].$clusterTime){const n=e.documents[0].$clusterTime;t.topology.clusterTime=n,null!=r.session&&_(r.session,n)}e.documents[0].operationTime&&r.session&&r.session.supports.causalConsistency&&r.session.advanceOperationTime(e.documents[0].operationTime)}if(r.command&&e.documents[0]){const n=e.documents[0];if(0===n.ok||n.$err||n.errmsg||n.code)return i(t,r.cb,new s(n));if(n.writeConcernError){const e=1===n.ok?new c(n.writeConcernError,n):new c(n.writeConcernError);return i(t,r.cb,e)}}e.hashedName=n.hashedName,i(t,r.cb,null,new p(r.fullResult?e:e.documents[0],n,e))}})}}r(N,o),Object.defineProperty(N.prototype,"size",{enumerable:!0,get:function(){return this.options.size}}),Object.defineProperty(N.prototype,"minSize",{enumerable:!0,get:function(){return this.options.minSize}}),Object.defineProperty(N.prototype,"connectionTimeout",{enumerable:!0,get:function(){return this.options.connectionTimeout}}),Object.defineProperty(N.prototype,"socketTimeout",{enumerable:!0,get:function(){return this.options.socketTimeout}}),N.prototype.socketCount=function(){return this.availableConnections.length+this.inUseConnections.length},N.prototype.allConnections=function(){return this.availableConnections.concat(this.inUseConnections).concat(this.connectingConnections)},N.prototype.get=function(){return this.allConnections()[0]},N.prototype.isConnected=function(){if(this.state===T||this.state===C)return!1;for(var t=this.availableConnections.concat(this.inUseConnections),e=0;e<t.length;e++)if(t[e].isConnected())return!0;return!(0!==t.length||!this.authenticating)},N.prototype.isDestroyed=function(){return this.state===T||this.state===C},N.prototype.isDisconnected=function(){return this.state===O},N.prototype.connect=function(){if(this.state!==O)throw new s("connection in unlawful state "+this.state);var t=this;$(this,S);var e=Array.prototype.slice.call(arguments,0),n=new i(B(t),this.options);this.connectingConnections.push(n),n.once("connect",function(n){return t.state===T||t.state===C?t.destroy():t.options.inTopology?($(t,A),D(n,t.connectingConnections,t.availableConnections),t.emit("connect",t)):void R(t,n,function(r){return t.state===T||t.state===C?t.destroy():r?(t.destroy(),t.emit("error",r)):void I(t,e,n,function(e){if(t.state===T||t.state===C)return t.destroy();if(e)return t.destroy(),t.emit("error",e);if($(t,A),D(n,t.connectingConnections,t.availableConnections),t.minSize)for(let e=0;e<t.minSize;e++)H(t);t.emit("connect",t)})})}),n.once("error",P(this,"error")),n.once("close",P(this,"close")),n.once("timeout",P(this,"timeout")),n.once("parseError",P(this,"parseError"));try{n.connect()}catch(e){process.nextTick(function(){t.emit("error",e)})}},N.prototype.auth=function(t){var e=this,n=Array.prototype.slice.call(arguments,0),r=n.pop();if(null==e.authProviders[t]&&"default"!==t)throw new s(l("auth provider %s does not exist",t));this.authenticating=!0,this.authenticatingTimestamp=(new Date).getTime(),function t(e,n){if(!e.loggingout)return n();setTimeout(function(){t(e,n)},1)}(e,function(){!function(t,e,n){var o=t.allConnections();t.availableConnections=[],t.inUseConnections=[],t.connectingConnections=[];var i=o.length,s=null;if(0===i)return t.authenticating=!1,r(null);for(var u=0;u<o.length;u++)I(t,e,o[u],function(e,r){if(e&&(s=e),0==(i-=1)){if(t.authenticating=!1,t.availableConnections=t.availableConnections.concat(o),s)return t.logger.isError()&&t.logger.error(l("[%s] failed to authenticate against server %s:%s",t.id,t.options.host,t.options.port)),n(s,r);n(null,r)}})}(e,n,function(t,n){e.authenticating=!1,r(t,n)})})},N.prototype.logout=function(t,e){var n=this;if("string"!=typeof t)throw new s("logout method requires a db name as first argument");if("function"!=typeof e)throw new s("logout method requires a callback");this.loggingout=!0;for(var r=n.availableConnections.concat(n.inUseConnections),o=r.length,i=null,u=0;u<r.length;u++)M(n)(r[u],new h(this.options.bson,l("%s.$cmd",t),{logout:1},{numberToSkip:0,numberToReturn:1}),function(t){t&&(i=t),0===(o-=1)&&(n.loggingout=!1,e(i))})},N.prototype.unref=function(){this.availableConnections.concat(this.inUseConnections).concat(this.connectingConnections).forEach(function(t){t.unref()})};var L=["error","close","timeout","parseError","connect"];function F(t,e){e.forEach(function(t){for(var e=0;e<L.length;e++)t.removeAllListeners(L[e]);t.destroy()}),t.inUseConnections=[],t.availableConnections=[],t.nonAuthenticatedConnections=[],t.connectingConnections=[],$(t,T)}N.prototype.destroy=function(t){var e=this;if(this.state!==T&&e.state!==C){if($(this,C),t){for(var n=e.availableConnections.concat(e.inUseConnections).concat(e.nonAuthenticatedConnections).concat(e.connectingConnections);e.queue.length>0;){var r=e.queue.shift();"function"==typeof r.cb&&r.cb(new s("Pool was force destroyed"))}return F(e,n)}this.reconnectId&&clearTimeout(this.reconnectId),this.reconnectConnection&&this.reconnectConnection.destroy(),function t(){if(Y(e.queue),0===e.queue.length){for(var n=e.availableConnections.concat(e.inUseConnections).concat(e.nonAuthenticatedConnections).concat(e.connectingConnections),r=0;r<n.length;r++)if(n[r].workItems.length>0)return setTimeout(t,1);F(e,n)}else Q(e)(),setTimeout(t,1)}()}};var U=function(t,e,n,r){if(0===e.length)return r(null,n);var o=e.shift(),i=o.toBin();if(t.options.agreedCompressor&&!q(o)){var s=b.concat(i),u=s.slice(f),c=s.readInt32LE(12);m(t,u,function(i,s){if(i)return r(i,null);var a=b.alloc(f);a.writeInt32LE(f+9+s.length,0),a.writeInt32LE(o.requestId,4),a.writeInt32LE(0,8),a.writeInt32LE(d.OP_COMPRESSED,12);var l=b.alloc(9);l.writeInt32LE(c,0),l.writeInt32LE(u.length,4),l.writeUInt8(g[t.options.agreedCompressor],8),n.push(b.concat([a,l,s])),U(t,e,n,r)})}else n.push(i),U(t,e,n,r)};N.prototype.write=function(t,e,n){var r=this;if("function"==typeof e&&(n=e),e=e||{},"function"!=typeof n&&!e.noResponse)throw new s("write method must provide a callback");if(this.state!==T&&this.state!==C){if(this.options.domainsEnabled&&process.domain&&"function"==typeof n){var o=n;n=process.domain.bind(function(){for(var t=new Array(arguments.length),e=0;e<arguments.length;e++)t[e]=arguments[e];process.nextTick(function(){o.apply(null,t)})})}var i,u={cb:n,raw:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,fullResult:!1};if(u.promoteLongs="boolean"!=typeof e.promoteLongs||e.promoteLongs,u.promoteValues="boolean"!=typeof e.promoteValues||e.promoteValues,u.promoteBuffers="boolean"==typeof e.promoteBuffers&&e.promoteBuffers,u.raw="boolean"==typeof e.raw&&e.raw,u.immediateRelease="boolean"==typeof e.immediateRelease&&e.immediateRelease,u.documentsReturnedIn=e.documentsReturnedIn,u.command="boolean"==typeof e.command&&e.command,u.fullResult="boolean"==typeof e.fullResult&&e.fullResult,u.noResponse="boolean"==typeof e.noResponse&&e.noResponse,u.session=e.session||null,u.socketTimeout=e.socketTimeout,u.monitoring=e.monitoring,e.socketTimeout&&(u.socketTimeout=e.socketTimeout),Array.isArray(t)||(t=[t]),u.requestId=t[t.length-1].requestId,null!=(i=this.topology)&&null!=i.ismaster&&i.ismaster.maxWireVersion>=6){let e={};if(this.topology.clusterTime&&(e={$clusterTime:this.topology.clusterTime}),u.session){if(u.session.hasEnded)return n(new s("Use of expired sessions is not permitted"));u.session.clusterTime&&u.session.clusterTime.clusterTime.greaterThan(e.$clusterTime.clusterTime)&&(e.$clusterTime=u.session.clusterTime),e.lsid=u.session.id,u.session.serverSession.lastUse=Date.now()}t.forEach(t=>{t instanceof h?t.query.$query?Object.assign(t.query.$query,e):Object.assign(t.query,e):Object.assign(t,e)})}if(r.options.monitorCommands){const e=t[0];this.emit("commandStarted",new v.CommandStartedEvent(this,e)),u.started=process.hrtime(),u.cb=((t,o)=>{t?r.emit("commandFailed",new v.CommandFailedEvent(this,e,t,u.started)):o&&o.result&&(0===o.result.ok||o.result.$err)?r.emit("commandFailed",new v.CommandFailedEvent(this,e,o.result,u.started)):r.emit("commandSucceeded",new v.CommandSucceededEvent(this,e,o,u.started)),"function"==typeof n&&n(t,o)})}U(r,t,[],function(t,n){if(t)throw t;u.buffer=n,e.monitoring?r.queue.unshift(u):r.queue.push(u),r.executing||process.nextTick(function(){Q(r)()})})}else if(n)try{n(new s("pool destroyed"))}catch(t){process.nextTick(function(){throw t})}};var q=function(t){return y.some(function(e){return t.query.hasOwnProperty(e)})};function x(t,e){for(var n=0;n<e.length;n++)if(e[n]===t)return e.splice(n,1),!0}function W(t,e){x(e,t.availableConnections)||x(e,t.inUseConnections)||x(e,t.connectingConnections)||x(e,t.nonAuthenticatedConnections)}var V=["close","message","error","timeout","parseError","connect"];function H(t){if(t.state!==T&&t.state!==C){var e=new i(B(t),t.options);t.connectingConnections.push(e);var n,r=function(e){return function(){e.destroy(),W(t,e),!t.reconnectId&&t.options.reconnect&&(t.reconnectId=setTimeout(j(t),t.options.reconnectInterval))}};e.once("close",r(e)),e.once("error",r(e)),e.once("timeout",r(e)),e.once("parseError",r(e)),e.once("connect",(n=e,function(){if(t.state===T||t.state===C)return W(t,n),n.destroy();V.forEach(function(t){n.removeAllListeners(t)}),n.once("close",P(t,"close")),n.once("error",P(t,"error")),n.once("timeout",P(t,"timeout")),n.once("parseError",P(t,"parseError")),R(t,n,function(e){return t.state===T||t.state===C?n.destroy():(W(t,n),e?n.destroy():void(t.authenticating?t.nonAuthenticatedConnections.push(n):(t.availableConnections.push(n),Q(t)())))})})),e.connect()}}function Y(t){for(var e=0;e<t.length;e++)if(t[e].monitoring){var n=t[e];t.splice(e,1),n.cb(new s({message:"no connection available for monitoring",driver:!0}))}}function Q(t){return function(){t.state!==T&&(t.executing||(t.executing=!0,function e(n){if(!t.authenticating)return n();setTimeout(function(){e(n)},1)}(function(){if(!(t.connectingConnections.length>0))for(;;){var e=t.availableConnections.length+t.connectingConnections.length+t.inUseConnections.length;if(0===t.availableConnections.length){Y(t.queue);break}if(0===t.queue.length)break;for(var n=null,r=[],o=0;o<t.availableConnections.length;o++)0===t.availableConnections[o].workItems.length&&r.push(t.availableConnections[o]);if((n=0===r.length?t.availableConnections[t.connectionIndex++%t.availableConnections.length]:r[t.connectionIndex++%r.length]).isConnected()){var i=t.queue.shift();if(i.monitoring){var s=!1;for(o=0;o<t.availableConnections.length;o++)if(t.availableConnections[o].isConnected()&&0===t.availableConnections[o].workItems.length){s=!0,n=t.availableConnections[o];break}if(!s){t.queue.unshift(i),e<t.options.size&&t.queue.length>0&&H(t),setTimeout(function(){Q(t)()},10);break}}if(e<t.options.size&&n.workItems.length>0){t.queue.unshift(i),H(t);break}var u=i.buffer;i.authenticating=t.authenticating,i.authenticatingTimestamp=t.authenticatingTimestamp,i.monitoring&&D(n,t.availableConnections,t.inUseConnections),i.noResponse||n.workItems.push(i),i.immediateRelease||"number"!=typeof i.socketTimeout||n.setSocketTimeout(i.socketTimeout);var c=!0;if(Array.isArray(u))for(o=0;o<u.length;o++)c=n.write(u[o]);else c=n.write(u);i.noResponse&&"function"==typeof i.cb&&i.cb(null,null),c&&i.immediateRelease&&t.authenticating?(W(t,n),t.nonAuthenticatedConnections.push(n)):!1===c&&(t.queue.unshift(i),W(t,n),Y(t.queue))}else W(t,n),Y(t.queue)}}),t.executing=!1))}}N._execute=Q,t.exports=N},function(t,e,n){"use strict";var r=function(t,e,n){this.result=t,this.connection=e,this.message=n};r.prototype.toJSON=function(){return this.result},r.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.exports=r},function(t){t.exports={_from:"mongodb-core@3.1.9",_id:"mongodb-core@3.1.9",_inBundle:!1,_integrity:"sha512-MJpciDABXMchrZphh3vMcqu8hkNf/Mi+Gk6btOimVg1XMxLXh87j6FAvRm+KmwD1A9fpu3qRQYcbQe4egj23og==",_location:"/mongodb-core",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"mongodb-core@3.1.9",name:"mongodb-core",escapedName:"mongodb-core",rawSpec:"3.1.9",saveSpec:null,fetchSpec:"3.1.9"},_requiredBy:["/mongodb","/mongoose"],_resolved:"https://registry.npmjs.org/mongodb-core/-/mongodb-core-3.1.9.tgz",_shasum:"c31ee407bf932b0149eaed775c17ee09974e4ca3",_spec:"mongodb-core@3.1.9",_where:"/Users/andeladeveloper/Documents/workspace/micro-blog/node_modules/mongoose",author:{name:"Christian Kvalheim"},bugs:{url:"https://github.com/mongodb-js/mongodb-core/issues"},bundleDependencies:!1,dependencies:{bson:"^1.1.0",require_optional:"^1.0.1","safe-buffer":"^5.1.2",saslprep:"^1.0.0"},deprecated:!1,description:"Core MongoDB driver functionality, no bells and whistles and meant for integration not end applications",devDependencies:{chai:"^4.1.2","chai-subset":"^1.6.0",co:"^4.6.0",eslint:"^4.6.1","eslint-plugin-prettier":"^2.2.0",jsdoc:"3.5.4","mongodb-extjson":"^2.1.2","mongodb-mock-server":"^1.0.0","mongodb-test-runner":"^1.1.18",prettier:"~1.12.0",sinon:"^6.0.0",snappy:"^6.1.1","standard-version":"^4.4.0"},files:["index.js","lib"],homepage:"https://github.com/mongodb-js/mongodb-core",keywords:["mongodb","core"],license:"Apache-2.0",main:"index.js",name:"mongodb-core",optionalDependencies:{saslprep:"^1.0.0"},peerOptionalDependencies:{kerberos:"^1.0.0","mongodb-extjson":"^2.1.2",snappy:"^6.1.1","bson-ext":"^2.0.0"},repository:{type:"git",url:"git://github.com/mongodb-js/mongodb-core.git"},scripts:{atlas:"node ./test/atlas.js",changelog:"conventional-changelog -p angular -i HISTORY.md -s",coverage:"nyc node test/runner.js -t functional -l && node_modules/.bin/nyc report --reporter=text-lcov | node_modules/.bin/coveralls",format:"prettier --print-width 100 --tab-width 2 --single-quote --write index.js 'test/**/*.js' 'lib/**/*.js'",lint:"eslint index.js lib test",release:"standard-version -i HISTORY.md",test:"npm run lint && mongodb-test-runner -t 60000 test/tests"},version:"3.1.9"}},function(t,e,n){"use strict";const r=n(18).KillCursor,o=n(18).GetMore,i=n(27).calculateDurationInMs,s=new Set(["authenticate","saslStart","saslContinue","getnonce","createUser","updateUser","copydbgetnonce","copydbsaslstart","copydb"]),u=t=>Object.keys(t)[0],c=t=>t.ns,a=t=>t.ns.split(".")[0],l=t=>t.ns.split(".")[1],h=t=>`${t.options.host}:${t.options.port}`,p=(t,e)=>s.has(t)?{}:e,f={$query:"filter",$orderby:"sort",$hint:"hint",$comment:"comment",$maxScan:"maxScan",$max:"max",$min:"min",$returnKey:"returnKey",$showDiskLoc:"showRecordId",$maxTimeMS:"maxTimeMS",$snapshot:"snapshot"},d={numberToSkip:"skip",numberToReturn:"batchSize",returnFieldsSelector:"projection"},m=["tailable","oplogReplay","noCursorTimeout","awaitData","partial","exhaust"],g=t=>{if(t instanceof o)return{getMore:t.cursorId,collection:l(t),batchSize:t.numberToReturn};if(t instanceof r)return{killCursors:l(t),cursors:t.cursorIds};if(t.query&&t.query.$query){let e;return"admin.$cmd"===t.ns?e=Object.assign({},t.query.$query):(e={find:l(t)},Object.keys(f).forEach(n=>{void 0!==t.query[n]&&(e[f[n]]=t.query[n])})),Object.keys(d).forEach(n=>{void 0!==t.options[n]&&(e[d[n]]=t.options[n])}),m.forEach(n=>{t[n]&&(e[n]=t[n])}),void 0!==t.pre32Limit&&(e.limit=t.pre32Limit),t.query.$explain?{explain:e}:e}return t.query?t.query:t},y=(t,e)=>t instanceof o?{ok:1,cursor:{id:e.message.cursorId,ns:c(t),nextBatch:e.message.documents}}:t instanceof r?{ok:1,cursorsUnknown:t.cursorIds}:t.query&&void 0!==t.query.$query?{ok:1,cursor:{id:e.message.cursorId,ns:c(t),firstBatch:e.message.documents}}:e.result;t.exports={CommandStartedEvent:class{constructor(t,e){const n=g(e),r=u(n);s.has(r)&&(this.commandObj={},this.commandObj[r]=!0),Object.assign(this,{command:n,databaseName:a(e),commandName:r,requestId:e.requestId,connectionId:h(t)})}},CommandSucceededEvent:class{constructor(t,e,n,r){const o=g(e),s=u(o);Object.assign(this,{duration:i(r),commandName:s,reply:p(s,y(e,n)),requestId:e.requestId,connectionId:h(t)})}},CommandFailedEvent:class{constructor(t,e,n,r){const o=g(e),s=u(o);Object.assign(this,{duration:i(r),commandName:s,failure:p(s,n),requestId:e.requestId,connectionId:h(t)})}}}},function(t,e,n){"use strict";const r=n(0).format,o=n(18).Query,i=n(4).MongoError,s=n(27).retrieveKerberos;var u=function(t,e,n,r){this.db=t,this.username=e,this.password=n,this.options=r};u.prototype.equal=function(t){return t.db===this.db&&t.username===this.username&&t.password===this.password};var c=function(t){this.bson=t,this.authStore=[]};function a(t,e,n,r,i,s,u,c,a){const l=new e(u.host,u.port,i,c);function h(e,n){const r=new o(t.bson,"$external.$cmd",e,{numberToSkip:0,numberToReturn:1});s(u,r,n)}l.init(n,r,t=>{if(t)return a(t,!1);l.transition("",(t,e)=>{if(t)return a(t,!1);h({saslStart:1,mechanism:"GSSAPI",payload:e,autoAuthorize:1},(t,e)=>{if(t)return a(t,!1);const n=e.result;l.transition(n.payload,(t,e)=>{if(t)return a(t,!1);h({saslContinue:1,conversationId:n.conversationId,payload:e},(t,e)=>{if(t)return a(t,!1);const n=e.result;l.transition(n.payload,(t,e)=>{if(t)return a(t,!1);h({saslContinue:1,conversationId:n.conversationId,payload:e},(t,e)=>{if(t)return a(t,!1);l.transition(null,t=>{if(t)return a(t,null);a(null,e)})})})})})})})})}c.prototype.auth=function(t,e,n,o,c,h,p){var f=this;let d;try{d=s()}catch(t){return p(t,null)}var m=h.gssapiServiceName||"mongodb",g=e.length;if(0===g)return p(null,null);for(var y=0,_=null;e.length>0;){!function(e){process.nextTick(function(){var s;s=e,a(f,d.processes.MongoAuthProcess,o,c,m,t,s,h,function(t,e){g-=1,t?_=t:e&&"object"==typeof e&&e.result.$err?_=e.result:e&&"object"==typeof e&&e.result.errmsg?_=e.result:y+=1,0===g&&y>0?(l(f.authStore,new u(n,o,c,h)),p(null,!0)):0===g&&(null==_&&(_=new i(r("failed to authenticate using mongocr"))),p(_,!1))})})}(e.shift())}};var l=function(t,e){for(var n=!1,r=0;r<t.length;r++)if(t[r].equal(e)){n=!0;break}n||t.push(e)};c.prototype.logout=function(t){this.authStore=this.authStore.filter(function(e){return e.db!==t})},c.prototype.reauthenticate=function(t,e,n){var r=this.authStore.slice(0),o=r.length;if(0===o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(t,e,r[i].db,r[i].username,r[i].password,r[i].options,function(t){0===(o-=1)&&n(t,null)})},t.exports=c},function(t,e,n){"use strict";const{unassigned_code_points:r,commonly_mapped_to_nothing:o,non_ASCII_space_characters:i,prohibited_characters:s,bidirectional_r_al:u,bidirectional_l:c}=n(245);t.exports=function(t,e={}){if("string"!=typeof t)throw new TypeError("Expected string.");if(0===t.length)return"";const n=t.split("").map(h).map(t=>a.get(t)?32:t).filter(t=>!l.get(t)),o=String.fromCodePoint(...n).normalize("NFKC"),i=o.split("").map(h);if(i.some(t=>s.get(t)))throw new Error("Prohibited character, see https://tools.ietf.org/html/rfc4013#section-2.3");if(!0!==e.allowUnassigned){const t=i.some(t=>r.get(t));if(t)throw new Error("Unassigned code point, see https://tools.ietf.org/html/rfc4013#section-2.5")}const d=i.some(t=>u.get(t)),m=i.some(t=>c.get(t));if(d&&m)throw new Error("String must not contain RandALCat and LCat at the same time, see https://tools.ietf.org/html/rfc3454#section-6");const g=u.get(h(p(o))),y=u.get(h(f(o)));if(d&&(!g||!y))throw new Error("Bidirectional RandALCat character must be the first and the last character of the string, see https://tools.ietf.org/html/rfc3454#section-6");return o};const a=i,l=o,h=t=>t.codePointAt(0),p=t=>t[0],f=t=>t[t.length-1]},function(t,e,n){"use strict";(function(e){const r=n(48),o=n(53),i=n(246),s=r.readFileSync(o.resolve(e,"../code-points.mem"));let u=0;function c(){const t=s.readUInt32BE(u);u+=4;const e=s.slice(u,u+t);return u+=t,i({buffer:e})}const a=c(),l=c(),h=c(),p=c(),f=c(),d=c();t.exports={unassigned_code_points:a,commonly_mapped_to_nothing:l,non_ASCII_space_characters:h,prohibited_characters:p,bidirectional_r_al:f,bidirectional_l:d}}).call(this,"/")},function(t,e,n){var r=n(247);function o(t){if(!(this instanceof o))return new o(t);if(t||(t={}),Buffer.isBuffer(t)&&(t={buffer:t}),this.pageOffset=t.pageOffset||0,this.pageSize=t.pageSize||1024,this.pages=t.pages||r(this.pageSize),this.byteLength=this.pages.length*this.pageSize,this.length=8*this.byteLength,(e=this.pageSize)&e-1)throw new Error("The page size should be a power of two");var e;if(this._trackUpdates=!!t.trackUpdates,this._pageMask=this.pageSize-1,t.buffer){for(var n=0;n<t.buffer.length;n+=this.pageSize)this.pages.set(n/this.pageSize,t.buffer.slice(n,n+this.pageSize));this.byteLength=t.buffer.length,this.length=8*this.byteLength}}t.exports=o,o.prototype.get=function(t){var e=7&t,n=(t-e)/8;return!!(this.getByte(n)&128>>e)},o.prototype.getByte=function(t){var e=t&this._pageMask,n=(t-e)/this.pageSize,r=this.pages.get(n,!0);return r?r.buffer[e+this.pageOffset]:0},o.prototype.set=function(t,e){var n=7&t,r=(t-n)/8,o=this.getByte(r);return this.setByte(r,e?o|128>>n:o&(255^128>>n))},o.prototype.toBuffer=function(){for(var t=function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e}(this.pages.length*this.pageSize),e=0;e<this.pages.length;e++){var n=this.pages.get(e,!0),r=e*this.pageSize;n&&n.buffer.copy(t,r,this.pageOffset,this.pageOffset+this.pageSize)}return t},o.prototype.setByte=function(t,e){var n=t&this._pageMask,r=(t-n)/this.pageSize,o=this.pages.get(r,!1);return n+=this.pageOffset,o.buffer[n]!==e&&(o.buffer[n]=e,t>=this.byteLength&&(this.byteLength=t+1,this.length=8*this.byteLength),this._trackUpdates&&this.pages.updated(o),!0)}},function(t,e){function n(t,e){if(!(this instanceof n))return new n(t,e);this.length=0,this.updates=[],this.path=new Uint16Array(4),this.pages=new Array(32768),this.maxPages=this.pages.length,this.level=0,this.pageSize=t||1024,this.deduplicate=e?e.deduplicate:null,this.zeros=this.deduplicate?r(this.deduplicate.length):null}function r(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e}function o(t,e){this.offset=t*e.length,this.buffer=e,this.updated=!1,this.deduplicate=0}t.exports=n,n.prototype.updated=function(t){for(;this.deduplicate&&t.buffer[t.deduplicate]===this.deduplicate[t.deduplicate];)if(t.deduplicate++,t.deduplicate===this.deduplicate.length){t.deduplicate=0,t.buffer.equals&&t.buffer.equals(this.deduplicate)&&(t.buffer=this.deduplicate);break}!t.updated&&this.updates&&(t.updated=!0,this.updates.push(t))},n.prototype.lastUpdate=function(){if(!this.updates||!this.updates.length)return null;var t=this.updates.pop();return t.updated=!1,t},n.prototype._array=function(t,e){if(t>=this.maxPages){if(e)return;!function(t,e){for(;t.maxPages<e;){var n=t.pages;t.pages=new Array(32768),t.pages[0]=n,t.level++,t.maxPages*=32768}}(this,t)}var n,r;n=t,r=this.path,n=((n=(n-(r[0]=32767&n))/32768)-(r[1]=32767&n))/32768,r[3]=(n-(r[2]=32767&n))/32768&32767;for(var o=this.pages,i=this.level;i>0;i--){var s=this.path[i],u=o[s];if(!u){if(e)return;u=o[s]=new Array(32768)}o=u}return o},n.prototype.get=function(t,e){var n,i,s=this._array(t,e),u=this.path[0],c=s&&s[u];return c||e||(c=s[u]=new o(t,r(this.pageSize)),t>=this.length&&(this.length=t+1)),c&&c.buffer===this.deduplicate&&this.deduplicate&&!e&&(c.buffer=(n=c.buffer,i=Buffer.allocUnsafe?Buffer.allocUnsafe(n.length):new Buffer(n.length),n.copy(i),i),c.deduplicate=0),c},n.prototype.set=function(t,e){var n=this._array(t,!1),i=this.path[0];if(t>=this.length&&(this.length=t+1),!e||this.zeros&&e.equals&&e.equals(this.zeros))n[i]=void 0;else{this.deduplicate&&e.equals&&e.equals(this.deduplicate)&&(e=this.deduplicate);var s=n[i],u=function(t,e){if(t.length===e)return t;if(t.length>e)return t.slice(0,e);var n=r(e);return t.copy(n),n}(e,this.pageSize);s?s.buffer=u:n[i]=new o(t,u)}},n.prototype.toBuffer=function(){for(var t=new Array(this.length),e=r(this.pageSize),n=0;n<t.length;)for(var o=this._array(n,!0),i=0;i<32768&&n<t.length;i++)t[n++]=o&&o[i]?o[i].buffer:e;return Buffer.concat(t)}},function(t,e,n){"use strict";var r=n(20).copy,o=n(20).retrieveBSON,i=n(18).KillCursor,s=n(18).GetMore,u=n(18).Query,c=n(0).format,a=n(4).MongoError,l=n(32).getReadPreference,h=o().Long,p=function(){},f=function(t,e,n,r,o,i,s,l){if(0===i.length)throw new a("insert must contain at least one document");"function"==typeof s&&(l=s,s=(s={})||{});var h=o.split("."),p=h.shift(),f="boolean"!=typeof s.ordered||s.ordered,d=s.writeConcern,m={};m[n]=h.join("."),m[r]=i,m.ordered=f,d&&Object.keys(d).length>0&&(m.writeConcern=d),!0===s.bypassDocumentValidation&&(m.bypassDocumentValidation=s.bypassDocumentValidation);var g={command:!0};void 0!==s.session&&(g.session=s.session);var y={checkKeys:!1,numberToSkip:0,numberToReturn:1};"insert"===n&&(y.checkKeys=!0),"boolean"==typeof s.checkKeys&&(y.checkKeys=s.checkKeys),s.serializeFunctions&&(y.serializeFunctions=s.serializeFunctions),s.ignoreUndefined&&(y.ignoreUndefined=s.ignoreUndefined);try{var _=new u(e,c("%s.$cmd",p),m,y);t.write(_,g,l)}catch(t){l(t)}};p.prototype.insert=function(t,e,n,r,o,i){f(t,n,"insert","documents",e,r,o,i)},p.prototype.update=function(t,e,n,r,o,i){f(t,n,"update","updates",e,r,o,i)},p.prototype.remove=function(t,e,n,r,o,i){f(t,n,"delete","deletes",e,r,o,i)},p.prototype.killCursor=function(t,e,n,r,o){var s=n.cursorId,u=new i(t,e,[s]);const c={immediateRelease:!0,noResponse:!0};if("object"==typeof n.session&&(c.session=n.session),r&&r.isConnected())try{r.write(u,c,o)}catch(t){"function"==typeof o?o(t,null):console.warn(t)}},p.prototype.getMore=function(t,e,n,r,o,i,u,c){var l=new s(t,e,n.cursorId,{numberToReturn:r}),p={};o&&(p.raw=o),"boolean"==typeof n.promoteLongs&&(p.promoteLongs=n.promoteLongs),"boolean"==typeof n.promoteValues&&(p.promoteValues=n.promoteValues),"boolean"==typeof n.promoteBuffers&&(p.promoteBuffers=n.promoteBuffers),"object"==typeof n.session&&(p.session=n.session),i.write(l,p,function(t,e){if(t)return c(t);var r=e.message;if(0!=(1&r.responseFlags))return c(new a("cursor does not exist, was killed or timed out"),null);var o="number"==typeof r.cursorId?h.fromNumber(r.cursorId):r.cursorId;n.documents=r.documents,n.cursorId=o,c(null,null,r.connection)})},p.prototype.command=function(t,e,n,r,o,i){if(n.find)return d(t,e,n,r,o,i);if(null==r.cursorId){if(n)return m(t,e,n,r,o,i);throw new a(c("command %s does not return a cursor",JSON.stringify(n)))}};var d=function(t,e,n,o,i,s){var h=l(n,s=s||{});o.batchSize=n.batchSize||o.batchSize;var p=0;p=0===o.limit?o.batchSize:o.limit<0||o.limit<o.batchSize||o.limit>0&&0===o.batchSize?o.limit:o.batchSize;var f=o.skip||0,d={};if("mongos"===i.type&&h&&(d.$readPreference=h.toJSON()),n.sort&&(d.$orderby=n.sort),n.hint&&(d.$hint=n.hint),n.snapshot&&(d.$snapshot=n.snapshot),void 0!==n.returnKey&&(d.$returnKey=n.returnKey),n.maxScan&&(d.$maxScan=n.maxScan),n.min&&(d.$min=n.min),n.max&&(d.$max=n.max),void 0!==n.showDiskLoc&&(d.$showDiskLoc=n.showDiskLoc),n.comment&&(d.$comment=n.comment),n.maxTimeMS&&(d.$maxTimeMS=n.maxTimeMS),n.explain&&(p=-Math.abs(n.limit||0),d.$explain=!0),d.$query=n.query,n.readConcern&&"local"!==n.readConcern.level)throw new a(c("server find command does not support a readConcern level of %s",n.readConcern.level));n.readConcern&&delete(n=r(n)).readConcern;var m="boolean"==typeof s.serializeFunctions&&s.serializeFunctions,g="boolean"==typeof s.ignoreUndefined&&s.ignoreUndefined,y=new u(t,e,d,{numberToSkip:f,numberToReturn:p,pre32Limit:void 0!==n.limit?n.limit:void 0,checkKeys:!1,returnFieldSelector:n.fields,serializeFunctions:m,ignoreUndefined:g});return y.slaveOk=h.slaveOk(),"boolean"==typeof n.tailable&&(y.tailable=n.tailable),"boolean"==typeof n.oplogReplay&&(y.oplogReplay=n.oplogReplay),"boolean"==typeof n.noCursorTimeout&&(y.noCursorTimeout=n.noCursorTimeout),"boolean"==typeof n.awaitData&&(y.awaitData=n.awaitData),"boolean"==typeof n.partial&&(y.partial=n.partial),y},m=function(t,e,n,r,o,i){var s=l(n,i=i||{}),h={};for(var p in n)h[p]=n[p];var f=e.split(/\./),d="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,m="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined;if(n.readConcern&&"local"!==n.readConcern.level)throw new a(c("server %s command does not support a readConcern level of %s",JSON.stringify(n),n.readConcern.level));n.readConcern&&delete n.readConcern,"mongos"===o.type&&s&&"primary"!==s.preference&&(h={$query:h,$readPreference:s.toJSON()});var g=new u(t,c("%s.$cmd",f.shift()),h,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,serializeFunctions:d,ignoreUndefined:m});return g.slaveOk=s.slaveOk(),g};t.exports=p},function(t,e,n){"use strict";const r=n(18).Query,o=n(20).retrieveBSON,i=n(4).MongoError,s=n(4).MongoNetworkError,u=n(32).getReadPreference,c=o(),a=c.Long,l=n(33),h=n(100).TxnState,p=function(){};function f(t,e,n){if(!e)return;const r=e.serverSession,o=e.inTransaction()||function(t){return!(!t.commitTransaction&&!t.abortTransaction)}(t),s=n.willRetryWrite;if(r.txnNumber&&(s||o)&&(t.txnNumber=c.Long.fromNumber(r.txnNumber)),!o)return e.transaction.state!==h.NO_TRANSACTION&&e.transaction.transition(h.NO_TRANSACTION),void(e.supports.causalConsistency&&e.operationTime&&(t.readConcern=t.readConcern||{},Object.assign(t.readConcern,{afterClusterTime:e.operationTime})));if(n.readPreference&&!n.readPreference.equals(l.primary))return new i(`Read preference in a transaction must be primary, not: ${n.readPreference.mode}`);if(t.autocommit=!1,e.transaction.state===h.STARTING_TRANSACTION){e.transaction.transition(h.TRANSACTION_IN_PROGRESS),t.startTransaction=!0;const n=e.transaction.options.readConcern||e.clientOptions.readConcern;n&&(t.readConcern=n),e.supports.causalConsistency&&e.operationTime&&(t.readConcern=t.readConcern||{},Object.assign(t.readConcern,{afterClusterTime:e.operationTime}))}}function d(t,e,n,o,s,u,c,a){if(0===u.length)throw new i("insert must contain at least one document");"function"==typeof c&&(a=c,c=(c={})||{});const l=s.split("."),h=l.shift(),p="boolean"!=typeof c.ordered||c.ordered,d=c.writeConcern,m={};if(m[n]=l.join("."),m[o]=u,m.ordered=p,d&&Object.keys(d).length>0&&(m.writeConcern=d),c.collation)for(let t=0;t<m[o].length;t++)m[o][t].collation||(m[o][t].collation=c.collation);!0===c.bypassDocumentValidation&&(m.bypassDocumentValidation=c.bypassDocumentValidation);const g=f(m,c.session,c);if(g)return a(g,null);const y={command:!0};void 0!==c.session&&(y.session=c.session);const _={checkKeys:!1,numberToSkip:0,numberToReturn:1};"insert"===n&&(_.checkKeys=!0),"boolean"==typeof c.checkKeys&&(_.checkKeys=c.checkKeys),c.serializeFunctions&&(_.serializeFunctions=c.serializeFunctions),c.ignoreUndefined&&(_.ignoreUndefined=c.ignoreUndefined);try{const n=new r(e,`${h}.$cmd`,m,_);t.write(n,y,a)}catch(g){a(g)}}p.prototype.insert=function(t,e,n,r,o,i){d(t,n,"insert","documents",e,r,o,i)},p.prototype.update=function(t,e,n,r,o,i){d(t,n,"update","updates",e,r,o,i)},p.prototype.remove=function(t,e,n,r,o,i){d(t,n,"delete","deletes",e,r,o,i)},p.prototype.killCursor=function(t,e,n,o,u){const c=e.split(/\./),a=`${c.shift()}.$cmd`,l=n.cursorId,h={killCursors:c.join("."),cursors:[l]},p=new r(t,a,h,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,returnFieldSelector:null});function f(t,e){if(t){if("function"!=typeof u)return;return u(t)}const n=e.message;if(0!=(1&n.responseFlags)){if("function"!=typeof u)return;return u(new s("cursor killed or timed out"),null)}if(!Array.isArray(n.documents)||0===n.documents.length){if("function"!=typeof u)return;return u(new i(`invalid killCursors result returned for cursor id ${l}`))}"function"==typeof u&&u(null,n.documents[0])}const d={command:!0};if("object"==typeof n.session&&(d.session=n.session),o&&o.isConnected())try{o.write(p,d,f)}catch(t){f(t,null)}else"function"==typeof u&&u(null,null)},p.prototype.getMore=function(t,e,n,o,u,c,l,h){l=l||{};const p=e.split(/\./),d=`${p.shift()}.$cmd`,m={getMore:n.cursorId,collection:p.join("."),batchSize:Math.abs(o)},g=f(m,l.session,l);if(g)return h(g,null);n.cmd.tailable&&"number"==typeof n.cmd.maxAwaitTimeMS&&(m.maxTimeMS=n.cmd.maxAwaitTimeMS);const y=new r(t,d,m,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,returnFieldSelector:null});const _={command:!0};u&&(_.raw=u),_.documentsReturnedIn="nextBatch","boolean"==typeof n.promoteLongs&&(_.promoteLongs=n.promoteLongs),"boolean"==typeof n.promoteValues&&(_.promoteValues=n.promoteValues),"boolean"==typeof n.promoteBuffers&&(_.promoteBuffers=n.promoteBuffers),"object"==typeof n.session&&(_.session=n.session),c.write(y,_,function(t,e){if(t)return h(t);const r=e.message;if(0!=(1&r.responseFlags))return h(new s("cursor killed or timed out"),null);if(u)return n.documents=r.documents,n.cursorId=r.cursorId,h(null,r.documents);if(0===r.documents[0].ok)return h(new i(r.documents[0]));const o="number"==typeof r.documents[0].cursor.id?a.fromNumber(r.documents[0].cursor.id):r.documents[0].cursor.id;n.documents=r.documents[0].cursor.nextBatch,n.cursorId=o,h(null,r.documents[0],r.connection)})},p.prototype.command=function(t,e,n,o,s,c){const a="boolean"!=typeof(c=c||{}).wireProtocolCommand||c.wireProtocolCommand;let l;if(n.find&&a)l=function(t,e,n,o,i,s){const c=u(n,s=s||{});o.batchSize=n.batchSize||o.batchSize;const a=e.split(/\./),l=`${a.shift()}.$cmd`;let h={find:a.join(".")};n.query&&(n.query.$query?h.filter=n.query.$query:h.filter=n.query);let p=n.sort;if(Array.isArray(p)){const t={};if(p.length>0&&!Array.isArray(p[0])){let e=p[1];"asc"===e?e=1:"desc"===e&&(e=-1),t[p[0]]=e}else for(var d=0;d<p.length;d++){let e=p[d][1];"asc"===e?e=1:"desc"===e&&(e=-1),t[p[d][0]]=e}p=t}n.sort&&(h.sort=p);n.fields&&(h.projection=n.fields);n.hint&&(h.hint=n.hint);n.skip&&(h.skip=n.skip);n.limit&&(h.limit=n.limit);n.limit<0&&(h.limit=Math.abs(n.limit),h.singleBatch=!0);"number"==typeof n.batchSize&&(n.batchSize<0&&(0!==n.limit&&Math.abs(n.batchSize)<Math.abs(n.limit)&&(h.limit=Math.abs(n.batchSize)),h.singleBatch=!0),h.batchSize=Math.abs(n.batchSize));n.comment&&(h.comment=n.comment);n.maxScan&&(h.maxScan=n.maxScan);n.maxTimeMS&&(h.maxTimeMS=n.maxTimeMS);n.min&&(h.min=n.min);n.max&&(h.max=n.max);h.returnKey=!!n.returnKey&&n.returnKey,h.showRecordId=!!n.showDiskLoc&&n.showDiskLoc,n.snapshot&&(h.snapshot=n.snapshot);n.tailable&&(h.tailable=n.tailable);n.oplogReplay&&(h.oplogReplay=n.oplogReplay);n.noCursorTimeout&&(h.noCursorTimeout=n.noCursorTimeout);n.awaitData&&(h.awaitData=n.awaitData);n.awaitdata&&(h.awaitData=n.awaitdata);n.partial&&(h.partial=n.partial);n.collation&&(h.collation=n.collation);n.explain&&(h={explain:h});n.readConcern&&(h.readConcern=n.readConcern);const m="boolean"==typeof s.serializeFunctions&&s.serializeFunctions,g="boolean"==typeof s.ignoreUndefined&&s.ignoreUndefined;"mongos"===i.type&&c&&"primary"!==c.preference&&(h={$query:h,$readPreference:c.toJSON()});const y=f(h,s.session,s);if(y)return y;const _=new r(t,l,h,{numberToSkip:0,numberToReturn:1,checkKeys:!1,returnFieldSelector:null,serializeFunctions:m,ignoreUndefined:g});return _.slaveOk=c.slaveOk(),_}(t,e,n,o,s,c),n.virtual=!1,l.documentsReturnedIn="firstBatch";else{if(null!=o.cursorId)return;if(!n)return new i(`command ${JSON.stringify(n)} does not return a cursor`);l=function(t,e,n,o,i,s){const c=u(n,s=s||{});let a={};for(let t in n)a[t]=n[t];const l=e.split(/\./),h="boolean"==typeof s.serializeFunctions&&s.serializeFunctions,p="boolean"==typeof s.ignoreUndefined&&s.ignoreUndefined;"mongos"===i.type&&c&&"primary"!==c.preference&&(a={$query:a,$readPreference:c.toJSON()});const d=f(a,s.session,s);if(d)return d;const m=new r(t,`${l.shift()}.$cmd`,a,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,serializeFunctions:h,ignoreUndefined:p});return m.slaveOk=c.slaveOk(),m}(t,e,n,0,s,c)}if(l instanceof i)return l;const h=f(l.query,c.session,c);return h||l},t.exports=p},function(t,e,n){"use strict";const r=n(0).inherits,o=n(0).format,i=n(10).EventEmitter,s=n(33),u=n(77),c=n(20).retrieveBSON,a=n(34),l=n(4).MongoError,h=n(98),p=n(251),f=n(12).clone,d=n(12).Timeout,m=n(12).Interval,g=n(12).createClientInfo,y=n(12).SessionMixins,_=n(12).isRetryableWritesSupported,v=n(27).relayEvents,w=n(4).isRetryableError,b=n(75).defaultAuthProviders;var O=c(),S="disconnected",A="connecting",C="connected",T="unreferenced",E="destroyed";function N(t,e){var n={disconnected:[A,E,S],connecting:[A,E,C,S],connected:[C,S,E,T],unreferenced:[T,E],destroyed:[E]}[t.state];n&&-1!==n.indexOf(e)?t.state=e:t.s.logger.error(o("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",t.id,t.state,e,n))}var $=1,I=["connect","close","error","timeout","parseError"],M=function(t,e){var n=this;if(e=e||{},!Array.isArray(t))throw new l("seedlist must be an array");if(0===t.length)throw new l("seedlist must contain at least one entry");t.forEach(function(t){if("string"!=typeof t.host||"number"!=typeof t.port)throw new l("seedlist entry must contain a host and port")}),i.call(this),this.id=$++;var r=e.localThresholdMS||15;e.acceptableLatency&&(r=e.acceptableLatency);var s=a("ReplSet",e);this.s={options:Object.assign({},e),bson:e.bson||new O([O.Binary,O.Code,O.DBRef,O.Decimal128,O.Double,O.Int32,O.Long,O.Map,O.MaxKey,O.MinKey,O.ObjectId,O.BSONRegExp,O.Symbol,O.Timestamp]),Cursor:e.cursorFactory||u,logger:s,seedlist:t,replicaSetState:new p({id:this.id,setName:e.setName,acceptableLatency:r,heartbeatFrequencyMS:e.haInterval?e.haInterval:1e4,logger:s}),connectingServers:[],haInterval:e.haInterval?e.haInterval:1e4,minHeartbeatFrequencyMS:500,disconnectHandler:e.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof e.debug&&e.debug,clientInfo:g(e),authenticationContexts:[]},this.s.replicaSetState.on("topologyDescriptionChanged",function(t){n.emit("topologyDescriptionChanged",t)}),this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(o("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.authProviders=e.authProviders||b(this.s.bson);["joined","left"].forEach(function(t){n.s.replicaSetState.on(t,function(e,r){n.emit(t,e,r)})}),this.initialConnectState={connect:!1,fullsetup:!1,all:!1},this.state=S,this.haTimeoutId=null,this.authenticating=!1,this.ismaster=null,this.intervalIds=[],this.clusterTime=null};function R(t){t.s.replicaSetState.hasPrimaryAndSecondary()&&t.s.disconnectHandler?t.s.disconnectHandler.execute():t.s.replicaSetState.hasPrimary()&&t.s.disconnectHandler?t.s.disconnectHandler.execute({executePrimary:!0}):t.s.replicaSetState.hasSecondary()&&t.s.disconnectHandler&&t.s.disconnectHandler.execute({executeSecondary:!0})}function P(t,e,n){var r=e.length,o=null,i=function(t,e){return function(i){var s=this;if(r-=1,t.state===E||t.state===T)return this.destroy({force:!0});if("connect"!==e||t.authenticating)"connect"===e&&t.authenticating?this.destroy({force:!0}):"error"===e&&(o=i);else{if(t.state===E||t.state===T)return s.destroy({force:!0});F(t,s,function(){if(t.state===E||t.state===T)return s.destroy({force:!0});if(t.s.replicaSetState.update(s)){s.lastIsMaster()&&s.lastIsMaster().ismaster&&(t.ismaster=s.lastIsMaster());for(var e=0;e<I.length;e++)s.removeAllListeners(I[e]);s.on("error",L(t,"error")),s.on("close",L(t,"close")),s.on("timeout",L(t,"timeout")),s.on("parseError",L(t,"parseError")),j(s.lastIsMaster().me,t,{}),R(t)}else s.destroy({force:!0})})}R(t),0===r&&n(o)}};if(0===r)return n();function s(e,n){setTimeout(function(){if(t.state!==E&&t.state!==T){var n=new h(Object.assign({},t.s.options,{host:e.split(":")[0],port:parseInt(e.split(":")[1],10),authProviders:t.authProviders,reconnect:!1,monitoring:!1,parent:t,clientInfo:f(t.s.clientInfo)}));n.once("connect",i(t,"connect")),n.once("close",i(t,"close")),n.once("timeout",i(t,"timeout")),n.once("error",i(t,"error")),n.once("parseError",i(t,"parseError")),n.on("serverOpening",e=>t.emit("serverOpening",e)),n.on("serverDescriptionChanged",e=>t.emit("serverDescriptionChanged",e)),n.on("serverClosed",e=>t.emit("serverClosed",e)),v(n,t,["commandStarted","commandSucceeded","commandFailed"]),n.connect(t.s.connectOptions)}},n)}for(var u=0;u<e.length;u++)s(e[u],u)}r(M,i),Object.assign(M.prototype,y),Object.defineProperty(M.prototype,"type",{enumerable:!0,get:function(){return"replset"}}),Object.defineProperty(M.prototype,"parserType",{enumerable:!0,get:function(){return O.native?"c++":"js"}}),Object.defineProperty(M.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.replicaSetState.logicalSessionTimeoutMinutes||null}});var j=function(t,e,n){if(!n.haInterval)for(var r=0;r<e.intervalIds.length;r++)if(e.intervalIds[r].__host===t)return;var o=n.haInterval?d:m,i=n.haInterval?n.haInterval:e.s.haInterval,s=new o(function(){if(e.state!==E&&e.state!==T){var n=e.s.replicaSetState.get(t);return n?function(t,e,n){var r=(new Date).getTime();q(t,"serverHeartbeatStarted",{connectionId:e.name}),e.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:t.s.options.connectionTimeout||2e3},function(o,i){if(t.state===E||t.state===T)return e.destroy({force:!0}),n(o,i);var s=(new Date).getTime()-r,u=process.hrtime();e.lastUpdateTime=1e3*u[0]+Math.round(u[1]/1e3),o?(q(t,"serverHeartbeatFailed",{durationMS:s,failure:o,connectionId:e.name}),t.s.replicaSetState.remove(e)):(e.ismaster=i.result,e.ismaster.lastWrite&&e.ismaster.lastWrite.lastWriteDate&&(e.lastWriteDate=e.ismaster.lastWrite.lastWriteDate.getTime()),-1===e.lastIsMasterMS?e.lastIsMasterMS=s:e.lastIsMasterMS&&(e.lastIsMasterMS=.2*s+.8*e.lastIsMasterMS),t.s.replicaSetState.update(e)&&e.lastIsMaster()&&e.lastIsMaster().ismaster&&(t.ismaster=e.lastIsMaster()),q(t,"serverHeartbeatSucceeded",{durationMS:s,reply:i.result,connectionId:e.name})),t.s.replicaSetState.updateServerMaxStaleness(e,t.s.haInterval),n(o,i)})}(e,n,function(t){t||(e.state!==E&&e.state!==T?(e.intervalIds=e.intervalIds.filter(function(t){return t.isRunning()}),o===d?e.state===A&&(e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed||e.s.replicaSetState.hasPrimary())&&(e.state=C,process.nextTick(function(){e.emit("connect",e)}),D(e,{})):e.state===S&&(e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed||e.s.replicaSetState.hasPrimary())&&(e.state=C,R(e),process.nextTick(function(){e.emit("reconnect",e)})),e.initialConnectState.connect&&!e.initialConnectState.fullsetup&&e.s.replicaSetState.hasPrimaryAndSecondary()&&(e.initialConnectState.fullsetup=!0,e.initialConnectState.all=!0,process.nextTick(function(){e.emit("fullsetup",e),e.emit("all",e)}))):s.stop())}):void 0}s.stop()},i);s.start(),s.__host=t,e.intervalIds.push(s)};function D(t,e){if(t.state!==E&&t.state!==T){e=e||{};var n=Object.keys(t.s.replicaSetState.set),r=e.haInterval?d:m,o=e.haInterval?e.haInterval:t.s.haInterval;if(r===d)return P(t,t.s.replicaSetState.unknownServers,function(r){if(t.state!==E&&t.state!==T){if(!t.s.replicaSetState.hasPrimary()&&!t.s.options.secondaryOnlyConnectionAllowed)return r?t.emit("error",r):(t.emit("error",new l("no primary found in replicaset or invalid replica set name")),t.destroy({force:!0}));if(!t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed)return r?t.emit("error",r):(t.emit("error",new l("no secondary found in replicaset or invalid replica set name")),t.destroy({force:!0}));for(var o=0;o<n.length;o++)j(n[o],t,e)}});for(var i=0;i<n.length;i++)j(n[i],t,e);var s=t.s.replicaSetState.hasPrimary()?o:t.s.minHeartbeatFrequencyMS;t.intervalIds.push(new d(function t(e){return function(){e.state!==E&&e.state!==T&&P(e,e.s.replicaSetState.unknownServers,function(){var n=e.s.replicaSetState.hasPrimary()?o:e.s.minHeartbeatFrequencyMS;e.intervalIds.push(new d(t(e),n).start())})}}(t),s).start())}}function B(t,e){for(var n=0;n<t.length;n++)if(t[n].name.toLowerCase()===e.name.toLowerCase())return!0;t.push(e)}function L(t,e){return function(){t.state!==E&&t.state!==T&&(t.s.logger.isDebug()&&t.s.logger.debug(o("handleEvent %s from server %s in replset with id %s",e,this.name,t.id)),t.s.replicaSetState.remove(this),t.state!==E&&t.state!==T&&((t.s.replicaSetState.hasPrimary()||t.s.replicaSetState.hasSecondary()||!t.s.options.secondaryOnlyConnectionAllowed)&&t.s.replicaSetState.hasPrimary()||N(t,S),B(t.s.connectingServers,this)))}}function F(t,e,n){if(0===t.s.authenticationContexts.length)return n();if(e.lastIsMaster()&&e.lastIsMaster().arbiterOnly)return n();!function t(e,n,r){if(0===e.length)return r();var o=e.shift().slice(0);o.push(function(){t(e,n,r)}),n.auth.apply(n,o)}(t.s.authenticationContexts.slice(0),e,n)}function U(t,e){return function(){var n=this;if(t.s.logger.isDebug()&&t.s.logger.debug(o("handleInitialConnectEvent %s from server %s in replset with id %s",e,this.name,t.id)),t.state===E||t.state===T)return this.destroy({force:!0});"connect"===e?F(t,n,function(){if(t.state===E||t.state===T)return n.destroy({force:!0});var r=t.s.replicaSetState.update(n);if(!0===r){n.lastIsMaster()&&n.lastIsMaster().ismaster&&(t.ismaster=n.lastIsMaster()),t.s.logger.isDebug()&&t.s.logger.debug(o("handleInitialConnectEvent %s from server %s in replset with id %s has state [%s]",e,n.name,t.id,JSON.stringify(t.s.replicaSetState.set)));for(var i=0;i<I.length;i++)n.removeAllListeners(I[i]);n.on("error",L(t,"error")),n.on("close",L(t,"close")),n.on("timeout",L(t,"timeout")),n.on("parseError",L(t,"parseError")),function(t){const e=t.state===A,n=t.s.replicaSetState.hasPrimary(),r=t.s.replicaSetState.hasSecondary(),o=t.s.options.secondaryOnlyConnectionAllowed,i=t.s.connectOptions.readPreference&&t.s.connectOptions.readPreference.equals(s.secondary);return e&&(i&&r||!i&&n)||r&&o}(t)&&(t.state=C,t.initialConnectState.connect=!0,process.nextTick(function(){t.emit("connect",t)}),D(t,{}))}else{if(r instanceof l)return n.destroy({force:!0}),t.destroy({force:!0}),t.emit("error",r);n.destroy({force:!0})}}):(t.emit("failed",this),B(t.s.connectingServers,this),t.s.replicaSetState.remove(this)),t.initialConnectState.connect&&!t.initialConnectState.fullsetup&&t.s.replicaSetState.hasPrimaryAndSecondary()&&(t.initialConnectState.fullsetup=!0,t.initialConnectState.all=!0,process.nextTick(function(){t.emit("fullsetup",t),t.emit("all",t)}));for(var r=0;r<t.s.connectingServers.length;r++)t.s.connectingServers[r].equals(this)&&t.s.connectingServers.splice(r,1);0===t.s.connectingServers.length&&t.state===A&&D(t,{haInterval:1})}}function q(t,e,n){t.listeners(e).length>0&&t.emit(e,n)}function x(t,e,n){"function"==typeof e&&(n=e,e={}),e=e||{};const r=t.self,i=t.op,s=t.ns,u=t.ops;if(r.state===E)return n(new l(o("topology was destroyed")));const c=!t.retrying&&!!e.retryWrites&&e.session&&_(r)&&!e.session.inTransaction();if(!r.s.replicaSetState.hasPrimary()){if(r.s.disconnectHandler)return r.s.disconnectHandler.add(i,s,u,e,n);if(!c)return n(new l("no primary server found"))}const a=(o,i)=>{if(!o)return n(null,i);if(!w(o))return n(o);if(c){return x(Object.assign({},t,{retrying:!0}),e,n)}return r.s.replicaSetState.primary&&r.s.replicaSetState.remove(r.s.replicaSetState.primary,{force:!0}),n(o)};n.operationId&&(a.operationId=n.operationId),c&&(e.session.incrementTransactionNumber(),e.willRetryWrite=c),r.s.replicaSetState.primary[i](s,u,e,a)}M.prototype.connect=function(t){var e=this;this.s.connectOptions=t||{},N(this,A);var n=this.s.seedlist.map(function(t){return new h(Object.assign({},e.s.options,t,{authProviders:e.authProviders,reconnect:!1,monitoring:!1,parent:e,clientInfo:f(e.s.clientInfo)}))});if(this.s.options.socketTimeout>0&&this.s.options.socketTimeout<=this.s.options.haInterval)return e.emit("error",new l(o("haInterval [%s] MS must be set to less than socketTimeout [%s] MS",this.s.options.haInterval,this.s.options.socketTimeout)));q(this,"topologyOpening",{topologyId:this.id}),function(t,e){t.s.connectingServers=t.s.connectingServers.concat(e);var n=0;function r(e,n){setTimeout(function(){t.s.replicaSetState.update(e)&&e.lastIsMaster()&&e.lastIsMaster().ismaster&&(t.ismaster=e.lastIsMaster()),e.once("close",U(t,"close")),e.once("timeout",U(t,"timeout")),e.once("parseError",U(t,"parseError")),e.once("error",U(t,"error")),e.once("connect",U(t,"connect")),e.on("serverOpening",e=>t.emit("serverOpening",e)),e.on("serverDescriptionChanged",e=>t.emit("serverDescriptionChanged",e)),e.on("serverClosed",e=>t.emit("serverClosed",e)),v(e,t,["commandStarted","commandSucceeded","commandFailed"]),e.connect(t.s.connectOptions)},n)}for(;e.length>0;)r(e.shift(),n++)}(e,n)},M.prototype.destroy=function(t){t=t||{},N(this,E),this.haTimeoutId&&clearTimeout(this.haTimeoutId),this.s.replicaSetState.destroy(t),this.s.authenticationContexts=[],this.s.connectingServers.forEach(function(e){e.destroy(t)});for(var e=0;e<this.intervalIds.length;e++)this.intervalIds[e].stop();this.intervalIds=[],q(this,"topologyClosed",{topologyId:this.id})},M.prototype.unref=function(){N(this,T),this.s.replicaSetState.allServers().forEach(function(t){t.unref()}),clearTimeout(this.haTimeoutId)},M.prototype.lastIsMaster=function(){return this.s.options.secondaryOnlyConnectionAllowed&&!this.s.replicaSetState.hasPrimary()&&this.s.replicaSetState.hasSecondary()?this.s.replicaSetState.secondaries[0].lastIsMaster():this.s.replicaSetState.primary?this.s.replicaSetState.primary.lastIsMaster():this.ismaster},M.prototype.connections=function(){for(var t=this.s.replicaSetState.allServers(),e=[],n=0;n<t.length;n++)e=e.concat(t[n].connections());return e},M.prototype.isConnected=function(t){return t=t||{},!this.authenticating&&(t.readPreference&&t.readPreference.equals(s.secondary)?this.s.replicaSetState.hasSecondary():t.readPreference&&t.readPreference.equals(s.primary)?this.s.replicaSetState.hasPrimary():t.readPreference&&t.readPreference.equals(s.primaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():t.readPreference&&t.readPreference.equals(s.secondaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():!(!this.s.options.secondaryOnlyConnectionAllowed||!this.s.replicaSetState.hasSecondary())||this.s.replicaSetState.hasPrimary())},M.prototype.isDestroyed=function(){return this.state===E},M.prototype.selectServer=function(t,e,n){"function"==typeof t&&void 0===n&&(n=t,t=void 0,e={}),"function"==typeof e&&(n=e,e=t,t=void 0),e=e||{};const r=this.s.replicaSetState.pickServer(e.readPreference);this.s.debug&&this.emit("pickedServer",e.readPreference,r),n(null,r)},M.prototype.getServers=function(){return this.s.replicaSetState.allServers()},M.prototype.insert=function(t,e,n,r){x({self:this,op:"insert",ns:t,ops:e},n,r)},M.prototype.update=function(t,e,n,r){x({self:this,op:"update",ns:t,ops:e},n,r)},M.prototype.remove=function(t,e,n,r){x({self:this,op:"remove",ns:t,ops:e},n,r)};const W=["findAndModify","insert","update","delete"];M.prototype.command=function(t,e,n,r){if("function"==typeof n&&(r=n,n=(n={})||{}),this.state===E)return r(new l(o("topology was destroyed")));var i=n.readPreference?n.readPreference:s.primary;if("primary"===i.preference&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",t,e,n,r);if("secondary"===i.preference&&!this.s.replicaSetState.hasSecondary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",t,e,n,r);if("primary"!==i.preference&&!this.s.replicaSetState.hasSecondary()&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",t,e,n,r);var u=this.s.replicaSetState.pickServer(i);if(!(u instanceof h))return r(u);if(this.s.debug&&this.emit("pickedServer",s.primary,u),null==u)return r(new l(o("no server found that matches the provided readPreference %s",i)));const c=!n.retrying&&!!n.retryWrites&&n.session&&_(this)&&!n.session.inTransaction()&&(a=e,W.some(t=>a[t]));var a;c&&(n.session.incrementTransactionNumber(),n.willRetryWrite=c),u.command(t,e,n,(o,i)=>{if(!o)return r(null,i);if(!w(o))return r(o);if(c){const o=Object.assign({},n,{retrying:!0});return this.command(t,e,o,r)}return this.s.replicaSetState.primary&&this.s.replicaSetState.remove(this.s.replicaSetState.primary,{force:!0}),r(o)})},M.prototype.auth=function(t,e){var n=Array.prototype.slice.call(arguments,0).slice(0),r=this,i=Array.prototype.slice.call(arguments,2),s=i.pop(),u=0;if(null==this.authProviders[t]&&"default"!==t)return s(new l(o("auth provider %s does not exist",t)));if(this.authenticating)return s(new l("authentication or logout allready in process"));if(!this.isConnected()&&null!=r.s.disconnectHandler){if(!r.s.replicaSetState.hasPrimary()&&!r.s.options.secondaryOnlyConnectionAllowed)return r.s.disconnectHandler.add("auth",e,n,{},s);if(!r.s.replicaSetState.hasSecondary()&&r.s.options.secondaryOnlyConnectionAllowed)return r.s.disconnectHandler.add("auth",e,n,{},s)}this.authenticating=!0;var c=[],a=this.s.replicaSetState.allServers();function h(n){var o=[t,e].concat(i.slice(0)).concat([function(t){if(p-=1,t&&c.push({name:n.name,err:t}),0===p){if(r.authenticating=!1,c.length)return r.s.authenticationContexts.splice(u,0),s(new l({message:"authentication fail",errors:c}),!1);s(null,r)}}]);n.lastIsMaster().arbiterOnly?o.pop()(null):n.auth.apply(n,o)}0===a.length&&(this.authenticating=!1,s(null,!0));var p=a.length;for(u=this.s.authenticationContexts.length,this.s.authenticationContexts.push([t,e].concat(i.slice(0)));a.length>0;)h(a.shift())},M.prototype.logout=function(t,e){var n=this;if(this.authenticating)throw new l("authentication or logout allready in process");this.authenticating=!0;for(var r=Object.keys(this.authProviders),i=0;i<r.length;i++)this.authProviders[r[i]].logout(t);n.s.authenticationContexts=n.s.authenticationContexts.filter(function(e){return e[1]!==t});var s=this.s.replicaSetState.allServers(),u=s.length;if(0===u)return e();var c=[];function a(e,n){e.logout(t,function(t){t&&c.push({name:e.name,err:t}),n()})}for(i=0;i<s.length;i++)a(s[i],function(){if(0===(u-=1)){if(n.authenticating=!1,c.length)return e(new l({message:o("logout failed against db %s",t),errors:c}),!1);e()}})},M.prototype.cursor=function(t,e,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(this.s.bson,t,e,n,r,this.s.options)},t.exports=M},function(t,e,n){"use strict";var r=n(0).inherits,o=n(0).format,i=n(12).diff,s=n(10).EventEmitter,u=n(34),c=n(33),a=n(4).MongoError,l=n(14).Buffer,h="ReplicaSetNoPrimary",p="ReplicaSetWithPrimary",f="Unknown",d="PossiblePrimary",m="RSPrimary",g="RSSecondary",y="RSArbiter",_="RSOther",v="RSGhost",w="Unknown",b=function(t){t=t||{},s.call(this),this.topologyType=h,this.setName=t.setName,this.set={},this.id=t.id,this.setName=t.setName,this.logger=t.logger||u("ReplSet",t),this.index=0,this.acceptableLatency=t.acceptableLatency||15,this.heartbeatFrequencyMS=t.heartbeatFrequencyMS||1e4,this.primary=null,this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.maxElectionId=null,this.maxSetVersion=0,this.replicasetDescription={topologyType:"Unknown",servers:[]},this.logicalSessionTimeoutMinutes=void 0};r(b,s),b.prototype.hasPrimaryAndSecondary=function(){return null!=this.primary&&this.secondaries.length>0},b.prototype.hasPrimaryOrSecondary=function(){return this.hasPrimary()||this.hasSecondary()},b.prototype.hasPrimary=function(){return null!=this.primary},b.prototype.hasSecondary=function(){return this.secondaries.length>0},b.prototype.get=function(t){for(var e=this.allServers(),n=0;n<e.length;n++)if(e[n].name.toLowerCase()===t.toLowerCase())return e[n];return null},b.prototype.allServers=function(t){t=t||{};var e=this.primary?[this.primary]:[];return e=e.concat(this.secondaries),t.ignoreArbiters||(e=e.concat(this.arbiters)),e=e.concat(this.passives)},b.prototype.destroy=function(t){this.primary&&this.primary.destroy(t),this.secondaries.forEach(function(e){e.destroy(t)}),this.arbiters.forEach(function(e){e.destroy(t)}),this.passives.forEach(function(e){e.destroy(t)}),this.ghosts.forEach(function(e){e.destroy(t)}),this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.primary=null,I(this)},b.prototype.remove=function(t,e){e=e||{};var n=t.name.toLowerCase(),r=this.primary?[this.primary]:[];r=(r=(r=r.concat(this.secondaries)).concat(this.arbiters)).concat(this.passives);for(var o=0;o<r.length;o++)if(!e.force&&r[o].equals(t)&&r[o].isConnected&&r[o].isConnected())return;this.set[n]&&(this.set[n].type=w,this.set[n].electionId=null,this.set[n].setName=null,this.set[n].setVersion=null);var i=null;this.primary&&this.primary.equals(t)&&(this.primary=null,this.topologyType=h,i="primary"),i=$(t,this.secondaries)?"secondary":i,i=$(t,this.arbiters)?"arbiter":i,i=$(t,this.passives)?"secondary":i,$(t,this.ghosts),$(t,this.unknownServers),this.unknownServers.push(n),i&&this.emit("left",i,t)};const O=t=>t.arbiterOnly&&t.setName;b.prototype.update=function(t){var e=t.lastIsMaster(),n=t.name.toLowerCase();if(e){var r=Array.isArray(e.hosts)?e.hosts:[];r=(r=(r=r.concat(Array.isArray(e.arbiters)?e.arbiters:[])).concat(Array.isArray(e.passives)?e.passives:[])).map(function(t){return t.toLowerCase()});for(var i=0;i<r.length;i++)-1!==this.unknownServers.indexOf(r[i])||this.set[r[i]]&&this.set[r[i]].type!==w||this.unknownServers.push(r[i].toLowerCase()),this.set[r[i]]||(this.set[r[i]]={type:w,electionId:null,setName:null,setVersion:null})}if(!e&&!T(e,t,this.unknownServers))return this.set[n]={type:w,setVersion:null,electionId:null,setName:null},this.set[n].type=w,this.set[n].electionId=e?e.electionId:e,this.set[n].setName=e?e.setName:e,this.set[n].setVersion=e?e.setVersion:e,-1===this.unknownServers.indexOf(t.name)&&this.unknownServers.push(n),!1;if(void 0===e.logicalSessionTimeoutMinutes||O(e)||(void 0===this.logicalSessionTimeoutMinutes||null===e.logicalSessionTimeoutMinutes?this.logicalSessionTimeoutMinutes=e.logicalSessionTimeoutMinutes:this.logicalSessionTimeoutMinutes=Math.min(this.logicalSessionTimeoutMinutes,e.logicalSessionTimeoutMinutes)),e&&"isdbgrid"===e.msg)return!1;if(e.setName&&e.hidden||e.setName&&!e.ismaster&&!e.secondary&&!e.arbiterOnly&&!e.passive)return this.set[n]={type:_,setVersion:null,electionId:null,setName:e.setName},this.topologyType=this.primary?p:h,e.setName&&(this.setName=e.setName),!1;if(e.isreplicaset)return this.set[n]={type:v,setVersion:null,electionId:null,setName:null},this.topologyType=this.primary?p:h,e.setName&&(this.setName=e.setName),!1;if(e&&e.ismaster&&!e.setName)return this.topologyType=this.primary?p:f,this.remove(t,{force:!0}),!1;if(e&&!e.ismaster&&!e.secondary&&!e.arbiterOnly)return this.remove(t,{force:!0}),!1;if(e.me&&e.me.toLowerCase()!==n)return this.logger.isWarn()&&this.logger.warn(o("the seedlist server was removed due to its address %s not matching its ismaster.me address %s",t.name,e.me)),delete this.set[n],$(t,this.unknownServers),t.destroy(),this.primary&&!this.primary.equals(t)?this.topologyType=p:this.topologyType=h,!this.primary&&e.primary&&(this.set[e.primary.toLowerCase()]={type:d,setName:null,electionId:null,setVersion:null}),!1;if(!this.primary&&e.ismaster&&e.setName){var s=t.lastIsMaster().electionId;if(this.setName&&this.setName!==e.setName)return this.topologyType=h,new a(o("setName from ismaster does not match provided connection setName [%s] != [%s]",e.setName,this.setName));if(!this.maxElectionId&&s)this.maxElectionId=s;else if(this.maxElectionId&&s){var u=N(this.maxElectionId,s),c=t.lastIsMaster().setVersion;if(1===u)return this.topologyType=h,!1;if(0===u&&c&&c<this.maxSetVersion)return this.topologyType=h,!1;this.maxSetVersion=c,this.maxElectionId=s}return-1!==e.hosts.map(function(t){return t.toLowerCase()}).indexOf(n)?(this.primary=t,this.set[n]={type:m,setVersion:e.setVersion,electionId:e.electionId,setName:e.setName},this.topologyType=p,e.setName&&(this.setName=e.setName),$(t,this.unknownServers),$(t,this.secondaries),$(t,this.passives),this.emit("joined","primary",t)):this.topologyType=h,I(this),!0}if(e.ismaster&&e.setName){var l=this.set[this.primary.name.toLowerCase()].electionId,b=this.set[this.primary.name.toLowerCase()].setVersion,S=this.set[this.primary.name.toLowerCase()].setName;s=t.lastIsMaster().electionId,c=t.lastIsMaster().setVersion;var A=t.lastIsMaster().setName;if(this.primary.equals(t)&&S===A)return!1;if(S&&S!==A)return this.primary.equals(t)?this.topologyType=h:this.topologyType=p,!1;if(l&&s){if(1===(u=N(l,s)))return!1;if(0===u&&b>c)return!1}else if(!l&&s&&c&&c<this.maxSetVersion)return!1;if(!this.maxElectionId&&s)this.maxElectionId=s;else if(this.maxElectionId&&s){if(1===(u=N(this.maxElectionId,s)))return!1;if(0===u&&b&&c){if(c<this.maxSetVersion)return!1}else if(c<this.maxSetVersion)return!1;this.maxElectionId=s,this.maxSetVersion=c}else this.maxSetVersion=c;return this.set[this.primary.name.toLowerCase()]={type:w,setVersion:null,electionId:null,setName:null},this.emit("left","primary",this.primary),this.primary.destroy(),this.primary=t,this.set[n]={type:m,setVersion:e.setVersion,electionId:e.electionId,setName:e.setName},this.topologyType=p,e.setName&&(this.setName=e.setName),$(t,this.unknownServers),$(t,this.secondaries),$(t,this.passives),this.emit("joined","primary",t),I(this),!0}return!this.primary&&e.primary&&(this.set[e.primary.toLowerCase()]={type:d,setVersion:null,electionId:null,setName:null}),e.secondary&&e.setName&&!T(e,t,this.secondaries)&&this.setName&&this.setName===e.setName?(E(this,g,e,t,this.secondaries),this.topologyType=this.primary?p:h,e.setName&&(this.setName=e.setName),$(t,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(t.destroy(),this.primary=null,this.emit("left","primary",t)),this.emit("joined","secondary",t),I(this),!0):O(e)&&!T(e,t,this.arbiters)&&this.setName&&this.setName===e.setName?(E(this,y,e,t,this.arbiters),this.topologyType=this.primary?p:h,e.setName&&(this.setName=e.setName),$(t,this.unknownServers),this.emit("joined","arbiter",t),I(this),!0):e.passive&&e.setName&&!T(e,t,this.passives)&&this.setName&&this.setName===e.setName?(E(this,g,e,t,this.passives),this.topologyType=this.primary?p:h,e.setName&&(this.setName=e.setName),$(t,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(t.destroy(),this.primary=null,this.emit("left","primary",t)),this.emit("joined","secondary",t),I(this),!0):this.set[n]&&this.set[n].type===m?(this.emit("left","primary",this.primary),this.primary.destroy(),this.primary=null,this.topologyType=h,!1):(this.topologyType=this.primary?p:h,!1)},b.prototype.updateServerMaxStaleness=function(t,e){for(var n=0,r=0;r<this.secondaries.length;r++)n=Math.max(n,this.secondaries[r].lastWriteDate);t.ismaster.maxWireVersion>=5&&t.ismaster.secondary&&this.hasPrimary()?t.staleness=t.lastUpdateTime-t.lastWriteDate-(this.primary.lastUpdateTime-this.primary.lastWriteDate)+e:t.ismaster.maxWireVersion>=5&&t.ismaster.secondary&&(t.staleness=n-t.lastWriteDate+e)},b.prototype.updateSecondariesMaxStaleness=function(t){for(var e=0;e<this.secondaries.length;e++)this.updateServerMaxStaleness(this.secondaries[e],t)},b.prototype.pickServer=function(t){if("primary"===(t=t||c.primary).preference&&null!=t.maxStalenessSeconds)return new a("primary readPreference incompatible with maxStalenessSeconds");var e=this.primary?[this.primary]:[];if(e=e.concat(this.secondaries),null!=t.maxStalenessSeconds)for(var n=0;n<e.length;n++)if(e[n].ismaster.maxWireVersion<5)return new a("maxStalenessSeconds not supported by at least one of the replicaset members");if("nearest"===t.preference&&null==t.maxStalenessSeconds)return C(this,t);if("nearest"===t.preference&&null!=t.maxStalenessSeconds)return A(this,t);var r=this.secondaries;if(t.equals(c.secondary)&&0===r.length)return new a("no secondary server available");if(t.equals(c.secondaryPreferred)&&0===r.length&&null==this.primary)return new a("no secondary or primary server available");if(t.equals(c.primary)&&null==this.primary)return new a("no primary server available");if(t.equals(c.secondaryPreferred)||t.equals(c.secondary)){if(r.length>0&&null==t.maxStalenessSeconds){var o=C(this,t);if(o)return o}else if(r.length>0&&null!=t.maxStalenessSeconds&&(o=A(this,t)))return o;return t.equals(c.secondaryPreferred)?this.primary:null}if(t.equals(c.primaryPreferred)){if(o=null,this.primary)return this.primary;if(r.length>0&&null==t.maxStalenessSeconds?o=C(this,t):r.length>0&&null!=t.maxStalenessSeconds&&(o=A(this,t)),o)return o}return this.primary};var S=function(t,e){if(null==t.tags)return e;for(var n=[],r=Array.isArray(t.tags)?t.tags:[t.tags],o=0;o<r.length;o++)for(var i=r[o],s=0;s<e.length;s++){var u=e[s].lastIsMaster().tags||{},c=!0;for(var a in i)u[a]!==i[a]&&(c=!1);c&&n.push(e[s])}return n};function A(t,e){var n=[],r=1e3*e.maxStalenessSeconds;if(r<9e4)return new a("maxStalenessSeconds must be set to at least 90 seconds");t.primary&&"secondary"!==e.preference&&"secondaryPreferred"!==e.preference&&n.push(t.primary);for(var o=0;o<t.secondaries.length;o++)n.push(t.secondaries[o]);if(t.primary&&0===n.length&&"secondaryPreferred"!==e.preference&&n.push(t.primary),(n=(n=S(e,n)).filter(function(t){return t.staleness<=r})).sort(function(t,e){return t.lastIsMasterMS-e.lastIsMasterMS}),0===n.length)return null;t.index=t.index%n.length;var i=n[t.index];return t.index=t.index+1,i}function C(t,e){var n=[];t.primary&&"secondary"!==e.preference&&"secondaryPreferred"!==e.preference&&n.push(t.primary);for(var r=0;r<t.secondaries.length;r++)n.push(t.secondaries[r]);0===n.length&&t.primary&&"secondaryPreferred"!==e.preference&&n.push(t.primary),(n=S(e,n)).sort(function(t,e){return t.lastIsMasterMS-e.lastIsMasterMS});var o=n.length>0?n[0].lastIsMasterMS:0;if(0===(n=n.filter(function(e){return e.lastIsMasterMS<=o+t.acceptableLatency})).length)return null;t.index=t.index%n.length;var i=n[t.index];return t.index=t.index+1,i}function T(t,e,n){for(var r=0;r<n.length;r++)if(n[r]&&n[r].name&&n[r].name.toLowerCase()===e.name.toLowerCase())return!0;return!1}function E(t,e,n,r,o){var i=r.name.toLowerCase();t.set[i].type=e,t.set[i].electionId=n?n.electionId:n,t.set[i].setName=n?n.setName:n,t.set[i].setVersion=n?n.setVersion:n,o.push(r)}function N(t,e){var n=l.from(t.toHexString(),"hex"),r=l.from(e.toHexString(),"hex");if(n===r)return 0;if("function"==typeof l.compare)return l.compare(n,r);for(var o=n.length,i=r.length,s=Math.min(o,i),u=0;u<s&&n[u]===r[u];u++);return u!==s&&(o=n[u],i=r[u]),o<i?-1:i<o?1:0}function $(t,e){for(var n=0;n<e.length;n++){if(e[n].equals&&e[n].equals(t))return e.splice(n,1),!0;if("string"==typeof e[n]&&e[n].toLowerCase()===t.name.toLowerCase())return e.splice(n,1),!0}return!1}function I(t){if(t.listeners("topologyDescriptionChanged").length>0){var e="Unknown",n=t.setName;t.hasPrimaryAndSecondary()?e="ReplicaSetWithPrimary":!t.hasPrimary()&&t.hasSecondary()&&(e="ReplicaSetNoPrimary");var r={topologyType:e,setName:n,servers:[]};if(t.hasPrimary()){var o=t.primary.getDescription();o.type="RSPrimary",r.servers.push(o)}r.servers=r.servers.concat(t.secondaries.map(function(t){var e=t.getDescription();return e.type="RSSecondary",e})),r.servers=r.servers.concat(t.arbiters.map(function(t){var e=t.getDescription();return e.type="RSArbiter",e})),r.servers=r.servers.concat(t.passives.map(function(t){var e=t.getDescription();return e.type="RSSecondary",e}));var s=i(t.replicasetDescription,r),u={topologyId:t.id,previousDescription:t.replicasetDescription,newDescription:r,diff:s};t.emit("topologyDescriptionChanged",u),t.replicasetDescription=r}}t.exports=b},function(t,e,n){"use strict";const r=n(0).inherits,o=n(0).format,i=n(10).EventEmitter,s=n(77),u=n(34),c=n(20).retrieveBSON,a=n(4).MongoError,l=n(98),h=n(12).clone,p=n(12).diff,f=n(12).cloneOptions,d=n(12).createClientInfo,m=n(12).SessionMixins,g=n(12).isRetryableWritesSupported,y=n(27).relayEvents,_=n(4).isRetryableError,v=c(),w=n(75).defaultAuthProviders;var b="disconnected",O="connecting",S="connected",A="unreferenced",C="destroyed";function T(t,e){var n={disconnected:[O,C,b],connecting:[O,C,S,b],connected:[S,b,C,A],unreferenced:[A,C],destroyed:[C]}[t.state];n&&-1!==n.indexOf(e)?t.state=e:t.logger.error(o("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",t.id,t.state,e,n))}var E=1,N=["connect","close","error","timeout","parseError"],$=function(t,e){e=e||{},this.id=E++,this.s={options:Object.assign({},e),bson:e.bson||new v([v.Binary,v.Code,v.DBRef,v.Decimal128,v.Double,v.Int32,v.Long,v.Map,v.MaxKey,v.MinKey,v.ObjectId,v.BSONRegExp,v.Symbol,v.Timestamp]),Cursor:e.cursorFactory||s,logger:u("Mongos",e),seedlist:t,haInterval:e.haInterval?e.haInterval:1e4,disconnectHandler:e.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof e.debug&&e.debug,localThresholdMS:e.localThresholdMS||15,clientInfo:d(e),authenticationContexts:[]},this.s.options.clientInfo=d(e),this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(o("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.authProviders=e.authProviders||w(this.s.bson),this.state=b,this.connectingProxies=[],this.connectedProxies=[],this.disconnectedProxies=[],this.authenticating=!1,this.index=0,this.haTimeoutId=null,this.ismaster=null,this.topologyDescription={topologyType:"Unknown",servers:[]},this.clusterTime=null,i.call(this)};function I(t,e,n){t.listeners(e).length>0&&t.emit(e,n)}r($,i),Object.assign($.prototype,m),Object.defineProperty($.prototype,"type",{enumerable:!0,get:function(){return"mongos"}}),Object.defineProperty($.prototype,"parserType",{enumerable:!0,get:function(){return v.native?"c++":"js"}}),Object.defineProperty($.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}});const M=["serverDescriptionChanged","error","close","timeout","parseError"];function R(t,e){e=e||{},M.forEach(e=>t.removeAllListeners(e)),t.destroy(e)}function P(t){return function(){t.state!==C&&(B(t.connectedProxies,t.disconnectedProxies,this),W(t),t.emit("left","mongos",this),t.emit("serverClosed",{topologyId:t.id,address:this.name}))}}function j(t,e){return function(){var n=this;if(t.state===C)return W(t),B(t.connectingProxies,t.disconnectedProxies,this),this.destroy();if("connect"===e?U(t,n,function(){if(t.ismaster=n.lastIsMaster(),"isdbgrid"===t.ismaster.msg){for(var e=0;e<t.connectedProxies.length;e++)if(t.connectedProxies[e].name===n.name)return B(t.connectingProxies,t.disconnectedProxies,n),W(t),n.destroy(),t.emit("failed",n);for(e=0;e<N.length;e++)n.removeAllListeners(N[e]);n.on("error",P(t)),n.on("close",P(t)),n.on("timeout",P(t)),n.on("parseError",P(t)),B(t.connectingProxies,t.connectedProxies,n),t.emit("joined","mongos",n)}else{if(t.s.logger.isWarn()){var r="expected mongos proxy, but found replicaset member mongod for server %s";t.ismaster.hosts||(r="expected mongos proxy, but found standalone mongod for server %s"),t.s.logger.warn(o(r,n.name))}L(t.connectingProxies,n),t.emit("left","server",n),t.emit("failed",n)}}):(B(t.connectingProxies,t.disconnectedProxies,this),t.emit("left","mongos",this),t.emit("failed",this)),W(t),0===t.connectingProxies.length){if(t.connectedProxies.length>0&&t.state===O)T(t,S),t.emit("connect",t),t.emit("fullsetup",t),t.emit("all",t);else if(0===t.disconnectedProxies.length)return t.s.logger.isWarn()&&t.s.logger.warn(o("no mongos proxies found in seed list, did you mean to connect to a replicaset")),t.emit("error",new a("no mongos proxies found in seed list"));!function t(e,n){n=n||{};e.haTimeoutId=setTimeout(function(){if(e.state!==C&&e.state!==A){e.isConnected()&&e.s.disconnectHandler&&e.s.disconnectHandler.execute();var r=e.connectedProxies.slice(0),o=r.length;if(0===r.length)return e.listeners("close").length>0&&e.state===O?e.emit("error",new a("no mongos proxy available")):e.emit("close",e),F(e,e.disconnectedProxies,function(){e.state!==C&&e.state!==A&&(e.state===O&&n.firstConnect?(e.emit("connect",e),e.emit("fullsetup",e),e.emit("all",e)):e.isConnected()?e.emit("reconnect",e):!e.isConnected()&&e.listeners("close").length>0&&e.emit("close",e),t(e))});for(var i=0;i<r.length;i++)s(e,r[i],function(){if(0===(o-=1)){if(e.state===C||e.state===A)return;F(e,e.disconnectedProxies,function(){e.state!==C&&e.state!==A&&t(e)})}})}function s(t,n,r){var o=(new Date).getTime();I(e,"serverHeartbeatStarted",{connectionId:n.name}),n.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:e.s.options.connectionTimeout||2e3},function(t,i){if(e.state===C||e.state===A)return B(e.connectedProxies,e.disconnectedProxies,n),n.destroy(),r(t,i);var s=(new Date).getTime()-o;t?(I(e,"serverHeartbeatFailed",{durationMS:s,failure:t,connectionId:n.name}),B(e.connectedProxies,e.disconnectedProxies,n)):(n.ismaster=i.result,n.lastIsMasterMS=s,I(e,"serverHeartbeatSucceeded",{durationMS:s,reply:i.result,connectionId:n.name})),r(t,i)})}},e.s.haInterval)}(t,{firstConnect:!0})}}}function D(t){for(var e=t.connectedProxies.slice(0),n=Number.MAX_VALUE,r=0;r<e.length;r++)e[r].lastIsMasterMS<n&&(n=e[r].lastIsMasterMS);if(0===(e=e.filter(function(e){if(e.lastIsMasterMS<=n+t.s.localThresholdMS&&e.isConnected())return!0})).length)return t.connectedProxies[0];var o=e[t.index%e.length];return t.index=(t.index+1)%e.length,o}function B(t,e,n){for(var r=0;r<t.length;r++)t[r].name===n.name&&t.splice(r,1);for(r=0;r<e.length;r++)e[r].name===n.name&&e.splice(r,1);e.push(n)}function L(t,e){for(var n=0;n<t.length;n++)t[n].name===e.name&&t.splice(n,1)}function F(t,e,n){var r=e.length,o=function(t,e){return function(){var o=this;if(r-=1,t.state===C||t.state===A)return B(t.connectingProxies,t.disconnectedProxies,o),this.destroy();"connect"!==e||t.authenticating?(B(t.connectingProxies,t.disconnectedProxies,o),this.destroy()):U(t,o,function(){if(t.state===C||t.state===A)return B(t.connectingProxies,t.disconnectedProxies,o),o.destroy();for(var e=0;e<N.length;e++)o.removeAllListeners(N[e]);o.on("error",P(t)),o.on("close",P(t)),o.on("timeout",P(t)),o.on("parseError",P(t)),B(t.connectingProxies,t.connectedProxies,o),W(t),t.emit("joined","mongos",o)}),0===r&&n()}};if(0===r)return n();function i(e,n){setTimeout(function(){if(t.state!==C&&t.state!==A){var n=new l(Object.assign({},t.s.options,{host:e.name.split(":")[0],port:parseInt(e.name.split(":")[1],10),authProviders:t.authProviders,reconnect:!1,monitoring:!1,parent:t,clientInfo:h(t.s.clientInfo)}));R(e),L(t.disconnectedProxies,e),y(n,t,["serverDescriptionChanged"]),t.emit("serverOpening",{topologyId:-1!==n.s.topologyId?n.s.topologyId:t.id,address:n.name}),n.once("connect",o(t,"connect")),n.once("close",o(t,"close")),n.once("timeout",o(t,"timeout")),n.once("error",o(t,"error")),n.once("parseError",o(t,"parseError")),y(n,t,["commandStarted","commandSucceeded","commandFailed"]),t.connectingProxies.push(n),n.connect(t.s.connectOptions)}},n)}for(var s=0;s<e.length;s++)i(e[s],s)}function U(t,e,n){if(0===t.s.authenticationContexts.length)return n();!function t(e,n,r){if(0===e.length)return r();var o=e.shift().slice(0);o.push(function(){t(e,n,r)}),n.auth.apply(n,o)}(t.s.authenticationContexts.slice(0),e,n)}$.prototype.connect=function(t){var e=this;this.s.connectOptions=t||{},T(this,O);var n=this.s.seedlist.map(function(t){const n=new l(Object.assign({},e.s.options,t,{authProviders:e.authProviders,reconnect:!1,monitoring:!1,parent:e,clientInfo:h(e.s.clientInfo)}));return y(n,e,["serverDescriptionChanged"]),n});I(this,"topologyOpening",{topologyId:this.id}),function(t,e){t.connectingProxies=t.connectingProxies.concat(e);var n=0;function r(e,n){setTimeout(function(){t.emit("serverOpening",{topologyId:t.id,address:e.name}),W(t),e.once("close",j(t,"close")),e.once("timeout",j(t,"timeout")),e.once("parseError",j(t,"parseError")),e.once("error",j(t,"error")),e.once("connect",j(t,"connect")),y(e,t,["commandStarted","commandSucceeded","commandFailed"]),e.connect(t.s.connectOptions)},n)}for(;e.length>0;)r(e.shift(),n++)}(e,n)},$.prototype.lastIsMaster=function(){return this.ismaster},$.prototype.unref=function(){T(this,A),this.connectedProxies.concat(this.connectingProxies).forEach(function(t){t.unref()}),clearTimeout(this.haTimeoutId)},$.prototype.destroy=function(t){var e=this;T(this,C);var n=this.connectedProxies.concat(this.connectingProxies);this.haTimeoutId&&clearTimeout(this.haTimeoutId),this.s.authenticationContexts=[],n.forEach(function(n){e.emit("serverClosed",{topologyId:e.id,address:n.name}),R(n,t),B(e.connectedProxies,e.disconnectedProxies,n)}),W(e),I(this,"topologyClosed",{topologyId:this.id})},$.prototype.isConnected=function(){return this.connectedProxies.length>0},$.prototype.isDestroyed=function(){return this.state===C};var q=function(t,e,n,r,o,i){"function"==typeof o&&(i=o,o={}),o=o||{};let s=D(t);return s?o.retryWrites&&o.session&&g(t)?(o.willRetryWrite=!0,o.session.incrementTransactionNumber(),void s[e](n,r,o,(u,c)=>u?_(u)&&(s=D(t))&&g(s)?void s[e](n,r,o,i):i(u):i(null,c))):s[e](n,r,o,i):i(new a("no mongos proxy available"))};$.prototype.insert=function(t,e,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===C?r(new a(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void q(this,"insert",t,e,n,r):r(new a("no mongos proxy available")):this.s.disconnectHandler.add("insert",t,e,n,r)},$.prototype.update=function(t,e,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===C?r(new a(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void q(this,"update",t,e,n,r):r(new a("no mongos proxy available")):this.s.disconnectHandler.add("update",t,e,n,r)},$.prototype.remove=function(t,e,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===C?r(new a(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void q(this,"remove",t,e,n,r):r(new a("no mongos proxy available")):this.s.disconnectHandler.add("remove",t,e,n,r)};const x=["findAndModify","insert","update","delete"];function W(t){if(t.listeners("topologyDescriptionChanged").length>0){var e="Unknown";t.connectedProxies.length>0&&(e="Sharded");var n={topologyType:e,servers:[]},r=t.disconnectedProxies.concat(t.connectingProxies);n.servers=n.servers.concat(r.map(function(t){var e=t.getDescription();return e.type="Unknown",e})),n.servers=n.servers.concat(t.connectedProxies.map(function(t){var e=t.getDescription();return e.type="Mongos",e}));var o=p(t.topologyDescription,n),i={topologyId:t.id,previousDescription:t.topologyDescription,newDescription:n,diff:o};o.servers.length>0&&t.emit("topologyDescriptionChanged",i),t.topologyDescription=n}}$.prototype.command=function(t,e,n,r){if("function"==typeof n&&(r=n,n=(n={})||{}),this.state===C)return r(new a(o("topology was destroyed")));var i=D(this);if((null==i||!i.isConnected())&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",t,e,n,r);if(null==i)return r(new a("no mongos proxy available"));var s=f(n);s.topology=this;const u=!n.retrying&&n.retryWrites&&n.session&&g(this)&&!n.session.inTransaction()&&(c=e,x.some(t=>c[t]));var c;u&&(n.session.incrementTransactionNumber(),n.willRetryWrite=u),i.command(t,e,s,(n,o)=>{if(!n)return r(null,o);if(!_(n))return r(n);if(u){const n=Object.assign({},s,{retrying:!0});return this.command(t,e,n,r)}return r(n)})},$.prototype.cursor=function(t,e,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(this.s.bson,t,e,n,r,this.s.options)},$.prototype.auth=function(t,e){var n=Array.prototype.slice.call(arguments,0).slice(0),r=this,i=Array.prototype.slice.call(arguments,2),s=i.pop(),u=0;if(null==this.authProviders[t]&&"default"!==t)return s(new a(o("auth provider %s does not exist",t)));if(this.authenticating)return s(new a("authentication or logout allready in process"));if(!r.isConnected()&&null!=r.s.disconnectHandler)return r.s.disconnectHandler.add("auth",e,n,{},s);this.authenticating=!0;var c=[],l=this.connectedProxies.slice(0);function h(n){var o=[t,e].concat(i.slice(0)).concat([function(t){if(p-=1,t&&c.push({name:n.name,err:t}),0===p){if(r.authenticating=!1,c.length)return r.s.authenticationContexts.splice(u,0),s(new a({message:"authentication fail",errors:c}),!1);s(null,r)}}]);n.lastIsMaster().arbiterOnly||n.auth.apply(n,o)}0===l.length&&(this.authenticating=!1,s(null,!0)),u=this.s.authenticationContexts.length,this.s.authenticationContexts.push([t,e].concat(i.slice(0)));for(var p=l.length;l.length>0;)h(l.shift())},$.prototype.logout=function(t,e){var n=this;if(this.authenticating)throw new a("authentication or logout allready in process");this.authenticating=!0;for(var r=Object.keys(this.authProviders),i=0;i<r.length;i++)this.authProviders[r[i]].logout(t);var s=this.connectedProxies.slice(0),u=s.length;if(0===u)return e();var c=[];function l(e,n){e.logout(t,function(t){t&&c.push({name:e.name,err:t}),n()})}for(i=0;i<s.length;i++)l(s[i],function(){if(0===(u-=1)){if(n.authenticating=!1,c.length)return e(new a({message:o("logout failed against db %s",t),errors:c}),!1);e()}})},$.prototype.selectServer=function(t,e,n){"function"==typeof t&&void 0===n&&(n=t,t=void 0,e={}),"function"==typeof e&&(n=e,e=t,t=void 0),e=e||{};const r=D(this);this.s.debug&&this.emit("pickedServer",null,r),n(null,r)},$.prototype.connections=function(){for(var t=[],e=0;e<this.connectedProxies.length;e++)t=t.concat(this.connectedProxies[e].connections());return t},t.exports=$},function(t,e,n){"use strict";const r=n(20).retrieveBSON,o=n(10),i=r().Binary,s=n(27).uuidV4,u=n(4).MongoError,c=n(4).isRetryableError,a=n(4).MongoNetworkError,l=n(4).MongoWriteConcernError,h=n(100).Transaction,p=n(100).TxnState;function f(t,e){if(null==t.serverSession){const t=new u("Cannot use a session that has ended");if("function"==typeof e)return e(t,null),!1;throw t}return!0}class d extends o{constructor(t,e,n,r){if(super(),null==t)throw new Error("ClientSession requires a topology");if(null==e||!(e instanceof y))throw new Error("ClientSession requires a ServerSessionPool");n=n||{},this.topology=t,this.sessionPool=e,this.hasEnded=!1,this.serverSession=e.acquire(),this.clientOptions=r,this.supports={causalConsistency:void 0===n.causalConsistency||n.causalConsistency},void 0!==(n=n||{}).initialClusterTime?this.clusterTime=n.initialClusterTime:this.clusterTime=null,this.operationTime=null,this.explicit=!!n.explicit,this.owner=n.owner,this.defaultTransactionOptions=Object.assign({},n.defaultTransactionOptions),this.transaction=new h}get id(){return this.serverSession.id}endSession(t,e){"function"==typeof t&&(e=t,t={}),t=t||{},this.hasEnded?"function"==typeof e&&e(null,null):(this.serverSession&&this.inTransaction()&&this.abortTransaction(),this.hasEnded=!0,this.emit("ended",this),this.sessionPool.release(this.serverSession),"function"==typeof e&&e(null,null))}advanceOperationTime(t){null!=this.operationTime?t.greaterThan(this.operationTime)&&(this.operationTime=t):this.operationTime=t}equals(t){return t instanceof d&&this.id.id.buffer.equals(t.id.id.buffer)}incrementTransactionNumber(){this.serverSession.txnNumber++}inTransaction(){return this.transaction.isActive}startTransaction(t){if(f(this),this.inTransaction())throw new u("Transaction already in progress");this.incrementTransactionNumber(),this.transaction=new h(Object.assign({},this.clientOptions,t||this.defaultTransactionOptions)),this.transaction.transition(p.STARTING_TRANSACTION)}commitTransaction(t){if("function"!=typeof t)return new Promise((t,e)=>{m(this,"commitTransaction",(n,r)=>n?e(n):t(r))});m(this,"commitTransaction",t)}abortTransaction(t){if("function"!=typeof t)return new Promise((t,e)=>{m(this,"abortTransaction",(n,r)=>n?e(n):t(r))});m(this,"abortTransaction",t)}toBSON(){throw new Error("ClientSession cannot be serialized to BSON.")}}function m(t,e,n){if(!f(t,n))return;let r=t.transaction.state;if(r===p.NO_TRANSACTION)return void n(new u("No transaction started"));if("commitTransaction"===e){if(r===p.STARTING_TRANSACTION||r===p.TRANSACTION_COMMITTED_EMPTY)return t.transaction.transition(p.TRANSACTION_COMMITTED_EMPTY),void n(null,null);if(r===p.TRANSACTION_ABORTED)return void n(new u("Cannot call commitTransaction after calling abortTransaction"))}else{if(r===p.STARTING_TRANSACTION)return t.transaction.transition(p.TRANSACTION_ABORTED),void n(null,null);if(r===p.TRANSACTION_ABORTED)return void n(new u("Cannot call abortTransaction twice"));if(r===p.TRANSACTION_COMMITTED||r===p.TRANSACTION_COMMITTED_EMPTY)return void n(new u("Cannot call abortTransaction after calling commitTransaction"))}const o={[e]:1};function i(r,o){if("commitTransaction"===e){if(t.transaction.transition(p.TRANSACTION_COMMITTED),r&&(r instanceof a||r instanceof l||c(r))){if(r.errorLabels){const t=r.errorLabels.indexOf("TransientTransactionError");-1!==t&&r.errorLabels.splice(t,1)}else r.errorLabels=[];r.errorLabels.push("UnknownTransactionCommitResult")}}else t.transaction.transition(p.TRANSACTION_ABORTED);n(r,o)}function s(t){return"commitTransaction"===e?t:null}t.transaction.options.writeConcern?Object.assign(o,{writeConcern:t.transaction.options.writeConcern}):t.clientOptions&&t.clientOptions.w&&Object.assign(o,{writeConcern:{w:t.clientOptions.w}}),t.topology.command("admin.$cmd",o,{session:t},(e,n)=>{if(e&&c(e))return t.topology.command("admin.$cmd",o,{session:t},(t,e)=>i(s(t),e));i(s(e),n)})}class g{constructor(){this.id={id:new i(s(),i.SUBTYPE_UUID)},this.lastUse=Date.now(),this.txnNumber=0}hasTimedOut(t){return Math.round((Date.now()-this.lastUse)%864e5%36e5/6e4)>t-1}}class y{constructor(t){if(null==t)throw new Error("ServerSessionPool requires a topology");this.topology=t,this.sessions=[]}endAllPooledSessions(){this.sessions.length&&(this.topology.endSessions(this.sessions.map(t=>t.id)),this.sessions=[])}acquire(){const t=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){const e=this.sessions.shift();if(!e.hasTimedOut(t))return e}return new g}release(t){const e=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){if(!this.sessions[this.sessions.length-1].hasTimedOut(e))break;this.sessions.pop()}t.hasTimedOut(e)||this.sessions.unshift(t)}}t.exports={ClientSession:d,ServerSession:g,ServerSessionPool:y,TxnState:p}},function(t,e,n){"use strict";const r=n(36),o=n(101),i=n(150),s=n(4).MongoParseError,u=n(33),c=/(mongodb(?:\+srv|)):\/\/(?: (?:[^:]*) (?: : ([^@]*) )? @ )?([^\/?]*)(?:\/|)(.*)/;function a(t,e){const n=/^.*?\./,r=`.${t.replace(n,"")}`,o=`.${e.replace(n,"")}`;return r.endsWith(o)}function l(t,e){if(Array.isArray(e))1===(e=e.filter((t,n)=>e.indexOf(t)===n)).length&&(e=e[0]);else if(e.indexOf(":")>0)e=e.split(",").reduce((e,n)=>{const r=n.split(":");return e[r[0]]=l(t,r[1]),e},{});else if(e.indexOf(",")>0)e=e.split(",").map(e=>l(t,e));else if("true"===e.toLowerCase()||"false"===e.toLowerCase())e="true"===e.toLowerCase();else if(!Number.isNaN(e)&&!p.has(t)){const t=parseFloat(e);Number.isNaN(t)||(e=parseFloat(e))}return e}const h=new Set(["slaveok","slave_ok","sslvalidate","fsync","safe","retrywrites","j"]),p=new Set(["authsource","replicaset"]),f=new Set(["GSSAPI","MONGODB-X509","MONGODB-CR","DEFAULT","SCRAM-SHA-1","SCRAM-SHA-256","PLAIN"]),d={replicaset:"replicaSet",connecttimeoutms:"connectTimeoutMS",sockettimeoutms:"socketTimeoutMS",maxpoolsize:"maxPoolSize",minpoolsize:"minPoolSize",maxidletimems:"maxIdleTimeMS",waitqueuemultiple:"waitQueueMultiple",waitqueuetimeoutms:"waitQueueTimeoutMS",wtimeoutms:"wtimeoutMS",readconcern:"readConcern",readconcernlevel:"readConcernLevel",readpreference:"readPreference",maxstalenessseconds:"maxStalenessSeconds",readpreferencetags:"readPreferenceTags",authsource:"authSource",authmechanism:"authMechanism",authmechanismproperties:"authMechanismProperties",gssapiservicename:"gssapiServiceName",localthresholdms:"localThresholdMS",serverselectiontimeoutms:"serverSelectionTimeoutMS",serverselectiontryonce:"serverSelectionTryOnce",heartbeatfrequencyms:"heartbeatFrequencyMS",appname:"appName",retrywrites:"retryWrites",uuidrepresentation:"uuidRepresentation",zlibcompressionlevel:"zlibCompressionLevel"};function m(t,e,n,r){if("journal"===e?e="j":"wtimeoutms"===e&&(e="wtimeout"),h.has(e)?n="true"===n||!0===n:"appname"===e?n=decodeURIComponent(n):"readconcernlevel"===e&&(e="readconcern",n={level:n}),"compressors"===e&&!(n=Array.isArray(n)?n:[n]).every(t=>"snappy"===t||"zlib"===t))throw new s("Value for `compressors` must be at least one of: `snappy`, `zlib`");if("authmechanism"===e&&!f.has(n))throw new s("Value for `authMechanism` must be one of: `DEFAULT`, `GSSAPI`, `PLAIN`, `MONGODB-X509`, `SCRAM-SHA-1`, `SCRAM-SHA-256`");if("readpreference"===e&&!u.isValid(n))throw new s("Value for `readPreference` must be one of: `primary`, `primaryPreferred`, `secondary`, `secondaryPreferred`, `nearest`");if("zlibcompressionlevel"===e&&(n<-1||n>9))throw new s("zlibCompressionLevel must be an integer between -1 and 9");"compressors"!==e&&"zlibcompressionlevel"!==e||(t.compression=t.compression||{},t=t.compression),"authmechanismproperties"===e&&("string"==typeof n.SERVICE_NAME&&(t.gssapiServiceName=n.SERVICE_NAME),"string"==typeof n.SERVICE_REALM&&(t.gssapiServiceRealm=n.SERVICE_REALM),void 0!==n.CANONICALIZE_HOST_NAME&&(t.gssapiCanonicalizeHostName=n.CANONICALIZE_HOST_NAME)),r.caseTranslate&&d[e]?t[d[e]]=n:t[e]=n}const g=new Set(["GSSAPI","MONGODB-CR","PLAIN","SCRAM-SHA-1","SCRAM-SHA-256"]);const y="mongodb+srv",_=["mongodb",y];function v(t,e,n){"function"==typeof e&&(n=e,e={}),e=Object.assign({},{caseTranslate:!0},e);try{r.parse(t)}catch(t){return n(new s("URI malformed, cannot be parsed"))}const u=t.match(c);if(!u)return n(new s("Invalid connection string"));const h=u[1];if(-1===_.indexOf(h))return n(new s("Invalid protocol provided"));if(h===y)return function(t,e,n){const u=r.parse(t,!0);if(u.hostname.split(".").length<3)return n(new s("URI does not have hostname, domain name and tld"));if(u.domainLength=u.hostname.split(".").length,u.pathname&&u.pathname.match(","))return n(new s("Invalid URI, cannot contain multiple hostnames"));if(u.port)return n(new s(`Ports not accepted with '${y}' URIs`));const c=u.host;i.resolveSrv(`_mongodb._tcp.${c}`,(t,l)=>{if(t)return n(t);if(0===l.length)return n(new s("No addresses found at host"));for(let t=0;t<l.length;t++)if(!a(l[t].name,u.hostname,u.domainLength))return n(new s("Server record does not share hostname with parent URI"));u.protocol="mongodb",u.host=l.map(t=>`${t.name}:${t.port}`).join(","),"ssl"in e||u.search&&"ssl"in u.query&&null!==u.query.ssl||(u.query.ssl=!0),i.resolveTxt(c,(t,i)=>{if(t){if("ENODATA"!==t.code)return n(t);i=null}if(i){if(i.length>1)return n(new s("Multiple text records not allowed"));if(i=o.parse(i[0].join("")),Object.keys(i).some(t=>"authSource"!==t&&"replicaSet"!==t))return n(new s("Text record must only set `authSource` or `replicaSet`"));Object.assign(u.query,i)}u.search=o.stringify(u.query),v(r.format(u),e,n)})})}(t,e,n);const p=u[4].split("?"),f=p.length>0?p[0]:null,d=p.length>1?p[1]:null;let w;try{w=function(t,e){const n={};let r=o.parse(t);for(const t in r){const o=r[t];if(""===o||null==o)throw new s("Incomplete key value pair for option");const i=t.toLowerCase();m(n,i,l(i,o),e)}return n.wtimeout&&n.wtimeoutms&&(delete n.wtimeout,console.warn("Unsupported option `wtimeout` specified")),Object.keys(n).length?n:null}(d,e)}catch(t){return n(t)}w=Object.assign({},w,e);const b={username:null,password:null,db:f&&""!==f?o.unescape(f):null};if(w.auth&&(w.auth.username&&(b.username=w.auth.username),w.auth.user&&(b.username=w.auth.user),w.auth.password&&(b.password=w.auth.password)),-1!==u[4].split("?")[0].indexOf("@"))return n(new s("Unescaped slash in userinfo section"));const O=u[3].split("@");if(O.length>2)return n(new s("Unescaped at-sign in authority section"));if(O.length>1){const t=O.shift().split(":");if(t.length>2)return n(new s("Unescaped colon in authority section"));b.username=o.unescape(t[0]),b.password=t[1]?o.unescape(t[1]):null}let S=null;const A=O.shift().split(",").map(t=>{let e=r.parse(`mongodb://${t}`);if("/:"===e.path)return S=new s("Double colon in host identifier"),null;if(t.match(/\.sock/)&&(e.hostname=o.unescape(t),e.port=null),Number.isNaN(e.port))return void(S=new s("Invalid port (non-numeric string)"));const n={host:e.hostname,port:e.port?parseInt(e.port):27017};if(0!==n.port)if(n.port>65535)S=new s("Invalid port (larger than 65535) with hostname");else{if(!(n.port<0))return n;S=new s("Invalid port (negative number)")}else S=new s("Invalid port (zero) with hostname")}).filter(t=>!!t);if(S)return n(S);if(0===A.length||""===A[0].host||null===A[0].host)return n(new s("No hostname or hostnames provided in connection string"));const C={hosts:A,auth:b.db||b.username?b:null,options:Object.keys(w).length?w:null};C.auth&&C.auth.db&&(C.defaultDatabase=C.auth.db);try{!function(t){if(null==t.options)return;const e=t.options,n=e.authsource||e.authSource;null!=n&&(t.auth=Object.assign({},t.auth,{db:n}));const r=e.authmechanism||e.authMechanism;if(null!=r){if(g.has(r)&&(!t.auth||null==t.auth.username))throw new s(`Username required for mechanism \`${r}\``);if("GSSAPI"===r){if(null!=n&&"$external"!==n)throw new s(`Invalid source \`${n}\` for mechanism \`${r}\` specified.`);t.auth=Object.assign({},t.auth,{db:"$external"})}if("MONGODB-X509"===r){if(t.auth&&null!=t.auth.password)throw new s(`Password not allowed for mechanism \`${r}\``);if(null!=n&&"$external"!==n)throw new s(`Invalid source \`${n}\` for mechanism \`${r}\` specified.`);t.auth=Object.assign({},t.auth,{db:"$external"})}"PLAIN"===r&&t.auth&&null==t.auth.db&&(t.auth=Object.assign({},t.auth,{db:"$external"}))}t.auth&&null==t.auth.db&&(t.auth=Object.assign({},t.auth,{db:"admin"}))}(C)}catch(t){return n(t)}n(null,C)}t.exports=v},function(t,e,n){"use strict";const r=n(10).EventEmitter;t.exports=class extends r{constructor(){super()}instrument(t,e){this.$MongoClient=t;const n=this.$prototypeConnect=t.prototype.connect,r=this;t.prototype.connect=function(t){return this.s.options.monitorCommands=!0,this.on("commandStarted",t=>r.emit("started",t)),this.on("commandSucceeded",t=>r.emit("succeeded",t)),this.on("commandFailed",t=>r.emit("failed",t)),n.call(this,t)},"function"==typeof e&&e(null,this)}uninstrument(){this.$MongoClient.prototype.connect=this.$prototypeConnect}}},function(t,e,n){"use strict";const r=n(2).MongoNetworkError,o=n(2).mongoErrorContextSymbol,i=new Set([136,237,11601]);t.exports={GET_MORE_NON_RESUMABLE_CODES:i,isResumableError:function(t){return!!function(t){if(t[o])return t[o].isGetMore}(t)&&!!(t instanceof r||!i.has(t.code)||t.message.match(/not master/)||t.message.match(/node is recovering/))}}},function(t,e,n){"use strict";const r=n(79),o=r.BulkOperationBase,i=n(1),s=i.toError,u=i.handleCallback,c=r.BulkWriteResult,a=r.Batch,l=r.mergeBatchResults,h=i.executeOperation,p=n(2).MongoWriteConcernError,f=n(79).handleMongoWriteConcernError,d=r.bson;function m(t,e,n){const o=d.calculateObjectSize(n,{checkKeys:!1});if(o>=t.s.maxBatchSizeBytes)throw s("document is larger than the maximum size "+t.s.maxBatchSizeBytes);if(t.s.currentBatch=null,e===r.INSERT?t.s.currentBatch=t.s.currentInsertBatch:e===r.UPDATE?t.s.currentBatch=t.s.currentUpdateBatch:e===r.REMOVE&&(t.s.currentBatch=t.s.currentRemoveBatch),null==t.s.currentBatch&&(t.s.currentBatch=new a(e,t.s.currentIndex)),(t.s.currentBatch.size+1>=t.s.maxWriteBatchSize||t.s.currentBatch.sizeBytes+o>=t.s.maxBatchSizeBytes||t.s.currentBatch.batchType!==e)&&(t.s.batches.push(t.s.currentBatch),t.s.currentBatch=new a(e,t.s.currentIndex)),Array.isArray(n))throw s("operation passed in cannot be an Array");return t.s.currentBatch.operations.push(n),t.s.currentBatch.originalIndexes.push(t.s.currentIndex),t.s.currentIndex=t.s.currentIndex+1,e===r.INSERT?(t.s.currentInsertBatch=t.s.currentBatch,t.s.bulkResult.insertedIds.push({index:t.s.bulkResult.insertedIds.length,_id:n._id})):e===r.UPDATE?t.s.currentUpdateBatch=t.s.currentBatch:e===r.REMOVE&&(t.s.currentRemoveBatch=t.s.currentBatch),t.s.currentBatch.size=t.s.currentBatch.size+1,t.s.currentBatch.sizeBytes=t.s.currentBatch.sizeBytes+o,t}class g extends o{constructor(t,e,n){n=n||{},super(t,e,n=Object.assign(n,{addToOperationsList:m}),!1)}execute(t,e,n){const r=this.bulkExecute(t,e,n);return e=r.options,n=r.callback,h(this.s.topology,_,[this,e,n])}}function y(t,e,n,r){t.finalOptionsHandler({options:n,batch:e,resultHandler:function(n,o){return!(n&&n.driver||n&&n.message)||n instanceof p?(n&&(n.ok=0),n instanceof p?f(e,t.s.bulkResult,!1,n,r):void u(r,null,l(!1,e,t.s.bulkResult,n,o))):u(r,n)}},r)}function _(t,e,n){let r=t.s.batches.length;for(let o=0;o<t.s.batches.length;o++)y(t,t.s.batches[o],e,function(e){if(0===(r-=1)){if(e)return u(n,e);const r=new c(t.s.bulkResult);if(t.handleWriteError(n,r))return;return u(n,null,r)}})}function v(t,e,n){return new g(t,e,n)}v.UnorderedBulkOperation=g,t.exports=v,t.exports.Bulk=g},function(t,e,n){"use strict";const r=n(79),o=r.BulkOperationBase,i=n(1),s=i.toError,u=i.handleCallback,c=r.BulkWriteResult,a=r.Batch,l=r.mergeBatchResults,h=i.executeOperation,p=n(2).MongoWriteConcernError,f=n(79).handleMongoWriteConcernError,d=r.bson;function m(t,e,n){const o=d.calculateObjectSize(n,{checkKeys:!1});if(o>=t.s.maxBatchSizeBytes)throw s("document is larger than the maximum size "+t.s.maxBatchSizeBytes);if(null==t.s.currentBatch&&(t.s.currentBatch=new a(e,t.s.currentIndex)),t.s.currentBatchSize+1>=t.s.maxWriteBatchSize||t.s.currentBatchSizeBytes+t.s.currentBatchSizeBytes>=t.s.maxBatchSizeBytes||t.s.currentBatch.batchType!==e?(t.s.batches.push(t.s.currentBatch),t.s.currentBatch=new a(e,t.s.currentIndex),t.s.currentBatchSize=0,t.s.currentBatchSizeBytes=0):(t.s.currentBatchSize=t.s.currentBatchSize+1,t.s.currentBatchSizeBytes=t.s.currentBatchSizeBytes+o),e===r.INSERT&&t.s.bulkResult.insertedIds.push({index:t.s.currentIndex,_id:n._id}),Array.isArray(n))throw s("operation passed in cannot be an Array");return t.s.currentBatch.originalIndexes.push(t.s.currentIndex),t.s.currentBatch.operations.push(n),t.s.currentBatchSizeBytes=t.s.currentBatchSizeBytes+o,t.s.currentIndex=t.s.currentIndex+1,t}class g extends o{constructor(t,e,n){n=n||{},super(t,e,n=Object.assign(n,{addToOperationsList:m}),!0)}execute(t,e,n){const r=this.bulkExecute(t,e,n);return e=r.options,n=r.callback,h(this.s.topology,y,[this,e,n])}}function y(t,e,n){if(0===t.s.batches.length)return u(n,null,new c(t.s.bulkResult));const r=t.s.batches.shift();t.finalOptionsHandler({options:e,batch:r,resultHandler:function(o,i){if((o&&o.driver||o&&o.message)&&!(o instanceof p))return u(n,o);if(o&&(o.ok=0),o instanceof p)return f(r,t.s.bulkResult,!0,o,n);const s=new c(t.s.bulkResult);if(null!=l(!0,r,t.s.bulkResult,o,i))return u(n,null,s);t.handleWriteError(n,s)||y(t,e,n)}},n)}function _(t,e,n){return new g(t,e,n)}_.OrderedBulkOperation=g,t.exports=_,t.exports.Bulk=g},function(t,e,n){"use strict";var r=n(1).shallowClone,o=n(1).handleCallback,i=n(2).MongoError,s=n(0).format,u=function(t,e,n,r,u){if(t.topology&&t.topology.isDestroyed())return u(new i("topology was destroyed"));var c=r.dbName;c=r.authdb?r.authdb:c,c=r.authSource?r.authSource:c;var a=function(e,n){t.listeners("authenticated").length>0&&t.emit("authenticated",e,n),o(u,e,n)},l=r.authMechanism||"";"MONGODB-CR"===(l=l.toUpperCase())?t.topology.auth("mongocr",c,e,n,function(t){if(t)return o(u,t,!1);a(null,!0)}):"PLAIN"===l?t.topology.auth("plain",c,e,n,function(t){if(t)return o(u,t,!1);a(null,!0)}):"MONGODB-X509"===l?t.topology.auth("x509",c,e,n,function(t){if(t)return o(u,t,!1);a(null,!0)}):"SCRAM-SHA-1"===l?t.topology.auth("scram-sha-1",c,e,n,function(t){if(t)return o(u,t,!1);a(null,!0)}):"SCRAM-SHA-256"===l?t.topology.auth("scram-sha-256",c,e,n,function(t){if(t)return o(u,t,!1);a(null,!0)}):"GSSAPI"===l?"win32"===process.platform?t.topology.auth("sspi",c,e,n,r,function(t){if(t)return o(u,t,!1);a(null,!0)}):t.topology.auth("gssapi",c,e,n,r,function(t){if(t)return o(u,t,!1);a(null,!0)}):"DEFAULT"===l?t.topology.auth("default",c,e,n,function(t){if(t)return o(u,t,!1);a(null,!0)}):o(u,i.create({message:s("authentication mechanism %s not supported",r.authMechanism),driver:!0}))};t.exports=function(t,e,n,s,c){if("function"==typeof s&&(c=s,s={}),(s=r(s=s||{})).authMechanism){if("GSSAPI"!==s.authMechanism&&"DEFAULT"!==s.authMechanism&&"MONGODB-CR"!==s.authMechanism&&"MONGODB-X509"!==s.authMechanism&&"SCRAM-SHA-1"!==s.authMechanism&&"SCRAM-SHA-256"!==s.authMechanism&&"PLAIN"!==s.authMechanism)return o(c,i.create({message:"only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, or SCRAM-SHA-1 is supported by authMechanism",driver:!0}))}else s.authMechanism="DEFAULT";return"function"==typeof c?u(t,e,n,s,function(t,e){if(t&&t.message&&-1!==t.message.indexOf("saslStart")&&(t.code=59),t)return c(t,e);c(null,e)}):new t.s.promiseLibrary(function(r,o){u(t,e,n,s,function(t,e){if(t&&t.message&&-1!==t.message.indexOf("saslStart")&&(t.code=59),t)return o(t);r(e)})})}},function(t){t.exports={_from:"mongodb@3.1.10",_id:"mongodb@3.1.10",_inBundle:!1,_integrity:"sha512-Uml42GeFxhTGQVml1XQ4cD0o/rp7J2ROy0fdYUcVitoE7vFqEhKH4TYVqRDpQr/bXtCJVxJdNQC1ntRxNREkPQ==",_location:"/mongodb",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"mongodb@3.1.10",name:"mongodb",escapedName:"mongodb",rawSpec:"3.1.10",saveSpec:null,fetchSpec:"3.1.10"},_requiredBy:["/mongoose"],_resolved:"https://registry.npmjs.org/mongodb/-/mongodb-3.1.10.tgz",_shasum:"45ad9b74ea376f4122d0881b75e5489b9e504ed7",_spec:"mongodb@3.1.10",_where:"/Users/andeladeveloper/Documents/workspace/micro-blog/node_modules/mongoose",bugs:{url:"https://github.com/mongodb/node-mongodb-native/issues"},bundleDependencies:!1,dependencies:{"mongodb-core":"3.1.9","safe-buffer":"^5.1.2"},deprecated:!1,description:"The official MongoDB driver for Node.js",devDependencies:{bluebird:"3.5.0",bson:"^1.0.4",chai:"^4.1.1","chai-subset":"^1.6.0",co:"4.6.0",coveralls:"^2.11.6",eslint:"^4.5.0","eslint-plugin-prettier":"^2.2.0",istanbul:"^0.4.5",jsdoc:"3.5.5","lodash.camelcase":"^4.3.0","mocha-sinon":"^2.1.0","mongodb-extjson":"^2.1.1","mongodb-mock-server":"^1.0.0","mongodb-test-runner":"^1.1.18",prettier:"~1.12.0",semver:"^5.5.0",sinon:"^4.3.0","sinon-chai":"^3.2.0","standard-version":"^4.4.0","worker-farm":"^1.5.0"},engines:{node:">=4"},files:["index.js","lib"],homepage:"https://github.com/mongodb/node-mongodb-native",keywords:["mongodb","driver","official"],license:"Apache-2.0",main:"index.js",name:"mongodb",repository:{type:"git",url:"git+ssh://git@github.com/mongodb/node-mongodb-native.git"},scripts:{bench:"node test/driverBench/",coverage:"istanbul cover mongodb-test-runner -- -t 60000  test/unit test/functional",format:"prettier --print-width 100 --tab-width 2 --single-quote --write 'test/**/*.js' 'lib/**/*.js'","generate-evergreen":"node .evergreen/generate_evergreen_tasks.js",lint:"eslint lib test",release:"standard-version -i HISTORY.md",test:"npm run lint && mongodb-test-runner -t 60000 test/unit test/functional"},version:"3.1.10"}},function(t,e,n){"use strict";const r=n(2).ReadPreference,o=n(36),i=n(0).format,s=n(2).Logger,u=n(150);function c(t,e){let n=/^.*?\./,r=`.${t.replace(n,"")}`,o=`.${e.replace(n,"")}`;return!!r.endsWith(o)}function a(t,e,n){let u,c;try{u=function(t,e){let n="",u="",c="",a="admin",l=o.parse(t,!0);if((null==l.hostname||""===l.hostname)&&-1===t.indexOf(".sock"))throw new Error("No hostname or hostnames provided in connection string");if("0"===l.port)throw new Error("Invalid port (zero) with hostname");if(!isNaN(parseInt(l.port,10))&&parseInt(l.port,10)>65535)throw new Error("Invalid port (larger than 65535) with hostname");if(l.path&&l.path.length>0&&"/"!==l.path[0]&&-1===t.indexOf(".sock"))throw new Error("Missing delimiting slash between hosts and options");if(l.query)for(let t in l.query){if(-1!==t.indexOf("::"))throw new Error("Double colon in host identifier");if(""===l.query[t])throw new Error("Query parameter "+t+" is an incomplete value pair")}if(l.auth){let e=l.auth.split(":");if(-1!==t.indexOf(l.auth)&&e.length>2)throw new Error("Username with password containing an unescaped colon");if(-1!==t.indexOf(l.auth)&&-1!==l.auth.indexOf("@"))throw new Error("Username containing an unescaped at-sign")}let h=t.split("?").shift().split(","),p=[];for(let t=0;t<h.length;t++){let e=h[t];-1!==e.indexOf("mongodb")?-1!==e.indexOf("@")?p.push(e.split("@").pop()):p.push(e.substr("mongodb://".length)):-1!==e.indexOf("/")?p.push(e.split("/").shift()):-1===e.indexOf("/")&&p.push(e.trim())}for(let t=0;t<p.length;t++){let e=o.parse(i("mongodb://%s",p[t].trim()));if((!e.path||-1===e.path.indexOf(".sock"))&&(e.path&&-1!==e.path.indexOf(":")))throw e.path.split("/").length>1&&-1===e.path.indexOf("::")?new Error("Slash in host identifier"):new Error("Double colon in host identifier")}-1!==t.indexOf("?")?(c=t.substr(t.indexOf("?")+1),n=t.substring("mongodb://".length,t.indexOf("?"))):n=t.substring("mongodb://".length);-1!==n.indexOf("@")&&(u=n.split("@")[0],n=n.split("@")[1]);if(n.split("/").length>2)throw new Error("Unsupported host '"+n.split("?")[0]+"', hosts must be URL encoded and contain at most one unencoded slash");if(-1!==n.indexOf(".sock")){if(-1!==n.indexOf(".sock/")){if(-1!==(a=n.split(".sock/")[1]).indexOf("/")){if(2===a.split("/").length&&0===a.split("/")[1].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}n=n.split("/",n.indexOf(".sock")+".sock".length)}}else if(-1!==n.indexOf("/")){if(n.split("/").length>2){if(0===n.split("/")[2].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}a=n.split("/")[1],n=n.split("/")[0]}n=decodeURIComponent(n);let f,d,m,g,y={},_=u||"",v=_.split(":",2),w=decodeURIComponent(v[0]);if(v[0]!==encodeURIComponent(w))throw new Error("Username contains an illegal unescaped character");if(v[0]=w,v[1]){let t=decodeURIComponent(v[1]);if(v[1]!==encodeURIComponent(t))throw new Error("Password contains an illegal unescaped character");v[1]=t}2===v.length&&(y.auth={user:v[0],password:v[1]});e&&null!=e.auth&&(y.auth=e.auth);let b={socketOptions:{}},O={read_preference_tags:[]},S={socketOptions:{}},A={socketOptions:{}};if(y.server_options=b,y.db_options=O,y.rs_options=S,y.mongos_options=A,t.match(/\.sock/)){let e=t.substring(t.indexOf("mongodb://")+"mongodb://".length,t.lastIndexOf(".sock")+".sock".length);-1!==e.indexOf("@")&&(e=e.split("@")[1]),e=decodeURIComponent(e),m=[{domain_socket:e}]}else{let t={};m=(f=n).split(",").map(function(e){let n,r,o;if(o=/\[([^\]]+)\](?::(.+))?/.exec(e))n=o[1],r=parseInt(o[2],10)||27017;else{let t=e.split(":",2);n=t[0]||"localhost",r=null!=t[1]?parseInt(t[1],10):27017,-1!==n.indexOf("?")&&(n=n.split(/\?/)[0])}return t[n+"_"+r]?null:(t[n+"_"+r]=1,{host:n,port:r})}).filter(function(t){return null!=t})}y.dbName=a||"admin",(d=(c||"").split(/[&;]/)).forEach(function(t){if(t){var e=t.split("="),n=e[0],o=e[1];switch(n){case"slaveOk":case"slave_ok":b.slave_ok="true"===o,O.slaveOk="true"===o;break;case"maxPoolSize":case"poolSize":b.poolSize=parseInt(o,10),S.poolSize=parseInt(o,10);break;case"appname":y.appname=decodeURIComponent(o);break;case"autoReconnect":case"auto_reconnect":b.auto_reconnect="true"===o;break;case"ssl":if("prefer"===o){b.ssl=o,S.ssl=o,A.ssl=o;break}b.ssl="true"===o,S.ssl="true"===o,A.ssl="true"===o;break;case"sslValidate":b.sslValidate="true"===o,S.sslValidate="true"===o,A.sslValidate="true"===o;break;case"replicaSet":case"rs_name":S.rs_name=o;break;case"reconnectWait":S.reconnectWait=parseInt(o,10);break;case"retries":S.retries=parseInt(o,10);break;case"readSecondary":case"read_secondary":S.read_secondary="true"===o;break;case"fsync":O.fsync="true"===o;break;case"journal":O.j="true"===o;break;case"safe":O.safe="true"===o;break;case"nativeParser":case"native_parser":O.native_parser="true"===o;break;case"readConcernLevel":O.readConcern={level:o};break;case"connectTimeoutMS":b.socketOptions.connectTimeoutMS=parseInt(o,10),S.socketOptions.connectTimeoutMS=parseInt(o,10),A.socketOptions.connectTimeoutMS=parseInt(o,10);break;case"socketTimeoutMS":b.socketOptions.socketTimeoutMS=parseInt(o,10),S.socketOptions.socketTimeoutMS=parseInt(o,10),A.socketOptions.socketTimeoutMS=parseInt(o,10);break;case"w":O.w=parseInt(o,10),isNaN(O.w)&&(O.w=o);break;case"authSource":O.authSource=o;break;case"gssapiServiceName":O.gssapiServiceName=o;break;case"authMechanism":if("GSSAPI"===o)if(null==y.auth){let t=decodeURIComponent(_);if(-1===t.indexOf("@"))throw new Error("GSSAPI requires a provided principal");y.auth={user:t,password:null}}else y.auth.user=decodeURIComponent(y.auth.user);else"MONGODB-X509"===o&&(y.auth={user:decodeURIComponent(_)});if("GSSAPI"!==o&&"MONGODB-X509"!==o&&"MONGODB-CR"!==o&&"DEFAULT"!==o&&"SCRAM-SHA-1"!==o&&"SCRAM-SHA-256"!==o&&"PLAIN"!==o)throw new Error("Only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, or SCRAM-SHA-1 is supported by authMechanism");O.authMechanism=o;break;case"authMechanismProperties":{let t=o.split(","),e={};t.forEach(function(t){let n=t.split(":");e[n[0]]=n[1]}),O.authMechanismProperties=e,"string"==typeof e.SERVICE_NAME&&(O.gssapiServiceName=e.SERVICE_NAME),"string"==typeof e.SERVICE_REALM&&(O.gssapiServiceRealm=e.SERVICE_REALM),"string"==typeof e.CANONICALIZE_HOST_NAME&&(O.gssapiCanonicalizeHostName="true"===e.CANONICALIZE_HOST_NAME)}break;case"wtimeoutMS":O.wtimeout=parseInt(o,10);break;case"readPreference":if(!r.isValid(o))throw new Error("readPreference must be either primary/primaryPreferred/secondary/secondaryPreferred/nearest");O.readPreference=o;break;case"maxStalenessSeconds":O.maxStalenessSeconds=parseInt(o,10);break;case"readPreferenceTags":{let t={};if(null==(o=decodeURIComponent(o))||""===o){O.read_preference_tags.push(t);break}let e=o.split(/,/);for(let n=0;n<e.length;n++){let r=e[n].trim().split(/:/);t[r[0]]=r[1]}O.read_preference_tags.push(t)}break;case"compressors":{g=b.compression||{};let t=o.split(",");if(!t.every(function(t){return"snappy"===t||"zlib"===t}))throw new Error("Compressors must be at least one of snappy or zlib");g.compressors=t,b.compression=g}break;case"zlibCompressionLevel":{g=b.compression||{};let t=parseInt(o,10);if(t<-1||t>9)throw new Error("zlibCompressionLevel must be an integer between -1 and 9");g.zlibCompressionLevel=t,b.compression=g}break;case"retryWrites":O.retryWrites="true"===o;break;case"minSize":O.minSize=parseInt(o,10);break;default:s("URL Parser").warn(`${n} is not supported as a connection string option`)}}}),0===O.read_preference_tags.length&&(O.read_preference_tags=null);if(!(-1!==O.w&&0!==O.w||!0!==O.journal&&!0!==O.fsync&&!0!==O.safe))throw new Error("w set to -1 or 0 cannot be combined with safe/w/journal/fsync");O.readPreference||(O.readPreference="primary");return O=Object.assign(O,e),y.servers=m,y}(t,e)}catch(t){c=t}return c?n(c,null):n(null,u)}t.exports=function(t,e,n){let r;"function"==typeof e&&(n=e,e={}),e=e||{};try{r=o.parse(t,!0)}catch(t){return n(new Error("URL malformed, cannot be parsed"))}if("mongodb:"!==r.protocol&&"mongodb+srv:"!==r.protocol)return n(new Error("Invalid schema, expected `mongodb` or `mongodb+srv`"));if("mongodb:"===r.protocol)return a(t,e,n);if(r.hostname.split(".").length<3)return n(new Error("URI does not have hostname, domain name and tld"));if(r.domainLength=r.hostname.split(".").length,r.pathname&&r.pathname.match(","))return n(new Error("Invalid URI, cannot contain multiple hostnames"));if(r.port)return n(new Error("Ports not accepted with `mongodb+srv` URIs"));let i=`_mongodb._tcp.${r.host}`;u.resolveSrv(i,function(t,o){if(t)return n(t);if(0===o.length)return n(new Error("No addresses found at host"));for(let t=0;t<o.length;t++)if(!c(o[t].name,r.hostname,r.domainLength))return n(new Error("Server record does not share hostname with parent URI"));let i=r.auth?`mongodb://${r.auth}@`:"mongodb://",s=o.map(function(t,e){return 0===e?`${i}${t.name}:${t.port}`:`${t.name}:${t.port}`}).join(",")+"/",l=[];if(r.path){let t=r.path.slice(1);-1!==t.indexOf("?")&&(t=t.slice(0,t.indexOf("?"))),s+=t}(e.ssl||r.search)&&(e.ssl||!r.search||r.search.match("ssl"))||l.push("ssl=true"),r.search&&l.push(r.search.replace("?","")),u.resolveTxt(r.host,function(t,r){if(t&&"ENODATA"!==t.code)return n(t);if(t&&"ENODATA"===t.code&&(r=null),r){if(r.length>1)return n(new Error("Multiple text records not allowed"));if(!(r=(r=r[0]).length>1?r.join(""):r[0]).includes("authSource")&&!r.includes("replicaSet"))return n(new Error("Text record must only set `authSource` or `replicaSet`"));l.push(r)}l.length&&(s+=`?${l.join("&")}`),a(s,e,n)})})}},function(t,e,n){"use strict";const r=n(156),o=n(2).BSON.ObjectID,i=n(2).ReadPreference,s=n(14).Buffer,u=n(48),c=n(0).format,a=n(0),l=n(2).MongoError,h=a.inherits,p=n(15).Duplex,f=n(1).shallowClone,d=n(1).executeOperation,m=n(0).deprecate;const g=m(()=>{},"GridStore is deprecated, and will be removed in a future version. Please use GridFSBucket instead");var y=function t(e,n,s,u,c){if(g(),!(this instanceof t))return new t(e,n,s,u,c);this.db=e,void 0===c&&(c={}),void 0===u?(u=s,s=void 0):"object"==typeof u&&(c=u,u=s,s=void 0),n&&"ObjectID"===n._bsontype?(this.referenceBy=1,this.fileId=n,this.filename=s):void 0===s?(this.referenceBy=0,this.filename=n,null!=u.indexOf("w")&&(this.fileId=new o)):(this.referenceBy=1,this.fileId=n,this.filename=s),this.mode=null==u?"r":u,this.options=c||{},this.isOpen=!1,this.root=null==this.options.root?t.DEFAULT_ROOT_COLLECTION:this.options.root,this.position=0,this.readPreference=this.options.readPreference||e.options.readPreference||i.primary,this.writeConcern=q(e,this.options),this.internalChunkSize=null==this.options.chunkSize?r.DEFAULT_CHUNK_SIZE:this.options.chunkSize;var a=this.options.promiseLibrary||Promise;this.promiseLibrary=a,Object.defineProperty(this,"chunkSize",{enumerable:!0,get:function(){return this.internalChunkSize},set:function(t){"w"!==this.mode[0]||0!==this.position||null!=this.uploadDate?this.internalChunkSize=this.internalChunkSize:this.internalChunkSize=t}}),Object.defineProperty(this,"md5",{enumerable:!0,get:function(){return this.internalMd5}}),Object.defineProperty(this,"chunkNumber",{enumerable:!0,get:function(){return this.currentChunk&&this.currentChunk.chunkNumber?this.currentChunk.chunkNumber:null}})};y.prototype.open=function(t,e){if("function"==typeof t&&(e=t,t={}),t=t||{},"w"!==this.mode&&"w+"!==this.mode&&"r"!==this.mode)throw l.create({message:"Illegal mode "+this.mode,driver:!0});return d(this.db.s.topology,_,[this,t,e],{skipSessions:!0})};var _=function(t,e,n){var r=q(t.db,t.options);"w"===t.mode||"w+"===t.mode?t.collection().ensureIndex([["filename",1]],r,function(){var e=t.chunkCollection(),o=f(r);o.unique=!0,e.ensureIndex([["files_id",1],["n",1]],o,function(){E(t,r,function(e,r){if(e)return n(e);t.isOpen=!0,n(e,r)})})}):E(t,r,function(e,r){if(e)return n(e);t.isOpen=!0,n(e,r)})};y.prototype.eof=function(){return this.position===this.length},y.prototype.getc=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},d(this.db.s.topology,v,[this,t,e],{skipSessions:!0})};var v=function(t,e,n){t.eof()?n(null,null):t.currentChunk.eof()?I(t,t.currentChunk.chunkNumber+1,function(e,r){t.currentChunk=r,t.position=t.position+1,n(e,t.currentChunk.getc())}):(t.position=t.position+1,n(null,t.currentChunk.getc()))};y.prototype.puts=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=e||{};var r=null==t.match(/\n$/)?t+"\n":t;return d(this.db.s.topology,this.write.bind(this),[r,e,n],{skipSessions:!0})},y.prototype.stream=function(){return new x(this)},y.prototype.write=function(t,e,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},d(this.db.s.topology,F,[this,t,e,n,r],{skipSessions:!0})},y.prototype.destroy=function(){this.writable&&(this.readable=!1,this.writable&&(this.writable=!1,this._q.length=0,this.emit("close")))},y.prototype.writeFile=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},d(this.db.s.topology,w,[this,t,e,n],{skipSessions:!0})};var w=function(t,e,n,o){"string"!=typeof e?t.open(function(t,n){if(t)return o(t,n);u.fstat(e,function(t,i){if(t)return o(t,n);var c=0,a=0,l=function(){var t=s.alloc(n.chunkSize);u.read(e,t,0,t.length,c,function(t,s,h){if(t)return o(t,n);c+=s,new r(n,{n:a++},n.writeConcern).write(h.slice(0,s),function(t,r){if(t)return o(t,n);r.save({},function(t){return t?o(t,n):(n.position=n.position+s,n.currentChunk=r,c>=i.size?void u.close(e,function(t){if(t)return o(t);n.close(function(t){return o(t||null,n)})}):process.nextTick(l))})})})};process.nextTick(l)})}):u.open(e,"r",function(e,n){if(e)return o(e);t.writeFile(n,o)})};y.prototype.close=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},d(this.db.s.topology,b,[this,t,e],{skipSessions:!0})};var b=function(t,e,n){"w"===t.mode[0]?(e=Object.assign({},t.writeConcern,e),null!=t.currentChunk&&t.currentChunk.position>0?t.currentChunk.save({},function(r){if(r&&"function"==typeof n)return n(r);t.collection(function(r,o){if(r&&"function"==typeof n)return n(r);null!=t.uploadDate?$(t,function(t,r){if(t){if("function"==typeof n)return n(t);throw t}o.save(r,e,function(t){"function"==typeof n&&n(t,r)})}):(t.uploadDate=new Date,$(t,function(t,r){if(t){if("function"==typeof n)return n(t);throw t}o.save(r,e,function(t){"function"==typeof n&&n(t,r)})}))})}):t.collection(function(r,o){if(r&&"function"==typeof n)return n(r);t.uploadDate=new Date,$(t,function(t,r){if(t){if("function"==typeof n)return n(t);throw t}o.save(r,e,function(t){"function"==typeof n&&n(t,r)})})})):"r"===t.mode[0]?"function"==typeof n&&n(null,null):"function"==typeof n&&n(l.create({message:c("Illegal mode %s",t.mode),driver:!0}))};y.prototype.chunkCollection=function(t){return"function"==typeof t?this.db.collection(this.root+".chunks",t):this.db.collection(this.root+".chunks")},y.prototype.unlink=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},d(this.db.s.topology,O,[this,t,e],{skipSessions:!0})};var O=function(t,e,n){R(t,function(e){if(null!==e)return e.message="at deleteChunks: "+e.message,n(e);t.collection(function(e,r){if(null!==e)return e.message="at collection: "+e.message,n(e);r.remove({_id:t.fileId},t.writeConcern,function(e){n(e,t)})})})};y.prototype.collection=function(t){return"function"==typeof t&&this.db.collection(this.root+".files",t),this.db.collection(this.root+".files")},y.prototype.readlines=function(t,e,n){var r=Array.prototype.slice.call(arguments,0);return n="function"==typeof r[r.length-1]?r.pop():void 0,t=(t=r.length?r.shift():"\n")||"\n",e=r.length?r.shift():{},d(this.db.s.topology,S,[this,t,e,n],{skipSessions:!0})};var S=function(t,e,n,r){t.read(function(t,n){if(t)return r(t);var o=n.toString().split(e);o=o.length>0?o.splice(0,o.length-1):[];for(var i=0;i<o.length;i++)o[i]=o[i]+e;r(null,o)})};y.prototype.rewind=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},d(this.db.s.topology,A,[this,t,e],{skipSessions:!0})};var A=function(t,e,n){0!==t.currentChunk.chunkNumber?"w"===t.mode[0]?R(t,function(e){if(e)return n(e);t.currentChunk=new r(t,{n:0},t.writeConcern),t.position=0,n(null,t)}):t.currentChunk(0,function(e,r){if(e)return n(e);t.currentChunk=r,t.currentChunk.rewind(),t.position=0,n(null,t)}):(t.currentChunk.rewind(),t.position=0,n(null,t))};y.prototype.read=function(t,e,n,r){var o=Array.prototype.slice.call(arguments,0);return r="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():null,e=o.length?o.shift():null,n=o.length?o.shift():{},d(this.db.s.topology,C,[this,t,e,n,r],{skipSessions:!0})};var C=function(t,e,n,r,o){var i=null==e?t.length-t.position:e,u=null==n?s.alloc(i):n;if(u._index=null!=n&&null!=n._index?n._index:0,t.currentChunk.length()-t.currentChunk.position+u._index>=i){var c=t.currentChunk.readSlice(i-u._index);return c.copy(u,u._index),t.position=t.position+u.length,0===i&&0===u.length?o(l.create({message:"File does not exist",driver:!0}),null):o(null,u)}(c=t.currentChunk.readSlice(t.currentChunk.length()-t.currentChunk.position)).copy(u,u._index),u._index+=c.length,I(t,t.currentChunk.chunkNumber+1,function(n,r){if(n)return o(n);r.length()>0?(t.currentChunk=r,t.read(e,u,o)):u._index>0?o(null,u):o(l.create({message:"no chunks found for file, possibly corrupt",driver:!0}),null)})};y.prototype.tell=function(t){var e=this;return"function"==typeof t?t(null,this.position):new e.promiseLibrary(function(t){t(e.position)})},y.prototype.seek=function(t,e,n,r){var o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length?o.shift():null,n=o.length?o.shift():{},d(this.db.s.topology,T,[this,t,e,n,r],{skipSessions:!0})};var T=function(t,e,n,r,o){if("r"!==t.mode)return o(l.create({message:"seek is only supported for mode r",driver:!0}));var i=null==n?y.IO_SEEK_SET:n,s=e,u=0;u=i===y.IO_SEEK_CUR?t.position+s:i===y.IO_SEEK_END?t.length+s:s;var c=Math.floor(u/t.chunkSize);I(t,c,function(e,n){return e?o(e,null):null==n?o(new Error("no chunk found")):(t.currentChunk=n,t.position=u,t.currentChunk.position=t.position%t.chunkSize,void o(e,t))})},E=function(t,e,n){var i=t.collection(),s=1===t.referenceBy?{_id:t.fileId}:{filename:t.filename};function u(t){u.err||n(u.err=t)}s=null==t.fileId&&null==t.filename?null:s,e.readPreference=t.readPreference,null!=s?i.findOne(s,e,function(i,s){if(i)return u(i);if(null!=s)t.fileId=s._id,t.filename="r"===t.mode||void 0===t.filename?s.filename:t.filename,t.contentType=s.contentType,t.internalChunkSize=s.chunkSize,t.uploadDate=s.uploadDate,t.aliases=s.aliases,t.length=s.length,t.metadata=s.metadata,t.internalMd5=s.md5;else{if("r"===t.mode){t.length=0;var a="ObjectID"===t.fileId._bsontype?t.fileId.toHexString():t.fileId;return u(l.create({message:c("file with id %s not opened for writing",1===t.referenceBy?a:t.filename),driver:!0}))}t.fileId=null==t.fileId?new o:t.fileId,t.contentType=y.DEFAULT_CONTENT_TYPE,t.internalChunkSize=null==t.internalChunkSize?r.DEFAULT_CHUNK_SIZE:t.internalChunkSize,t.length=0}"r"===t.mode?I(t,0,e,function(e,r){if(e)return u(e);t.currentChunk=r,t.position=0,n(null,t)}):"w"===t.mode&&s?R(t,e,function(e){if(e)return u(e);t.currentChunk=new r(t,{n:0},t.writeConcern),t.contentType=null==t.options.content_type?t.contentType:t.options.content_type,t.internalChunkSize=null==t.options.chunk_size?t.internalChunkSize:t.options.chunk_size,t.metadata=null==t.options.metadata?t.metadata:t.options.metadata,t.aliases=null==t.options.aliases?t.aliases:t.options.aliases,t.position=0,n(null,t)}):"w"===t.mode?(t.currentChunk=new r(t,{n:0},t.writeConcern),t.contentType=null==t.options.content_type?t.contentType:t.options.content_type,t.internalChunkSize=null==t.options.chunk_size?t.internalChunkSize:t.options.chunk_size,t.metadata=null==t.options.metadata?t.metadata:t.options.metadata,t.aliases=null==t.options.aliases?t.aliases:t.options.aliases,t.position=0,n(null,t)):"w+"===t.mode&&I(t,M(t),e,function(e,o){if(e)return u(e);t.currentChunk=null==o?new r(t,{n:0},t.writeConcern):o,t.currentChunk.position=t.currentChunk.data.length(),t.metadata=null==t.options.metadata?t.metadata:t.options.metadata,t.aliases=null==t.options.aliases?t.aliases:t.options.aliases,t.position=t.length,n(null,t)})}):(t.fileId=null==t.fileId?new o:t.fileId,t.contentType=y.DEFAULT_CONTENT_TYPE,t.internalChunkSize=null==t.internalChunkSize?r.DEFAULT_CHUNK_SIZE:t.internalChunkSize,t.length=0,"w"===t.mode?R(t,e,function(e){if(e)return u(e);t.currentChunk=new r(t,{n:0},t.writeConcern),t.contentType=null==t.options.content_type?t.contentType:t.options.content_type,t.internalChunkSize=null==t.options.chunk_size?t.internalChunkSize:t.options.chunk_size,t.metadata=null==t.options.metadata?t.metadata:t.options.metadata,t.aliases=null==t.options.aliases?t.aliases:t.options.aliases,t.position=0,n(null,t)}):"w+"===t.mode&&I(t,M(t),e,function(e,o){if(e)return u(e);t.currentChunk=null==o?new r(t,{n:0},t.writeConcern):o,t.currentChunk.position=t.currentChunk.data.length(),t.metadata=null==t.options.metadata?t.metadata:t.options.metadata,t.aliases=null==t.options.aliases?t.aliases:t.options.aliases,t.position=t.length,n(null,t)}))},N=function(t,e,n,o){"function"==typeof n&&(o=n,n=null);var i="boolean"==typeof n&&n;if("w"!==t.mode)o(l.create({message:c("file with id %s not opened for writing",1===t.referenceBy?t.referenceBy:t.filename),driver:!0}),null);else{if(!(t.currentChunk.position+e.length>=t.chunkSize))return t.position=t.position+e.length,t.currentChunk.write(e),i?t.close(function(e){o(e,t)}):o(null,t);for(var s=t.currentChunk.chunkNumber,u=t.chunkSize-t.currentChunk.position,a=e.slice(0,u),h=e.slice(u),p=[t.currentChunk.write(a)];h.length>=t.chunkSize;){var f=new r(t,{n:s+1},t.writeConcern);a=h.slice(0,t.chunkSize),h=h.slice(t.chunkSize),s+=1,f.write(a),p.push(f)}t.currentChunk=new r(t,{n:s+1},t.writeConcern),h.length>0&&t.currentChunk.write(h),t.position=t.position+e.length;for(var d=p.length,m=0;m<p.length;m++)p[m].save({},function(e){return e?o(e):(d-=1)<=0?i?t.close(function(e){o(e,t)}):o(null,t):void 0})}},$=function(t,e){var n={_id:t.fileId,filename:t.filename,contentType:t.contentType,length:t.position?t.position:0,chunkSize:t.chunkSize,uploadDate:t.uploadDate,aliases:t.aliases,metadata:t.metadata},r={filemd5:t.fileId,root:t.root};t.db.command(r,function(t,r){if(t)return e(t);n.md5=r.md5,e(null,n)})},I=function(t,e,n,o){"function"==typeof n&&(o=n,n={}),(n=n||t.writeConcern).readPreference=t.readPreference,t.chunkCollection().findOne({files_id:t.fileId,n:e},n,function(e,n){if(e)return o(e);o(null,new r(t,null==n?{}:n,t.writeConcern))})},M=function(t){return Math.floor((t.length?t.length-1:0)/t.chunkSize)},R=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=e||t.writeConcern,null!=t.fileId?t.chunkCollection().remove({files_id:t.fileId},e,function(t){if(t)return n(t,!1);n(null,!0)}):n(null,!0)};y.DEFAULT_ROOT_COLLECTION="fs",y.DEFAULT_CONTENT_TYPE="binary/octet-stream",y.IO_SEEK_SET=0,y.IO_SEEK_CUR=1,y.IO_SEEK_END=2,y.exist=function(t,e,n,r,o){var i=Array.prototype.slice.call(arguments,2);return o="function"==typeof i[i.length-1]?i.pop():void 0,n=i.length?i.shift():null,r=(r=i.length?i.shift():{})||{},d(t.s.topology,P,[t,e,n,r,o],{skipSessions:!0})};var P=function(t,e,n,r,o){var s=r.readPreference||i.PRIMARY,u=null!=n?n:y.DEFAULT_ROOT_COLLECTION;t.collection(u+".files",function(t,n){if(t)return o(t);var r="string"==typeof e||"[object RegExp]"===Object.prototype.toString.call(e)?{filename:e}:{_id:e};null!=e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&(r=e),n.findOne(r,{readPreference:s},function(t,e){if(t)return o(t);o(null,null!=e)})})};y.list=function(t,e,n,r){var o=Array.prototype.slice.call(arguments,1);return r="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length?o.shift():null,n=(n=o.length?o.shift():{})||{},d(t.s.topology,j,[t,e,n,r],{skipSessions:!0})};var j=function(t,e,n,r){null!=e&&"object"==typeof e&&(n=e,e=null);var o=n.readPreference||i.primary,s=null!=n.id&&n.id,u=null!=e?e:y.DEFAULT_ROOT_COLLECTION,c=[];t.collection(u+".files",function(t,e){if(t)return r(t);e.find({},{readPreference:o},function(t,e){if(t)return r(t);e.each(function(t,e){null!=e?c.push(s?e._id:e.filename):r(t,c)})})})};y.read=function(t,e,n,r,o,i){var s=Array.prototype.slice.call(arguments,2);return i="function"==typeof s[s.length-1]?s.pop():void 0,n=s.length?s.shift():null,r=s.length?s.shift():null,o=(o=s.length?s.shift():null)||{},d(t.s.topology,D,[t,e,n,r,o,i],{skipSessions:!0})};var D=function(t,e,n,r,o,i){new y(t,e,"r",o).open(function(t,e){return t?i(t):r&&r>=e.length?i("offset larger than size of file",null):n&&n>e.length?i("length is larger than the size of the file",null):r&&n&&r+n>e.length?i("offset and length is larger than the size of the file",null):void(null!=r?e.seek(r,function(t,e){if(t)return i(t);e.read(n,i)}):e.read(n,i))})};y.readlines=function(t,e,n,r,o){var i=Array.prototype.slice.call(arguments,2);return o="function"==typeof i[i.length-1]?i.pop():void 0,n=i.length?i.shift():null,r=(r=i.length?i.shift():null)||{},d(t.s.topology,B,[t,e,n,r,o],{skipSessions:!0})};var B=function(t,e,n,r,o){var i=null==n?"\n":n;new y(t,e,"r",r).open(function(t,e){if(t)return o(t);e.readlines(i,o)})};y.unlink=function(t,e,n,r){var o=Array.prototype.slice.call(arguments,2);return r="function"==typeof o[o.length-1]?o.pop():void 0,n=(n=o.length?o.shift():{})||{},d(t.s.topology,L,[this,t,e,n,r],{skipSessions:!0})};var L=function(t,e,n,r,o){var i=q(e,r);if(n.constructor===Array)for(var s=0,u=0;u<n.length;u++)++s,y.unlink(e,n[u],r,function(){0==--s&&o(null,t)});else new y(e,n,"w",r).open(function(e,n){if(e)return o(e);R(n,function(e){if(e)return o(e);n.collection(function(e,r){if(e)return o(e);r.remove({_id:n.fileId},i,function(e){o(e,t)})})})})},F=function(t,e,n,r,o){return s.isBuffer(e)?N(t,e,n,o):N(t,s.from(e,"binary"),n,o)},U=function(t){var e={};return null!=t.w&&(e.w=t.w),!0===t.journal&&(e.j=t.journal),!0===t.j&&(e.j=t.j),!0===t.fsync&&(e.fsync=t.fsync),null!=t.wtimeout&&(e.wtimeout=t.wtimeout),e},q=function(t,e){var n={w:1};if(null!=(e=e||{}).w||"boolean"==typeof e.j||"boolean"==typeof e.journal||"boolean"==typeof e.fsync?n=U(e):null!=e.safe&&"object"==typeof e.safe?n=U(e.safe):"boolean"==typeof e.safe?n={w:e.safe?1:0}:null!=t.options.w||"boolean"==typeof t.options.j||"boolean"==typeof t.options.journal||"boolean"==typeof t.options.fsync?n=U(t.options):!t.safe||null==t.safe.w&&"boolean"!=typeof t.safe.j&&"boolean"!=typeof t.safe.journal&&"boolean"!=typeof t.safe.fsync?"boolean"==typeof t.safe&&(n={w:t.safe?1:0}):n=U(t.safe),n.w<1&&(!0===n.journal||!0===n.j||!0===n.fsync))throw l.create({message:"No acknowledgement using w < 1 cannot be combined with journal:true or fsync:true",driver:!0});return n},x=function(t){p.call(this),this.gs=t,this.endCalled=!1,this.totalBytesToRead=this.gs.length-this.gs.position,this.seekPosition=this.gs.position};h(x,p),x.prototype._pipe=x.prototype.pipe,x.prototype.pipe=function(t){var e=this;return e.gs.isOpen?(e.totalBytesToRead=e.gs.length-e.gs.position,e._pipe.apply(e,[t])):e.gs.open(function(n){if(n)return e.emit("error",n);e.totalBytesToRead=e.gs.length-e.gs.position,e._pipe.apply(e,[t])}),t},x.prototype._read=function(){var t=this,e=function(){t.gs.read(n,function(e,n){return e&&!t.endCalled?t.emit("error",e):t.endCalled||null==n?t.push(null):(n.length<=t.totalBytesToRead?(t.totalBytesToRead=t.totalBytesToRead-n.length,t.push(n)):n.length>t.totalBytesToRead&&(t.totalBytesToRead=t.totalBytesToRead-n._index,t.push(n.slice(0,n._index))),void(t.totalBytesToRead<=0&&(t.endCalled=!0)))})},n=t.gs.length<t.gs.chunkSize?t.gs.length-t.seekPosition:t.gs.chunkSize;t.gs.isOpen?e():t.gs.open(function(n){if(t.totalBytesToRead=t.gs.length-t.gs.position,n)return t.emit("error",n);e()})},x.prototype.destroy=function(){this.pause(),this.endCalled=!0,this.gs.close(),this.emit("end")},x.prototype.write=function(t){var e=this;return e.endCalled?e.emit("error",l.create({message:"attempting to write to stream after end called",driver:!0})):e.gs.isOpen?(e.gs.write(t,function(){e.emit("drain")}),!0):(e.gs.open(function(){e.gs.isOpen=!0,e.gs.write(t,function(){process.nextTick(function(){e.emit("drain")})})}),!1)},x.prototype.end=function(t,e,n){var r=this,o=Array.prototype.slice.call(arguments,0);n="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():null,e=o.length?o.shift():null,r.endCalled=!0,t&&r.gs.write(t,function(){r.gs.close(function(){"function"==typeof n&&n(),r.emit("end")})}),r.gs.close(function(){"function"==typeof n&&n(),r.emit("end")})},t.exports=y},function(t,e,n){"use strict";var r=n(10).EventEmitter,o=n(264),i=n(265),s=n(1).shallowClone,u=n(1).toError,c=n(0),a=n(1).executeOperation,l={bucketName:"fs",chunkSizeBytes:261120};function h(t,e){if(r.apply(this),this.setMaxListeners(0),e&&"object"==typeof e){e=s(e);for(var n=Object.keys(l),o=0;o<n.length;++o)e[n[o]]||(e[n[o]]=l[n[o]])}else e=l;this.s={db:t,options:e,_chunksCollection:t.collection(e.bucketName+".chunks"),_filesCollection:t.collection(e.bucketName+".files"),checkedIndexes:!1,calledOpenUploadStream:!1,promiseLibrary:t.s.promiseLibrary||Promise}}function p(t,e,n){t.s._filesCollection.deleteOne({_id:e},function(r,o){if(r)return n(r);t.s._chunksCollection.deleteMany({files_id:e},function(t){return t?n(t):o.result.n?void n():n(new Error("FileNotFound: no file with id "+e+" found"))})})}function f(t,e,n,r){var o={_id:e},i={$set:{filename:n}};t.s._filesCollection.updateOne(o,i,function(t,n){return t?r(t):n.result.n?void r():r(u("File with id "+e+" not found"))})}function d(t,e){t.s._filesCollection.drop(function(n){if(n)return e(n);t.s._chunksCollection.drop(function(t){return t?e(t):e()})})}t.exports=h,c.inherits(h,r),h.prototype.openUploadStream=function(t,e){return(e=e?s(e):{}).chunkSizeBytes||(e.chunkSizeBytes=this.s.options.chunkSizeBytes),new i(this,t,e)},h.prototype.openUploadStreamWithId=function(t,e,n){return(n=n?s(n):{}).chunkSizeBytes||(n.chunkSizeBytes=this.s.options.chunkSizeBytes),n.id=t,new i(this,e,n)},h.prototype.openDownloadStream=function(t,e){var n={_id:t};return e={start:e&&e.start,end:e&&e.end},new o(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,n,e)},h.prototype.delete=function(t,e){return a(this.s.db.s.topology,p,[this,t,e],{skipSessions:!0})},h.prototype.find=function(t,e){t=t||{},e=e||{};var n=this.s._filesCollection.find(t);return null!=e.batchSize&&n.batchSize(e.batchSize),null!=e.limit&&n.limit(e.limit),null!=e.maxTimeMS&&n.maxTimeMS(e.maxTimeMS),null!=e.noCursorTimeout&&n.addCursorFlag("noCursorTimeout",e.noCursorTimeout),null!=e.skip&&n.skip(e.skip),null!=e.sort&&n.sort(e.sort),n},h.prototype.openDownloadStreamByName=function(t,e){var n={uploadDate:-1},r=null;e&&null!=e.revision&&(e.revision>=0?(n={uploadDate:1},r=e.revision):r=-e.revision-1);var i={filename:t};return e={sort:n,skip:r,start:e&&e.start,end:e&&e.end},new o(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,i,e)},h.prototype.rename=function(t,e,n){return a(this.s.db.s.topology,f,[this,t,e,n],{skipSessions:!0})},h.prototype.drop=function(t){return a(this.s.db.s.topology,d,[this,t],{skipSessions:!0})},h.prototype.getLogger=function(){return this.s.db.s.logger}},function(t,e,n){"use strict";var r=n(15),o=n(0);function i(t,e,n,o,i){this.s={bytesRead:0,chunks:t,cursor:null,expected:0,files:e,filter:o,init:!1,expectedEnd:0,file:null,options:i,readPreference:n},r.Readable.call(this)}function s(t){if(t.s.init)throw new Error("You cannot change options after the stream has enteredflowing mode!")}function u(t,e){t.emit("error",e)}t.exports=i,o.inherits(i,r.Readable),i.prototype._read=function(){var t=this;this.destroyed||function(t,e){if(t.s.file)return e();t.s.init||(!function(t){var e={};t.s.readPreference&&(e.readPreference=t.s.readPreference);t.s.options&&t.s.options.sort&&(e.sort=t.s.options.sort);t.s.options&&t.s.options.skip&&(e.skip=t.s.options.skip);t.s.files.findOne(t.s.filter,e,function(e,n){if(e)return u(t,e);if(!n){var r=t.s.filter._id?t.s.filter._id.toString():t.s.filter.filename,o="FileNotFound: file "+r+" was not found",i=new Error(o);return i.code="ENOENT",u(t,i)}if(n.length<=0)t.push(null);else if(t.destroyed)t.emit("close");else{t.s.bytesToSkip=function(t,e,n){if(n&&null!=n.start){if(n.start>e.length)throw new Error("Stream start ("+n.start+") must not be more than the length of the file ("+e.length+")");if(n.start<0)throw new Error("Stream start ("+n.start+") must not be negative");if(null!=n.end&&n.end<n.start)throw new Error("Stream start ("+n.start+") must not be greater than stream end ("+n.end+")");return t.s.bytesRead=Math.floor(n.start/e.chunkSize)*e.chunkSize,t.s.expected=Math.floor(n.start/e.chunkSize),n.start-t.s.bytesRead}}(t,n,t.s.options);var s={files_id:n._id};if(t.s.options&&null!=t.s.options.start){var c=Math.floor(t.s.options.start/n.chunkSize);c>0&&(s.n={$gte:c})}t.s.cursor=t.s.chunks.find(s).sort({n:1}),t.s.readPreference&&t.s.cursor.setReadPreference(t.s.readPreference),t.s.expectedEnd=Math.ceil(n.length/n.chunkSize),t.s.file=n,t.s.bytesToTrim=function(t,e,n,r){if(r&&null!=r.end){if(r.end>e.length)throw new Error("Stream end ("+r.end+") must not be more than the length of the file ("+e.length+")");if(r.start<0)throw new Error("Stream end ("+r.end+") must not be negative");var o=null!=r.start?Math.floor(r.start/e.chunkSize):0;return n.limit(Math.ceil(r.end/e.chunkSize)-o),t.s.expectedEnd=Math.ceil(r.end/e.chunkSize),Math.ceil(r.end/e.chunkSize)*e.chunkSize-r.end}}(t,n,t.s.cursor,t.s.options),t.emit("file",n)}})}(t),t.s.init=!0);t.once("file",function(){e()})}(t,function(){!function(t){if(t.destroyed)return;t.s.cursor.next(function(e,n){if(!t.destroyed){if(e)return u(t,e);if(!n)return t.push(null),t.s.cursor.close(function(e){if(e)return u(t,e);t.emit("close")});var r=t.s.file.length-t.s.bytesRead,o=t.s.expected++,i=Math.min(t.s.file.chunkSize,r);if(n.n>o){var s="ChunkIsMissing: Got unexpected n: "+n.n+", expected: "+o;return u(t,new Error(s))}if(n.n<o)return s="ExtraChunk: Got unexpected n: "+n.n+", expected: "+o,u(t,new Error(s));var c=Buffer.isBuffer(n.data)?n.data:n.data.buffer;if(c.length!==i)return r<=0?(s="ExtraChunk: Got unexpected n: "+n.n,u(t,new Error(s))):(s="ChunkIsWrongSize: Got unexpected length: "+c.length+", expected: "+i,u(t,new Error(s)));if(t.s.bytesRead+=c.length,0===c.length)return t.push(null);var a=null,l=null;null!=t.s.bytesToSkip&&(a=t.s.bytesToSkip,t.s.bytesToSkip=0),o===t.s.expectedEnd&&null!=t.s.bytesToTrim&&(l=t.s.bytesToTrim),t.s.options.end&&t.s.options.end-t.s.bytesToSkip<c.length&&(l=t.s.options.end-t.s.bytesToSkip),null==a&&null==l||(c=c.slice(a||0,l||c.length)),t.push(c)}})}(t)})},i.prototype.start=function(t){return s(this),this.s.options.start=t,this},i.prototype.end=function(t){return s(this),this.s.options.end=t,this},i.prototype.abort=function(t){var e=this;this.push(null),this.destroyed=!0,this.s.cursor?this.s.cursor.close(function(n){e.emit("close"),t&&t(n)}):(this.s.init||e.emit("close"),t&&t())}},function(t,e,n){"use strict";var r=n(2),o=n(11),i=n(15),s=n(0),u=n(14).Buffer,c=26;function a(t,e,n){if(n=n||{},this.bucket=t,this.chunks=t.s._chunksCollection,this.filename=e,this.files=t.s._filesCollection,this.options=n,this.done=!1,this.id=n.id?n.id:r.BSON.ObjectId(),this.chunkSizeBytes=this.options.chunkSizeBytes,this.bufToStore=u.alloc(this.chunkSizeBytes),this.length=0,this.md5=!n.disableMD5&&o.createHash("md5"),this.n=0,this.pos=0,this.state={streamEnd:!1,outstandingRequests:0,errored:!1,aborted:!1,promiseLibrary:this.bucket.s.promiseLibrary},!this.bucket.s.calledOpenUploadStream){this.bucket.s.calledOpenUploadStream=!0;var i=this;!function(t,e){t.files.findOne({},{_id:1},function(n,r){return n?e(n):r?e():void t.files.listIndexes().toArray(function(n,r){if(n){if(n.code===c){var o={filename:1,uploadDate:1};return void t.files.createIndex(o,{background:!1},function(n){if(n)return e(n);p(t,e)})}return e(n)}var i=!1;if(r.forEach(function(t){var e=Object.keys(t.key);2===e.length&&1===t.key.filename&&1===t.key.uploadDate&&(i=!0)}),i)p(t,e);else{o={filename:1,uploadDate:1};var s=d(t);s.background=!1,t.files.createIndex(o,s,function(n){if(n)return e(n);p(t,e)})}})})}(this,function(){i.bucket.s.checkedIndexes=!0,i.bucket.emit("index")})}}function l(t,e,n){if(!t.state.errored){if(t.state.errored=!0,n)return n(e);t.emit("error",e)}}function h(t,e,n){return{_id:r.BSON.ObjectId(),files_id:t,n:e,data:n}}function p(t,e){t.chunks.listIndexes().toArray(function(n,r){if(n){if(n.code===c){var o={files_id:1,n:1};return void t.chunks.createIndex(o,{background:!1,unique:!0},function(t){if(t)return e(t);e()})}return e(n)}var i=!1;if(r.forEach(function(t){t.key&&(2===Object.keys(t.key).length&&1===t.key.files_id&&1===t.key.n&&(i=!0))}),i)e();else{o={files_id:1,n:1};var s=d(t);s.background=!1,s.unique=!0,t.chunks.createIndex(o,s,function(t){if(t)return e(t);e()})}})}function f(t,e){if(t.done)return!0;if(t.state.streamEnd&&0===t.state.outstandingRequests&&!t.state.errored){t.done=!0;var n=function(t,e,n,r,o,i,s,u){var c={_id:t,length:e,chunkSize:n,uploadDate:new Date,filename:o};r&&(c.md5=r);i&&(c.contentType=i);s&&(c.aliases=s);u&&(c.metadata=u);return c}(t.id,t.length,t.chunkSizeBytes,t.md5&&t.md5.digest("hex"),t.filename,t.options.contentType,t.options.aliases,t.options.metadata);return!y(t,e)&&(t.files.insertOne(n,d(t),function(r){if(r)return l(t,r,e);t.emit("finish",n)}),!0)}return!1}function d(t){var e={};return t.options.writeConcern&&(e.w=t.options.writeConcern.w,e.wtimeout=t.options.writeConcern.wtimeout,e.j=t.options.writeConcern.j),e}function m(t,e){return t.bucket.s.checkedIndexes?e(!1):(t.bucket.once("index",function(){e(!0)}),!0)}function g(t,e){if(0===t.pos)return f(t,e);++t.state.outstandingRequests;var n=u.alloc(t.pos);t.bufToStore.copy(n,0,0,t.pos),t.md5&&t.md5.update(n);var r=h(t.id,t.n,n);if(y(t,e))return!1;t.chunks.insertOne(r,d(t),function(e){if(e)return l(t,e);--t.state.outstandingRequests,f(t)})}function y(t,e){return!!t.state.aborted&&("function"==typeof e&&e(new Error("this stream has been aborted")),!0)}t.exports=a,s.inherits(a,i.Writable),a.prototype.write=function(t,e,n){var r=this;return m(this,function(){return function(t,e,n,r){if(y(t,r))return!1;var o=u.isBuffer(e)?e:u.from(e,n);if(t.length+=o.length,t.pos+o.length<t.chunkSizeBytes)return o.copy(t.bufToStore,t.pos),t.pos+=o.length,r&&r(),!0;var i=o.length,s=t.chunkSizeBytes-t.pos,c=Math.min(s,o.length),a=0;for(;i>0;){var p=o.length-i;if(o.copy(t.bufToStore,t.pos,p,p+c),t.pos+=c,0===(s-=c)){t.md5&&t.md5.update(t.bufToStore);var m=h(t.id,t.n,t.bufToStore);if(++t.state.outstandingRequests,++a,y(t,r))return!1;t.chunks.insertOne(m,d(t),function(e){if(e)return l(t,e);--t.state.outstandingRequests,--a||(t.emit("drain",m),r&&r(),f(t))}),s=t.chunkSizeBytes,t.pos=0,++t.n}i-=c,c=Math.min(s,i)}return!1}(r,t,e,n)})},a.prototype.abort=function(t){if(this.state.streamEnd){var e=new Error("Cannot abort a stream that has already completed");return"function"==typeof t?t(e):this.state.promiseLibrary.reject(e)}if(this.state.aborted)return e=new Error("Cannot call abort() on a stream twice"),"function"==typeof t?t(e):this.state.promiseLibrary.reject(e);this.state.aborted=!0,this.chunks.deleteMany({files_id:this.id},function(e){"function"==typeof t&&t(e)})},a.prototype.end=function(t,e,n){var r=this;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),y(this,n)||(this.state.streamEnd=!0,n&&this.once("finish",function(t){n(null,t)}),t?this.write(t,e,function(){g(r)}):m(this,function(){g(r)}))}},function(t,e,n){"undefined"==typeof process||"renderer"===process.type?t.exports=n(267):t.exports=n(269)},function(t,e,n){function r(){var t;try{t=e.storage.debug}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t}(e=t.exports=n(161)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var o=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(i=o))}),t.splice(i,0,r)},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=r,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(r())},function(t,e){var n=1e3,r=60*n,o=60*r,i=24*o,s=365.25*i;function u(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}t.exports=function(t,e){e=e||{};var c,a=typeof t;if("string"===a&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var u=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return u*s;case"days":case"day":case"d":return u*i;case"hours":case"hour":case"hrs":case"hr":case"h":return u*o;case"minutes":case"minute":case"mins":case"min":case"m":return u*r;case"seconds":case"second":case"secs":case"sec":case"s":return u*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}(t);if("number"===a&&!1===isNaN(t))return e.long?u(c=t,i,"day")||u(c,o,"hour")||u(c,r,"minute")||u(c,n,"second")||c+" ms":function(t){if(t>=i)return Math.round(t/i)+"d";if(t>=o)return Math.round(t/o)+"h";if(t>=r)return Math.round(t/r)+"m";if(t>=n)return Math.round(t/n)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){var r=n(211),o=n(0);(e=t.exports=n(161)).init=function(t){t.inspectOpts={};for(var n=Object.keys(e.inspectOpts),r=0;r<n.length;r++)t.inspectOpts[n[r]]=e.inspectOpts[n[r]]},e.log=function(){return process.stderr.write(o.format.apply(o,arguments)+"\n")},e.formatArgs=function(t){var n=this.namespace;if(this.useColors){var r=this.color,o="[3"+(r<8?r:"8;5;"+r),i="  "+o+";1m"+n+" [0m";t[0]=i+t[0].split("\n").join("\n"+i),t.push(o+"m+"+e.humanize(this.diff)+"[0m")}else t[0]=(e.inspectOpts.hideDate?"":(new Date).toISOString()+" ")+n+" "+t[0]},e.save=function(t){null==t?delete process.env.DEBUG:process.env.DEBUG=t},e.load=s,e.useColors=function(){return"colors"in e.inspectOpts?Boolean(e.inspectOpts.colors):r.isatty(process.stderr.fd)},e.colors=[6,2,3,4,5,1];try{var i=n(270);i&&i.level>=2&&(e.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(t){}function s(){return process.env.DEBUG}e.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var n=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(t,e){return e.toUpperCase()}),r=process.env[e];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),t[n]=r,t},{}),e.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,o.inspect(t,this.inspectOpts).split("\n").map(function(t){return t.trim()}).join(" ")},e.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,o.inspect(t,this.inspectOpts)},e.enable(s())},function(t,e,n){"use strict";const r=n(99),o=n(271),i=process.env;let s;function u(t){return function(t){return 0!==t&&{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}(function(t){if(!1===s)return 0;if(o("color=16m")||o("color=full")||o("color=truecolor"))return 3;if(o("color=256"))return 2;if(t&&!t.isTTY&&!0!==s)return 0;const e=s?1:0;if("win32"===process.platform){const t=r.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in i)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in i)||"codeship"===i.CI_NAME?1:e;if("TEAMCITY_VERSION"in i)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(i.TEAMCITY_VERSION)?1:0;if("truecolor"===i.COLORTERM)return 3;if("TERM_PROGRAM"in i){const t=parseInt((i.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(i.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(i.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(i.TERM)?1:"COLORTERM"in i?1:(i.TERM,e)}(t))}o("no-color")||o("no-colors")||o("color=false")?s=!1:(o("color")||o("colors")||o("color=true")||o("color=always"))&&(s=!0),"FORCE_COLOR"in i&&(s=0===i.FORCE_COLOR.length||0!==parseInt(i.FORCE_COLOR,10)),t.exports={supportsColor:u,stdout:u(process.stdout),stderr:u(process.stderr)}},function(t,e,n){"use strict";t.exports=((t,e)=>{e=e||process.argv;const n=t.startsWith("-")?"":1===t.length?"-":"--",r=e.indexOf(n+t),o=e.indexOf("--");return-1!==r&&(-1===o||r<o)})},function(t,e,n){"use strict";var r=e;r.distinct=function(t){return t._fields&&Object.keys(t._fields).length>0?"field selection and slice":(Object.keys(r.distinct).every(function(n){return!t.options[n]||(e=n,!1)}),e);var e},r.distinct.select=r.distinct.slice=r.distinct.sort=r.distinct.limit=r.distinct.skip=r.distinct.batchSize=r.distinct.comment=r.distinct.maxScan=r.distinct.snapshot=r.distinct.hint=r.distinct.tailable=!0,r.findOneAndUpdate=r.findOneAndRemove=function(t){var e;return Object.keys(r.findOneAndUpdate).every(function(n){return!t.options[n]||(e=n,!1)}),e},r.findOneAndUpdate.limit=r.findOneAndUpdate.skip=r.findOneAndUpdate.batchSize=r.findOneAndUpdate.maxScan=r.findOneAndUpdate.snapshot=r.findOneAndUpdate.hint=r.findOneAndUpdate.tailable=r.findOneAndUpdate.comment=!0,r.count=function(t){return t._fields&&Object.keys(t._fields).length>0?"field selection and slice":(Object.keys(r.count).every(function(n){return!t.options[n]||(e=n,!1)}),e);var e},r.count.slice=r.count.batchSize=r.count.comment=r.count.maxScan=r.count.snapshot=r.count.tailable=!0},function(t,e,n){"use strict";var r=n(162);if("unknown"==r.type)throw new Error("Unknown environment");t.exports=r.isNode?n(274):(r.isMongo,n(85))},function(t,e,n){"use strict";var r=n(85);function o(t){this.collection=t,this.collectionName=t.collectionName}n(159).inherits(o,r),o.prototype.find=function(t,e,n){this.collection.find(t,e,function(t,e){if(t)return n(t);try{e.toArray(n)}catch(t){n(t)}})},o.prototype.findOne=function(t,e,n){this.collection.findOne(t,e,n)},o.prototype.count=function(t,e,n){this.collection.count(t,e,n)},o.prototype.distinct=function(t,e,n,r){this.collection.distinct(t,e,n,r)},o.prototype.update=function(t,e,n,r){this.collection.update(t,e,n,r)},o.prototype.updateMany=function(t,e,n,r){this.collection.updateMany(t,e,n,r)},o.prototype.updateOne=function(t,e,n,r){this.collection.updateOne(t,e,n,r)},o.prototype.replaceOne=function(t,e,n,r){this.collection.replaceOne(t,e,n,r)},o.prototype.deleteOne=function(t,e,n){this.collection.deleteOne(t,e,n)},o.prototype.deleteMany=function(t,e,n){this.collection.deleteMany(t,e,n)},o.prototype.remove=function(t,e,n){this.collection.remove(t,e,n)},o.prototype.findAndModify=function(t,e,n,r){var o=Array.isArray(n.sort)?n.sort:[];this.collection.findAndModify(t,o,e,n,r)},o.prototype.findStream=function(t,e,n){return this.collection.find(t,e).stream(n)},o.prototype.findCursor=function(t,e){return this.collection.find(t,e)},t.exports=o},function(t,e,n){"use strict";var r;"undefined"!=typeof Promise&&(r=Promise);var o=n(276)();o.noConflict=function(){try{Promise===o&&(Promise=r)}catch(t){}return o},t.exports=o},function(t,e,n){"use strict";t.exports=function(){var e=function(){return new f("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},r=function(){return new N.PromiseInspection(this._target())},o=function(t){return N.reject(new f(t))};function i(){}var s,u={},c=n(7);s=c.isNode?function(){var t=process.domain;return void 0===t&&(t=null),t}:function(){return null},c.notEnumerableProp(N,"_getDomain",s);var a=n(46),l=n(277),h=new l;a.defineProperty(N,"_async",{value:h});var p=n(35),f=N.TypeError=p.TypeError;N.RangeError=p.RangeError;var d=N.CancellationError=p.CancellationError;N.TimeoutError=p.TimeoutError,N.OperationalError=p.OperationalError,N.RejectionError=p.OperationalError,N.AggregateError=p.AggregateError;var m=function(){},g={},y={},_=n(280)(N,m),v=n(281)(N,m,_,o,i),w=n(282)(N),b=w.create,O=n(283)(N,w),S=(O.CapturedTrace,n(284)(N,_,y)),A=n(163)(y),C=n(164),T=c.errorObj,E=c.tryCatch;function N(t){t!==m&&function(t,e){if(null==t||t.constructor!==N)throw new f("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new f("expecting a function but got "+c.classString(e))}(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function $(t){this.promise._resolveCallback(t)}function I(t){this.promise._rejectCallback(t,!1)}function M(t){var e=new N(m);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}return N.prototype.toString=function(){return"[object Promise]"},N.prototype.caught=N.prototype.catch=function(t){var e=arguments.length;if(e>1){var n,r=new Array(e-1),i=0;for(n=0;n<e-1;++n){var s=arguments[n];if(!c.isObject(s))return o("Catch statement predicate: expecting an object but got "+c.classString(s));r[i++]=s}return r.length=i,t=arguments[n],this.then(void 0,A(r,t,this))}return this.then(void 0,t)},N.prototype.reflect=function(){return this._then(r,r,void 0,this,void 0)},N.prototype.then=function(t,e){if(O.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var n=".then() only accepts functions but was passed: "+c.classString(t);arguments.length>1&&(n+=", "+c.classString(e)),this._warn(n)}return this._then(t,e,void 0,void 0,void 0)},N.prototype.done=function(t,e){this._then(t,e,void 0,void 0,void 0)._setIsFinal()},N.prototype.spread=function(t){return"function"!=typeof t?o("expecting a function but got "+c.classString(t)):this.all()._then(t,void 0,void 0,g,void 0)},N.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},N.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new v(this).promise()},N.prototype.error=function(t){return this.caught(c.originatesFromRejection,t)},N.getNewLibraryCopy=t.exports,N.is=function(t){return t instanceof N},N.fromNode=N.fromCallback=function(t){var e=new N(m);e._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=E(t)(C(e,n));return r===T&&e._rejectCallback(r.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},N.all=function(t){return new v(t).promise()},N.cast=function(t){var e=_(t);return e instanceof N||((e=new N(m))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},N.resolve=N.fulfilled=N.cast,N.reject=N.rejected=function(t){var e=new N(m);return e._captureStackTrace(),e._rejectCallback(t,!0),e},N.setScheduler=function(t){if("function"!=typeof t)throw new f("expecting a function but got "+c.classString(t));return h.setScheduler(t)},N.prototype._then=function(t,e,n,r,o){var i=void 0!==o,u=i?o:new N(m),a=this._target(),l=a._bitField;i||(u._propagateFrom(this,3),u._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&l)?this._boundValue():a===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,u));var p=s();if(0!=(50397184&l)){var f,g,y=a._settlePromiseCtx;0!=(33554432&l)?(g=a._rejectionHandler0,f=t):0!=(16777216&l)?(g=a._fulfillmentHandler0,f=e,a._unsetRejectionIsUnhandled()):(y=a._settlePromiseLateCancellationObserver,g=new d("late cancellation observer"),a._attachExtraTrace(g),f=e),h.invoke(y,a,{handler:null===p?f:"function"==typeof f&&c.domainBind(p,f),promise:u,receiver:r,value:g})}else a._addCallbacks(t,e,u,r,p);return u},N.prototype._length=function(){return 65535&this._bitField},N.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},N.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},N.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},N.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},N.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},N.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},N.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},N.prototype._isFinal=function(){return(4194304&this._bitField)>0},N.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},N.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},N.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},N.prototype._setAsyncGuaranteed=function(){h.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},N.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==u)return void 0===e&&this._isBound()?this._boundValue():e},N.prototype._promiseAt=function(t){return this[4*t-4+2]},N.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},N.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},N.prototype._boundValue=function(){},N.prototype._migrateCallback0=function(t){t._bitField;var e=t._fulfillmentHandler0,n=t._rejectionHandler0,r=t._promise0,o=t._receiverAt(0);void 0===o&&(o=u),this._addCallbacks(e,n,r,o,null)},N.prototype._migrateCallbackAt=function(t,e){var n=t._fulfillmentHandlerAt(e),r=t._rejectionHandlerAt(e),o=t._promiseAt(e),i=t._receiverAt(e);void 0===i&&(i=u),this._addCallbacks(n,r,o,i,null)},N.prototype._addCallbacks=function(t,e,n,r,o){var i=this._length();if(i>=65531&&(i=0,this._setLength(0)),0===i)this._promise0=n,this._receiver0=r,"function"==typeof t&&(this._fulfillmentHandler0=null===o?t:c.domainBind(o,t)),"function"==typeof e&&(this._rejectionHandler0=null===o?e:c.domainBind(o,e));else{var s=4*i-4;this[s+2]=n,this[s+3]=r,"function"==typeof t&&(this[s+0]=null===o?t:c.domainBind(o,t)),"function"==typeof e&&(this[s+1]=null===o?e:c.domainBind(o,e))}return this._setLength(i+1),i},N.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},N.prototype._resolveCallback=function(t,n){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(e(),!1);var r=_(t,this);if(!(r instanceof N))return this._fulfill(t);n&&this._propagateFrom(r,2);var o=r._target();if(o!==this){var i=o._bitField;if(0==(50397184&i)){var s=this._length();s>0&&o._migrateCallback0(this);for(var u=1;u<s;++u)o._migrateCallbackAt(this,u);this._setFollowing(),this._setLength(0),this._setFollowee(o)}else if(0!=(33554432&i))this._fulfill(o._value());else if(0!=(16777216&i))this._reject(o._reason());else{var c=new d("late cancellation observer");o._attachExtraTrace(c),this._reject(c)}}else this._reject(e())}},N.prototype._rejectCallback=function(t,e,n){var r=c.ensureErrorObject(t),o=r===t;if(!o&&!n&&O.warnings()){var i="a promise was rejected with a non-error: "+c.classString(t);this._warn(i,!0)}this._attachExtraTrace(r,!!e&&o),this._reject(t)},N.prototype._resolveFromExecutor=function(t){if(t!==m){var e=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,n)});n=!1,this._popContext(),void 0!==r&&e._rejectCallback(r,!0)}},N.prototype._settlePromiseFromHandler=function(t,e,n,r){var o=r._bitField;if(0==(65536&o)){var i;r._pushContext(),e===g?n&&"number"==typeof n.length?i=E(t).apply(this._boundValue(),n):(i=T).e=new f("cannot .spread() a non-array: "+c.classString(n)):i=E(t).call(e,n);var s=r._popContext();0==(65536&(o=r._bitField))&&(i===y?r._reject(n):i===T?r._rejectCallback(i.e,!1):(O.checkForgottenReturns(i,s,"",r,this),r._resolveCallback(i)))}},N.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},N.prototype._followee=function(){return this._rejectionHandler0},N.prototype._setFollowee=function(t){this._rejectionHandler0=t},N.prototype._settlePromise=function(t,e,n,o){var s=t instanceof N,u=this._bitField,c=0!=(134217728&u);0!=(65536&u)?(s&&t._invokeInternalOnCancel(),n instanceof S&&n.isFinallyHandler()?(n.cancelPromise=t,E(e).call(n,o)===T&&t._reject(T.e)):e===r?t._fulfill(r.call(n)):n instanceof i?n._promiseCancelled(t):s||t instanceof v?t._cancel():n.cancel()):"function"==typeof e?s?(c&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,n,o,t)):e.call(n,o,t):n instanceof i?n._isResolved()||(0!=(33554432&u)?n._promiseFulfilled(o,t):n._promiseRejected(o,t)):s&&(c&&t._setAsyncGuaranteed(),0!=(33554432&u)?t._fulfill(o):t._reject(o))},N.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,n=t.promise,r=t.receiver,o=t.value;"function"==typeof e?n instanceof N?this._settlePromiseFromHandler(e,r,o,n):e.call(r,o,n):n instanceof N&&n._reject(o)},N.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},N.prototype._settlePromise0=function(t,e,n){var r=this._promise0,o=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,t,o,e)},N.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},N.prototype._fulfill=function(t){var n=this._bitField;if(!((117506048&n)>>>16)){if(t===this){var r=e();return this._attachExtraTrace(r),this._reject(r)}this._setFulfilled(),this._rejectionHandler0=t,(65535&n)>0&&(0!=(134217728&n)?this._settlePromises():h.settlePromises(this))}},N.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=t,this._isFinal())return h.fatalError(t,c.isNode);(65535&e)>0?h.settlePromises(this):this._ensurePossibleRejectionHandled()}},N.prototype._fulfillPromises=function(t,e){for(var n=1;n<t;n++){var r=this._fulfillmentHandlerAt(n),o=this._promiseAt(n),i=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(o,r,i,e)}},N.prototype._rejectPromises=function(t,e){for(var n=1;n<t;n++){var r=this._rejectionHandlerAt(n),o=this._promiseAt(n),i=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(o,r,i,e)}},N.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!=(16842752&t)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,t),this._rejectPromises(e,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,t),this._fulfillPromises(e,r)}this._setLength(0)}this._clearCancellationData()},N.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},N.defer=N.pending=function(){return O.deprecated("Promise.defer","new Promise"),{promise:new N(m),resolve:$,reject:I}},c.notEnumerableProp(N,"_makeSelfResolutionError",e),n(285)(N,m,_,o,O),n(286)(N,m,_,O),n(287)(N,v,o,O),n(288)(N),n(289)(N),n(290)(N,v,_,m,h,s),N.Promise=N,N.version="3.5.1",n(291)(N,v,o,_,m,O),n(292)(N),n(293)(N,o,_,b,m,O),n(294)(N,m,O),n(295)(N,o,m,_,i,O),n(296)(N),n(297)(N,m),n(298)(N,v,_,o),n(299)(N,m,_,o),n(300)(N,v,o,_,m,O),n(301)(N,v,O),n(302)(N,v,o),n(303)(N,m),n(304)(N,m),n(305)(N),c.toFastProperties(N),c.toFastProperties(N.prototype),M({a:1}),M({b:2}),M({c:3}),M(1),M(function(){}),M(void 0),M(!1),M(new N(m)),O.setBounds(l.firstLineError,c.lastLineError),N}},function(t,e,n){"use strict";var r;try{throw new Error}catch(t){r=t}var o=n(278),i=n(279),s=n(7);function u(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new i(16),this._normalQueue=new i(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=o}function c(t,e,n){this._lateQueue.push(t,e,n),this._queueTick()}function a(t,e,n){this._normalQueue.push(t,e,n),this._queueTick()}function l(t){this._normalQueue._pushOne(t),this._queueTick()}u.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},u.prototype.hasCustomScheduler=function(){return this._customScheduler},u.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},u.prototype.disableTrampolineIfNecessary=function(){s.hasDevTools&&(this._trampolineEnabled=!1)},u.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},u.prototype.fatalError=function(t,e){e?(process.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),process.exit(2)):this.throwLater(t)},u.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},s.hasDevTools?(u.prototype.invokeLater=function(t,e,n){this._trampolineEnabled?c.call(this,t,e,n):this._schedule(function(){setTimeout(function(){t.call(e,n)},100)})},u.prototype.invoke=function(t,e,n){this._trampolineEnabled?a.call(this,t,e,n):this._schedule(function(){t.call(e,n)})},u.prototype.settlePromises=function(t){this._trampolineEnabled?l.call(this,t):this._schedule(function(){t._settlePromises()})}):(u.prototype.invokeLater=c,u.prototype.invoke=a,u.prototype.settlePromises=l),u.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var n=t.shift(),r=t.shift();e.call(n,r)}else e._settlePromises()}},u.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},u.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},u.prototype._reset=function(){this._isTickUsed=!1},t.exports=u,t.exports.firstLineError=r},function(t,e,n){"use strict";var r,o=n(7),i=o.getNativePromise();if(o.isNode&&"undefined"==typeof MutationObserver){var s=global.setImmediate,u=process.nextTick;r=o.isRecentNode?function(t){s.call(global,t)}:function(t){u.call(process,t)}}else if("function"==typeof i&&"function"==typeof i.resolve){var c=i.resolve();r=function(t){c.then(t)}}else r="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(t){setImmediate(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:function(){var t=document.createElement("div"),e={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){t.classList.toggle("foo"),n=!1}).observe(r,e);return function(o){var i=new MutationObserver(function(){i.disconnect(),o()});i.observe(t,e),n||(n=!0,r.classList.toggle("foo"))}}();t.exports=r},function(t,e,n){"use strict";function r(t){this._capacity=t,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(t){return this._capacity<t},r.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1),this[this._front+e&this._capacity-1]=t,this._length=e+1},r.prototype.push=function(t,e,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(t),this._pushOne(e),void this._pushOne(n);var o=this._front+r-3;this._checkCapacity(r);var i=this._capacity-1;this[o+0&i]=t,this[o+1&i]=e,this[o+2&i]=n,this._length=r},r.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t,function(t,e,n,r,o){for(var i=0;i<o;++i)n[i+r]=t[i+e],t[i+e]=void 0}(this,0,this,e,this._front+this._length&e-1)},t.exports=r},function(t,e,n){"use strict";t.exports=function(t,e){var r=n(7),o=r.errorObj,i=r.isObject;var s={}.hasOwnProperty;return function(n,u){if(i(n)){if(n instanceof t)return n;var c=function(t){try{return function(t){return t.then}(t)}catch(t){return o.e=t,o}}(n);if(c===o){u&&u._pushContext();var a=t.reject(c.e);return u&&u._popContext(),a}if("function"==typeof c)return function(t){try{return s.call(t,"_promise0")}catch(t){return!1}}(n)?(a=new t(e),n._then(a._fulfill,a._reject,void 0,a,null),a):function(n,i,s){var u=new t(e),c=u;s&&s._pushContext(),u._captureStackTrace(),s&&s._popContext();var a=!0,l=r.tryCatch(i).call(n,function(t){u&&(u._resolveCallback(t),u=null)},function(t){u&&(u._rejectCallback(t,a,!0),u=null)});return a=!1,u&&l===o&&(u._rejectCallback(l.e,!0,!0),u=null),c}(n,c,u)}return n}}},function(t,e,n){"use strict";t.exports=function(t,e,r,o,i){var s=n(7);s.isArray;function u(n){var r=this._promise=new t(e);n instanceof t&&r._propagateFrom(n,3),r._setOnCancel(this),this._values=n,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return s.inherits(u,i),u.prototype.length=function(){return this._length},u.prototype.promise=function(){return this._promise},u.prototype._init=function e(n,i){var u=r(this._values,this._promise);if(u instanceof t){var c=(u=u._target())._bitField;if(this._values=u,0==(50397184&c))return this._promise._setAsyncGuaranteed(),u._then(e,this._reject,void 0,this,i);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(u._reason()):this._cancel();u=u._value()}if(null!==(u=s.asArray(u)))0!==u.length?this._iterate(u):-5===i?this._resolveEmptyArray():this._resolve(function(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}(i));else{var a=o("expecting an array or an iterable object but got "+s.classString(u)).reason();this._promise._rejectCallback(a,!1)}},u.prototype._iterate=function(e){var n=this.getActualLength(e.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var o=this._promise,i=!1,s=null,u=0;u<n;++u){var c=r(e[u],o);s=c instanceof t?(c=c._target())._bitField:null,i?null!==s&&c.suppressUnhandledRejections():null!==s?0==(50397184&s)?(c._proxy(this,u),this._values[u]=c):i=0!=(33554432&s)?this._promiseFulfilled(c._value(),u):0!=(16777216&s)?this._promiseRejected(c._reason(),u):this._promiseCancelled(u):i=this._promiseFulfilled(c,u)}i||o._setAsyncGuaranteed()},u.prototype._isResolved=function(){return null===this._values},u.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},u.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},u.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},u.prototype._promiseFulfilled=function(t,e){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},u.prototype._promiseCancelled=function(){return this._cancel(),!0},u.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},u.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var n=0;n<e.length;++n)e[n]instanceof t&&e[n].cancel()}},u.prototype.shouldCopyValues=function(){return!0},u.prototype.getActualLength=function(t){return t},u}},function(t,e,n){"use strict";t.exports=function(t){var e=!1,n=[];function r(){this._trace=new r.CapturedTrace(o())}function o(){var t=n.length-1;if(t>=0)return n[t]}return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},r.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,n.push(this._trace))},r.prototype._popContext=function(){if(void 0!==this._trace){var t=n.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},r.CapturedTrace=null,r.create=function(){if(e)return new r},r.deactivateLongStackTraces=function(){},r.activateLongStackTraces=function(){var n=t.prototype._pushContext,i=t.prototype._popContext,s=t._peekContext,u=t.prototype._peekContext,c=t.prototype._promiseCreated;r.deactivateLongStackTraces=function(){t.prototype._pushContext=n,t.prototype._popContext=i,t._peekContext=s,t.prototype._peekContext=u,t.prototype._promiseCreated=c,e=!1},e=!0,t.prototype._pushContext=r.prototype._pushContext,t.prototype._popContext=r.prototype._popContext,t._peekContext=t.prototype._peekContext=o,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},r}},function(t,e,n){"use strict";t.exports=function(t,e){var r,o,i,s=t._getDomain,u=t._async,c=n(35).Warning,a=n(7),l=a.canAttachTrace,h=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,p=/\((?:timers\.js):\d+:\d+\)/,f=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,d=null,m=null,g=!1,y=!(0==a.env("BLUEBIRD_DEBUG")||!a.env("BLUEBIRD_DEBUG")&&"development"!==a.env("NODE_ENV")),_=!(0==a.env("BLUEBIRD_WARNINGS")||!y&&!a.env("BLUEBIRD_WARNINGS")),v=!(0==a.env("BLUEBIRD_LONG_STACK_TRACES")||!y&&!a.env("BLUEBIRD_LONG_STACK_TRACES")),w=0!=a.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(_||!!a.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var t=this;setTimeout(function(){t._notifyUnhandledRejection()},1)}},t.prototype._notifyUnhandledRejectionIsHandled=function(){W("rejectionHandled",r,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),W("unhandledRejection",o,t,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(t,e,n){return F(t,e,n||this)},t.onPossiblyUnhandledRejection=function(t){var e=s();o="function"==typeof t?null===e?t:a.domainBind(e,t):void 0},t.onUnhandledRejectionHandled=function(t){var e=s();r="function"==typeof t?null===e?t:a.domainBind(e,t):void 0};var b=function(){};t.longStackTraces=function(){if(u.haveItemsQueued()&&!J.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!J.longStackTraces&&H()){var n=t.prototype._captureStackTrace,r=t.prototype._attachExtraTrace;J.longStackTraces=!0,b=function(){if(u.haveItemsQueued()&&!J.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=n,t.prototype._attachExtraTrace=r,e.deactivateLongStackTraces(),u.enableTrampoline(),J.longStackTraces=!1},t.prototype._captureStackTrace=B,t.prototype._attachExtraTrace=L,e.activateLongStackTraces(),u.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return J.longStackTraces&&H()};var O=function(){try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return a.global.dispatchEvent(t),function(t,e){var n=new CustomEvent(t.toLowerCase(),{detail:e,cancelable:!0});return!a.global.dispatchEvent(n)}}if("function"==typeof Event){t=new Event("CustomEvent");return a.global.dispatchEvent(t),function(t,e){var n=new Event(t.toLowerCase(),{cancelable:!0});return n.detail=e,!a.global.dispatchEvent(n)}}return(t=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),a.global.dispatchEvent(t),function(t,e){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t.toLowerCase(),!1,!0,e),!a.global.dispatchEvent(n)}}catch(t){}return function(){return!1}}(),S=a.isNode?function(){return process.emit.apply(process,arguments)}:a.global?function(t){var e="on"+t.toLowerCase(),n=a.global[e];return!!n&&(n.apply(a.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function A(t,e){return{promise:e}}var C={promiseCreated:A,promiseFulfilled:A,promiseRejected:A,promiseResolved:A,promiseCancelled:A,promiseChained:function(t,e,n){return{promise:e,child:n}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,n){return{reason:e,promise:n}},rejectionHandled:A},T=function(t){var e=!1;try{e=S.apply(null,arguments)}catch(t){u.throwLater(t),e=!0}var n=!1;try{n=O(t,C[t].apply(null,arguments))}catch(t){u.throwLater(t),n=!0}return n||e};function E(){return!1}function N(t,e,n){var r=this;try{t(e,n,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+a.toString(t));r._attachCancellationCallback(t)})}catch(t){return t}}function $(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?a.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function I(){return this._onCancelField}function M(t){this._onCancelField=t}function R(){this._cancellationParent=void 0,this._onCancelField=void 0}function P(t,e){if(0!=(1&e)){this._cancellationParent=t;var n=t._branchesRemainingToCancel;void 0===n&&(n=0),t._branchesRemainingToCancel=n+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}t.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&b()),"warnings"in e){var n=e.warnings;J.warnings=!!n,w=J.warnings,a.isObject(n)&&"wForgottenReturn"in n&&(w=!!n.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!J.cancellation){if(u.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=R,t.prototype._propagateFrom=P,t.prototype._onCancel=I,t.prototype._setOnCancel=M,t.prototype._attachCancellationCallback=$,t.prototype._execute=N,j=P,J.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!J.monitoring?(J.monitoring=!0,t.prototype._fireEvent=T):!e.monitoring&&J.monitoring&&(J.monitoring=!1,t.prototype._fireEvent=E)),t},t.prototype._fireEvent=E,t.prototype._execute=function(t,e,n){try{t(e,n)}catch(t){return t}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(t){},t.prototype._attachCancellationCallback=function(t){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(t,e){};var j=function(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)};function D(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function B(){this._trace=new K(this._peekContext())}function L(t,e){if(l(t)){var n=this._trace;if(void 0!==n&&e&&(n=n._parent),void 0!==n)n.attachExtraTrace(t);else if(!t.__stackCleaned__){var r=q(t);a.notEnumerableProp(t,"stack",r.message+"\n"+r.stack.join("\n")),a.notEnumerableProp(t,"__stackCleaned__",!0)}}}function F(e,n,r){if(J.warnings){var o,i=new c(e);if(n)r._attachExtraTrace(i);else if(J.longStackTraces&&(o=t._peekContext()))o.attachExtraTrace(i);else{var s=q(i);i.stack=s.message+"\n"+s.stack.join("\n")}T("warning",i)||x(i,"",!0)}}function U(t){for(var e=[],n=0;n<t.length;++n){var r=t[n],o="    (No stack trace)"===r||d.test(r),i=o&&Y(r);o&&!i&&(g&&" "!==r.charAt(0)&&(r="    "+r),e.push(r))}return e}function q(t){var e=t.stack,n=t.toString();return e="string"==typeof e&&e.length>0?function(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),n=0;n<e.length;++n){var r=e[n];if("    (No stack trace)"===r||d.test(r))break}return n>0&&"SyntaxError"!=t.name&&(e=e.slice(n)),e}(t):["    (No stack trace)"],{message:n,stack:"SyntaxError"==t.name?e:U(e)}}function x(t,e,n){if("undefined"!=typeof console){var r;if(a.isObject(t)){var o=t.stack;r=e+m(o,t)}else r=e+String(t);"function"==typeof i?i(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function W(t,e,n,r){var o=!1;try{"function"==typeof e&&(o=!0,"rejectionHandled"===t?e(r):e(n,r))}catch(t){u.throwLater(t)}"unhandledRejection"===t?T(t,n,r)||o||x(n,"Unhandled rejection "):T(t,r)}function V(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():a.toString(t);if(/\[object [a-zA-Z0-9$_]+\]/.test(e))try{e=JSON.stringify(t)}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+function(t){if(t.length<41)return t;return t.substr(0,38)+"..."}(e)+">, no stack trace)"}function H(){return"function"==typeof G}var Y=function(){return!1},Q=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function z(t){var e=t.match(Q);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function K(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);G(this,K),e>32&&this.uncycle()}a.inherits(K,Error),e.CapturedTrace=K,K.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],n={},r=0,o=this;void 0!==o;++r)e.push(o),o=o._parent;for(r=(t=this._length=r)-1;r>=0;--r){var i=e[r].stack;void 0===n[i]&&(n[i]=r)}for(r=0;r<t;++r){var s=n[e[r].stack];if(void 0!==s&&s!==r){s>0&&(e[s-1]._parent=void 0,e[s-1]._length=1),e[r]._parent=void 0,e[r]._length=1;var u=r>0?e[r-1]:this;s<t-1?(u._parent=e[s+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var c=u._length+1,a=r-2;a>=0;--a)e[a]._length=c,c++;return}}}},K.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=q(t),n=e.message,r=[e.stack],o=this;void 0!==o;)r.push(U(o.stack.split("\n"))),o=o._parent;!function(t){for(var e=t[0],n=1;n<t.length;++n){for(var r=t[n],o=e.length-1,i=e[o],s=-1,u=r.length-1;u>=0;--u)if(r[u]===i){s=u;break}for(u=s;u>=0;--u){var c=r[u];if(e[o]!==c)break;e.pop(),o--}e=r}}(r),function(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(r),a.notEnumerableProp(t,"stack",function(t,e){for(var n=0;n<e.length-1;++n)e[n].push("From previous event:"),e[n]=e[n].join("\n");return n<e.length&&(e[n]=e[n].join("\n")),t+"\n"+e.join("\n")}(n,r)),a.notEnumerableProp(t,"__stackCleaned__",!0)}};var G=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():V(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,d=t,m=e;var n=Error.captureStackTrace;return Y=function(t){return h.test(t)},function(t,e){Error.stackTraceLimit+=6,n(t,e),Error.stackTraceLimit-=6}}var r,o=new Error;if("string"==typeof o.stack&&o.stack.split("\n")[0].indexOf("stackDetection@")>=0)return d=/@/,m=e,g=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(t){r="stack"in t}return"stack"in o||!r||"number"!=typeof Error.stackTraceLimit?(m=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?V(e):e.toString()},null):(d=t,m=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(i=function(t){console.warn(t)},a.isNode&&process.stderr.isTTY?i=function(t,e){var n=e?"[33m":"[31m";console.warn(n+t+"[0m\n")}:a.isNode||"string"!=typeof(new Error).stack||(i=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var J={warnings:_,longStackTraces:!1,cancellation:!1,monitoring:!1};return v&&t.longStackTraces(),{longStackTraces:function(){return J.longStackTraces},warnings:function(){return J.warnings},cancellation:function(){return J.cancellation},monitoring:function(){return J.monitoring},propagateFromFunction:function(){return j},boundValueFunction:function(){return D},checkForgottenReturns:function(t,e,n,r,o){if(void 0===t&&null!==e&&w){if(void 0!==o&&o._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var i="",s="";if(e._trace){for(var u=e._trace.stack.split("\n"),c=U(u),a=c.length-1;a>=0;--a){var l=c[a];if(!p.test(l)){var h=l.match(f);h&&(i="at "+h[1]+":"+h[2]+":"+h[3]+" ");break}}if(c.length>0){var d=c[0];for(a=0;a<u.length;++a)if(u[a]===d){a>0&&(s="\n"+u[a-1]);break}}}var m="a promise was created in a "+n+"handler "+i+"but was not returned from it, see http://goo.gl/rRqMUw"+s;r._warn(m,!0,e)}},setBounds:function(t,e){if(H()){for(var n,r,o=t.stack.split("\n"),i=e.stack.split("\n"),s=-1,u=-1,c=0;c<o.length;++c)if(a=z(o[c])){n=a.fileName,s=a.line;break}for(c=0;c<i.length;++c){var a;if(a=z(i[c])){r=a.fileName,u=a.line;break}}s<0||u<0||!n||!r||n!==r||s>=u||(Y=function(t){if(h.test(t))return!0;var e=z(t);return!!(e&&e.fileName===n&&s<=e.line&&e.line<=u)})}},warn:F,deprecated:function(t,e){var n=t+" is deprecated and will be removed in a future version.";return e&&(n+=" Use "+e+" instead."),F(n)},CapturedTrace:K,fireDomEvent:O,fireGlobalEvent:S}}},function(t,e,n){"use strict";t.exports=function(t,e,r){var o=n(7),i=t.CancellationError,s=o.errorObj,u=n(163)(r);function c(t,e,n){this.promise=t,this.type=e,this.handler=n,this.called=!1,this.cancelPromise=null}function a(t){this.finallyHandler=t}function l(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function h(){return f.call(this,this.promise._target()._settledValue())}function p(t){if(!l(this,t))return s.e=t,s}function f(n){var o=this.promise,u=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?u.call(o._boundValue()):u.call(o._boundValue(),n);if(c===r)return c;if(void 0!==c){o._setReturnedNonUndefined();var f=e(c,o);if(f instanceof t){if(null!=this.cancelPromise){if(f._isCancelled()){var d=new i("late cancellation observer");return o._attachExtraTrace(d),s.e=d,s}f.isPending()&&f._attachCancellationCallback(new a(this))}return f._then(h,p,void 0,this,void 0)}}}return o.isRejected()?(l(this),s.e=n,s):(l(this),n)}return c.prototype.isFinallyHandler=function(){return 0===this.type},a.prototype._resultCancelled=function(){l(this.finallyHandler)},t.prototype._passThrough=function(t,e,n,r){return"function"!=typeof t?this.then():this._then(n,r,void 0,new c(this,e,t),void 0)},t.prototype.lastly=t.prototype.finally=function(t){return this._passThrough(t,0,f,f)},t.prototype.tap=function(t){return this._passThrough(t,1,f)},t.prototype.tapCatch=function(e){var n=arguments.length;if(1===n)return this._passThrough(e,1,void 0,f);var r,i=new Array(n-1),s=0;for(r=0;r<n-1;++r){var c=arguments[r];if(!o.isObject(c))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+o.classString(c)));i[s++]=c}i.length=s;var a=arguments[r];return this._passThrough(u(i,a,this),1,void 0,f)},c}},function(t,e,n){"use strict";t.exports=function(t,e,r,o,i){var s=n(7),u=s.tryCatch;t.method=function(n){if("function"!=typeof n)throw new t.TypeError("expecting a function but got "+s.classString(n));return function(){var r=new t(e);r._captureStackTrace(),r._pushContext();var o=u(n).apply(this,arguments),s=r._popContext();return i.checkForgottenReturns(o,s,"Promise.method",r),r._resolveFromSyncValue(o),r}},t.attempt=t.try=function(n){if("function"!=typeof n)return o("expecting a function but got "+s.classString(n));var r,c=new t(e);if(c._captureStackTrace(),c._pushContext(),arguments.length>1){i.deprecated("calling Promise.try with more than 1 argument");var a=arguments[1],l=arguments[2];r=s.isArray(a)?u(n).apply(l,a):u(n).call(l,a)}else r=u(n)();var h=c._popContext();return i.checkForgottenReturns(r,h,"Promise.try",c),c._resolveFromSyncValue(r),c},t.prototype._resolveFromSyncValue=function(t){t===s.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},function(t,e,n){"use strict";t.exports=function(t,e,n,r){var o=!1,i=function(t,e){this._reject(e)},s=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(i,i,null,this,t)},u=function(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)},c=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(i){o||(o=!0,t.prototype._propagateFrom=r.propagateFromFunction(),t.prototype._boundValue=r.boundValueFunction());var a=n(i),l=new t(e);l._propagateFrom(this,1);var h=this._target();if(l._setBoundTo(a),a instanceof t){var p={promiseRejectionQueued:!1,promise:l,target:h,bindingPromise:a};h._then(e,s,void 0,l,p),a._then(u,c,void 0,l,p),l._setOnCancel(a)}else l._resolveCallback(h);return l},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},t.bind=function(e,n){return t.resolve(n).bind(e)}}},function(t,e,n){"use strict";t.exports=function(t,e,r,o){var i=n(7),s=i.tryCatch,u=i.errorObj,c=t._async;t.prototype.break=t.prototype.cancel=function(){if(!o.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var n=t._cancellationParent;if(null==n||!n._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=n}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),c.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,e){if(i.isArray(t))for(var n=0;n<t.length;++n)this._doInvokeOnCancel(t[n],e);else if(void 0!==t)if("function"==typeof t){if(!e){var r=s(t).call(this._boundValue());r===u&&(this._attachExtraTrace(r.e),c.throwLater(r.e))}}else t._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),c.invoke(this._doInvokeOnCancel,this,t)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},function(t,e,n){"use strict";t.exports=function(t){function e(){return this.value}function n(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(n){return n instanceof t&&n.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:n},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(n,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:t},void 0);var e=arguments[1];return this.caught(t,function(){throw e})},t.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof t&&n.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:n},void 0);var r=arguments[1];r instanceof t&&r.suppressUnhandledRejections();return this.caught(n,function(){return r})}}},function(t,e,n){"use strict";t.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var n=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},o=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},i=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},u=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return i.call(this._target())},t.prototype.isFulfilled=function(){return o.call(this._target())},t.prototype.isResolved=function(){return u.call(this._target())},t.prototype.value=function(){return n.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),r.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},function(t,e,n){"use strict";t.exports=function(t,e,r,o,i,s){var u,c=n(7),a=c.canEvaluate,l=c.tryCatch,h=c.errorObj;if(a){for(var p=function(t){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,t))},f=function(t){return new Function("promise","holder","                           \n            'use strict';                                                    \n            holder.pIndex = promise;                                         \n            ".replace(/Index/g,t))},d=function(e){for(var n=new Array(e),r=0;r<n.length;++r)n[r]="this.p"+(r+1);var o=n.join(" = ")+" = null;",s="var promise;\n"+n.map(function(t){return"                                                         \n                promise = "+t+";                                      \n                if (promise instanceof Promise) {                            \n                    promise.cancel();                                        \n                }                                                            \n            "}).join("\n"),u=n.join(", "),c="Holder$"+e,a="return function(tryCatch, errorObj, Promise, async) {    \n            'use strict';                                                    \n            function [TheName](fn) {                                         \n                [TheProperties]                                              \n                this.fn = fn;                                                \n                this.asyncNeeded = true;                                     \n                this.now = 0;                                                \n            }                                                                \n                                                                             \n            [TheName].prototype._callFunction = function(promise) {          \n                promise._pushContext();                                      \n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n                promise._popContext();                                       \n                if (ret === errorObj) {                                      \n                    promise._rejectCallback(ret.e, false);                   \n                } else {                                                     \n                    promise._resolveCallback(ret);                           \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype.checkFulfillment = function(promise) {       \n                var now = ++this.now;                                        \n                if (now === [TheTotal]) {                                    \n                    if (this.asyncNeeded) {                                  \n                        async.invoke(this._callFunction, this, promise);     \n                    } else {                                                 \n                        this._callFunction(promise);                         \n                    }                                                        \n                                                                             \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype._resultCancelled = function() {              \n                [CancellationCode]                                           \n            };                                                               \n                                                                             \n            return [TheName];                                                \n        }(tryCatch, errorObj, Promise, async);                               \n        ";return a=a.replace(/\[TheName\]/g,c).replace(/\[TheTotal\]/g,e).replace(/\[ThePassedArguments\]/g,u).replace(/\[TheProperties\]/g,o).replace(/\[CancellationCode\]/g,s),new Function("tryCatch","errorObj","Promise","async",a)(l,h,t,i)},m=[],g=[],y=[],_=0;_<8;++_)m.push(d(_+1)),g.push(p(_+1)),y.push(f(_+1));u=function(t){this._reject(t)}}t.join=function(){var n,i=arguments.length-1;if(i>0&&"function"==typeof arguments[i]&&(n=arguments[i],i<=8&&a)){(O=new t(o))._captureStackTrace();for(var l=new(0,m[i-1])(n),h=g,p=0;p<i;++p){var f=r(arguments[p],O);if(f instanceof t){var d=(f=f._target())._bitField;0==(50397184&d)?(f._then(h[p],u,void 0,O,l),y[p](f,l),l.asyncNeeded=!1):0!=(33554432&d)?h[p].call(O,f._value(),l):0!=(16777216&d)?O._reject(f._reason()):O._cancel()}else h[p].call(O,f,l)}if(!O._isFateSealed()){if(l.asyncNeeded){var _=s();null!==_&&(l.fn=c.domainBind(_,l.fn))}O._setAsyncGuaranteed(),O._setOnCancel(l)}return O}for(var v=arguments.length,w=new Array(v),b=0;b<v;++b)w[b]=arguments[b];n&&w.pop();var O=new e(w).promise();return void 0!==n?O.spread(n):O}}},function(t,e,n){"use strict";t.exports=function(t,e,r,o,i,s){var u=t._getDomain,c=n(7),a=c.tryCatch,l=c.errorObj,h=t._async;function p(t,e,n,r){this.constructor$(t),this._promise._captureStackTrace();var o=u();this._callback=null===o?e:c.domainBind(o,e),this._preservedValues=r===i?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],h.invoke(this._asyncInit,this,void 0)}function f(e,n,o,i){if("function"!=typeof n)return r("expecting a function but got "+c.classString(n));var s=0;if(void 0!==o){if("object"!=typeof o||null===o)return t.reject(new TypeError("options argument must be an object but it is "+c.classString(o)));if("number"!=typeof o.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+c.classString(o.concurrency)));s=o.concurrency}return new p(e,n,s="number"==typeof s&&isFinite(s)&&s>=1?s:0,i).promise()}c.inherits(p,e),p.prototype._asyncInit=function(){this._init$(void 0,-2)},p.prototype._init=function(){},p.prototype._promiseFulfilled=function(e,n){var r=this._values,i=this.length(),u=this._preservedValues,c=this._limit;if(n<0){if(r[n=-1*n-1]=e,c>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(c>=1&&this._inFlight>=c)return r[n]=e,this._queue.push(n),!1;null!==u&&(u[n]=e);var h=this._promise,p=this._callback,f=h._boundValue();h._pushContext();var d=a(p).call(f,e,n,i),m=h._popContext();if(s.checkForgottenReturns(d,m,null!==u?"Promise.filter":"Promise.map",h),d===l)return this._reject(d.e),!0;var g=o(d,this._promise);if(g instanceof t){var y=(g=g._target())._bitField;if(0==(50397184&y))return c>=1&&this._inFlight++,r[n]=g,g._proxy(this,-1*(n+1)),!1;if(0==(33554432&y))return 0!=(16777216&y)?(this._reject(g._reason()),!0):(this._cancel(),!0);d=g._value()}r[n]=d}return++this._totalResolved>=i&&(null!==u?this._filter(r,u):this._resolve(r),!0)},p.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,n=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var r=t.pop();this._promiseFulfilled(n[r],r)}},p.prototype._filter=function(t,e){for(var n=e.length,r=new Array(n),o=0,i=0;i<n;++i)t[i]&&(r[o++]=e[i]);r.length=o,this._resolve(r)},p.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(t,e){return f(this,t,e,null)},t.map=function(t,e,n,r){return f(t,e,n,r)}}},function(t,e,n){"use strict";var r=Object.create;if(r){var o=r(null),i=r(null);o[" size"]=i[" size"]=0}t.exports=function(t){var e,r,s=n(7),u=s.canEvaluate,c=s.isIdentifier,a=function(t){return new Function("ensureMethod","                                    \n        return function(obj) {                                               \n            'use strict'                                                     \n            var len = this.length;                                           \n            ensureMethod(obj, 'methodName');                                 \n            switch(len) {                                                    \n                case 1: return obj.methodName(this[0]);                      \n                case 2: return obj.methodName(this[0], this[1]);             \n                case 3: return obj.methodName(this[0], this[1], this[2]);    \n                case 0: return obj.methodName();                             \n                default:                                                     \n                    return obj.methodName.apply(obj, this);                  \n            }                                                                \n        };                                                                   \n        ".replace(/methodName/g,t))(p)},l=function(t){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",t))},h=function(t,e,n){var r=n[t];if("function"!=typeof r){if(!c(t))return null;if(r=e(t),n[t]=r,n[" size"]++,n[" size"]>512){for(var o=Object.keys(n),i=0;i<256;++i)delete n[o[i]];n[" size"]=o.length-256}}return r};function p(e,n){var r;if(null!=e&&(r=e[n]),"function"!=typeof r){var o="Object "+s.classString(e)+" has no method '"+s.toString(n)+"'";throw new t.TypeError(o)}return r}function f(t){return p(t,this.pop()).apply(t,this)}function d(t){return t[this]}function m(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}e=function(t){return h(t,a,o)},r=function(t){return h(t,l,i)},t.prototype.call=function(t){for(var n=arguments.length,r=new Array(Math.max(n-1,0)),o=1;o<n;++o)r[o-1]=arguments[o];if(u){var i=e(t);if(null!==i)return this._then(i,void 0,void 0,r,void 0)}return r.push(t),this._then(f,void 0,void 0,r,void 0)},t.prototype.get=function(t){var e;if("number"==typeof t)e=m;else if(u){var n=r(t);e=null!==n?n:d}else e=d;return this._then(e,void 0,void 0,t,void 0)}}},function(t,e,n){"use strict";t.exports=function(t,e,r,o,i,s){var u=n(7),c=n(35).TypeError,a=n(7).inherits,l=u.errorObj,h=u.tryCatch,p={};function f(t){setTimeout(function(){throw t},0)}function d(e,n){var o=0,s=e.length,u=new t(i);return function i(){if(o>=s)return u._fulfill();var c=function(t){var e=r(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}(e[o++]);if(c instanceof t&&c._isDisposable()){try{c=r(c._getDisposer().tryDispose(n),e.promise)}catch(t){return f(t)}if(c instanceof t)return c._then(i,f,null,null,null)}i()}(),u}function m(t,e,n){this._data=t,this._promise=e,this._context=n}function g(t,e,n){this.constructor$(t,e,n)}function y(t){return m.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function _(t){this.length=t,this.promise=null,this[t-1]=null}m.prototype.data=function(){return this._data},m.prototype.promise=function(){return this._promise},m.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():p},m.prototype.tryDispose=function(t){var e=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=e!==p?this.doDispose(e,t):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},m.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},a(g,m),g.prototype.doDispose=function(t,e){return this.data().call(t,t,e)},_.prototype._resultCancelled=function(){for(var e=this.length,n=0;n<e;++n){var r=this[n];r instanceof t&&r.cancel()}},t.using=function(){var n=arguments.length;if(n<2)return e("you must pass at least 2 arguments to Promise.using");var o,i=arguments[n-1];if("function"!=typeof i)return e("expecting a function but got "+u.classString(i));var c=!0;2===n&&Array.isArray(arguments[0])?(n=(o=arguments[0]).length,c=!1):(o=arguments,n--);for(var a=new _(n),p=0;p<n;++p){var f=o[p];if(m.isDisposer(f)){var g=f;(f=f.promise())._setDisposable(g)}else{var v=r(f);v instanceof t&&(f=v._then(y,null,null,{resources:a,index:p},void 0))}a[p]=f}var w=new Array(a.length);for(p=0;p<w.length;++p)w[p]=t.resolve(a[p]).reflect();var b=t.all(w).then(function(t){for(var e=0;e<t.length;++e){var n=t[e];if(n.isRejected())return l.e=n.error(),l;if(!n.isFulfilled())return void b.cancel();t[e]=n.value()}O._pushContext(),i=h(i);var r=c?i.apply(void 0,t):i(t),o=O._popContext();return s.checkForgottenReturns(r,o,"Promise.using",O),r}),O=b.lastly(function(){var e=new t.PromiseInspection(b);return d(a,e)});return a.promise=O,O._setOnCancel(a),O},t.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(t){if("function"==typeof t)return new g(t,this,o());throw new c}}},function(t,e,n){"use strict";t.exports=function(t,e,r){var o=n(7),i=t.TimeoutError;function s(t){this.handle=t}s.prototype._resultCancelled=function(){clearTimeout(this.handle)};var u=function(t){return c(+this).thenReturn(t)},c=t.delay=function(n,o){var i,c;return void 0!==o?(i=t.resolve(o)._then(u,null,null,n,void 0),r.cancellation()&&o instanceof t&&i._setOnCancel(o)):(i=new t(e),c=setTimeout(function(){i._fulfill()},+n),r.cancellation()&&i._setOnCancel(new s(c)),i._captureStackTrace()),i._setAsyncGuaranteed(),i};t.prototype.delay=function(t){return c(t,this)};function a(t){return clearTimeout(this.handle),t}function l(t){throw clearTimeout(this.handle),t}t.prototype.timeout=function(t,e){var n,u;t=+t;var c=new s(setTimeout(function(){n.isPending()&&function(t,e,n){var r;r="string"!=typeof e?e instanceof Error?e:new i("operation timed out"):new i(e),o.markAsOriginatingFromRejection(r),t._attachExtraTrace(r),t._reject(r),null!=n&&n.cancel()}(n,e,u)},t));return r.cancellation()?(u=this.then(),(n=u._then(a,l,void 0,c,void 0))._setOnCancel(c)):n=this._then(a,l,void 0,c,void 0),n}}},function(t,e,n){"use strict";t.exports=function(t,e,r,o,i,s){var u=n(35).TypeError,c=n(7),a=c.errorObj,l=c.tryCatch,h=[];function p(e,n,o,i){if(s.cancellation()){var u=new t(r),c=this._finallyPromise=new t(r);this._promise=u.lastly(function(){return c}),u._captureStackTrace(),u._setOnCancel(this)}else{(this._promise=new t(r))._captureStackTrace()}this._stack=i,this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof o?[o].concat(h):h,this._yieldedPromise=null,this._cancellationPhase=!1}c.inherits(p,i),p.prototype._isResolved=function(){return null===this._promise},p.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},p.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=l(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=l(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},p.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=l(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},p.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=l(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},p.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},p.prototype.promise=function(){return this._promise},p.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},p.prototype._continue=function(e){var n=this._promise;if(e===a)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var i=o(r,this._promise);if(i instanceof t||null!==(i=function(e,n,r){for(var i=0;i<n.length;++i){r._pushContext();var s=l(n[i])(e);if(r._popContext(),s===a){r._pushContext();var u=t.reject(a.e);return r._popContext(),u}var c=o(s,r);if(c instanceof t)return c}return null}(i,this._yieldHandlers,this._promise))){var s=(i=i._target())._bitField;0==(50397184&s)?(this._yieldedPromise=i,i._proxy(this,null)):0!=(33554432&s)?t._async.invoke(this._promiseFulfilled,this,i._value()):0!=(16777216&s)?t._async.invoke(this._promiseRejected,this,i._reason()):this._promiseCancelled()}else this._promiseRejected(new u("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(r))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},t.coroutine=function(t,e){if("function"!=typeof t)throw new u("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(e).yieldHandler,r=p,o=(new Error).stack;return function(){var e=t.apply(this,arguments),i=new r(void 0,void 0,n,o),s=i.promise();return i._generator=e,i._promiseFulfilled(void 0),s}},t.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new u("expecting a function but got "+c.classString(t));h.push(t)},t.spawn=function(n){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof n)return e("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new p(n,this),o=r.promise();return r._run(t.spawn),o}}},function(t,e,n){"use strict";t.exports=function(t){var e=n(7),r=t._async,o=e.tryCatch,i=e.errorObj;function s(t,n){if(!e.isArray(t))return u.call(this,t,n);var s=o(n).apply(this._boundValue(),[null].concat(t));s===i&&r.throwLater(s.e)}function u(t,e){var n=this._boundValue(),s=void 0===t?o(e).call(n,null):o(e).call(n,null,t);s===i&&r.throwLater(s.e)}function c(t,e){if(!t){var n=new Error(t+"");n.cause=t,t=n}var s=o(e).call(this._boundValue(),t);s===i&&r.throwLater(s.e)}t.prototype.asCallback=t.prototype.nodeify=function(t,e){if("function"==typeof t){var n=u;void 0!==e&&Object(e).spread&&(n=s),this._then(n,c,void 0,this,t)}return this}}},function(t,e,n){"use strict";t.exports=function(t,e){var r={},o=n(7),i=n(164),s=o.withAppended,u=o.maybeWrapAsError,c=o.canEvaluate,a=n(35).TypeError,l={__isPromisified__:!0},h=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),p=function(t){return o.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t};function f(t){return!h.test(t)}function d(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function m(t,e,n){var r=o.getDataPropertyOrDefault(t,e+n,l);return!!r&&d(r)}function g(t,e,n,r){for(var i=o.inheritedDataKeys(t),s=[],u=0;u<i.length;++u){var c=i[u],l=t[c],h=r===p||p(c,l,t);"function"!=typeof l||d(l)||m(t,c,e)||!r(c,l,t,h)||s.push(c,l)}return function(t,e,n){for(var r=0;r<t.length;r+=2){var o=t[r];if(n.test(o))for(var i=o.replace(n,""),s=0;s<t.length;s+=2)if(t[s]===i)throw new a("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}(s,e,n),s}var y=function(t){return t.replace(/([$])/,"\\$")},_=function(t){return o.filledRange(t,"_arg","")};var v=c?function(n,c,a,l,h,p){var f=Math.max(0,function(t){return"number"==typeof t.length?Math.max(Math.min(t.length,1024),0):0}(l)-1),d=function(t){for(var e=[t],n=Math.max(0,t-1-3),r=t-1;r>=n;--r)e.push(r);for(r=t+1;r<=3;++r)e.push(r);return e}(f),m="string"==typeof n||c===r;var g="string"==typeof n?"this != null ? this['"+n+"'] : fn":"fn",y="'use strict';                                                \n        var ret = function (Parameters) {                                    \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            var nodeback = nodebackForPromise(promise, "+p+");   \n            var ret;                                                         \n            var callback = tryCatch([GetFunctionCode]);                      \n            switch(len) {                                                    \n                [CodeForSwitchCase]                                          \n            }                                                                \n            if (ret === errorObj) {                                          \n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n            }                                                                \n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n            return promise;                                                  \n        };                                                                   \n        notEnumerableProp(ret, '__isPromisified__', true);                   \n        return ret;                                                          \n    ".replace("[CodeForSwitchCase]",function(){for(var t,e,n,r="",o=0;o<d.length;++o)r+="case "+d[o]+":"+(t=d[o],e=void 0,n=void 0,e=_(t).join(", "),n=t>0?", ":"",(m?"ret = callback.call(this, {{args}}, nodeback); break;\n":void 0===c?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n").replace("{{args}}",e).replace(", ",n));return r+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = nodeback;                                              \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",m?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n")}()).replace("[GetFunctionCode]",g);return y=y.replace("Parameters",function(t){return o.filledRange(Math.max(t,3),"_arg","")}(f)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",y)(t,l,c,s,u,i,o.tryCatch,o.errorObj,o.notEnumerableProp,e)}:function(n,c,a,l,h,p){var f=function(){return this}(),d=n;function m(){var o=c;c===r&&(o=this);var a=new t(e);a._captureStackTrace();var l="string"==typeof d&&this!==f?this[d]:n,h=i(a,p);try{l.apply(o,s(arguments,h))}catch(t){a._rejectCallback(u(t),!0,!0)}return a._isFateSealed()||a._setAsyncGuaranteed(),a}return"string"==typeof d&&(n=l),o.notEnumerableProp(m,"__isPromisified__",!0),m};function w(t,e,n,i,s){for(var u=new RegExp(y(e)+"$"),c=g(t,e,u,n),a=0,l=c.length;a<l;a+=2){var h=c[a],p=c[a+1],f=h+e;if(i===v)t[f]=v(h,r,h,p,e,s);else{var d=i(p,function(){return v(h,r,h,p,e,s)});o.notEnumerableProp(d,"__isPromisified__",!0),t[f]=d}}return o.toFastProperties(t),t}t.promisify=function(t,e){if("function"!=typeof t)throw new a("expecting a function but got "+o.classString(t));if(d(t))return t;var n=function(t,e,n){return v(t,e,void 0,t,null,n)}(t,void 0===(e=Object(e)).context?r:e.context,!!e.multiArgs);return o.copyDescriptors(t,n,f),n},t.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new a("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(e=Object(e)).multiArgs,r=e.suffix;"string"!=typeof r&&(r="Async");var i=e.filter;"function"!=typeof i&&(i=p);var s=e.promisifier;if("function"!=typeof s&&(s=v),!o.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var u=o.inheritedDataKeys(t),c=0;c<u.length;++c){var l=t[u[c]];"constructor"!==u[c]&&o.isClass(l)&&(w(l.prototype,r,i,s,n),w(l,r,i,s,n))}return w(t,r,i,s,n)}}},function(t,e,n){"use strict";t.exports=function(t,e,r,o){var i,s=n(7),u=s.isObject,c=n(46);"function"==typeof Map&&(i=Map);var a=function(){var t=0,e=0;function n(n,r){this[t]=n,this[t+e]=r,t++}return function(r){e=r.size,t=0;var o=new Array(2*r.size);return r.forEach(n,o),o}}();function l(t){var e,n=!1;if(void 0!==i&&t instanceof i)e=a(t),n=!0;else{var r=c.keys(t),o=r.length;e=new Array(2*o);for(var s=0;s<o;++s){var u=r[s];e[s]=t[u],e[s+o]=u}}this.constructor$(e),this._isMap=n,this._init$(void 0,n?-6:-3)}function h(e){var n,i=r(e);return u(i)?(n=i instanceof t?i._then(t.props,void 0,void 0,void 0,void 0):new l(i).promise(),i instanceof t&&n._propagateFrom(i,2),n):o("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}s.inherits(l,e),l.prototype._init=function(){},l.prototype._promiseFulfilled=function(t,e){if(this._values[e]=t,++this._totalResolved>=this._length){var n;if(this._isMap)n=function(t){for(var e=new i,n=t.length/2|0,r=0;r<n;++r){var o=t[n+r],s=t[r];e.set(o,s)}return e}(this._values);else{n={};for(var r=this.length(),o=0,s=this.length();o<s;++o)n[this._values[o+r]]=this._values[o]}return this._resolve(n),!0}return!1},l.prototype.shouldCopyValues=function(){return!1},l.prototype.getActualLength=function(t){return t>>1},t.prototype.props=function(){return h(this)},t.props=function(t){return h(t)}}},function(t,e,n){"use strict";t.exports=function(t,e,r,o){var i=n(7),s=function(t){return t.then(function(e){return u(e,t)})};function u(n,u){var c=r(n);if(c instanceof t)return s(c);if(null===(n=i.asArray(n)))return o("expecting an array or an iterable object but got "+i.classString(n));var a=new t(e);void 0!==u&&a._propagateFrom(u,3);for(var l=a._fulfill,h=a._reject,p=0,f=n.length;p<f;++p){var d=n[p];(void 0!==d||p in n)&&t.cast(d)._then(l,h,void 0,a,null)}return a}t.race=function(t){return u(t,void 0)},t.prototype.race=function(){return u(this,void 0)}}},function(t,e,n){"use strict";t.exports=function(t,e,r,o,i,s){var u=t._getDomain,c=n(7),a=c.tryCatch;function l(e,n,r,o){this.constructor$(e);var s=u();this._fn=null===s?n:c.domainBind(s,n),void 0!==r&&(r=t.resolve(r))._attachCancellationCallback(this),this._initialValue=r,this._currentCancellable=null,this._eachValues=o===i?Array(this._length):0===o?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function h(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function p(t,e,n,o){return"function"!=typeof e?r("expecting a function but got "+c.classString(e)):new l(t,e,n,o).promise()}function f(e){this.accum=e,this.array._gotAccum(e);var n=o(this.value,this.array._promise);return n instanceof t?(this.array._currentCancellable=n,n._then(d,void 0,void 0,this,void 0)):d.call(this,n)}function d(e){var n,r=this.array,o=r._promise,i=a(r._fn);o._pushContext(),(n=void 0!==r._eachValues?i.call(o._boundValue(),e,this.index,this.length):i.call(o._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(r._currentCancellable=n);var u=o._popContext();return s.checkForgottenReturns(n,u,void 0!==r._eachValues?"Promise.each":"Promise.reduce",o),n}c.inherits(l,e),l.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==i&&this._eachValues.push(t)},l.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},l.prototype._init=function(){},l.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},l.prototype.shouldCopyValues=function(){return!1},l.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},l.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},l.prototype._iterate=function(e){var n,r;this._values=e;var o=e.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=t.resolve(e[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<o;++r){var i={accum:null,value:e[r],index:r,length:o,array:this};n=n._then(f,void 0,void 0,i,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(h,h,void 0,n,this)},t.prototype.reduce=function(t,e){return p(this,t,e,null)},t.reduce=function(t,e,n,r){return p(t,e,n,r)}}},function(t,e,n){"use strict";t.exports=function(t,e,r){var o=t.PromiseInspection;function i(t){this.constructor$(t)}n(7).inherits(i,e),i.prototype._promiseResolved=function(t,e){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(t,e){var n=new o;return n._bitField=33554432,n._settledValueField=t,this._promiseResolved(e,n)},i.prototype._promiseRejected=function(t,e){var n=new o;return n._bitField=16777216,n._settledValueField=t,this._promiseResolved(e,n)},t.settle=function(t){return r.deprecated(".settle()",".reflect()"),new i(t).promise()},t.prototype.settle=function(){return t.settle(this)}}},function(t,e,n){"use strict";t.exports=function(t,e,r){var o=n(7),i=n(35).RangeError,s=n(35).AggregateError,u=o.isArray,c={};function a(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function l(t,e){if((0|e)!==e||e<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new a(t),o=n.promise();return n.setHowMany(e),n.init(),o}o.inherits(a,e),a.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var t=u(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},a.prototype.init=function(){this._initialized=!0,this._init()},a.prototype.setUnwrap=function(){this._unwrap=!0},a.prototype.howMany=function(){return this._howMany},a.prototype.setHowMany=function(t){this._howMany=t},a.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},a.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},a.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(c),this._checkOutcome())},a.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new s,e=this.length();e<this._values.length;++e)this._values[e]!==c&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},a.prototype._fulfilled=function(){return this._totalResolved},a.prototype._rejected=function(){return this._values.length-this.length()},a.prototype._addRejected=function(t){this._values.push(t)},a.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},a.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},a.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new i(e)},a.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(t,e){return l(t,e)},t.prototype.some=function(t){return l(this,t)},t._SomePromiseArray=a}},function(t,e,n){"use strict";t.exports=function(t,e){var n=t.map;t.prototype.filter=function(t,r){return n(this,t,r,e)},t.filter=function(t,r,o){return n(t,r,o,e)}}},function(t,e,n){"use strict";t.exports=function(t,e){var n=t.reduce,r=t.all;function o(){return r(this)}t.prototype.each=function(t){return n(this,t,e,0)._then(o,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return n(this,t,e,e)},t.each=function(t,r){return n(t,r,e,0)._then(o,void 0,void 0,t,void 0)},t.mapSeries=function(t,r){return n(t,r,e,e)}}},function(t,e,n){"use strict";t.exports=function(t){var e=t._SomePromiseArray;function n(t){var n=new e(t),r=n.promise();return n.setHowMany(1),n.setUnwrap(),n.init(),r}t.any=function(t){return n(t)},t.prototype.any=function(){return n(this)}}},function(t,e){var n=null!=global.Map?global.Map:function(){},r=["__proto__","constructor","prototype"];
/*!
 * Returns the value passed to it.
 */
function o(t){return t}e.get=function(t,r,i,s){var u;"function"==typeof i&&(i.length<2?(s=i,i=void 0):(u=i,i=void 0)),s||(s=o);var c="string"==typeof t?t.split("."):t;if(!Array.isArray(c))throw new TypeError("Invalid `path`. Must be either string or array");for(var a,l=r,h=0;h<c.length;++h){if(a=c[h],Array.isArray(l)&&!/^\d+$/.test(a)){var p=c.slice(h);return l.map(function(t){return t?e.get(p,t,i||u,s):s(void 0)})}if(u)l=u(l,a);else{var f=i&&l[i]?l[i]:l;l=f instanceof n?f.get(a):f[a]}if(!l)return s(l)}return s(l)},e.has=function(t,e){var n="string"==typeof t?t.split("."):t;if(!Array.isArray(n))throw new TypeError("Invalid `path`. Must be either string or array");for(var r=n.length,o=e,i=0;i<r;++i){if(null==o||"object"!=typeof o||!(n[i]in o))return!1;o=o[n[i]]}return!0},e.unset=function(t,e){var o="string"==typeof t?t.split("."):t;if(!Array.isArray(o))throw new TypeError("Invalid `path`. Must be either string or array");for(var i=o.length,s=e,u=0;u<i;++u){if(null==s||"object"!=typeof s||!(o[u]in s))return!1;if(-1!==r.indexOf(o[u]))return!1;if(u===i-1)return delete s[o[u]],!0;s=s instanceof n?s.get(o[u]):s[o[u]]}return!0},e.set=function(t,i,s,u,c,a){var l;"function"==typeof u&&(u.length<2?(c=u,u=void 0):(l=u,u=void 0)),c||(c=o);var h="string"==typeof t?t.split("."):t;if(!Array.isArray(h))throw new TypeError("Invalid `path`. Must be either string or array");if(null!=s){for(var p=0;p<h.length;++p)if(-1!==r.indexOf(h[p]))return;for(var f,d=a||/\$/.test(t)&&!1!==a,m=s,g=(p=0,h.length-1);p<g;++p)if("$"!=(f=h[p])){if(Array.isArray(m)&&!/^\d+$/.test(f)){var y=h.slice(p);if(!d&&Array.isArray(i))for(var _=0;_<m.length&&_<i.length;++_)e.set(y,i[_],m[_],u||l,c,d);else for(_=0;_<m.length;++_)e.set(y,i,m[_],u||l,c,d);return}if(l)m=l(m,f);else{var v=u&&m[u]?m[u]:m;m=v instanceof n?v.get(f):v[f]}if(!m)return}else if(p==g-1)break;if(f=h[g],u&&m[u]&&(m=m[u]),Array.isArray(m)&&!/^\d+$/.test(f))if(!d&&Array.isArray(i)){var w;for(_=0;_<m.length&&_<i.length;++_)(w=m[_])&&(l?l(w,f,c(i[_])):(w[u]&&(w=w[u]),w[f]=c(i[_])))}else for(_=0;_<m.length;++_)(w=m[_])&&(l?l(w,f,c(i)):(w[u]&&(w=w[u]),w[f]=c(i)));else l?l(m,f,c(i)):m instanceof n?m.set(f,c(i)):m[f]=c(i)}}},function(t,e){var n=1e3,r=60*n,o=60*r,i=24*o,s=365.25*i;function u(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}t.exports=function(t,e){e=e||{};var c,a=typeof t;if("string"===a&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var u=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return u*s;case"days":case"day":case"d":return u*i;case"hours":case"hour":case"hrs":case"hr":case"h":return u*o;case"minutes":case"minute":case"mins":case"min":case"m":return u*r;case"seconds":case"second":case"secs":case"sec":case"s":return u*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}(t);if("number"===a&&!1===isNaN(t))return e.long?u(c=t,i,"day")||u(c,o,"hour")||u(c,r,"minute")||u(c,n,"second")||c+" ms":function(t){if(t>=i)return Math.round(t/i)+"d";if(t>=o)return Math.round(t/o)+"h";if(t>=r)return Math.round(t/r)+"m";if(t>=n)return Math.round(t/n)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){"use strict";
/*!
 * Dependencies
 */const r=n(309).ctor("require","modify","init","default","ignore");t.exports=function(){this.strictMode=void 0,this.selected=void 0,this.shardval=void 0,this.saveError=void 0,this.validationError=void 0,this.adhocPaths=void 0,this.removing=void 0,this.inserting=void 0,this.saving=void 0,this.version=void 0,this.getters={},this._id=void 0,this.populate=void 0,this.populated=void 0,this.wasPopulated=!1,this.scope=void 0,this.activePaths=new r,this.pathsToScopes={},this.cachedRequired={},this.session=null,this.ownerDocument=void 0,this.fullPath=void 0}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(5),o=t.exports=function(){};
/*!
 * StateMachine represents a minimal `interface` for the
 * constructors it builds via StateMachine.ctor(...).
 *
 * @api private
 */
/*!
 * StateMachine.ctor('state1', 'state2', ...)
 * A factory method for subclassing StateMachine.
 * The arguments are a list of states. For each state,
 * the constructor's prototype gets state transition
 * methods named after each state. These transition methods
 * place their path argument into the given state.
 *
 * @param {String} state
 * @param {String} [state]
 * @return {Function} subclass constructor
 * @private
 */
o.ctor=function(){const t=r.args(arguments),e=function(){o.apply(this,arguments),this.paths={},this.states={},this.stateNames=t;let e,n=t.length;for(;n--;)e=t[n],this.states[e]={}};return e.prototype=new o,t.forEach(function(t){e.prototype[t]=function(e){this._changeState(e,t)}}),e},
/*!
 * This function is wrapped by the state change functions:
 *
 * - `require(path)`
 * - `modify(path)`
 * - `init(path)`
 *
 * @api private
 */
o.prototype._changeState=function(t,e){const n=this.states[this.paths[t]];n&&delete n[t],this.paths[t]=e,this.states[e][t]=!0},
/*!
 * ignore
 */
o.prototype.clear=function(t){const e=Object.keys(this.states[t]);let n,r=e.length;for(;r--;)n=e[r],delete this.states[t][n],delete this.paths[n]},
/*!
 * Checks to see if at least one path is in the states passed in via `arguments`
 * e.g., this.some('required', 'inited')
 *
 * @param {String} state that we want to check for.
 * @private
 */
o.prototype.some=function(){const t=this,e=arguments.length?arguments:this.stateNames;return Array.prototype.some.call(e,function(e){return Object.keys(t.states[e]).length})},
/*!
 * This function builds the functions that get assigned to `forEach` and `map`,
 * since both of those methods share a lot of the same logic.
 *
 * @param {String} iterMethod is either 'forEach' or 'map'
 * @return {Function}
 * @api private
 */
o.prototype._iter=function(t){return function(){const e=arguments.length;let n=r.args(arguments,0,e-1);const o=arguments[e-1];n.length||(n=this.stateNames);const i=this;return n.reduce(function(t,e){return t.concat(Object.keys(i.states[e]))},[])[t](function(t,e,n){return o(t,e,n)})}},
/*!
 * Iterates over the paths that belong to one of the parameter states.
 *
 * The function profile can look like:
 * this.forEach(state1, fn);         // iterates over all paths in state1
 * this.forEach(state1, state2, fn); // iterates over all paths in state1 or state2
 * this.forEach(fn);                 // iterates over all paths in all states
 *
 * @param {String} [state]
 * @param {String} [state]
 * @param {Function} callback
 * @private
 */
o.prototype.forEach=function(){return this.forEach=this._iter("forEach"),this.forEach.apply(this,arguments)},
/*!
 * Maps over the paths that belong to one of the parameter states.
 *
 * The function profile can look like:
 * this.forEach(state1, fn);         // iterates over all paths in state1
 * this.forEach(state1, state2, fn); // iterates over all paths in state1 or state2
 * this.forEach(fn);                 // iterates over all paths in all states
 *
 * @param {String} [state]
 * @param {String} [state]
 * @param {Function} callback
 * @return {Array}
 * @private
 */
o.prototype.map=function(){return this.map=this._iter("map"),this.map.apply(this,arguments)}},function(t,e,n){"use strict";const r=t.exports={};r.DocumentNotFoundError=null,r.general={},r.general.default="Validator failed for path `{PATH}` with value `{VALUE}`",r.general.required="Path `{PATH}` is required.",r.Number={},r.Number.min="Path `{PATH}` ({VALUE}) is less than minimum allowed value ({MIN}).",r.Number.max="Path `{PATH}` ({VALUE}) is more than maximum allowed value ({MAX}).",r.Date={},r.Date.min="Path `{PATH}` ({VALUE}) is before minimum allowed value ({MIN}).",r.Date.max="Path `{PATH}` ({VALUE}) is after maximum allowed value ({MAX}).",r.String={},r.String.enum="`{VALUE}` is not a valid enum value for path `{PATH}`.",r.String.match="Path `{PATH}` is invalid ({VALUE}).",r.String.minlength="Path `{PATH}` (`{VALUE}`) is shorter than the minimum allowed length ({MINLENGTH}).",r.String.maxlength="Path `{PATH}` (`{VALUE}`) is longer than the maximum allowed length ({MAXLENGTH})."},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(9);function o(t){let e=t.message;e||(e=r.messages.general.default);const n=this.formatMessage(e,t);r.call(this,n),t=Object.assign({},t,{message:n}),this.name="ValidatorError",Error.captureStackTrace?Error.captureStackTrace(this):this.stack=(new Error).stack,this.properties=t,this.kind=t.type,this.path=t.path,this.value=t.value,this.reason=t.reason}
/*!
 * Inherits from MongooseError
 */o.prototype=Object.create(r.prototype),o.prototype.constructor=r,
/*!
 * The object used to define this validator. Not enumerable to hide
 * it from `require('util').inspect()` output re: gh-3925
 */
Object.defineProperty(o.prototype,"properties",{enumerable:!1,writable:!0,value:null}),
/*!
 * Formats error messages
 */
o.prototype.formatMessage=function(t,e){if("function"==typeof t)return t(e);const n=Object.keys(e);for(let r=0;r<n.length;++r){const o=n[r];"message"!==o&&(t=t.replace("{"+o.toUpperCase()+"}",e[o]))}return t},
/*!
 * toString helper
 */
o.prototype.toString=function(){return this.message},
/*!
 * exports
 */
t.exports=o},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(9);function o(t,e,n){const o=n.join(", ");r.call(this,'No matching document found for id "'+t._id+'" version '+e+' modifiedPaths "'+o+'"'),this.name="VersionError",this.version=e,this.modifiedPaths=n}
/*!
 * Inherits from MongooseError.
 */o.prototype=Object.create(r.prototype),o.prototype.constructor=r,
/*!
 * exports
 */
t.exports=o},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(9);function o(t){r.call(this,"Can't save() the same doc multiple times in parallel. Document: "+t.id),this.name="ParallelSaveError"}
/*!
 * Inherits from MongooseError.
 */o.prototype=Object.create(r.prototype),o.prototype.constructor=r,
/*!
 * exports
 */
t.exports=o},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(9);
/*!
 * OverwriteModel Error constructor.
 *
 * @inherits MongooseError
 */function o(t){r.call(this,"Cannot overwrite `"+t+"` model once compiled."),this.name="OverwriteModelError",Error.captureStackTrace?Error.captureStackTrace(this):this.stack=(new Error).stack}
/*!
 * Inherits from MongooseError.
 */o.prototype=Object.create(r.prototype),o.prototype.constructor=r,
/*!
 * exports
 */
t.exports=o},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(9);
/*!
 * MissingSchema Error constructor.
 *
 * @inherits MongooseError
 */function o(t){const e="Schema hasn't been registered for model \""+t+'".\nUse mongoose.model(name, schema)';r.call(this,e),this.name="MissingSchemaError",Error.captureStackTrace?Error.captureStackTrace(this):this.stack=(new Error).stack}
/*!
 * Inherits from MongooseError.
 */o.prototype=Object.create(r.prototype),o.prototype.constructor=r,
/*!
 * exports
 */
t.exports=o},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(9);
/*!
 * DivergentArrayError constructor.
 *
 * @inherits MongooseError
 */function o(t){const e="For your own good, using `document.save()` to update an array which was selected using an $elemMatch projection OR populated using skip, limit, query conditions, or exclusion of the _id field when the operation results in a $pop or $set of the entire array is not supported. The following path(s) would have been modified unsafely:\n  "+t.join("\n  ")+"\nUse Model.update() to update these arrays instead.";r.call(this,e),this.name="DivergentArrayError",Error.captureStackTrace?Error.captureStackTrace(this):this.stack=(new Error).stack}
/*!
 * Inherits from MongooseError.
 */o.prototype=Object.create(r.prototype),o.prototype.constructor=r,
/*!
 * exports
 */
t.exports=o},function(t,e,n){"use strict";const r=n(8);
/*!
 * Like `schema.path()`, except with a document, because impossible to
 * determine path type without knowing the embedded discriminator key.
 */t.exports=function(t,e,n){const o=(n=n||{}).typeOnly,i=e.split(".");let s=null,u="adhocOrUndefined";for(let e=0;e<i.length;++e){const n=i.slice(0,e+1).join(".");if(null!=(s=t.schema.path(n))&&(u=t.schema.pathType(n),(s.$isSingleNested||s.$isMongooseDocumentArrayElement)&&null!=s.schema.discriminators)){const o=s.schema.discriminators,c=t.get(n+"."+r(s,"schema.options.discriminatorKey"));if(null==c||null==o[c])continue;const a=i.slice(e+1).join(".");if(null!=(s=o[c].path(a))){u=o[c].pathType(a);break}}}return o?u:s}},function(t,e,n){"use strict";
/*!
 * ignore
 */
/*!
 * Returns this documents _id cast to a string.
 */
function r(){return null!=this._id?String(this._id):null}t.exports=function(t){!t.paths.id&&!t.options.noVirtualId&&t.options.id&&t.virtual("id").get(r)}},function(t,e,n){"use strict";const r=n(58);
/*!
 * ignore
 */t.exports=function(t){const e=Object.keys(t);let n=e.length,o=null;if(1===n&&"_id"===e[0])o=!!t[e[n]];else for(;n--;)if("_id"!==e[n]&&r(t[e[n]])){o=!t[e[n]];break}return o}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(16),o=n(10).EventEmitter,i=n(9),s=n(88),u=n(38),c=i.ValidationError,a=n(113),l=n(5);function h(t,e,n,o,c){if(!(this instanceof h))return new h(t,e,n,o,c);if(l.isObject(e)&&!e.instanceOfSchema&&(e=new s(e)),e=this.schema||e,!this.schema&&e.options._id&&void 0===(t=t||{})._id&&(t._id=new u),!e)throw new i.MissingSchemaError;this.$__setSchema(e),r.call(this,t,n,o,c),a(this,e,{decorateDoc:!0});for(const t in e.methods)this[t]=e.methods[t];for(const t in e.statics)this[t]=e.statics[t]}
/*!
 * Inherit from the NodeJS document
 */h.prototype=Object.create(r.prototype),h.prototype.constructor=h,
/*!
 * ignore
 */
h.events=new o,
/*!
 * Browser doc exposes the event emitter API
 */
h.$emitter=new o,l.each(["on","once","emit","listeners","removeListener","setMaxListeners","removeAllListeners","addListener"],function(t){h[t]=function(){return h.$emitter[t].apply(h.$emitter,arguments)}}),
/*!
 * Module exports.
 */
h.ValidationError=c,t.exports=h},function(t,e,n){"use strict";const r=n(8),o=n(5);
/*!
 * Gather all indexes defined in the schema, including single nested,
 * document arrays, and embedded discriminators.
 */
t.exports=function(t){let e=[];const n=new WeakMap,i=t.constructor.indexTypes,s=function(t,u){if(n.has(t))return;n.set(t,!0),u=u||"";const c=Object.keys(t.paths),a=c.length;for(let n=0;n<a;++n){const a=c[n],l=t.paths[a];if(l.$isMongooseDocumentArray||l.$isSingleNested){if(!0!==r(l,"options.excludeIndexes")&&!0!==r(l,"schemaOptions.excludeIndexes")&&s(l.schema,u+a+"."),null!=l.schema.discriminators){const t=l.schema.discriminators,e=Object.keys(t);for(const n of e)s(t[n]._originalSchema,u+a+".")}if(l.$isMongooseDocumentArray)continue}const h=l._index||l.caster&&l.caster._index;if(!1!==h&&null!=h){const t={},n=o.isObject(h),r=n?h:{},s="string"==typeof h?h:!!n&&h.type;s&&-1!==i.indexOf(s)?t[u+a]=s:r.text?(t[u+a]="text",delete r.text):t[u+a]=1,delete r.type,"background"in r||(r.background=!0),e.push([t,r])}}n.delete(t),u?
/*!
   * Checks for indexes added to subdocs using Schema.index().
   * These indexes need their paths prefixed properly.
   *
   * schema._indexes = [ [indexObj, options], [indexObj, options] ..]
   */
function(t,n){const r=t._indexes,o=r.length;for(let t=0;t<o;++t){const o=r[t][0],i=Object.keys(o),s=i.length,u={};for(let t=0;t<s;++t){const e=i[t];u[n+e]=o[e]}e.push([u,r[t][1]])}}(t,u):(t._indexes.forEach(function(t){"background"in t[1]||(t[1].background=!0)}),e=e.concat(t._indexes))};return s(t),e}},function(t,e,n){"use strict";t.exports=function(t,e){t.add(e.obj),t.callQueue=t.callQueue.concat(e.callQueue),t.method(e.methods),t.static(e.statics);for(const n in e.query)t.query[n]=e.query[n];for(const n in e.virtuals)t.virtual[n]=e.virtual[n].clone();t.s.hooks.merge(e.s.hooks,!1)}},function(t,e,n){"use strict";const r=n(86),o=n(0);t.exports=function(t,e){if("string"==typeof t)return;if("function"==typeof t)return;throw new r('Invalid ref at path "'+e+'". Got '+o.inspect(t,{depth:0}))}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(116),o=n(24),i=n(10).EventEmitter,s=n(19),u=n(120),c=n(0),a=n(5),l=n(31).getDiscriminatorByValue;let h,p;function f(t,e,n,o){const i=d(e,n);i.prototype.$basePath=t,r.call(this,t,i,n),this.schema=e,this.schemaOptions=o||{},this.$isMongooseDocumentArray=!0,this.Constructor=i,i.base=e.base;const s=this.defaultValue;"defaultValue"in this&&void 0===s||this.default(function(){let t=s.call(this);return Array.isArray(t)||(t=[t]),t})}
/*!
 * Ignore
 */
function d(t,e){function r(){p.apply(this,arguments),this.$session(this.ownerDocument().$session())}p||(p=n(59)),r.prototype=Object.create(p.prototype),r.prototype.$__setSchema(t),r.schema=t,r.prototype.constructor=r,r.$isArraySubdocument=!0,r.events=new i;for(const e in t.methods)r.prototype[e]=t.methods[e];for(const e in t.statics)r[e]=t.statics[e];for(const t in i.prototype)r[t]=i.prototype[t];return r.options=e,r}
/*!
 * Ignore
 */
/*!
 * Removes listeners from parent
 */
function m(t){if(null!=t&&null!=t._parent)for(const e in t._handlers)t._parent.removeListener(e,t._handlers[e])}
/*!
 * Scopes paths selected in a query to this array.
 * Necessary for proper default application of subdocument values.
 *
 * @param {DocumentArray} array - the array to scope `fields` paths
 * @param {Object|undefined} fields - the root fields selected in the query
 * @param {Boolean|undefined} init - if we are being created part of a query result
 */function g(t,e,n){if(!n||!e)return;const r=t.path+".",o=Object.keys(e);let i=o.length;const s={};let u,c,a;for(;i--;)if(0===(c=o[i]).indexOf(r)){if("$"===(a=c.substring(r.length)))continue;0===a.indexOf("$.")&&(a=a.substr(2)),u||(u=!0),s[a]=e[c]}return u&&s||void 0}
/*!
 * Module exports.
 */f.schemaName="DocumentArray",f.options={castNonArrays:!0},
/*!
 * Inherits from ArrayType.
 */
f.prototype=Object.create(r.prototype),f.prototype.constructor=f,f.prototype.discriminator=function(t,e){"function"==typeof t&&(t=a.getFunctionName(t));const n=d(e=u(this.casterConstructor,t,e));n.baseCasterConstructor=this.casterConstructor;try{Object.defineProperty(n,"name",{value:t})}catch(t){}return this.casterConstructor.discriminators[t]=n,this.casterConstructor.discriminators[t]},f.prototype.doValidate=function(t,e,r,o){h||(h=n(40));const i=this;try{s.prototype.doValidate.call(this,t,function(n){if(n)return n.$isArrayValidatorError=!0,e(n);let s,u=t&&t.length;if(!u)return e();if(o&&o.updateValidator)return e();t.isMongooseDocumentArray||(t=new h(t,i.path,r));function c(t){null!=t&&"ValidationError"!==(s=t).name&&(s.$isArrayValidatorError=!0),--u||e(s)}for(let n=0,r=u;n<r;++n){let r=t[n];null!=r?(r instanceof p||(r=t[n]=new i.casterConstructor(r,t,void 0,void 0,n)),r.$__validate(c)):--u||e(s)}},r)}catch(t){return t.$isArrayValidatorError=!0,e(t)}},f.prototype.doValidateSync=function(t,e){const n=s.prototype.doValidateSync.call(this,t,e);if(null!=n)return n.$isArrayValidatorError=!0,n;const r=t&&t.length;let o=null;if(r){for(let e=0,n=r;e<n;++e){let n=t[e];if(!n)continue;n instanceof p||(n=t[e]=new this.casterConstructor(n,t,void 0,void 0,e));const r=n.validateSync();r&&null==o&&(o=r)}return o}},
/*!
 * ignore
 */
f.prototype.getDefault=function(t){let e="function"==typeof this.defaultValue?this.defaultValue.call(t):this.defaultValue;if(null==e)return e;h||(h=n(40)),Array.isArray(e)||(e=[e]);const r=(e=new h(e,this.path,t))._parent;e._parent=null;for(let t=0;t<e.length;++t)e[t]=new this.Constructor(e[t],e,void 0,void 0,t);return e._parent=r,e},f.prototype.cast=function(t,e,r,i,s){let u,d,y;h||(h=n(40));const _={transform:!1,virtuals:!1};if(!Array.isArray(t)){if(!r&&!f.options.castNonArrays)throw new o("DocumentArray",c.inspect(t),this.path);return e&&r&&e.markModified(this.path),this.cast([t],e,r,i)}for(t&&t.isMongooseDocumentArray||s&&s.skipDocumentArrayCast?t&&t.isMongooseDocumentArray&&(t=new h(t,this.path,e)):(t=new h(t,this.path,e),m(i)),y=t.length;y--;){if(!t[y])continue;let n=this.casterConstructor;if(n.discriminators&&n.schema&&n.schema.options&&"string"==typeof t[y][n.schema.options.discriminatorKey])if(n.discriminators[t[y][n.schema.options.discriminatorKey]])n=n.discriminators[t[y][n.schema.options.discriminatorKey]];else{const e=l(n,t[y][n.schema.options.discriminatorKey]);e&&(n=e)}if(t[y].$__&&t[y].schema!==n.schema&&(t[y]=t[y].toObject({transform:!1,virtuals:!1})),!(t[y]instanceof p)&&t[y])if(r)e?u||(u=g(this,e.$__.selected,r)):u=!0,d=new n(null,t,!0,u,y),t[y]=d.init(t[y]);else if(i&&(d=i.id(t[y]._id))&&(d=i.id(t[y]._id)),i&&d&&a.deepEqual(d.toObject(_),t[y]))d.set(t[y]),t[y]=d;else try{d=new n(t[y],t,void 0,void 0,y),t[y]=d}catch(e){m(t);const n=c.inspect(t[y]);throw new o("embedded",n,t._path,e)}}return t},t.exports=f},function(t,e,n){"use strict";const r=n(29);t.exports=function(t){if(null==t||""===t)return null;if(t instanceof Date)return r.ok(!isNaN(t.valueOf())),t;let e;if(r.ok("boolean"!=typeof t),e=t instanceof Number||"number"==typeof t?new Date(t):"string"==typeof t&&!isNaN(Number(t))&&(Number(t)>=275761||Number(t)<-271820)?new Date(Number(t)):"function"==typeof t.valueOf?new Date(t.valueOf()):new Date(t),!isNaN(e.valueOf()))return e;r.ok(!1)}},function(t,e,n){"use strict";const r=n(24),o=n(109),i=n(177);
/*!
 * Casts val to an object suitable for `$text`. Throws an error if the object
 * can't be casted.
 *
 * @param {Any} val value to cast
 * @param {String} [path] path to associate with any errors that occured
 * @return {Object} casted object
 * @see https://docs.mongodb.com/manual/reference/operator/query/text/
 * @api private
 */
t.exports=function(t,e){if(null==t||"object"!=typeof t)throw new r("$text",t,e);return null!=t.$search&&(t.$search=i(t.$search,e+".$search")),null!=t.$language&&(t.$language=i(t.$language,e+".$language")),null!=t.$caseSensitive&&(t.$caseSensitive=o(t.$caseSensitive,e+".$castSensitive")),null!=t.$diacriticSensitive&&(t.$diacriticSensitive=o(t.$diacriticSensitive,e+".$diacriticSensitive")),t}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(24),o=n(10).EventEmitter,i=n(167),s=n(19),u=n(108),c=n(89).castToNumber,a=n(120),l=n(187),h=n(8),p=n(31).getDiscriminatorByValue,f=n(39).internalToObjectOptions;let d;function m(t,e,n){this.caster=g(t),this.caster.path=e,this.caster.prototype.$basePath=e,this.schema=t,this.$isSingleNested=!0,s.call(this,e,n,"Embedded")}
/*!
 * ignore
 */
/*!
 * ignore
 */
function g(t){d||(d=n(188));const e=function(t,e,n){const r=this;this.$parent=n,d.apply(this,arguments),this.$session(this.ownerDocument().$session()),n&&(n.on("save",function(){r.emit("save",r),r.constructor.emit("save",r)}),n.on("isNew",function(t){r.isNew=t,r.emit("isNew",t),r.constructor.emit("isNew",t)}))};(e.prototype=Object.create(d.prototype)).$__setSchema(t),e.prototype.constructor=e,e.schema=t,e.$isSingleNested=!0,e.events=new o,e.prototype.toBSON=function(){return this.toObject(f)};for(const n in t.methods)e.prototype[n]=t.methods[n];for(const n in t.statics)e[n]=t.statics[n];for(const t in o.prototype)e[t]=o.prototype[t];return e}
/*!
 * Special case for when users use a common location schema to represent
 * locations for use with $geoWithin.
 * https://docs.mongodb.org/manual/reference/operator/query/geoWithin/
 *
 * @param {Object} val
 * @api private
 */t.exports=m,m.prototype=Object.create(s.prototype),m.prototype.$conditionalHandlers.$geoWithin=function(t){return{$geometry:this.castForQuery(t.$geometry)}},
/*!
 * ignore
 */
m.prototype.$conditionalHandlers.$near=m.prototype.$conditionalHandlers.$nearSphere=l.cast$near,m.prototype.$conditionalHandlers.$within=m.prototype.$conditionalHandlers.$geoWithin=l.cast$within,m.prototype.$conditionalHandlers.$geoIntersects=l.cast$geoIntersects,m.prototype.$conditionalHandlers.$minDistance=c,m.prototype.$conditionalHandlers.$maxDistance=c,m.prototype.$conditionalHandlers.$exists=u,m.prototype.cast=function(t,e,n,r){if(t&&t.$isSingleNested)return t;if(null!=t&&("object"!=typeof t||Array.isArray(t)))throw new i(this.path,t);let o=this.caster;const s=o.schema.options.discriminatorKey;if(null!=t&&o.discriminators&&"string"==typeof t[s])if(o.discriminators[t[s]])o=o.discriminators[t[s]];else{const e=p(o,t[s]);e&&(o=e)}let u;const c=h(e,"$__.selected",{}),a=this.path,l=Object.keys(c).reduce((t,e)=>(e.startsWith(a+".")&&(t[e.substr(a.length+1)]=c[e]),t),{});return n?((u=new o(void 0,l,e)).init(t),u):0===Object.keys(t).length?new o({},l,e):new o(t,l,e,void 0,{priorDoc:r})},m.prototype.castForQuery=function(t,e){let n;if(2===arguments.length){if(!(n=this.$conditionalHandlers[t]))throw new Error("Can't use "+t);return n.call(this,e)}if(null==(e=t))return e;this.options.runSetters&&(e=this._applySetters(e));let o=this.caster;const i=o.schema.options.discriminatorKey;if(null!=e&&o.discriminators&&"string"==typeof e[i])if(o.discriminators[e[i]])o=o.discriminators[e[i]];else{const t=p(o,e[i]);t&&(o=t)}try{e=new o(e)}catch(t){if(!(t instanceof r))throw new r("Embedded",e,this.path,t);throw t}return e},m.prototype.doValidate=function(t,e,n,r){let o=this.caster;const i=o.schema.options.discriminatorKey;if(null!=t&&o.discriminators&&"string"==typeof t[i])if(o.discriminators[t[i]])o=o.discriminators[t[i]];else{const e=p(o,t[i]);e&&(o=e)}if(r&&r.skipSchemaValidators)return t instanceof o||(t=new o(t,null,n)),t.validate(e);s.prototype.doValidate.call(this,t,function(n){return n?e(n):t?void t.validate(e):e(null)},n)},m.prototype.doValidateSync=function(t,e,n){if(!n||!n.skipSchemaValidators){const n=s.prototype.doValidateSync.call(this,t,e);if(n)return n}if(t)return t.validateSync()},m.prototype.discriminator=function(t,e){return a(this.caster,t,e),this.caster.discriminators[t]=g(e),this.caster.discriminators[t]}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(19),o=r.CastError,i=n(83),s=n(329),u=n(5);let c;function a(t,e){r.call(this,t,e,"Decimal128")}
/*!
 * ignore
 */
function l(t){return this.cast(t)}a.schemaName="Decimal128",
/*!
 * Inherits from SchemaType.
 */
a.prototype=Object.create(r.prototype),a.prototype.constructor=a,
/*!
 * ignore
 */
a._cast=s,a.cast=function(t){return 0===arguments.length?this._cast:(!1===t&&(t=(t=>{if(null!=t&&!(t instanceof i))throw new Error;return t})),this._cast=t,this._cast)},
/*!
 * ignore
 */
a._checkRequired=(t=>t instanceof i),a.checkRequired=r.checkRequired,a.prototype.checkRequired=function(t,e){return r._isRef(this,t,e,!0)?!!t:this.constructor._checkRequired(t)},a.prototype.cast=function(t,e,s){if(r._isRef(this,t,e,s)){if(null==t)return t;if(c||(c=n(16)),t instanceof c)return t.$__.wasPopulated=!0,t;if(t instanceof i)return t;if(Buffer.isBuffer(t)||!u.isObject(t))throw new o("Decimal128",t,this.path);const r=e.$__fullPath(this.path),s=(e.ownerDocument?e.ownerDocument():e).populated(r,!0);let a=t;return e.$__.populated&&e.$__.populated[r]&&e.$__.populated[r].options&&e.$__.populated[r].options.options&&e.$__.populated[r].options.options.lean||((a=new s.options.model(t)).$__.wasPopulated=!0),a}const a=this.constructor.cast();try{return a(t)}catch(e){throw new o("Decimal128",t,this.path)}},a.prototype.$conditionalHandlers=u.options(r.prototype.$conditionalHandlers,{$gt:l,$gte:l,$lt:l,$lte:l}),
/*!
 * Module exports.
 */
t.exports=a},function(t,e,n){"use strict";const r=n(83),o=n(29);t.exports=function(t){return null==t?t:"object"==typeof t&&"string"==typeof t.$numberDecimal?r.fromString(t.$numberDecimal):t instanceof r?t:"string"==typeof t?r.fromString(t):Buffer.isBuffer(t)?new r(t):"number"==typeof t?r.fromString(String(t)):"function"==typeof t.valueOf&&"string"==typeof t.valueOf()?r.fromString(t.valueOf()):void o.ok(!1)}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=n(37).Decimal128},function(t,e,n){"use strict";
/*!
 * [node-mongodb-native](https://github.com/mongodb/node-mongodb-native) ObjectId
 * @constructor NodeMongoDbObjectId
 * @see ObjectId
 */const r=n(37).ObjectId;
/*!
 * ignore
 */t.exports=r},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(37).ReadPreference;
/*!
 * Converts arguments to ReadPrefs the driver
 * can understand.
 *
 * @param {String|Array} pref
 * @param {Array} [tags]
 */
t.exports=function(t,e){if(Array.isArray(t)&&(e=t[1],t=t[0]),t instanceof r)return t;switch(t){case"p":t="primary";break;case"pp":t="primaryPreferred";break;case"s":t="secondary";break;case"sp":t="secondaryPreferred";break;case"n":t="nearest"}return new r(t,e)}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(15).Readable,o=n(189),i=n(31),s=n(0),u=n(5);function c(t,e){r.call(this,{objectMode:!0}),this.cursor=null,this.query=t;const n=this,o=t.model;this._mongooseOptions={},this._transforms=[],this.model=o,o.hooks.execPre("find",t,()=>{this._transforms=this._transforms.concat(t._transforms.slice()),e.transform&&this._transforms.push(e.transform),o.collection.find(t._conditions,e,function(t,e){if(n._error&&(e.close(function(){}),n.listeners("error").length>0&&n.emit("error",n._error)),t)return n.emit("error",t);n.cursor=e,n.emit("cursor",e)})})}
/*!
 * Get the next doc from the underlying cursor and mongooseify it
 * (populate, etc.)
 */
function a(t,e){let n=e;return t._transforms.length&&(n=function(n,r){if(n||null===r&&!t._mongooseOptions.transformNull)return e(n,r);e(n,t._transforms.reduce(function(e,n){return n.call(t,e)},r))}),t._error?process.nextTick(function(){n(t._error)}):t.cursor?t.cursor.next(function(e,r){if(e)return n(e);if(!r)return n(null,null);const o=t.query._mongooseOptions;if(!o.populate)return o.lean?n(null,r):l(t,r,null,n);const s=i.preparePopulationOptionsMQ(t.query,t.query._mongooseOptions);s.__noPromise=!0,t.query.model.populate(r,s,function(e,r){return e?n(e):o.lean?n(null,r):l(t,r,s,n)})}):void t.once("cursor",function(){a(t,e)})}
/*!
 * ignore
 */
/*!
 * Convert a raw doc into a full mongoose doc.
 */
function l(t,e,n,r){const o=i.createModel(t.query.model,e,t.query._fields),s=n?{populated:n}:void 0;o.init(e,s,function(t){if(t)return r(t);r(null,o)})}s.inherits(c,r),
/*!
 * Necessary to satisfy the Readable API
 */
c.prototype._read=function(){const t=this;a(this,function(e,n){return e?t.emit("error",e):n?void t.push(n):(t.push(null),void t.cursor.close(function(e){if(e)return t.emit("error",e);setTimeout(function(){t.emit("close")},0)}))})},c.prototype.map=function(t){return this._transforms.push(t),this},
/*!
 * Marks this cursor as errored
 */
c.prototype._markError=function(t){return this._error=t,this},c.prototype.close=function(t){return u.promiseOrCallback(t,t=>{this.cursor.close(e=>{if(e)return t(e),this.listeners("error").length>0&&this.emit("error",e);this.emit("close"),t(null)})},this.model.events)},c.prototype.next=function(t){return u.promiseOrCallback(t,t=>{a(this,function(e,n){if(e)return t(e);t(null,n)})},this.model.events)},c.prototype.eachAsync=function(t,e,n){const r=this;return"function"==typeof e&&(n=e,e={}),o(function(t){return a(r,t)},t,e=e||{},n)},c.prototype.addCursorFlag=function(t,e){const n=this;return function(t,e){if(t.cursor)return e();t.once("cursor",function(){e()})}(this,function(){n.cursor.addCursorFlag(t,e)}),this},
/*!
 * ignore
 */
c.prototype.transformNull=function(t){return 0===arguments.length&&(t=!0),this._mongooseOptions.transformNull=t,this},t.exports=c},function(t,e,n){(function(t){(function(e){"use strict";function n(t,e){e|=0;for(var n=Math.max(t.length-e,0),r=Array(n),o=0;o<n;o++)r[o]=t[e+o];return r}var r=function(t){var e=n(arguments,1);return function(){var r=n(arguments);return t.apply(null,e.concat(r))}},o=function(t){return function(){var e=n(arguments),r=e.pop();t.call(this,e,r)}};function i(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var s="function"==typeof setImmediate&&setImmediate,u="object"==typeof process&&"function"==typeof process.nextTick;function c(t){setTimeout(t,0)}function a(t){return function(e){var r=n(arguments,1);t(function(){e.apply(null,r)})}}var l=a(s?setImmediate:u?process.nextTick:c);function h(t){return o(function(e,n){var r;try{r=t.apply(this,e)}catch(t){return n(t)}i(r)&&"function"==typeof r.then?r.then(function(t){p(n,null,t)},function(t){p(n,t.message?t:new Error(t))}):n(null,r)})}function p(t,e,n){try{t(e,n)}catch(t){l(f,t)}}function f(t){throw t}var d="function"==typeof Symbol;function m(t){return d&&"AsyncFunction"===t[Symbol.toStringTag]}function g(t){return m(t)?h(t):t}function y(t){return function(e){var r=n(arguments,1),i=o(function(n,r){var o=this;return t(e,function(t,e){g(t).apply(o,n.concat(e))},r)});return r.length?i.apply(this,r):i}}var _="object"==typeof global&&global&&global.Object===Object&&global,v="object"==typeof self&&self&&self.Object===Object&&self,w=_||v||Function("return this")(),b=w.Symbol,O=Object.prototype,S=O.hasOwnProperty,A=O.toString,C=b?b.toStringTag:void 0,T=Object.prototype.toString,E="[object Null]",N="[object Undefined]",$=b?b.toStringTag:void 0;function I(t){return null==t?void 0===t?N:E:$&&$ in Object(t)?function(t){var e=S.call(t,C),n=t[C];try{t[C]=void 0;var r=!0}catch(t){}var o=A.call(t);return r&&(e?t[C]=n:delete t[C]),o}(t):function(t){return T.call(t)}(t)}var M="[object AsyncFunction]",R="[object Function]",P="[object GeneratorFunction]",j="[object Proxy]",D=9007199254740991;function B(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=D}function L(t){return null!=t&&B(t.length)&&!function(t){if(!i(t))return!1;var e=I(t);return e==R||e==P||e==M||e==j}(t)}var F={};function U(){}function q(t){return function(){if(null!==t){var e=t;t=null,e.apply(this,arguments)}}}var x="function"==typeof Symbol&&Symbol.iterator,W=function(t){return x&&t[x]&&t[x]()};function V(t){return null!=t&&"object"==typeof t}var H="[object Arguments]";function Y(t){return V(t)&&I(t)==H}var Q=Object.prototype,z=Q.hasOwnProperty,K=Q.propertyIsEnumerable,G=Y(function(){return arguments}())?Y:function(t){return V(t)&&z.call(t,"callee")&&!K.call(t,"callee")},J=Array.isArray,X="object"==typeof e&&e&&!e.nodeType&&e,Z=X&&"object"==typeof t&&t&&!t.nodeType&&t,k=Z&&Z.exports===X?w.Buffer:void 0,tt=(k?k.isBuffer:void 0)||function(){return!1},et=9007199254740991,nt=/^(?:0|[1-9]\d*)$/;function rt(t,e){var n=typeof t;return!!(e=null==e?et:e)&&("number"==n||"symbol"!=n&&nt.test(t))&&t>-1&&t%1==0&&t<e}var ot={};ot["[object Float32Array]"]=ot["[object Float64Array]"]=ot["[object Int8Array]"]=ot["[object Int16Array]"]=ot["[object Int32Array]"]=ot["[object Uint8Array]"]=ot["[object Uint8ClampedArray]"]=ot["[object Uint16Array]"]=ot["[object Uint32Array]"]=!0,ot["[object Arguments]"]=ot["[object Array]"]=ot["[object ArrayBuffer]"]=ot["[object Boolean]"]=ot["[object DataView]"]=ot["[object Date]"]=ot["[object Error]"]=ot["[object Function]"]=ot["[object Map]"]=ot["[object Number]"]=ot["[object Object]"]=ot["[object RegExp]"]=ot["[object Set]"]=ot["[object String]"]=ot["[object WeakMap]"]=!1;var it,st="object"==typeof e&&e&&!e.nodeType&&e,ut=st&&"object"==typeof t&&t&&!t.nodeType&&t,ct=ut&&ut.exports===st&&_.process,at=function(){try{var t=ut&&ut.require&&ut.require("util").types;return t||ct&&ct.binding&&ct.binding("util")}catch(t){}}(),lt=at&&at.isTypedArray,ht=lt?(it=lt,function(t){return it(t)}):function(t){return V(t)&&B(t.length)&&!!ot[I(t)]},pt=Object.prototype.hasOwnProperty;function ft(t,e){var n=J(t),r=!n&&G(t),o=!n&&!r&&tt(t),i=!n&&!r&&!o&&ht(t),s=n||r||o||i,u=s?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=u.length;for(var a in t)!e&&!pt.call(t,a)||s&&("length"==a||o&&("offset"==a||"parent"==a)||i&&("buffer"==a||"byteLength"==a||"byteOffset"==a)||rt(a,c))||u.push(a);return u}var dt=Object.prototype,mt=function(t,e){return function(n){return t(e(n))}}(Object.keys,Object),gt=Object.prototype.hasOwnProperty;function yt(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||dt))return mt(t);var e,n,r=[];for(var o in Object(t))gt.call(t,o)&&"constructor"!=o&&r.push(o);return r}function _t(t){return L(t)?ft(t):yt(t)}function vt(t){if(L(t))return function(t){var e=-1,n=t.length;return function(){return++e<n?{value:t[e],key:e}:null}}(t);var e,n,r,o,i=W(t);return i?function(t){var e=-1;return function(){var n=t.next();return n.done?null:(e++,{value:n.value,key:e})}}(i):(n=_t(e=t),r=-1,o=n.length,function(){var t=n[++r];return r<o?{value:e[t],key:t}:null})}function wt(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}function bt(t){return function(e,n,r){if(r=q(r||U),t<=0||!e)return r(null);var o=vt(e),i=!1,s=0,u=!1;function c(t,e){if(s-=1,t)i=!0,r(t);else{if(e===F||i&&s<=0)return i=!0,r(null);u||a()}}function a(){for(u=!0;s<t&&!i;){var e=o();if(null===e)return i=!0,void(s<=0&&r(null));s+=1,n(e.value,e.key,wt(c))}u=!1}a()}}function Ot(t,e,n,r){bt(e)(t,g(n),r)}function St(t,e){return function(n,r,o){return t(n,e,r,o)}}function At(t,e,n){n=q(n||U);var r=0,o=0,i=t.length;function s(t,e){t?n(t):++o!==i&&e!==F||n(null)}for(0===i&&n(null);r<i;r++)e(t[r],r,wt(s))}var Ct=St(Ot,1/0),Tt=function(t,e,n){(L(t)?At:Ct)(t,g(e),n)};function Et(t){return function(e,n,r){return t(Tt,e,g(n),r)}}function Nt(t,e,n,r){r=r||U,e=e||[];var o=[],i=0,s=g(n);t(e,function(t,e,n){var r=i++;s(t,function(t,e){o[r]=e,n(t)})},function(t){r(t,o)})}var $t=Et(Nt),It=y($t);function Mt(t){return function(e,n,r,o){return t(bt(n),e,g(r),o)}}var Rt=Mt(Nt),Pt=St(Rt,1),jt=y(Pt);function Dt(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}var Bt,Lt=function(t,e,n){for(var r=-1,o=Object(t),i=n(t),s=i.length;s--;){var u=i[Bt?s:++r];if(!1===e(o[u],u,o))break}return t};function Ft(t,e){return t&&Lt(t,e,_t)}function Ut(t){return t!=t}function qt(t,e,n){return e==e?function(t,e,n){for(var r=n-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}(t,e,n):function(t,e,n,r){for(var o=t.length,i=n+(r?1:-1);r?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,Ut,n)}var xt=function(t,e,r){"function"==typeof e&&(r=e,e=null),r=q(r||U);var o=_t(t).length;if(!o)return r(null);e||(e=o);var i={},s=0,u=!1,c=Object.create(null),a=[],l=[],h={};function p(t,e){a.push(function(){!function(t,e){if(u)return;var o=wt(function(e,o){if(s--,arguments.length>2&&(o=n(arguments,1)),e){var a={};Ft(i,function(t,e){a[e]=t}),a[t]=o,u=!0,c=Object.create(null),r(e,a)}else i[t]=o,Dt(c[t]||[],function(t){t()}),f()});s++;var a=g(e[e.length-1]);e.length>1?a(i,o):a(o)}(t,e)})}function f(){if(0===a.length&&0===s)return r(null,i);for(;a.length&&s<e;){a.shift()()}}function d(e){var n=[];return Ft(t,function(t,r){J(t)&&qt(t,e,0)>=0&&n.push(r)}),n}Ft(t,function(e,n){if(!J(e))return p(n,[e]),void l.push(n);var r=e.slice(0,e.length-1),o=r.length;if(0===o)return p(n,e),void l.push(n);h[n]=o,Dt(r,function(i){if(!t[i])throw new Error("async.auto task `"+n+"` has a non-existent dependency `"+i+"` in "+r.join(", "));!function(t,e){var n=c[t];n||(n=c[t]=[]);n.push(e)}(i,function(){0===--o&&p(n,e)})})}),function(){var t,e=0;for(;l.length;)t=l.pop(),e++,Dt(d(t),function(t){0==--h[t]&&l.push(t)});if(e!==o)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}(),f()};function Wt(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}var Vt="[object Symbol]",Ht=1/0,Yt=b?b.prototype:void 0,Qt=Yt?Yt.toString:void 0;function zt(t){if("string"==typeof t)return t;if(J(t))return Wt(t,zt)+"";if(function(t){return"symbol"==typeof t||V(t)&&I(t)==Vt}(t))return Qt?Qt.call(t):"";var e=t+"";return"0"==e&&1/t==-Ht?"-0":e}function Kt(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:function(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i}(t,e,n)}var Gt=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),Jt="[\\ud800-\\udfff]",Xt="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Zt="\\ud83c[\\udffb-\\udfff]",kt="[^\\ud800-\\udfff]",te="(?:\\ud83c[\\udde6-\\uddff]){2}",ee="[\\ud800-\\udbff][\\udc00-\\udfff]",ne="(?:"+Xt+"|"+Zt+")"+"?",re="[\\ufe0e\\ufe0f]?"+ne+("(?:\\u200d(?:"+[kt,te,ee].join("|")+")[\\ufe0e\\ufe0f]?"+ne+")*"),oe="(?:"+[kt+Xt+"?",Xt,te,ee,Jt].join("|")+")",ie=RegExp(Zt+"(?="+Zt+")|"+oe+re,"g");function se(t){return function(t){return Gt.test(t)}(t)?function(t){return t.match(ie)||[]}(t):function(t){return t.split("")}(t)}var ue=/^\s+|\s+$/g;function ce(t,e,n){var r;if((t=null==(r=t)?"":zt(r))&&(n||void 0===e))return t.replace(ue,"");if(!t||!(e=zt(e)))return t;var o=se(t),i=se(e);return Kt(o,function(t,e){for(var n=-1,r=t.length;++n<r&&qt(e,t[n],0)>-1;);return n}(o,i),function(t,e){for(var n=t.length;n--&&qt(e,t[n],0)>-1;);return n}(o,i)+1).join("")}var ae=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,le=/,/,he=/(=.+)?(\s*)$/,pe=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;function fe(t,e){var n={};Ft(t,function(t,e){var r,o,i=m(t),s=!i&&1===t.length||i&&0===t.length;if(J(t))r=t.slice(0,-1),t=t[t.length-1],n[e]=r.concat(r.length>0?u:t);else if(s)n[e]=t;else{if(r=o=(o=(o=(o=(o=t).toString().replace(pe,"")).match(ae)[2].replace(" ",""))?o.split(le):[]).map(function(t){return ce(t.replace(he,""))}),0===t.length&&!i&&0===r.length)throw new Error("autoInject task functions require explicit parameters.");i||r.pop(),n[e]=r.concat(u)}function u(e,n){var o=Wt(r,function(t){return e[t]});o.push(n),g(t).apply(null,o)}}),xt(n,e)}function de(){this.head=this.tail=null,this.length=0}function me(t,e){t.length=1,t.head=t.tail=e}function ge(t,e,n){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var r=g(t),o=0,i=[],s=!1;function u(t,e,n){if(null!=n&&"function"!=typeof n)throw new Error("task callback must be a function");if(h.started=!0,J(t)||(t=[t]),0===t.length&&h.idle())return l(function(){h.drain()});for(var r=0,o=t.length;r<o;r++){var i={data:t[r],callback:n||U};e?h._tasks.unshift(i):h._tasks.push(i)}s||(s=!0,l(function(){s=!1,h.process()}))}function c(t){return function(e){o-=1;for(var n=0,r=t.length;n<r;n++){var s=t[n],u=qt(i,s,0);0===u?i.shift():u>0&&i.splice(u,1),s.callback.apply(s,arguments),null!=e&&h.error(e,s.data)}o<=h.concurrency-h.buffer&&h.unsaturated(),h.idle()&&h.drain(),h.process()}}var a=!1,h={_tasks:new de,concurrency:e,payload:n,saturated:U,unsaturated:U,buffer:e/4,empty:U,drain:U,error:U,started:!1,paused:!1,push:function(t,e){u(t,!1,e)},kill:function(){h.drain=U,h._tasks.empty()},unshift:function(t,e){u(t,!0,e)},remove:function(t){h._tasks.remove(t)},process:function(){if(!a){for(a=!0;!h.paused&&o<h.concurrency&&h._tasks.length;){var t=[],e=[],n=h._tasks.length;h.payload&&(n=Math.min(n,h.payload));for(var s=0;s<n;s++){var u=h._tasks.shift();t.push(u),i.push(u),e.push(u.data)}o+=1,0===h._tasks.length&&h.empty(),o===h.concurrency&&h.saturated();var l=wt(c(t));r(e,l)}a=!1}},length:function(){return h._tasks.length},running:function(){return o},workersList:function(){return i},idle:function(){return h._tasks.length+o===0},pause:function(){h.paused=!0},resume:function(){!1!==h.paused&&(h.paused=!1,l(h.process))}};return h}function ye(t,e){return ge(t,1,e)}de.prototype.removeLink=function(t){return t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,t.prev=t.next=null,this.length-=1,t},de.prototype.empty=function(){for(;this.head;)this.shift();return this},de.prototype.insertAfter=function(t,e){e.prev=t,e.next=t.next,t.next?t.next.prev=e:this.tail=e,t.next=e,this.length+=1},de.prototype.insertBefore=function(t,e){e.prev=t.prev,e.next=t,t.prev?t.prev.next=e:this.head=e,t.prev=e,this.length+=1},de.prototype.unshift=function(t){this.head?this.insertBefore(this.head,t):me(this,t)},de.prototype.push=function(t){this.tail?this.insertAfter(this.tail,t):me(this,t)},de.prototype.shift=function(){return this.head&&this.removeLink(this.head)},de.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},de.prototype.toArray=function(){for(var t=Array(this.length),e=this.head,n=0;n<this.length;n++)t[n]=e.data,e=e.next;return t},de.prototype.remove=function(t){for(var e=this.head;e;){var n=e.next;t(e)&&this.removeLink(e),e=n}return this};var _e=St(Ot,1);function ve(t,e,n,r){r=q(r||U);var o=g(n);_e(t,function(t,n,r){o(e,t,function(t,n){e=n,r(t)})},function(t){r(t,e)})}function we(){var t=Wt(arguments,g);return function(){var e=n(arguments),r=this,o=e[e.length-1];"function"==typeof o?e.pop():o=U,ve(t,e,function(t,e,o){e.apply(r,t.concat(function(t){var e=n(arguments,1);o(t,e)}))},function(t,e){o.apply(r,[t].concat(e))})}}var be=function(){return we.apply(null,n(arguments).reverse())},Oe=Array.prototype.concat,Se=function(t,e,r,o){o=o||U;var i=g(r);Rt(t,e,function(t,e){i(t,function(t){return t?e(t):e(null,n(arguments,1))})},function(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&(n=Oe.apply(n,e[r]));return o(t,n)})},Ae=St(Se,1/0),Ce=St(Se,1),Te=function(){var t=n(arguments),e=[null].concat(t);return function(){return arguments[arguments.length-1].apply(this,e)}};function Ee(t){return t}function Ne(t,e){return function(n,r,o,i){i=i||U;var s,u=!1;n(r,function(n,r,i){o(n,function(r,o){r?i(r):t(o)&&!s?(u=!0,s=e(!0,n),i(null,F)):i()})},function(t){t?i(t):i(null,u?s:e(!1))})}}function $e(t,e){return e}var Ie=Et(Ne(Ee,$e)),Me=Mt(Ne(Ee,$e)),Re=St(Me,1);function Pe(t){return function(e){var r=n(arguments,1);r.push(function(e){var r=n(arguments,1);"object"==typeof console&&(e?console.error&&console.error(e):console[t]&&Dt(r,function(e){console[t](e)}))}),g(e).apply(null,r)}}var je=Pe("dir");function De(t,e,r){r=wt(r||U);var o=g(t),i=g(e);function s(t){if(t)return r(t);var e=n(arguments,1);e.push(u),i.apply(this,e)}function u(t,e){return t?r(t):e?void o(s):r(null)}u(null,!0)}function Be(t,e,r){r=wt(r||U);var o=g(t),i=function(t){if(t)return r(t);var s=n(arguments,1);if(e.apply(this,s))return o(i);r.apply(null,[null].concat(s))};o(i)}function Le(t,e,n){Be(t,function(){return!e.apply(this,arguments)},n)}function Fe(t,e,n){n=wt(n||U);var r=g(e),o=g(t);function i(t){if(t)return n(t);o(s)}function s(t,e){return t?n(t):e?void r(i):n(null)}o(s)}function Ue(t){return function(e,n,r){return t(e,r)}}function qe(t,e,n){Tt(t,Ue(g(e)),n)}function xe(t,e,n,r){bt(e)(t,Ue(g(n)),r)}var We=St(xe,1);function Ve(t){return m(t)?t:o(function(e,n){var r=!0;e.push(function(){var t=arguments;r?l(function(){n.apply(null,t)}):n.apply(null,t)}),t.apply(this,e),r=!1})}function He(t){return!t}var Ye=Et(Ne(He,He)),Qe=Mt(Ne(He,He)),ze=St(Qe,1);function Ke(t){return function(e){return null==e?void 0:e[t]}}function Ge(t,e,n,r){var o=new Array(e.length);t(e,function(t,e,r){n(t,function(t,n){o[e]=!!n,r(t)})},function(t){if(t)return r(t);for(var n=[],i=0;i<e.length;i++)o[i]&&n.push(e[i]);r(null,n)})}function Je(t,e,n,r){var o=[];t(e,function(t,e,r){n(t,function(n,i){n?r(n):(i&&o.push({index:e,value:t}),r())})},function(t){t?r(t):r(null,Wt(o.sort(function(t,e){return t.index-e.index}),Ke("value")))})}function Xe(t,e,n,r){(L(e)?Ge:Je)(t,e,g(n),r||U)}var Ze=Et(Xe),ke=Mt(Xe),tn=St(ke,1);function en(t,e){var n=wt(e||U),r=g(Ve(t));!function t(e){if(e)return n(e);r(t)}()}var nn=function(t,e,n,r){r=r||U;var o=g(n);Rt(t,e,function(t,e){o(t,function(n,r){return n?e(n):e(null,{key:r,val:t})})},function(t,e){for(var n={},o=Object.prototype.hasOwnProperty,i=0;i<e.length;i++)if(e[i]){var s=e[i].key,u=e[i].val;o.call(n,s)?n[s].push(u):n[s]=[u]}return r(t,n)})},rn=St(nn,1/0),on=St(nn,1),sn=Pe("log");function un(t,e,n,r){r=q(r||U);var o={},i=g(n);Ot(t,e,function(t,e,n){i(t,e,function(t,r){if(t)return n(t);o[e]=r,n()})},function(t){r(t,o)})}var cn=St(un,1/0),an=St(un,1);function ln(t,e){return e in t}function hn(t,e){var r=Object.create(null),i=Object.create(null);e=e||Ee;var s=g(t),u=o(function(t,o){var u=e.apply(null,t);ln(r,u)?l(function(){o.apply(null,r[u])}):ln(i,u)?i[u].push(o):(i[u]=[o],s.apply(null,t.concat(function(){var t=n(arguments);r[u]=t;var e=i[u];delete i[u];for(var o=0,s=e.length;o<s;o++)e[o].apply(null,t)})))});return u.memo=r,u.unmemoized=t,u}var pn=a(u?process.nextTick:s?setImmediate:c);function fn(t,e,r){r=r||U;var o=L(e)?[]:{};t(e,function(t,e,r){g(t)(function(t,i){arguments.length>2&&(i=n(arguments,1)),o[e]=i,r(t)})},function(t){r(t,o)})}function dn(t,e){fn(Tt,t,e)}function mn(t,e,n){fn(bt(e),t,n)}var gn=function(t,e){var n=g(t);return ge(function(t,e){n(t[0],e)},e,1)},yn=function(t,e){var n=gn(t,e);return n.push=function(t,e,r){if(null==r&&(r=U),"function"!=typeof r)throw new Error("task callback must be a function");if(n.started=!0,J(t)||(t=[t]),0===t.length)return l(function(){n.drain()});e=e||0;for(var o=n._tasks.head;o&&e>=o.priority;)o=o.next;for(var i=0,s=t.length;i<s;i++){var u={data:t[i],priority:e,callback:r};o?n._tasks.insertBefore(o,u):n._tasks.push(u)}l(n.process)},delete n.unshift,n};function _n(t,e){if(e=q(e||U),!J(t))return e(new TypeError("First argument to race must be an array of functions"));if(!t.length)return e();for(var n=0,r=t.length;n<r;n++)g(t[n])(e)}function vn(t,e,r,o){ve(n(t).reverse(),e,r,o)}function wn(t){var e=g(t);return o(function(t,r){return t.push(function(t,e){var o;t?r(null,{error:t}):(o=arguments.length<=2?e:n(arguments,1),r(null,{value:o}))}),e.apply(this,t)})}function bn(t){var e;return J(t)?e=Wt(t,wn):(e={},Ft(t,function(t,n){e[n]=wn.call(this,t)})),e}function On(t,e,n,r){Xe(t,e,function(t,e){n(t,function(t,n){e(t,!n)})},r)}var Sn=Et(On),An=Mt(On),Cn=St(An,1);function Tn(t){return function(){return t}}function En(t,e,n){var r=5,o=0,i={times:r,intervalFunc:Tn(o)};if(arguments.length<3&&"function"==typeof t?(n=e||U,e=t):(!function(t,e){if("object"==typeof e)t.times=+e.times||r,t.intervalFunc="function"==typeof e.interval?e.interval:Tn(+e.interval||o),t.errorFilter=e.errorFilter;else{if("number"!=typeof e&&"string"!=typeof e)throw new Error("Invalid arguments for async.retry");t.times=+e||r}}(i,t),n=n||U),"function"!=typeof e)throw new Error("Invalid arguments for async.retry");var s=g(e),u=1;!function t(){s(function(e){e&&u++<i.times&&("function"!=typeof i.errorFilter||i.errorFilter(e))?setTimeout(t,i.intervalFunc(u)):n.apply(null,arguments)})}()}var Nn=function(t,e){e||(e=t,t=null);var n=g(e);return o(function(e,r){function o(t){n.apply(null,e.concat(t))}t?En(t,o,r):En(o,r)})};function $n(t,e){fn(_e,t,e)}var In=Et(Ne(Boolean,Ee)),Mn=Mt(Ne(Boolean,Ee)),Rn=St(Mn,1);function Pn(t,e,n){var r=g(e);function o(t,e){var n=t.criteria,r=e.criteria;return n<r?-1:n>r?1:0}$t(t,function(t,e){r(t,function(n,r){if(n)return e(n);e(null,{value:t,criteria:r})})},function(t,e){if(t)return n(t);n(null,Wt(e.sort(o),Ke("value")))})}function jn(t,e,n){var r=g(t);return o(function(o,i){var s,u=!1;o.push(function(){u||(i.apply(null,arguments),clearTimeout(s))}),s=setTimeout(function(){var e=t.name||"anonymous",r=new Error('Callback function "'+e+'" timed out.');r.code="ETIMEDOUT",n&&(r.info=n),u=!0,i(r)},e),r.apply(null,o)})}var Dn=Math.ceil,Bn=Math.max;function Ln(t,e,n,r){var o=g(n);Rt(function(t,e,n,r){for(var o=-1,i=Bn(Dn((e-t)/(n||1)),0),s=Array(i);i--;)s[r?i:++o]=t,t+=n;return s}(0,t,1),e,o,r)}var Fn=St(Ln,1/0),Un=St(Ln,1);function qn(t,e,n,r){arguments.length<=3&&(r=n,n=e,e=J(t)?[]:{}),r=q(r||U);var o=g(n);Tt(t,function(t,n,r){o(e,t,n,r)},function(t){r(t,e)})}function xn(t,e){var r,o=null;e=e||U,We(t,function(t,e){g(t)(function(t,i){r=arguments.length>2?n(arguments,1):i,o=t,e(!t)})},function(){e(o,r)})}function Wn(t){return function(){return(t.unmemoized||t).apply(null,arguments)}}function Vn(t,e,r){r=wt(r||U);var o=g(e);if(!t())return r(null);var i=function(e){if(e)return r(e);if(t())return o(i);var s=n(arguments,1);r.apply(null,[null].concat(s))};o(i)}function Hn(t,e,n){Vn(function(){return!t.apply(this,arguments)},e,n)}var Yn=function(t,e){if(e=q(e||U),!J(t))return e(new Error("First argument to waterfall must be an array of functions"));if(!t.length)return e();var r=0;function o(e){var n=g(t[r++]);e.push(wt(i)),n.apply(null,e)}function i(i){if(i||r===t.length)return e.apply(null,arguments);o(n(arguments,1))}o([])},Qn={apply:r,applyEach:It,applyEachSeries:jt,asyncify:h,auto:xt,autoInject:fe,cargo:ye,compose:be,concat:Ae,concatLimit:Se,concatSeries:Ce,constant:Te,detect:Ie,detectLimit:Me,detectSeries:Re,dir:je,doDuring:De,doUntil:Le,doWhilst:Be,during:Fe,each:qe,eachLimit:xe,eachOf:Tt,eachOfLimit:Ot,eachOfSeries:_e,eachSeries:We,ensureAsync:Ve,every:Ye,everyLimit:Qe,everySeries:ze,filter:Ze,filterLimit:ke,filterSeries:tn,forever:en,groupBy:rn,groupByLimit:nn,groupBySeries:on,log:sn,map:$t,mapLimit:Rt,mapSeries:Pt,mapValues:cn,mapValuesLimit:un,mapValuesSeries:an,memoize:hn,nextTick:pn,parallel:dn,parallelLimit:mn,priorityQueue:yn,queue:gn,race:_n,reduce:ve,reduceRight:vn,reflect:wn,reflectAll:bn,reject:Sn,rejectLimit:An,rejectSeries:Cn,retry:En,retryable:Nn,seq:we,series:$n,setImmediate:l,some:In,someLimit:Mn,someSeries:Rn,sortBy:Pn,timeout:jn,times:Fn,timesLimit:Ln,timesSeries:Un,transform:qn,tryEach:xn,unmemoize:Wn,until:Hn,waterfall:Yn,whilst:Vn,all:Ye,allLimit:Qe,allSeries:ze,any:In,anyLimit:Mn,anySeries:Rn,find:Ie,findLimit:Me,findSeries:Re,forEach:qe,forEachSeries:We,forEachLimit:xe,forEachOf:Tt,forEachOfSeries:_e,forEachOfLimit:Ot,inject:ve,foldl:ve,foldr:vn,select:Ze,selectLimit:ke,selectSeries:tn,wrapSync:h};e.default=Qn,e.apply=r,e.applyEach=It,e.applyEachSeries=jt,e.asyncify=h,e.auto=xt,e.autoInject=fe,e.cargo=ye,e.compose=be,e.concat=Ae,e.concatLimit=Se,e.concatSeries=Ce,e.constant=Te,e.detect=Ie,e.detectLimit=Me,e.detectSeries=Re,e.dir=je,e.doDuring=De,e.doUntil=Le,e.doWhilst=Be,e.during=Fe,e.each=qe,e.eachLimit=xe,e.eachOf=Tt,e.eachOfLimit=Ot,e.eachOfSeries=_e,e.eachSeries=We,e.ensureAsync=Ve,e.every=Ye,e.everyLimit=Qe,e.everySeries=ze,e.filter=Ze,e.filterLimit=ke,e.filterSeries=tn,e.forever=en,e.groupBy=rn,e.groupByLimit=nn,e.groupBySeries=on,e.log=sn,e.map=$t,e.mapLimit=Rt,e.mapSeries=Pt,e.mapValues=cn,e.mapValuesLimit=un,e.mapValuesSeries=an,e.memoize=hn,e.nextTick=pn,e.parallel=dn,e.parallelLimit=mn,e.priorityQueue=yn,e.queue=gn,e.race=_n,e.reduce=ve,e.reduceRight=vn,e.reflect=wn,e.reflectAll=bn,e.reject=Sn,e.rejectLimit=An,e.rejectSeries=Cn,e.retry=En,e.retryable=Nn,e.seq=we,e.series=$n,e.setImmediate=l,e.some=In,e.someLimit=Mn,e.someSeries=Rn,e.sortBy=Pn,e.timeout=jn,e.times=Fn,e.timesLimit=Ln,e.timesSeries=Un,e.transform=qn,e.tryEach=xn,e.unmemoize=Wn,e.until=Hn,e.waterfall=Yn,e.whilst=Vn,e.all=Ye,e.allLimit=Qe,e.allSeries=ze,e.any=In,e.anyLimit=Mn,e.anySeries=Rn,e.find=Ie,e.findLimit=Me,e.findSeries=Re,e.forEach=qe,e.forEachSeries=We,e.forEachLimit=xe,e.forEachOf=Tt,e.forEachOfSeries=_e,e.forEachOfLimit=Ot,e.inject=ve,e.foldl=ve,e.foldr=vn,e.select=Ze,e.selectLimit=ke,e.selectSeries=tn,e.wrapSync=h,Object.defineProperty(e,"__esModule",{value:!0})})(e)}).call(this,n(64)(t))},function(t,e,n){"use strict";const r=n(336),o=n(191);t.exports=function(t){const e=t.options.arrayFilters;if(!Array.isArray(e))return;const n=t.getUpdate(),i=t.schema,s=o(n),u=Object.keys(s).reduce((t,e)=>{const n=e.match(/\$\[[^\]]+\]/g);if(null==n)return t;for(const r of n){const n=e.indexOf(r);if(n!==e.lastIndexOf(r))throw new Error(`Path '${e}' contains the same array filter multiple times`);t[r.substring(2,r.length-1)]=e.substr(0,n-1)}return t},{});for(const n of e){if(null==n)throw new Error(`Got null array filter in ${e}`);const o=Object.keys(n)[0];if(null==n[o])continue;const s=o.indexOf(".");let c=-1===s?u[o]+".0":u[o.substr(0,s)]+".0"+o.substr(s);if(null==c)throw new Error(`Filter path not found for ${o}`);c=c.replace(/\$\[[^\]]+\]/g,"0");const a=i.path(c);"object"==typeof n[o]?n[o]=r(t,a,n[o]):n[o]=a.castForQuery(n[o])}}},function(t,e,n){"use strict";t.exports=function(t,e,n){if(!Object.keys(n).some(function(t){return"$"===t.charAt(0)&&"$id"!==t&&"$ref"!==t}))return e.castForQueryWrapper({val:n,context:t});const r=Object.keys(n);let o=r.length;for(;o--;){const t=r[o],i=n[t];if("$not"===t){if(i&&e&&!e.caster){const r=Object.keys(i);if(r.length&&"$"===r[0].charAt(0))for(const t in i)i[t]=e.castForQueryWrapper({$conditional:t,val:i[t],context:context});else n[t]=e.castForQueryWrapper({$conditional:t,val:i,context:context});continue}}else n[t]=e.castForQueryWrapper({$conditional:t,val:i,context:context})}return n}},function(t,e,n){"use strict";const r=n(8);
/*!
 * Like `schema.path()`, except with a document, because impossible to
 * determine path type without knowing the embedded discriminator key.
 */t.exports=function(t,e,n,o){const i=o.split(".");let s=null,u="adhocOrUndefined";n=n||{},e=e||{};for(let e=0;e<i.length;++e){const o=i.slice(0,e+1).join(".").replace(/\.\$\./i,".0.").replace(/\.\$$/,".0");if(null!=(s=t.path(o))&&(u=t.pathType(o),(s.$isSingleNested||s.$isMongooseDocumentArrayElement)&&null!=s.schema.discriminators)){const t=s.schema.discriminators,c=o+"."+r(s,"schema.options.discriminatorKey"),a=c.replace(/\.\d+\./,".");let l=null;if(c in n&&(l=n[c]),a in n&&(l=n[a]),null==l||null==t[l])continue;const h=i.slice(e+1).join(".");if(null!=(s=t[l].path(h))){u=t[l]._getPathType(h);break}}}return{type:u,schematype:s}}},function(t,e,n){"use strict";const r=n(31);t.exports=
/*!
 * Given a model and an array of docs, hydrates all the docs to be instances
 * of the model. Used to initialize docs returned from the db from `find()`
 *
 * @param {Model} model
 * @param {Array} docs
 * @param {Object} fields the projection used, including `select` from schemas
 * @param {Object} userProvidedFields the user-specified projection
 * @param {Object} opts
 * @param {Array} [opts.populated]
 * @param {ClientSession} [opts.session]
 * @param {Function} callback
 */
function(t,e,n,o,i,s){const u=[];let c=e.length;const a=c;let l=null;function h(t){null!=t&&(l=l||t),null==l?--c||process.nextTick(()=>s(l,u)):--c||process.nextTick(()=>s(l))}for(let s=0;s<a;++s){u[s]=r.createModel(t,e[s],n,o);try{u[s].init(e[s],i,h)}catch(l){h(l)}u[s].$session(i.session)}}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t){const e=Object.keys(t),n=e.length;for(let t=0;t<n;++t)if("$"===e[t].charAt(0))return!0;return!1}},function(t,e,n){"use strict";const r=n(58);
/*!
 * ignore
 */t.exports=function(t){if(null==t)return!1;const e=Object.keys(t),n=e.length;if(0===n)return!1;for(let o=0;o<n;++o){const n=e[o];if("+"!==n.charAt(0)&&(r(t[n])&&t[n]))return!0}return!1}},function(t,e,n){"use strict";
/*!
 * ignore
 */
/*!
 * ignore
 */
function r(t,e){const n=e.split("."),r=n.length;let o=n[0];for(let e=1;e<r;++e){if(null!=t[o])return!0;o+="."+n[e]}return null!=t[o]}t.exports=function(t){const e=t._mongooseOptions;if(null!=e.populate){const n=Object.keys(e.populate),o=t._userProvidedFields||{};if(t.selectedInclusively())for(let e=0;e<n.length;++e)r(o,n[e])?0===o[n[e]]&&delete t._fields[n[e]]:t.select(n[e]);else if(t.selectedExclusively())for(let e=0;e<n.length;++e)null==o[n[e]]&&delete t._fields[n[e]]}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(47),o=n(107),i=n(57).flatten,s=n(57).modifiedPaths,u=n(194);t.exports=function(t,e,n,c){let a;const l=Object.keys(n||{});let h={},p={};const f={},d={},m=l.length;let g=!1;const y={};let _,v,w;for(w=0;w<m;++w)if("$"===l[w].charAt(0)){if(g=!0,"$push"===l[w]||"$addToSet"===l[w]){a=Object.keys(n[l[w]]);for(let t=0;t<a.length;++t)(_=n[l[w]][a[t]])&&_.$each?d[a[t]]=(d[a[t]]||[]).concat(_.$each):d[a[t]]=(d[a[t]]||[]).concat([_]);continue}s(n[l[w]],"",y);const t=i(n[l[w]]),e=Object.keys(t),r=e.length;for(let n=0;n<r;++n){let r=e[n].replace(".$.",".0.");r=r.replace(/\.\$$/,".0"),v=l[w],-1===r.indexOf("$")&&("$set"===v||"$setOnInsert"===v||"$pull"===v||"$pullAll"===v?(p[r]=t[e[n]],f[r]="$pull"===v||"$pullAll"===v):"$unset"===v&&(p[r]=void 0),h[r]=!0)}}g||(s(n,"",y),p=i(n),h=Object.keys(p));const b=Object.keys(p),O=b.length,S=[],A=[],C=[],T=c&&"query"===c.context?t:null;function E(t,n){const o=e._getSchema(b[t]);if(o){if(o instanceof r&&o.$fullPath!==b[t])return;n&&Array.isArray(n.$in)?n.$in.forEach((t,e)=>{S.push(function(n){o.doValidate(t,function(t){t&&(t.path=b[e]+".$in."+e,A.push(t)),n(null)},T,{updateValidator:!0})})}):(f[b[t]]&&!Array.isArray(n)&&o.$isMongooseArray&&(n=[n]),o.$isMongooseDocumentArrayElement&&null!=n&&null!=n.$__?(C.push(b[t]),S.push(function(e){o.doValidate(n,function(r){if(r)return r.path=b[t],A.push(r),e(null);n.validate(function(n){if(n&&n.errors)for(const e of Object.keys(n.errors)){const r=n.errors[e];r.path=b[t]+"."+e,A.push(r)}e(null)})},T,{updateValidator:!0})})):S.push(function(e){for(const n of C)if(b[t].startsWith(n+"."))return e(null);o.doValidate(n,function(n){n&&(n.path=b[t],A.push(n)),e(null)},T,{updateValidator:!0})}))}}for(w=0;w<O;++w)E(w,p[b[w]]);const N=Object.keys(d),$=N.length;for(w=0;w<$;++w)!function(n){let r=e._getSchema(N[n]);if(r&&r.$isMongooseDocumentArray)S.push(function(e){r.doValidate(d[N[n]],function(t){t&&(t.path=N[n],A.push(t)),e(null)},c&&"query"===c.context?t:null)});else{r=e._getSchema(N[n]+".0");for(let e=0;e<d[N[n]].length;++e)!function(e){S.push(function(o){r.doValidate(d[N[n]][e],function(t){t&&(t.path=N[n],A.push(t)),o(null)},c&&"query"===c.context?t:null,{updateValidator:!0})})}(e)}}(w);return function(t){u(S,function(){if(A.length){const e=new o(null);for(let t=0;t<A.length;++t)e.addError(A[t].path,A[t]);return t(e)}t(null)})}}},function(t,e,n){var r=n(122),o=n(199),i="[object AsyncFunction]",s="[object Function]",u="[object GeneratorFunction]",c="[object Proxy]";t.exports=function(t){if(!o(t))return!1;var e=r(t);return e==s||e==u||e==i||e==c}},function(t,e,n){var r=n(196),o=Object.prototype,i=o.hasOwnProperty,s=o.toString,u=r?r.toStringTag:void 0;t.exports=function(t){var e=i.call(t,u),n=t[u];try{t[u]=void 0;var r=!0}catch(t){}var o=s.call(t);return r&&(e?t[u]=n:delete t[u]),o}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,i){(0,r.default)(e)(t,(0,o.default)(n),i)};var r=i(n(202)),o=i(n(91));function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if((0,r.default)(t))return function(t){var e=-1,n=t.length;return function(){return++e<n?{value:t[e],key:e}:null}}(t);var e=(0,o.default)(t);return e?function(t){var e=-1;return function(){var n=t.next();return n.done?null:(e++,{value:n.value,key:e})}}(e):(n=t,s=(0,i.default)(n),u=-1,c=s.length,function(){var t=s[++u];return u<c?{value:n[t],key:t}:null});var n,s,u,c};var r=s(n(90)),o=s(n(348)),i=s(n(349));function s(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return r&&t[r]&&t[r]()};var r="function"==typeof Symbol&&Symbol.iterator;t.exports=e.default},function(t,e,n){var r=n(350),o=n(362),i=n(90);t.exports=function(t){return i(t)?r(t):o(t)}},function(t,e,n){var r=n(351),o=n(352),i=n(354),s=n(355),u=n(357),c=n(358),a=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=i(t),l=!n&&o(t),h=!n&&!l&&s(t),p=!n&&!l&&!h&&c(t),f=n||l||h||p,d=f?r(t.length,String):[],m=d.length;for(var g in t)!e&&!a.call(t,g)||f&&("length"==g||h&&("offset"==g||"parent"==g)||p&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||u(g,m))||d.push(g);return d}},function(t,e){t.exports=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}},function(t,e,n){var r=n(353),o=n(124),i=Object.prototype,s=i.hasOwnProperty,u=i.propertyIsEnumerable,c=r(function(){return arguments}())?r:function(t){return o(t)&&s.call(t,"callee")&&!u.call(t,"callee")};t.exports=c},function(t,e,n){var r=n(122),o=n(124),i="[object Arguments]";t.exports=function(t){return o(t)&&r(t)==i}},function(t,e){var n=Array.isArray;t.exports=n},function(t,e,n){(function(t){var r=n(197),o=n(356),i=e&&!e.nodeType&&e,s=i&&"object"==typeof t&&t&&!t.nodeType&&t,u=s&&s.exports===i?r.Buffer:void 0,c=(u?u.isBuffer:void 0)||o;t.exports=c}).call(this,n(64)(t))},function(t,e){t.exports=function(){return!1}},function(t,e){var n=9007199254740991,r=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var o=typeof t;return!!(e=null==e?n:e)&&("number"==o||"symbol"!=o&&r.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e,n){var r=n(359),o=n(360),i=n(361),s=i&&i.isTypedArray,u=s?o(s):r;t.exports=u},function(t,e,n){var r=n(122),o=n(200),i=n(124),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,t.exports=function(t){return i(t)&&o(t.length)&&!!s[r(t)]}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,n){(function(t){var r=n(198),o=e&&!e.nodeType&&e,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,s=i&&i.exports===o&&r.process,u=function(){try{var t=i&&i.require&&i.require("util").types;return t||s&&s.binding&&s.binding("util")}catch(t){}}();t.exports=u}).call(this,n(64)(t))},function(t,e,n){var r=n(363),o=n(364),i=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return o(t);var e=[];for(var n in Object(t))i.call(t,n)&&"constructor"!=n&&e.push(n);return e}},function(t,e){var n=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||n)}},function(t,e,n){var r=n(365)(Object.keys,Object);t.exports=r},function(t,e){t.exports=function(t,e){return function(n){return t(e(n))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return(0,o.default)(function(e,n){var o;try{o=t.apply(this,e)}catch(t){return n(t)}(0,r.default)(o)&&"function"==typeof o.then?o.then(function(t){u(n,null,t)},function(t){u(n,t.message?t:new Error(t))}):n(null,o)})};var r=s(n(199)),o=s(n(367)),i=s(n(368));function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e,n){try{t(e,n)}catch(t){(0,i.default)(c,t)}}function c(t){throw t}t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){var e=(0,i.default)(arguments),n=e.pop();t.call(this,e,n)}};var r,o=n(125),i=(r=o)&&r.__esModule?r:{default:r};t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasNextTick=e.hasSetImmediate=void 0,e.fallback=a,e.wrap=l;var r,o=n(125),i=(r=o)&&r.__esModule?r:{default:r};var s,u=e.hasSetImmediate="function"==typeof setImmediate&&setImmediate,c=e.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function a(t){setTimeout(t,0)}function l(t){return function(e){var n=(0,i.default)(arguments,1);t(function(){e.apply(null,n)})}}s=u?setImmediate:c?process.nextTick:a,e.default=l(s)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return function(n,r,o){return t(n,e,r,o)}},t.exports=e.default},function(t,e,n){"use strict";
/*!
 * A query thunk is the function responsible for sending the query to MongoDB,
 * like `Query#_findOne()` or `Query#_execUpdate()`. The `Query#exec()` function
 * calls a thunk. The term "thunk" here is the traditional Node.js definition:
 * a function that takes exactly 1 parameter, a callback.
 *
 * This function defines common behavior for all query thunks.
 */t.exports=function(t){return function(e){++this._executionCount,t.call(this,e)}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(206),o=n(373),i=n(16),s=n(9).DocumentNotFoundError,u=n(9).DivergentArrayError,c=n(9),a=n(10).EventEmitter,l=n(117),h=n(9).OverwriteModelError,p=n(84),f=n(121),d=n(88),m=n(9).VersionError,g=n(9).ParallelSaveError,y=n(175),_=n(113),v=n(374),w=n(375),b=n(190),O=n(376),S=n(377),A=n(120),C=n(31).getDiscriminatorByValue,T=n(55),E=n(39).internalToObjectOptions,N=n(378),$=n(379),I=n(8),M=n(380),R=n(381),P=n(207),j=n(191),D=n(56),B=n(382),L=n(194),F=n(383),U=n(384),q=n(0),x=n(5),W=1,V=2,H=W|V,Y=Symbol.for("mongoose#Model#collection"),Q=n(23).modelSymbol,z=n(87).schemaMixedSymbol;function K(t,e,n){if(e instanceof d)throw new TypeError("2nd argument to `Model` must be a POJO or string, **not** a schema. Make sure you're calling `mongoose.model()`, not `mongoose.Model()`.");i.call(this,t,e,n)}
/*!
 * Inherits from Document.
 *
 * All Model.prototype features are available on
 * top level (non-sub) documents.
 */
/*!
 * ignore
 */
function G(t,e){if(null==t.$where)return;const n=Object.keys(t.$where),r=n.length;for(let o=0;o<r;++o)e[n[o]]=t.$where[n[o]]}
/*!
 * ignore
 */
/*!
 * Apply the operation to the delta (update) clause as
 * well as track versioning for our where clause.
 *
 * @param {Document} self
 * @param {Object} where
 * @param {Object} delta
 * @param {Object} data
 * @param {Mixed} val
 * @param {String} [operation]
 */
function J(t,e,n,r,o,i){if(i||(i="$set"),n[i]||(n[i]={}),n[i][r.path]=o,!1!==t.schema.options.versionKey&&!
/*!
 * Determines whether versioning should be skipped for the given path
 *
 * @param {Document} self
 * @param {String} path
 * @return {Boolean} true if versioning should be skipped for the given path
 */
function(t,e){const n=t.schema.options.skipVersioning;return!!n&&n[e=e.replace(/\.\d+\./,".")]}(t,r.path)&&H!==(H&t.$__.version)){switch(i){case"$set":case"$unset":case"$pop":case"$pull":case"$pullAll":case"$push":case"$addToSet":break;default:return}"$push"===i||"$addToSet"===i||"$pullAll"===i||"$pull"===i?t.$__.version=V:/^\$p/.test(i)?t.increment():Array.isArray(o)?t.increment():/\.\d+\.|\.\d+$/.test(r.path)&&(t.$__.version=W)}}
/*!
 * Compiles an update and where clause for a `val` with _atomics.
 *
 * @param {Document} self
 * @param {Object} where
 * @param {Object} delta
 * @param {Object} data
 * @param {Array} value
 */function X(t,e,n,r,o){if(n.$set&&n.$set[r.path])return;if("function"==typeof o.$__getAtomics)return void o.$__getAtomics().forEach(function(e){const o=e[0],i=e[1];J(t,0,n,r,i,o)});const i=o._atomics,s=Object.keys(i);let u,c,a=s.length;if(0===a)return x.isMongooseObject(o)?o=o.toObject({depopulate:1,_isNested:!0}):o.valueOf&&(o=o.valueOf()),J(t,0,n,r,o);function l(t){return x.isMongooseObject(t)?t.toObject({depopulate:1,_isNested:!0}):t}for(;a--;)u=i[c=s[a]],x.isMongooseObject(u)?u=u.toObject({depopulate:!0,transform:!1,_isNested:!0}):Array.isArray(u)?u=u.map(l):u.valueOf&&(u=u.valueOf()),"$addToSet"===c&&(u={$each:u}),J(t,0,n,r,u,c)}
/*!
 * Determine if array was populated with some form of filter and is now
 * being updated in a manner which could overwrite data unintentionally.
 *
 * @see https://github.com/Automattic/mongoose/issues/1334
 * @param {Document} doc
 * @param {String} path
 * @return {String|undefined}
 */
function Z(t,e,n){const r=t.populated(e,!0);if(!r&&t.$__.selected){const n=e.split(".")[0];if(t.$__.selected[n+".$"])return n}if(r&&n&&n.isMongooseArray&&(r.options.match||r.options.options&&x.object.hasOwnProperty(r.options.options,"limit")||r.options.options&&r.options.options.skip||r.options.select&&(0===r.options.select._id||/\s?-_id\s?/.test(r.options.select)))){const t=n._atomics;if(0===Object.keys(t).length||t.$set||t.$pop)return e}}K.prototype.__proto__=i.prototype,K.prototype.$isMongooseModelPrototype=!0,K.prototype.db,K.prototype.collection,K.prototype.modelName,K.prototype.$where,K.prototype.baseModelName,K.events,
/*!
 * Compiled middleware for this model. Set in `applyHooks()`.
 *
 * @api private
 * @property _middleware
 * @memberOf Model
 * @static
 */
K._middleware,K.prototype.$__handleSave=function(t,e){const n=this;let r={};"safe"in t&&tt(t),b(this.schema,t),"w"in t&&(r.w=t.w),"j"in t&&(r.j=t.j),"wtimeout"in t&&(r.wtimeout=t.wtimeout),"checkKeys"in t&&(r.checkKeys=t.checkKeys);const o="session"in t?t.session:this.$session();if(null!=o&&(r.session=o,this.$session(o)),0===Object.keys(r).length&&(r=null),this.isNew){const t=this.toObject(E);if(void 0===(t||{})._id)return void setTimeout(function(){e(new c("document must have an _id before saving"))},0);this.$__version(!0,t),this[Y].insertOne(t,r,function(t,r){if(t)return n.isNew=!0,n.emit("isNew",!0),n.constructor.emit("isNew",!0),void e(t,null);e(null,r)}),this.$__reset(),this.isNew=!1,this.emit("isNew",!1),this.constructor.emit("isNew",!1),this.$__.inserting=!0}else{this.$__.inserting=!1;const t=this.$__delta();if(!t)return this.$__reset(),void e();{if(t instanceof c)return void e(t);const n=this.$__where(t[0]);if(n instanceof c)return void e(n);G(this,n),this[Y].updateOne(n,t[1],r,function(t,r){t?e(t):(r.$where=n,e(null,r))})}this.emit("isNew",!1),this.constructor.emit("isNew",!1)}},
/*!
 * ignore
 */
K.prototype.$__save=function(t,e){this.$__handleSave(t,(n,r)=>{if(n)return this.schema.s.hooks.execPost("save:error",this,[this],{error:n},function(t){e(t)});const o=this.modifiedPaths();this.$__reset();let i=0;if(0!==I(t,"safe.w")&&0!==I(t,"w")){if(r&&(i=Array.isArray(r)?r.length:r.result&&void 0!==r.result.n?r.result.n:r.result&&void 0!==r.result.nModified?r.result.nModified:r),this.$__.version&&!this.$__.inserting){const n=V===(V&this.$__.version);this.$__.version=void 0;const r=this.schema.options.versionKey,s=this.getValue(r)||0;if(i<=0){const n=t.$versionError||new m(this,s,o);return e(n)}n&&this.setValue(r,s+1)}if(null!=r&&i<=0)return n=new s(r.$where),this.schema.s.hooks.execPost("save:error",this,[this],{error:n},function(t){e(t)})}this.$__.saving=void 0,this.emit("save",this,i),this.constructor.emit("save",this,i),e(null,this)})},K.prototype.save=function(t,e){let n;return this.$__.saving?n=new g(this):this.$__.saving=new g(this),"function"==typeof t&&(e=t,t=void 0),t=null!=t?x.clone(t):{},e&&(e=this.constructor.$wrapCallback(e)),t.$versionError=
/*!
 * ignore
 */
function(t,e){const n=t.schema.options.versionKey;if(!n)return null;const r=t.getValue(n)||0;return new m(t,r,e)}(this,this.modifiedPaths()),x.promiseOrCallback(e,e=>{if(n)return this.$__handleReject(n),e(n);this.$__.saveOptions=t,this.$__save(t,t=>{if(this.$__.saving=void 0,delete this.$__.saveOptions,t)return this.$__handleReject(t),e(t);e(null,this)})},this.constructor.events)},K.prototype.$__delta=function(){const t=this.$__dirty();if(!t.length&&H!==this.$__.version)return;const e={},n={},r=t.length,o=[];let i=0;for(e._id=this._doc._id,null!=I(e,"_id.$__",null)&&(e._id=e._id.toObject({transform:!1,depopulate:!0}));i<r;++i){const r=t[i];let s=r.value;const u=Z(this,r.path,s);if(u)o.push(u);else{if(!this.populated(r.path,!0)&&this.$__.selected){const t=r.path.split("."),n=t[0];if(this.$__.selected[n]&&this.$__.selected[n].$elemMatch){if(!(t.length>1&&0==t[1]&&void 0===e[n])){o.push(r.path);continue}e[n]=this.$__.selected[n],t[1]="$",r.path=t.join(".")}}o.length||(void 0===s?J(this,0,n,r,1,"$unset"):null===s?J(this,0,n,r,null):s._path&&s._atomics?X(this,0,n,r,s):s._path&&Buffer.isBuffer(s)?J(this,0,n,r,s=s.toObject()):J(this,0,n,r,s=x.clone(s,{depopulate:!0,transform:!1,virtuals:!1,_isNested:!0})))}}return o.length?new u(o):(this.$__.version&&this.$__version(e,n),[e,n])},K.prototype.$__version=function(t,e){const n=this.schema.options.versionKey;if(!0!==t){if(this.isSelected(n)){if(W===(W&this.$__.version)){const e=this.getValue(n);null!=e&&(t[n]=e)}V===(V&this.$__.version)&&(null!=I(e.$set,n,null)?++e.$set[n]:(e.$inc=e.$inc||{},e.$inc[n]=1))}}else n&&this.setValue(n,e[n]=0)},K.prototype.increment=function(){return this.$__.version=H,this},K.prototype.$__where=function(t){return t||(t={}),t._id||(t._id=this._doc._id),void 0===this._doc._id?new c("No _id found on document!"):t},K.prototype.remove=function(t,e){return"function"==typeof t&&(e=t,t=void 0),t||(t={}),e&&(e=this.constructor.$wrapCallback(e)),x.promiseOrCallback(e,e=>{this.$__remove(t,e)},this.constructor.events)},K.prototype.delete=K.prototype.remove,
/*!
 * ignore
 */
K.prototype.$__remove=function(t,e){if(this.$__.isDeleted)return T(()=>e(null,this));const n=this.$__where();if(n instanceof c)return e(n);G(this,n),this[Y].deleteOne(n,t,t=>{if(!t)return this.$__.isDeleted=!0,this.emit("remove",this),this.constructor.emit("remove",this),e(null,this);this.$__.isDeleted=!1,e(t)})},K.prototype.model=function(t){return this.db.model(t)},K.discriminator=function(t,e,n){let r;if("function"==typeof t&&(r=t,t=x.getFunctionName(r),!(r.prototype instanceof K)))throw new c("The provided class "+t+" must extend Model");if(e=A(this,t,e,n),this.db.models[t])throw new h(t);e.$isRootDiscriminator=!0,e.$globalPluginsApplied=!1;const o=I(this.base,"options.applyPluginsToDiscriminators",!1);this.base._applyPlugins(e,{skipTopLevel:!o}),r=this.db.model(r||t,e,this.collection.name),this.discriminators[t]=r;const i=this.discriminators[t];return i.prototype.__proto__=this.prototype,Object.defineProperty(i,"baseModelName",{value:this.modelName,configurable:!0,writable:!1}),v(i,e),w(i,e),i};
/*!
 * Give the constructor the ability to emit events.
 */
for(const t in a.prototype)K[t]=a.prototype[t];function k(t,e){return null==t.baseModelName||!e.unique||"partialFilterExpression"in e||"sparse"in e||(e.partialFilterExpression={[t.schema.options.discriminatorKey]:t.modelName}),e}K.init=function(t){if(this.schema.emit("init",this),null!=this.$init)return t?(this.$init.then(()=>t(),e=>t(e)),null):this.$init;this.db.$internalEmitter.once("dropDatabase",()=>{delete this.$init});const e=p.get(),n=null==this.schema.options.autoIndex?this.db.config.autoIndex:this.schema.options.autoIndex,r=null==this.schema.options.autoCreate?this.db.config.autoCreate:this.schema.options.autoCreate,o=n?t=>this.ensureIndexes({_automatic:!0},t):t=>t(),i=r?t=>this.createCollection({},t):t=>t();if(this.$init=new e((t,e)=>{i(n=>{if(n)return e(n);o(n=>{if(n)return e(n);t(this)})})}),t)return this.$init.then(()=>t(),e=>t(e)),this.$caught=!0,null;{const t=this.$init.catch,e=this;this.$init.catch=function(){return this.$caught=!0,t.apply(e.$init,arguments)}}return this.$init},K.createCollection=function(t,e){if("string"==typeof t)throw new c("You can't specify a new collection name in Model.createCollection.This is not like Connection.createCollection. Only options are accepted here.");"function"==typeof t&&(e=t,t=null),e&&(e=this.$wrapCallback(e));const n=I(this,"schema.options.collation",null);return null!=n&&(t=Object.assign({collation:n},t)),x.promiseOrCallback(e,e=>{this.db.createCollection(this.collection.collectionName,t,x.tick(n=>{if(n)return e(n);this.collection=this.db.collection(this.collection.collectionName,t),e(null,this.collection)}))},this.events)},K.syncIndexes=function(t,e){e=this.$wrapCallback(e);const n=t=>{this.listIndexes((e,n)=>{if(null!=e)return t(e);const o=this.schema.indexes(),i=[];for(const t of n){let e=!1;if(!t.key._id){for(const n of o){const r=n[0],o=k(this,x.clone(n[1])),i=["unique","partialFilterExpression","sparse","expireAfterSeconds"],s=Object.assign({},t);for(const t of i)(t in o||t in s)&&(s[t]=o[t]);if(x.deepEqual(r,t.key)&&x.deepEqual(t,s)){e=!0;break}}e||i.push(t.name)}}if(0===i.length)return t(null,[]);r(i,t)})},r=(t,e)=>{let n=t.length,r=!1;t.forEach(o=>{this.collection.dropIndex(o,o=>{if(null!=o)return r=!0,e(o);r||--n||e(null,t)})})};return x.promiseOrCallback(e,e=>{n((n,r)=>{if(null!=n)return e(n);this.createIndexes(t,t=>{if(null!=t)return e(t);e(null,r)})})},this.events)},K.listIndexes=function(t){t=this.$wrapCallback(t);const e=t=>{this.collection.listIndexes().toArray(t)};return x.promiseOrCallback(t,t=>{this.collection.buffer?this.collection.addQueue(e,[t]):e(t)},this.events)},K.ensureIndexes=function(t,e){return"function"==typeof t&&(e=t,t=null),e&&(e=this.$wrapCallback(e)),x.promiseOrCallback(e,e=>{!
/*!
 * ignore
 */
function(t,e,n){const r=t.schema.indexes();e=e||{};const o=function(e){e&&!t.$caught&&t.emit("error",e),t.emit("index",e),n&&n(e)};for(const e of r){const n=Object.keys(e[0]);1===n.length&&"_id"===n[0]&&"hashed"!==e[0]._id&&console.warn('mongoose: Cannot specify a custom index on `_id` for model name "'+t.modelName+'", MongoDB does not allow overwriting the default `_id` index. See http://bit.ly/mongodb-id-index')}if(!r.length)return void T(function(){o()});const i=function(){if(e._automatic&&(!1===t.schema.options.autoIndex||null==t.schema.options.autoIndex&&!1===t.db.config.autoIndex))return o();const n=r.shift();if(!n)return o();const s=x.clone(n[0]),u=x.clone(n[1]);k(t,u),"safe"in e&&tt(e),b(t.schema,u),function(e,n){t.emit("index-single-start",e,n)}(s,e);let c=!!t.base.options.useCreateIndex;"useCreateIndex"in t.db.config&&(c=!!t.db.config.useCreateIndex),"createIndex"in e&&(c=!!e.createIndex);const a=c?"createIndex":"ensureIndex";t.collection[a](s,u,x.tick(function(e,n){if(function(e,n,r,o){t.emit("index-single-done",e,n,r,o)}(e,s,u,n),e)return o(e);i()}))};T(function(){e._automatic&&!t.collection.collection?t.collection.addQueue(i,[]):i()})}(this,t||{},t=>{if(t)return e(t);e(null)})},this.events)},K.createIndexes=function(t,e){return"function"==typeof t&&(e=t,t={}),(t=t||{}).createIndex=!0,this.ensureIndexes(t,e)};const tt=q.deprecate(function(t){t.safe&&("boolean"==typeof t.safe&&(t.w=t.safe,delete t.safe),"object"==typeof t.safe&&(t.w=t.safe.w,t.j=t.safe.j,t.wtimeout=t.safe.wtimeout,delete t.safe))},"Mongoose: the `safe` option for `save()` is deprecated. Use the `w` option instead: http://bit.ly/mongoose-save");
/*!
 * Decorate the update with a version key, if necessary
 */
function et(t,e,n){if(!n||!I(e,"upsert",!1))return;j(t)[n]||(e.overwrite?t[n]=0:(t.$setOnInsert||(t.$setOnInsert={}),t.$setOnInsert[n]=0))}
/*!
 * Common code for `updateOne()`, `updateMany()`, `replaceOne()`, and `update()`
 * because they need to do the same thing
 */
function nt(t,e,n,r,o,s){const u=new t.Query({},{},t,t.collection);return s&&(s=t.$wrapCallback(s)),n=n instanceof i?n.toObject():x.clone(n),et(r,o="function"==typeof o?o:x.clone(o),I(t,"schema.options.versionKey",null)),u[e](n,r,o,s)}K.schema,
/*!
 * Connection instance the model uses.
 *
 * @property db
 * @api public
 * @memberOf Model
 */
K.db,
/*!
 * Collection the model uses.
 *
 * @property collection
 * @api public
 * @memberOf Model
 */
K.collection,K.base,K.discriminators,K.translateAliases=function(t){const e=this.schema.aliases;if("object"==typeof t){for(const n in t)e[n]&&(t[e[n]]=t[n],delete t[n]);return t}return t},K.remove=function(t,e){"function"==typeof t&&(e=t,t={});const n=new this.Query({},{},this,this.collection);return e=this.$wrapCallback(e),n.remove(t,e)},K.deleteOne=function(t,e){"function"==typeof t&&(e=t,t={});const n=new this.Query(t,{},this,this.collection);return e=this.$wrapCallback(e),n.deleteOne(e)},K.deleteMany=function(t,e,n){"function"==typeof t?(n=t,t={},e=null):"function"==typeof e&&(n=e,e=null);const r=new this.Query(t,{},this,this.collection);return r.setOptions(e),n&&(n=this.$wrapCallback(n)),r.deleteMany(n)},K.find=function(t,e,n,r){"function"==typeof t?(r=t,t={},e=null,n=null):"function"==typeof e?(r=e,e=null,n=null):"function"==typeof n&&(r=n,n=null);const o=new this.Query({},{},this,this.collection);return o.select(e),o.setOptions(n),this.schema.discriminatorMapping&&this.schema.discriminatorMapping.isRoot&&o.selectedInclusively()&&o.select(this.schema.options.discriminatorKey),r&&(r=this.$wrapCallback(r)),o.find(t,r)},K.findById=function(t,e,n,r){return void 0===t&&(t=null),r&&(r=this.$wrapCallback(r)),this.findOne({_id:t},e,n,r)},K.findOne=function(t,e,n,r){"function"==typeof n?(r=n,n=null):"function"==typeof e?(r=e,e=null,n=null):"function"==typeof t&&(r=t,t={},e=null,n=null);const o=new this.Query({},{},this,this.collection);return o.select(e),o.setOptions(n),this.schema.discriminatorMapping&&this.schema.discriminatorMapping.isRoot&&o.selectedInclusively()&&o.select(this.schema.options.discriminatorKey),r&&(r=this.$wrapCallback(r)),o.findOne(t,r)},K.estimatedDocumentCount=function(t,e){const n=new this.Query({},{},this,this.collection);return e=this.$wrapCallback(e),n.estimatedDocumentCount(t,e)},K.countDocuments=function(t,e){"function"==typeof t&&(e=t,t={});const n=new this.Query({},{},this,this.collection);return e=this.$wrapCallback(e),n.countDocuments(t,e)},K.count=function(t,e){"function"==typeof t&&(e=t,t={});const n=new this.Query({},{},this,this.collection);return e&&(e=this.$wrapCallback(e)),n.count(t,e)},K.distinct=function(t,e,n){const r=new this.Query({},{},this,this.collection);return"function"==typeof e&&(n=e,e={}),n&&(n=this.$wrapCallback(n)),r.distinct(t,e,n)},K.where=function(t,e){const n=new this.Query({},{},this,this.collection).find({});return n.where.apply(n,arguments)},K.$where=function(){const t=new this.Query({},{},this,this.collection).find({});return t.$where.apply(t,arguments)},K.findOneAndUpdate=function(t,e,n,r){if("function"==typeof n)r=n,n=null;else if(1===arguments.length){if("function"==typeof t){const t="Model.findOneAndUpdate(): First argument must not be a function.\n\n  "+this.modelName+".findOneAndUpdate(conditions, update, options, callback)\n  "+this.modelName+".findOneAndUpdate(conditions, update, options)\n  "+this.modelName+".findOneAndUpdate(conditions, update)\n  "+this.modelName+".findOneAndUpdate(update)\n  "+this.modelName+".findOneAndUpdate()\n";throw new TypeError(t)}e=t,t=void 0}let o;r&&(r=this.$wrapCallback(r)),n&&(o=n.fields||n.projection),et(e=x.clone(e,{depopulate:!0,_isNested:!0}),n,this.schema.options.versionKey);const i=new this.Query({},{},this,this.collection);return i.select(o),i.findOneAndUpdate(t,e,n,r)},K.findByIdAndUpdate=function(t,e,n,r){if(r&&(r=this.$wrapCallback(r)),1===arguments.length){if("function"==typeof t){const t="Model.findByIdAndUpdate(): First argument must not be a function.\n\n  "+this.modelName+".findByIdAndUpdate(id, callback)\n  "+this.modelName+".findByIdAndUpdate(id)\n  "+this.modelName+".findByIdAndUpdate()\n";throw new TypeError(t)}return this.findOneAndUpdate({_id:t},void 0)}return t instanceof i&&(t=t._id),this.findOneAndUpdate.call(this,{_id:t},e,n,r)},K.findOneAndDelete=function(t,e,n){if(1===arguments.length&&"function"==typeof t){const t="Model.findOneAndDelete(): First argument must not be a function.\n\n  "+this.modelName+".findOneAndDelete(conditions, callback)\n  "+this.modelName+".findOneAndDelete(conditions)\n  "+this.modelName+".findOneAndDelete()\n";throw new TypeError(t)}let r;"function"==typeof e&&(n=e,e=void 0),n&&(n=this.$wrapCallback(n)),e&&(r=e.select,e.select=void 0);const o=new this.Query({},{},this,this.collection);return o.select(r),o.findOneAndDelete(t,e,n)},K.findByIdAndDelete=function(t,e,n){if(1===arguments.length&&"function"==typeof t){const t="Model.findByIdAndDelete(): First argument must not be a function.\n\n  "+this.modelName+".findByIdAndDelete(id, callback)\n  "+this.modelName+".findByIdAndDelete(id)\n  "+this.modelName+".findByIdAndDelete()\n";throw new TypeError(t)}return n&&(n=this.$wrapCallback(n)),this.findOneAndDelete({_id:t},e,n)},K.findOneAndReplace=function(t,e,n){if(1===arguments.length&&"function"==typeof t){const t="Model.findOneAndDelete(): First argument must not be a function.\n\n  "+this.modelName+".findOneAndDelete(conditions, callback)\n  "+this.modelName+".findOneAndDelete(conditions)\n  "+this.modelName+".findOneAndDelete()\n";throw new TypeError(t)}let r;"function"==typeof e&&(n=e,e=void 0),n&&(n=this.$wrapCallback(n)),e&&(r=e.select,e.select=void 0);const o=new this.Query({},{},this,this.collection);return o.select(r),o.findOneAndReplace(t,e,n)},K.findOneAndRemove=function(t,e,n){if(1===arguments.length&&"function"==typeof t){const t="Model.findOneAndRemove(): First argument must not be a function.\n\n  "+this.modelName+".findOneAndRemove(conditions, callback)\n  "+this.modelName+".findOneAndRemove(conditions)\n  "+this.modelName+".findOneAndRemove()\n";throw new TypeError(t)}let r;"function"==typeof e&&(n=e,e=void 0),n&&(n=this.$wrapCallback(n)),e&&(r=e.select,e.select=void 0);const o=new this.Query({},{},this,this.collection);return o.select(r),o.findOneAndRemove(t,e,n)},K.findByIdAndRemove=function(t,e,n){if(1===arguments.length&&"function"==typeof t){const t="Model.findByIdAndRemove(): First argument must not be a function.\n\n  "+this.modelName+".findByIdAndRemove(id, callback)\n  "+this.modelName+".findByIdAndRemove(id)\n  "+this.modelName+".findByIdAndRemove()\n";throw new TypeError(t)}return n&&(n=this.$wrapCallback(n)),this.findOneAndRemove({_id:t},e,n)},K.create=function(t,e,n){let r,o;const i=this.schema.options.discriminatorKey;if(Array.isArray(t))r=t,o="function"==typeof e?e:n,e=null!=e&&"object"==typeof e?e:{};else{const t=arguments[arguments.length-1];e={},"function"!=typeof t&&t?r=x.args(arguments):(o=t,r=x.args(arguments,0,arguments.length-1))}return o&&(o=this.$wrapCallback(o)),x.promiseOrCallback(o,n=>{if(0===r.length)return n(null);const o=[];let s;r.forEach(t=>{o.push(n=>{const r=this.discriminators&&null!=t[i]?this.discriminators[t[i]]||C(this,t[i]):this;if(null==r)throw new c(`Discriminator "${t[i]}" not `+`found for model "${this.modelName}"`);let o=t;const u=(t,e)=>{if(t)return s||(s=t),n(null,{error:t});n(null,{doc:e})};if(!(o instanceof r))try{o=new r(o)}catch(t){return u(t)}o.save(e,u)})}),L(o,(e,r)=>{const o=[],i=r.length;for(let t=0;t<i;++t)r[t].doc&&o.push(r[t].doc);if(s)return n(s,o);t instanceof Array?n(null,o):n.apply(this,[null].concat(o))})},this.events)},K.watch=function(t,e){return new o(this,t,e)},K.startSession=function(){return this.db.startSession.apply(this.db,arguments)},K.insertMany=function(t,e,n){return"function"==typeof e&&(n=e,e=null),x.promiseOrCallback(n,n=>{this.$__insertMany(t,e,n)},this.events)},
/*!
 * ignore
 */
K.$__insertMany=function(t,e,n){const r=this;"function"==typeof e&&(n=e,e=null),n&&(n=this.$wrapCallback(n)),n=n||x.noop;const o=I(e=e||{},"limit",1e3),i=I(e,"rawResult",!1),s=I(e,"ordered",!0);Array.isArray(t)||(t=[t]);const u=[],c=[];t.forEach(function(t){u.push(function(e){t instanceof r||(t=new r(t)),t.validate({__noPromise:!0},function(n){if(n)return!1===s?(c.push(n),e(null,null)):e(n);e(null,t)})})}),F(u,o,function(t,o){if(t)return void n(t,null);const u=o.filter(function(t){return null!=t});if(u.length<1)return void n(null,[]);const a=u.map(function(t){return t.schema.options.versionKey&&(t[t.schema.options.versionKey]=0),t.initializeTimestamps?t.initializeTimestamps().toObject(E):t.toObject(E)});r.collection.insertMany(a,e,function(t,e){if(t)n(t,null);else{for(let t=0;t<u.length;++t)u[t].isNew=!1,u[t].emit("isNew",!1),u[t].constructor.emit("isNew",!1);if(i)return!1===s&&(e.mongoose={validationErrors:c}),n(null,e);n(null,u)}})})},K.bulkWrite=function(t,e,n){"function"==typeof e&&(n=e,e=null),n&&(n=this.$wrapCallback(n)),e=e||{};const r=t.map(t=>S(this,t));return x.promiseOrCallback(n,n=>{L(r,r=>{if(r)return n(r);this.collection.bulkWrite(t,e,(t,e)=>{if(t)return n(t);n(null,e)})})},this.events)},K.hydrate=function(t){const e=n(31).createModel(this,t);return e.init(t),e},K.update=function(t,e,n,r){return nt(this,"update",t,e,n,r)},K.updateMany=function(t,e,n,r){return nt(this,"updateMany",t,e,n,r)},K.updateOne=function(t,e,n,r){return nt(this,"updateOne",t,e,n,r)},K.replaceOne=function(t,e,n,r){const o=I(this,"schema.options.versionKey",null);return o&&!e[o]&&(e[o]=0),nt(this,"replaceOne",t,e,n,r)},K.mapReduce=function(t,e){return e&&(e=this.$wrapCallback(e)),x.promiseOrCallback(e,e=>{if(!K.mapReduce.schema){const t={noId:!0,noVirtualId:!0,strict:!1};K.mapReduce.schema=new d({},t)}if(t.out||(t.out={inline:1}),!1!==t.verbose&&(t.verbose=!0),t.map=String(t.map),t.reduce=String(t.reduce),t.query){let e=new this.Query(t.query);e.cast(this),t.query=e._conditions,e=void 0}this.collection.mapReduce(null,null,t,(t,n)=>{if(t)return e(t);if(n.collection){const t=K.compile("_mapreduce_"+n.collection.collectionName,K.mapReduce.schema,n.collection.collectionName,this.db,this.base);return t._mapreduce=!0,n.model=t,e(null,n)}e(null,n)})},this.events)},K.aggregate=function(t,e){if(arguments.length>2||"Object"===I(t,"constructor.name"))throw new c("Mongoose 5.x disallows passing a spread of operators to `Model.aggregate()`. Instead of `Model.aggregate({ $match }, { $skip })`, do `Model.aggregate([{ $match }, { $skip }])`");"function"==typeof t&&(e=t,t=[]);const n=new r(t||[]);return n.model(this),void 0===e?n:(e&&(e=this.$wrapCallback(e)),n.exec(e),n)},K.geoSearch=function(t,e,n){return"function"==typeof e&&(n=e,e={}),n&&(n=this.$wrapCallback(n)),x.promiseOrCallback(n,n=>{let r;if(void 0!==t&&x.isObject(t)?e.near?Array.isArray(e.near)||(r=new c("near option must be an array [x, y]")):r=new c("Must specify the near option in geoSearch"):r=new c("Must pass conditions to geoSearch"),r)return n(r);e.search=t,this.collection.geoHaystackSearch(e.near[0],e.near[1],e,(t,r)=>{if(t)return n(t);let o=r.results.length;if(e.lean||0===o)return n(null,r.results);const i=!1;function s(t){if(t&&!i)return n(t);--o||i||n(null,r.results)}for(let t=0;t<r.results.length;++t){const e=r.results[t];r.results[t]=new this,r.results[t].init(e,{},s)}})},this.events)},K.populate=function(t,e,n){const r=this;n&&(n=this.$wrapCallback(n)),e=x.populate(e);return x.promiseOrCallback(n,n=>{!
/*!
 * Populate helper
 *
 * @param {Model} model the model to use
 * @param {Document|Array} docs Either a single document or array of documents to populate.
 * @param {Object} paths
 * @param {Function} [cb(err,doc)] Optional callback, executed upon completion. Receives `err` and the `doc(s)`.
 * @return {Function}
 * @api private
 */
function(t,e,n,r,o){let i=n.length;if(0===i)return o(null,e);let s,u=i;for(;u--;)s=n[u],it(t,e,s,c);function c(t){if(t)return o(t,null);--i||o(null,e)}}
/*!
 * Populates `docs`
 */(r,t,e,0,n)},this.events)};const rt=/\s?-_id\s?/,ot=/\s?-_id\s?/g;function it(t,e,n,r){if(Array.isArray(e)||(e=[e]),0===e.length||e.every(x.isNullOrUndefined))return r();const o=function(t,e,n){let r,o;const i=e.length,s={},u=[],a=n.model&&n.model.modelName||n.model;let l,h,p,f,d,m,g;const y=n.model;let _=!1;const v=t.schema;for(r=0;r<i;r++){o=e[r];const i=(l=M(v,o,n.path))&&l.$isUnderneathDocArray;if(i&&null!=I(n,"options.sort"))return new c("Cannot populate with `sort` on path "+n.path+" because it is a subproperty of a document array");d=null;let a=!1;if(Array.isArray(l))for(let t=0;t<l.length;++t){let e;try{const n=w(o,l[t]);e=n.modelNames,a=n.isRefPath}catch(t){return t}if(e){d=d||[];for(let t=0;t<e.length;++t)-1===d.indexOf(e[t])&&d.push(e[t])}}else{try{const t=w(o,l);d=t.modelNames,a=t.isRefPath}catch(t){return t}if(!d)continue}const h=R(t.schema,n.path);let g,b=!1;if(h&&h.options){const t=h.$nestedSchemaPath?h.$nestedSchemaPath+".":"";g="function"==typeof h.options.localField?t+h.options.localField.call(o,o):t+h.options.localField,b=h.options.count}else g=n.path;let O=h&&h.options?h.options.foreignField:"_id",S=null;if("justOne"in n)S=n.justOne;else if(h&&h.options&&h.options.ref){let t;t="function"==typeof h.options.ref?h.options.ref.call(o,o):h.options.ref,S=!!h.options.justOne,_=!0,d||(d=[].concat(t))}else l&&!l[z]&&(S=!l.$isMongooseArray);if(!d)continue;if(h&&(!g||!O))return new c("If you are populating a virtual, you must set the localField and foreignField options");n.isVirtual=_,n.virtual=h,"function"==typeof g&&(g=g.call(o,o)),"function"==typeof O&&(O=O.call(o));const A=v.paths[g],C=A?A.getters:[];let T;const E=I(n,"options",{}),N="getters"in E?E.getters:n.isVirtual&&I(h,"options.getters",!1);if(C.length>0&&N){const e=null!=o.$__?o:t.hydrate(o);T=A.applyGetters(o[g],e)}else T=st(x.getValue(g,o));const $=String(x.getValue(O,o));n._docs[$]=Array.isArray(T)?T.slice():T;let P=d.length;for(;P--;){if(null==(m=d[P]))continue;try{p=y&&y[Q]?y:m[Q]?m:t.db.model(m)}catch(t){return t}let e=T;const r=Array.isArray(T)?x.array.flatten(T):[];a&&Array.isArray(T)&&r.length===d.length&&(e=r.filter((t,e)=>d[e]===m)),s[m]?(s[m].localField.add(g),s[m].foreignField.add(O),s[m].docs.push(o),s[m].ids.push(e),s[m].allIds.push(T)):(f={model:p},_&&h.options&&h.options.options&&(f.options=x.clone(h.options.options)),x.merge(f,n),l&&(f.model=p),n.model=p,s[m]={model:p,options:f,docs:[o],ids:[e],allIds:[T],localField:new Set([g]),foreignField:new Set([O]),justOne:S,isVirtual:_,virtual:h,count:b},u.push(s[m]))}}function w(e,r){let o,i,s=!1;r&&r.caster&&(r=r.caster),r&&r.$isSchemaMap&&(r=r.$__schemaType),!r&&t.discriminators&&(i=t.schema.discriminatorMapping.key),h=r&&r.options&&r.options.refPath;const u=B(h,e,n.path);if(a)o=[a];else if(u){if(null!=n._queryProjection&&N(n._queryProjection,u))throw new c("refPath `"+u+"` must not be excluded in projection, got "+q.inspect(n._queryProjection));o=x.getValue(u,e),Array.isArray(o)&&(o=x.array.flatten(o)),s=!0}else{let s,u=t;if(!r&&i){if(g=x.getValue(i,e)){try{u=t.db.model(g)}catch(t){return t}(s=u.schema._getSchema(n.path))&&s.caster&&(s=s.caster)}}else s=r;const c=R(u.schema,n.path);let a;null!=(a=I(s,"options.ref"))?o=[a]:null!=(a=I(c,"options.ref"))?("function"==typeof a&&(a=a.call(e,e)),o=Array.isArray(a)?a:[a],_=!0):o=i?null:[t.modelName]}return o?(Array.isArray(o)||(o=[o]),{modelNames:o,isRefPath:s}):{modelNames:o,isRefPath:s}}return u}
/*!
 * Retrieve the _id of `val` if a Document or Array of Documents.
 *
 * @param {Array|Document|Any} val
 * @return {Array|Document|Any}
 */(t,e,n);if(o instanceof c)return T(function(){r(o)});const s=o.length;let u,a,h,p=[];function f(t){return void 0!==t}let d=s,m=!1;for(let t=0;t<s;++t){h=(u=o[t]).options.select,u.options.match?a=x.object.shallowCopy(u.options.match):I(u,"options.options.match")?(a=x.object.shallowCopy(u.options.options.match),delete u.options.options.match):a={};let n=x.array.flatten(u.ids,f);if(0===(n=x.array.unique(n)).length||n.every(x.isNullOrUndefined)){--d;continue}if(m=!0,1===u.foreignField.size){const t=Array.from(u.foreignField)[0];"_id"===t&&a._id||(a[t]={$in:n})}else{a.$or=[];for(const t of u.foreignField)"_id"===t&&a._id||a.$or.push({[t]:{$in:n}})}const i={};if(i.sort=I(u,"options.options.sort",void 0),i.excludeId=rt.test(h)||h&&0===h._id,i.excludeId&&("string"==typeof h?h=h.replace(ot," "):delete(h=x.object.shallowCopy(h))._id),u.count){u.model.countDocuments(a,function(t,n){if(null!=t)return r(t);for(const o of e)try{null!=o.$__?o.set(u.options.path,n):x.setValue(u.options.path,n,o)}catch(t){return r(t)}r(null)});continue}u.options.options&&u.options.options.limit&&(i.originalLimit=u.options.options.limit,u.options.options.limit=u.options.options.limit*n.length);const s=x.clone(u.options.populate),c=u.model.find(a,h,u.options.options);for(const t of u.foreignField)"_id"!==t&&c.selectedInclusively()&&!$(c._fields,t)&&c.select(t);s&&c.populate(s),c.exec(g.bind(this,u,i))}if(!m)return r();function g(e,n,o,s){if(u.options.options&&u.options.options.limit&&(u.options.options.limit=n.originalLimit),o)return r(o,null);(function(e,n,o,s){if(e)return r(e,null);const u=o.options,c=o.isVirtual,a=o.justOne;let h;const p=u.options&&u.options.lean,f=n.length,d={},m={};let g,y;const _=x.clone(o.allIds);for(let t=0;t<f;t++)if(null!=(y=n[t]))for(const e of o.foreignField){if(h=x.getValue(e,y),Array.isArray(h)){const e=(h=x.array.flatten(h)).length;for(let n=0;n<e;++n){let e=h[n];e instanceof i&&(e=e._id),g=String(e),m[g]?Array.isArray(m[g])?(m[g].push(y),d[g].push(t)):(m[g]=[m[g],y],d[g]=[d[g],t]):c&&!a?(m[g]=[y],d[g]=[t]):(m[g]=y,d[g]=t)}}else h instanceof i&&(h=h._id),g=String(h),m[g]?Array.isArray(m[g])?(m[g].push(y),d[g].push(t)):(m[g]=[m[g],y],d[g]=[d[g],t]):(m[g]=y,d[g]=t);p?P.set(y,o.model):y.$__.wasPopulated=!0}!
/*!
 * Assigns documents returned from a population query back
 * to the original document path.
 */
function(t){const e=I(t,"allOptions.options.options"),n=Object.assign({},t.options,e,{justOne:t.justOne}),r=[].concat(t.rawIds);O(t.rawIds,t.rawDocs,t.rawOrder,n);const o=t.docs,i=t.rawIds,s=t.options;function u(t){
/*!
 * 1) Apply backwards compatible find/findOne behavior to sub documents
 *
 *    find logic:
 *      a) filter out non-documents
 *      b) remove _id from sub docs when user specified
 *
 *    findOne
 *      a) if no doc found, set to null
 *      b) remove _id from sub docs when user specified
 *
 * 2) Remove _ids when specified by users query.
 *
 * background:
 * _ids are left in the query even when user excludes them so
 * that population mapping can occur.
 */
return function(t,e,n){if(Array.isArray(t)){const r=[],o=t.length;for(let i=0;i<o;++i){const o=t[i];if((ct(o)||n.retainNullValues&&null==o)&&(ut(o,e),r.push(o),e.originalLimit&&r.length>=e.originalLimit))break}for(;t.length>r.length;)Array.prototype.pop.apply(t,[]);for(let e=0;e<r.length;++e)t[e]=r[e];return t}if(ct(t))return ut(t,e),t;if(!0===n.justOne)return null==t?t:null;if(!1===n.justOne)return[];return t}
/*!
 * Remove _id from `subdoc` if user specified "lean" query option
 */(t,s,n)}for(let e=0;e<o.length;++e){const n=x.getValue(t.path,o[e]);if(null==n&&!R(t.originalModel.schema,t.path))continue;const s=t.originalModel.schema;let a=(c=o[e],null!=I(c,"$__")?n instanceof Map:x.isPOJO(n));if(a=a&&I(s._getSchema(t.path),"$isSchemaMap"),!t.isVirtual&&a){const t=n instanceof Map?Array.from(n.keys()):Object.keys(n);i[e]=i[e].reduce((e,n,r)=>(e.$init(t[r],n),e),new l({},o[e]))}if(t.isVirtual&&o[e]instanceof K){o[e].populated(t.path,t.justOne?r[0]:r,t.allOptions),D.set(t.path,i[e],o[e],u);continue}const h=t.path.split(".");let p=o[e];for(let t=0;t<h.length-1;++t)null==p[h[t]]&&(p[h[t]]={}),p=p[h[t]];o[e].$__&&o[e].populated(t.path,t.allIds[e],t.allOptions),x.setValue(t.path,i[e],o[e],function(e){return!0===t.justOne&&Array.isArray(e)?u(e[0]):!1!==t.justOne||Array.isArray(e)?u(e):u([e])},!1)}
/*!
 * Check if obj is a document
 */
var c}({originalModel:t,rawIds:o.isVirtual?_:o.allIds,allIds:_,foreignField:o.foreignField,rawDocs:m,rawOrder:d,docs:o.docs,path:u.path,options:s,justOne:o.justOne,isVirtual:o.isVirtual,allOptions:o,lean:p,virtual:o.virtual})})(null,p=p.concat(s),e,n),0==--d&&r()}}function st(t){if(t instanceof K)return t._id;if(Array.isArray(t)){for(let e=0;e<t.length;++e)t[e]instanceof K&&(t[e]=t[e]._id);return t.isMongooseArray&&t._schema?t._schema.cast(t,t._parent):[].concat(t)}if(null!=t&&"Object"===t.constructor.name){const e=[];for(const n of Object.keys(t))e.push(t[n]);return e}return t instanceof Map?Array.from(t.values()):t}function ut(t,e){e.excludeId&&("function"==typeof t.setValue?delete t._doc._id:delete t._id)}
/*!
 * Determine if `obj` is something we can set a populated path to. Can be a
 * document, a lean document, or an array/map that contains docs.
 */function ct(t){return null!=t&&(Array.isArray(t)||t.$isMongooseMap||null!=t.$__||P.has(t))}
/*!
 * Compiler utility.
 *
 * @param {String|Function} name model name or class extending Model
 * @param {Schema} schema
 * @param {String} collectionName
 * @param {Connection} connection
 * @param {Mongoose} base mongoose instance
 */K.compile=function(t,e,n,r,o){const i=!1!==e.options.versionKey;if(U(e),i&&!e.paths[e.options.versionKey]){const t={};t[e.options.versionKey]=Number,e.add(t)}let s;"function"==typeof t&&t.prototype instanceof K?(t=(s=t).name,e.loadClass(s,!1),s.prototype.$isMongooseModelPrototype=!0):s=function t(e,n,r){if(t.hooks.execPreSync("createModel",e),!(this instanceof t))return new t(e,n,r);K.call(this,e,n,r)},s.hooks=e.s.hooks.clone(),s.base=o,s.modelName=t,s.prototype instanceof K||(s.__proto__=K,s.prototype.__proto__=K.prototype),s.model=K.prototype.model,s.db=s.prototype.db=r,s.discriminators=s.prototype.discriminators=void 0,s[Q]=!0,s.events=new a,s.prototype.$__setSchema(e);const u=e._userProvidedOptions||{};let c=!0;null!=r.base.get("bufferCommands")&&(c=r.base.get("bufferCommands")),null!=r.config.bufferCommands&&(c=r.config.bufferCommands),null!=u.bufferCommands&&(c=u.bufferCommands);const l={bufferCommands:c,capped:e.options.capped};s.prototype.collection=r.collection(n,l),s.prototype[Y]=s.prototype.collection,v(s,e),w(s,e),_(s,e),s.schema=s.prototype.schema,s.collection=s.prototype.collection,s.Query=function(){f.apply(this,arguments)},s.Query.prototype=Object.create(f.prototype),s.Query.base=f.base,y(s.Query,s),
/*!
 * Register custom query methods for this model
 *
 * @param {Model} model
 * @param {Schema} schema
 */
function(t,e){for(const n in e)t.Query.prototype[n]=e[n]}
/*!
 * Subclass this model with `conn`, `schema`, and `collection` settings.
 *
 * @param {Connection} conn
 * @param {Schema} [schema]
 * @param {String} [collection]
 * @return {Model}
 */(s,e.query);return s.$__insertMany=s.hooks.createWrapper("insertMany",s.$__insertMany,s,{useErrorHandlers:!0,numCallbackParams:1}),s},K.__subclass=function(t,e,n){const r=this,o=function t(e,n,o){if(!(this instanceof t))return new t(e,n,o);r.call(this,e,n,o)};o.__proto__=r,o.prototype.__proto__=r.prototype,o.db=o.prototype.db=t;const i=e&&"string"!=typeof e?e:r.prototype.schema,s=i.options||{},u=i._userProvidedOptions||{};n||(n=r.prototype.schema.get("collection")||x.toCollectionName(r.modelName,this.base.pluralize()));let c=!0;i&&(null!=t.config.bufferCommands&&(c=t.config.bufferCommands),null!=u.bufferCommands&&(c=u.bufferCommands));const a={bufferCommands:c,capped:i&&s.capped};return o.prototype.collection=t.collection(n,a),o.prototype[Y]=o.prototype.collection,o.collection=o.prototype.collection,o.init(()=>{}),o},K.$wrapCallback=function(t){if(null==t)return t;if("function"!=typeof t)throw new c("Callback must be a function, got "+t);const e=this;return function(){try{t.apply(null,arguments)}catch(t){e.emit("error",t)}}},
/*!
 * Module exports.
 */
t.exports=K},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(15).Readable,o=n(189),i=n(0),s=n(5);function u(t){r.call(this,{objectMode:!0}),this.cursor=null,this.agg=t,this._transforms=[];const e=t._model;delete t.options.cursor.useMongooseAggCursor,this._mongooseOptions={},
/*!
 * ignore
 */
function(t,e,n){t.collection.buffer?t.collection.emitter.once("queue",function(){t.hooks.execPre("aggregate",n,function(){e.cursor=t.collection.aggregate(n._pipeline,n.options||{}),e.emit("cursor",e.cursor)})}):t.hooks.execPre("aggregate",n,function(){e.cursor=t.collection.aggregate(n._pipeline,n.options||{}),e.emit("cursor",e.cursor)})}
/*!
 * Necessary to satisfy the Readable API
 */(e,this,t)}
/*!
 * Get the next doc from the underlying cursor and mongooseify it
 * (populate, etc.)
 */
function c(t,e){let n=e;return t._transforms.length&&(n=function(n,r){if(n||null===r&&!t._mongooseOptions.transformNull)return e(n,r);e(n,t._transforms.reduce(function(t,e){return e(t)},r))}),t._error?process.nextTick(function(){n(t._error)}):t.cursor?t.cursor.next(function(t,e){return t?n(t):e?void n(null,e):n(null,null)}):void t.once("cursor",function(){c(t,e)})}i.inherits(u,r),u.prototype._read=function(){const t=this;c(this,function(e,n){return e?t.emit("error",e):n?void t.push(n):(t.push(null),void t.cursor.close(function(e){if(e)return t.emit("error",e);setTimeout(function(){t.emit("close")},0)}))})},u.prototype.map=function(t){return this._transforms.push(t),this},
/*!
 * Marks this cursor as errored
 */
u.prototype._markError=function(t){return this._error=t,this},u.prototype.close=function(t){return s.promiseOrCallback(t,t=>{this.cursor.close(e=>{if(e)return t(e),this.listeners("error").length>0&&this.emit("error",e);this.emit("close"),t(null)})})},u.prototype.next=function(t){return s.promiseOrCallback(t,t=>{c(this,t)})},u.prototype.eachAsync=function(t,e,n){const r=this;return"function"==typeof e&&(n=e,e={}),o(function(t){return c(r,t)},t,e=e||{},n)},
/*!
 * ignore
 */
u.prototype.transformNull=function(t){return 0===arguments.length&&(t=!0),this._mongooseOptions.transformNull=t,this},u.prototype.addCursorFlag=function(t,e){const n=this;
/*!
 * ignore
 */
return function(t,e){if(t.cursor)return e();t.once("cursor",function(){e()})}(this,function(){n.cursor.addCursorFlag(t,e)}),this},t.exports=u},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(10).EventEmitter;
/*!
 * ignore
 */
/*!
 * ignore
 */
t.exports=class extends r{constructor(t,e,n){super(),this.driverChangeStream=null,this.closed=!1,t.collection.buffer?t.collection.addQueue(()=>{this.closed||(this.driverChangeStream=t.collection.watch(e,n),this._bindEvents(),this.emit("ready"))}):(this.driverChangeStream=t.collection.watch(e,n),this._bindEvents(),this.emit("ready"))}_bindEvents(){["close","change","end","error"].forEach(t=>{this.driverChangeStream.on(t,e=>this.emit(t,e))})}_queue(t){this.once("ready",()=>t())}close(){this.closed=!0,this.driverChangeStream&&this.driverChangeStream.close()}}},function(t,e,n){"use strict";const r=n(8);
/*!
 * Register methods for this model
 *
 * @param {Model} model
 * @param {Schema} schema
 */t.exports=function t(e,n){function o(t,n){Object.defineProperty(e.prototype,t,{get:function(){const e={};for(const r in n.methods[t])e[r]=n.methods[t][r].bind(this);return e},configurable:!0})}for(const t of Object.keys(n.methods)){const i=n.methods[t];if(n.tree.hasOwnProperty(t))throw new Error('You have a method and a property in your schema both named "'+t+'"');n.reserved[t]&&!r(n,`methodOptions.${t}.suppressWarning`,!1)&&console.warn(`mongoose: the method name "${t}" is used by mongoose `+"internally, overwriting it may cause bugs. If you're sure you know what you're doing, you can suppress this error by using "+`\`schema.method('${t}', fn, { suppressWarning: true })\`.`),"function"==typeof i?e.prototype[t]=i:o(t,n)}e.$appliedMethods=!0;for(let e=0;e<n.childSchemas.length;++e)n.childSchemas[e].model.$appliedMethods||t(n.childSchemas[e].model,n.childSchemas[e].schema)}},function(t,e,n){"use strict";
/*!
 * Register statics for this model
 * @param {Model} model
 * @param {Schema} schema
 */t.exports=function(t,e){for(const n in e.statics)t[n]=e.statics[n]}},function(t,e,n){"use strict";t.exports=
/*!
 * Assign `vals` returned by mongo query to the `rawIds`
 * structure returned from utils.getVals() honoring
 * query sort order if specified by user.
 *
 * This can be optimized.
 *
 * Rules:
 *
 *   if the value of the path is not an array, use findOne rules, else find.
 *   for findOne the results are assigned directly to doc path (including null results).
 *   for find, if user specified sort order, results are assigned directly
 *   else documents are put back in original order of array if found in results
 *
 * @param {Array} rawIds
 * @param {Array} vals
 * @param {Boolean} sort
 * @api private
 */
function t(e,n,r,o,i){const s=[];const u=o.sort&&e.length>1;let c;let a;let l;for(let h=0;h<e.length;++h)l=e[h],Array.isArray(l)?(t(l,n,r,o,!0),s.push(l)):null!==l||u?(a=String(l),c=n[a],o.clone&&(c=c.constructor.hydrate(c._doc)),i?c?u?s[r[a]]=c:s.push(c):s.push(l):s[h]=c||null):s.push(l);e.length=0;s.length&&s.forEach(function(t,n){e[n]=t})}},function(t,e,n){"use strict";const r=n(172),o=n(174),i=n(118),s=n(192),u=n(193);
/*!
 * Given a model and a bulkWrite op, return a thunk that handles casting and
 * validating the individual op.
 */
t.exports=function(t,e){const n=t.base.now();return e.insertOne?n=>{const r=new t(e.insertOne.document);null!=t.schema.options.timestamps&&r.initializeTimestamps(),e.insertOne.document=r,e.insertOne.document.validate({__noPromise:!0},function(t){if(t)return n(t,null);n(null)})}:e.updateOne?(e=e.updateOne,c=>{try{if(e.filter=i(t.schema,e.filter),e.update=s(t.schema,e.update,{strict:t.schema.options.strict,overwrite:!1}),e.setDefaultsOnInsert&&u(e.filter,t.schema,e.update,{setDefaultsOnInsert:!0,upsert:e.upsert}),null!=t.schema.$timestamps){const r=t.schema.$timestamps.createdAt,i=t.schema.$timestamps.updatedAt;o(n,r,i,e.update,{})}r(n,e.update,t.schema)}catch(t){return c(t,null)}c(null)}):e.updateMany?(e=e.updateMany,c=>{try{if(e.filter=i(t.schema,e.filter),e.update=s(t.schema,e.update,{strict:t.schema.options.strict,overwrite:!1}),e.setDefaultsOnInsert&&u(e.filter,t.schema,e.update,{setDefaultsOnInsert:!0,upsert:e.upsert}),null!=t.schema.$timestamps){const r=t.schema.$timestamps.createdAt,i=t.schema.$timestamps.updatedAt;o(n,r,i,e.update,{})}r(n,e.update,t.schema)}catch(t){return c(t,null)}c(null)}):e.replaceOne?n=>{try{e.replaceOne.filter=i(t.schema,e.replaceOne.filter)}catch(t){return n(t,null)}const r=new t(e.replaceOne.replacement,null,!0);null!=t.schema.options.timestamps&&r.initializeTimestamps(),e.replaceOne.replacement=r,e.replaceOne.replacement.validate({__noPromise:!0},function(t){if(t)return n(t,null);n(null)})}:e.deleteOne?n=>{try{e.deleteOne.filter=i(t.schema,e.deleteOne.filter)}catch(t){return n(t,null)}n(null)}:e.deleteMany?n=>{try{e.deleteMany.filter=i(t.schema,e.deleteMany.filter)}catch(t){return n(t,null)}n(null)}:t=>{t(new Error("Invalid op passed to `bulkWrite()`"),null)}}},function(t,e,n){"use strict";const r=n(58);
/*!
 * Determines if `path` is excluded by `projection`
 *
 * @param {Object} projection
 * @param {string} path
 * @return {Boolean}
 */t.exports=function(t,e){if("_id"===e)return 0===t._id;const n=Object.keys(t);let o=null;for(const i of n)if(r(t[i])){o=1===t[e]?"inclusive":"exclusive";break}return"inclusive"===o?1!==t[e]:"exclusive"===o&&0===t[e]}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t,e){const n=e.split(".");let r,o,i,s="";for(let u=0;u<n.length;++u)if(t[s+=s.length?".":""+n[u]]){for(i=(o=Object.keys(t)).length,r=0;r<i;++r)0!==o[u].indexOf(s+".")||o[u].indexOf(e);return!0}return!1}},function(t,e,n){"use strict";
/*!
 * ignore
 */const r=n(47),o=n(8),i=n(207),s=n(56);
/*!
 * @param {Schema} schema
 * @param {Object} doc POJO
 * @param {string} path
 */
t.exports=function(t,e,n){const u=t.path(n),c=e;if(u)return u;const a=n.split(".");for(let t=0;t<a.length;++t)"$"===a[t]&&(a[t]="0");return function t(n,u,a,l){let h,p,f=n.length+1;for(;f--;){if(p=n.slice(0,f).join("."),null==(h=u.path(p)))continue;if(h.caster){if(h.caster instanceof r)return h.caster;let o=null;if(null!=e&&null!=h.schema&&null!=h.schema.discriminators){const t=h.schema.discriminators,e=p+"."+h.schema.options.discriminatorKey,n=a&&s.get(e,a)||[];o=Object.keys(t).reduce(function(e,r){return-1!==n.indexOf(r)&&e.push(t[r]),e},[])}if(f!==n.length&&h.schema){let e;if("$"===n[f])return f+1===n.length?h:((e=t(n.slice(f+1),u,a?s.get(p,a):null,l.concat(n.slice(0,f))))&&(e.$isUnderneathDocArray=e.$isUnderneathDocArray||!h.schema.$isSingleNested),e);if(null!=o&&o.length>0){e=[];for(let r=0;r<o.length;++r){const i=t(n.slice(f),o[r],a?s.get(p,a):null,l.concat(n.slice(0,f)));null!=i&&(i.$isUnderneathDocArray=i.$isUnderneathDocArray||!h.schema.$isSingleNested,i.$isUnderneathDocArray&&(e.$isUnderneathDocArray=!0),e.push(i))}return e}return(e=t(n.slice(f),h.schema,a?s.get(p,a):null,l.concat(n.slice(0,f))))&&(e.$isUnderneathDocArray=e.$isUnderneathDocArray||!h.schema.$isSingleNested),e}}const d=l.concat([p]).join(".");if(c.$__&&c.populated(d)&&f<n.length){const r=o(e.$__.populated[d],"options.model.schema");if(null!=r){const e=t(n.slice(f),r,a?s.get(p,a):null,l.concat(n.slice(0,f)));return e&&(e.$isUnderneathDocArray=e.$isUnderneathDocArray||!r.$isSingleNested),e}}const m=o(c,p);if(null!=m){const e=Array.isArray(m)&&m.length>0?i.get(m[0]):i.get(m),r=null!=e?e.schema:null;if(null!=r){const e=t(n.slice(f),r,a?s.get(p,a):null,l.concat(n.slice(0,f)));return e&&(e.$isUnderneathDocArray=e.$isUnderneathDocArray||!r.$isSingleNested),e}}return h}}(a,t,e,[])}},function(t,e,n){"use strict";t.exports=
/*!
 * ignore
 */
function t(e,n){if(e.virtuals[n])return e.virtuals[n];const r=n.split(".");let o="";let i="";for(let n=0;n<r.length;++n)if(o+=(o.length>0?".":"")+r[n],e.virtuals[o]){if(n===r.length-1)return e.virtuals[o].$nestedSchemaPath=i,e.virtuals[o]}else if(!e.nested[o]){if(!e.paths[o]||!e.paths[o].schema)return null;{e=e.paths[o].schema;const s=r.slice(n+1).join(".");if(e.virtuals[s]){if(n===r.length-2)return e.virtuals[s].$nestedSchemaPath=[i,o].filter(t=>!!t).join("."),e.virtuals[s];continue}if(n+1<r.length&&e.discriminators)for(const n of Object.keys(e.discriminators)){const r=t(e.discriminators[n],s);if(null!=r)return r.$nestedSchemaPath=[i,o].filter(t=>!!t).join("."),r}i+=(i.length>0?".":"")+o,o=""}}}},function(t,e,n){"use strict";t.exports=function(t,e,n){if(null==t)return t;"function"==typeof t&&(t=t.call(e,e,n));const r=/(\.\d+$|\.\d+\.)/g;if(r.test(n)){const e=n.split(r);if(""===e[e.length-1])throw new Error("Can't populate individual element in an array");let o="",i=t;for(let t=0;t<e.length;t+=2){const n=e[t];if(!i.startsWith(n+".")){if(t===e.length-1){o+=i,i="";break}throw new Error("Could not normalize ref path, chunk "+n+" not in populated path")}o+=i.substr(0,n.length)+e[t+1],i=i.substr(n.length+1)}return o}return t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){(0,o.default)((0,r.default)(e),t,n)};var r=i(n(202)),o=i(n(205));function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e,n){"use strict";
/*!
 * Set `$parentSchema` on all schema types, and `$schemaType` on single
 * nested docs.
 *
 * This is a slow path function, should only run when model is compiled
 */t.exports=function t(e,n){for(const t of Object.keys(e.paths)){const n=e.paths[t];null!=n.schema&&Object.defineProperty(n.schema,"$schemaType",{configurable:!0,writable:!1,enumerable:!1,value:n}),Object.defineProperty(n,"$parentSchema",{configurable:!0,writable:!1,enumerable:!1,value:e})}if(!n)for(const n of e.childSchemas)t(n.schema,!0)}},function(t,e){t.exports=
/*!
 * Pluralize function.
 *
 * @author TJ Holowaychuk (extracted from _ext.js_)
 * @param {String} string to pluralize
 * @api private
 */
function(t){var e;if(t=t.toLowerCase(),!~r.indexOf(t)&&(e=n.filter(function(e){return t.match(e[0])}))[0])return t.replace(e[0][0],e[0][1]);return t},e.pluralization=[[/(m)an$/gi,"$1en"],[/(pe)rson$/gi,"$1ople"],[/(child)$/gi,"$1ren"],[/^(ox)$/gi,"$1en"],[/(ax|test)is$/gi,"$1es"],[/(octop|vir)us$/gi,"$1i"],[/(alias|status)$/gi,"$1es"],[/(bu)s$/gi,"$1ses"],[/(buffal|tomat|potat)o$/gi,"$1oes"],[/([ti])um$/gi,"$1a"],[/sis$/gi,"ses"],[/(?:([^f])fe|([lr])f)$/gi,"$1$2ves"],[/(hive)$/gi,"$1s"],[/([^aeiouy]|qu)y$/gi,"$1ies"],[/(x|ch|ss|sh)$/gi,"$1es"],[/(matr|vert|ind)ix|ex$/gi,"$1ices"],[/([m|l])ouse$/gi,"$1ice"],[/(kn|w|l)ife$/gi,"$1ives"],[/(quiz)$/gi,"$1zes"],[/s$/gi,"s"],[/([^a-z])$/,"$1"],[/$/gi,"s"]];var n=e.pluralization;e.uncountables=["advice","energy","excretion","digestion","cooperation","health","justice","labour","machinery","equipment","information","pollution","sewage","paper","money","species","series","rain","rice","fish","sheep","moose","deer","news","expertise","status","media"];var r=e.uncountables},function(t){t.exports={_from:"mongoose",_id:"mongoose@5.4.7",_inBundle:!1,_integrity:"sha512-bFB9/VHB1FAY2dgTHIjtUYThcIaYSyS0vG0sCpwjW2GZ3XDTykXKV9dlGSWPqJ9+dnSOevdrhoHBgL3b63Or5w==",_location:"/mongoose",_phantomChildren:{lodash:"4.17.11"},_requested:{type:"tag",registry:!0,raw:"mongoose",name:"mongoose",escapedName:"mongoose",rawSpec:"",saveSpec:null,fetchSpec:"latest"},_requiredBy:["#USER","/"],_resolved:"https://registry.npmjs.org/mongoose/-/mongoose-5.4.7.tgz",_shasum:"eac012b38636a4b9075f66480263dd426e65c5c1",_spec:"mongoose",_where:"/Users/andeladeveloper/Documents/workspace/micro-blog",author:{name:"Guillermo Rauch",email:"guillermo@learnboost.com"},browser:"./browser.js",bugs:{url:"https://github.com/Automattic/mongoose/issues/new"},bundleDependencies:!1,dependencies:{async:"2.6.1",bson:"~1.1.0",kareem:"2.3.0",mongodb:"3.1.10","mongodb-core":"3.1.9","mongoose-legacy-pluralize":"1.0.2",mpath:"0.5.1",mquery:"3.2.0",ms:"2.0.0","regexp-clone":"0.0.1","safe-buffer":"5.1.2",sliced:"1.0.1"},deprecated:!1,description:"Mongoose MongoDB ODM",devDependencies:{acorn:"5.7.3",acquit:"1.0.2","acquit-ignore":"0.1.0","acquit-require":"0.1.1","babel-loader":"7.1.4","babel-preset-es2015":"6.24.1",benchmark:"2.1.2",bluebird:"3.5.0",chalk:"2.4.1",co:"4.6.0",dox:"0.3.1",eslint:"5.3.0","highlight.js":"9.1.0",jade:"1.11.0",lodash:"4.17.5",markdown:"0.5.0",marked:"0.3.9",mocha:"5.2.0","mongodb-topology-manager":"1.0.11","mongoose-long":"0.2.1","node-static":"0.7.10",nyc:"11.8.0","power-assert":"1.4.1","promise-debug":"0.1.1",q:"1.5.1",semver:"5.5.0",uuid:"2.0.3","uuid-parse":"1.0.0",validator:"10.8.0",webpack:"4.16.4"},directories:{lib:"./lib/mongoose"},engines:{node:">=4.0.0"},eslintConfig:{extends:["eslint:recommended"],parserOptions:{ecmaVersion:2015},env:{node:!0,mocha:!0,es6:!0},rules:{"comma-style":"error","consistent-this":["error","_this"],indent:["error",2,{SwitchCase:1,VariableDeclarator:2}],"keyword-spacing":"error","no-buffer-constructor":"warn","no-console":"off","no-multi-spaces":"error","func-call-spacing":"error","no-trailing-spaces":"error",quotes:["error","single"],semi:"error","space-before-blocks":"error","space-before-function-paren":["error","never"],"space-infix-ops":"error","space-unary-ops":"error","no-var":"warn","prefer-const":"warn",strict:["error","global"]}},homepage:"http://mongoosejs.com",keywords:["mongodb","document","model","schema","database","odm","data","datastore","query","nosql","orm","db"],license:"MIT",main:"./index.js",name:"mongoose",repository:{type:"git",url:"git://github.com/Automattic/mongoose.git"},scripts:{lint:"eslint .",release:"git pull && git push origin master --tags && npm publish","release-legacy":"git pull origin 4.x && git push origin 4.x --tags && npm publish --tag legacy",test:"mocha --exit test/*.test.js test/**/*.test.js","test-cov":"nyc --reporter=html --reporter=text npm test"},version:"5.4.7"}},function(t,e,n){"use strict";const r=n(208);
/*!
 * ignore
 */t.exports=function(t){t.s.hooks.pre("remove",!1,function(t){if(this.ownerDocument)return void t();const e=this,n=this.$__getAllSubdocs();n.length?r(n,function(t,e){t.$__remove(function(t){e(t)})},function(n){if(n)return e.schema.s.hooks.execPost("remove:error",e,[e],{error:n},function(e){t(e)});t()}):t()},null,!0)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(e,n,r){return t(e,r)}},t.exports=e.default},function(t,e,n){"use strict";const r=n(208);
/*!
 * ignore
 */t.exports=function(t){t.s.hooks.pre("save",!1,function(t){if(this.ownerDocument)return void t();const e=this,n=this.$__getAllSubdocs();n.length?r(n,function(t,e){t.schema.s.hooks.execPre("save",t,function(t){e(t)})},function(n){if(n)return e.schema.s.hooks.execPost("save:error",e,[e],{error:n},function(e){t(e)});t()}):t()},null,!0),t.s.hooks.post("save",function(t,e){if(this.ownerDocument)return void e();const n=this,o=this.$__getAllSubdocs();o.length?r(o,function(t,e){t.schema.s.hooks.execPost("save",t,[t],function(t){e(t)})},function(t){if(t)return n.schema.s.hooks.execPost("save:error",n,[n],{error:t},function(t){e(t)});e()}):e()},null,!0)}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t){t.pre("save",!1,function(t,e){const n=this;if(this.ownerDocument)return t();let r;(r=e&&"object"==typeof e&&"validateBeforeSave"in e?!!e.validateBeforeSave:this.schema.options.validateBeforeSave)?this.validate(function(e){return n.schema.s.hooks.execPost("save:error",n,[n],{error:e},function(e){t(e)})}):t()},null,!0)}},function(t,e,n){"use strict";const r=n(23).objectIdSymbol,o=n(5);
/*!
 * ignore
 */
function i(){let t,e;if(this.$__.shardval){e=(t=Object.keys(this.$__.shardval)).length,this.$where=this.$where||{};for(let n=0;n<e;++n)this.$where[t[n]]=this.$__.shardval[t[n]]}}
/*!
 * ignore
 */
/*!
 * ignore
 */
function s(){const t=this.schema.options.shardKey||this.schema.options.shardkey;if(!t||"Object"!==o.getFunctionName(t.constructor))return;const e=this.$__.shardval={},n=Object.keys(t),i=n.length;let s;for(let t=0;t<i;++t)null==(s=this.getValue(n[t]))?e[n[t]]=s:o.isMongooseObject(s)?e[n[t]]=s.toObject({depopulate:!0,_isNested:!0}):s instanceof Date||s[r]?e[n[t]]=s:"function"==typeof s.valueOf?e[n[t]]=s.valueOf():e[n[t]]=s}
/*!
 * ignore
 */
t.exports=function(t){t.post("init",function(){return s.call(this),this}),t.pre("save",function(t){i.call(this),t()}),t.pre("remove",function(t){i.call(this),t()}),t.post("save",function(){s.call(this)})},t.exports.storeShard=s},function(t,e,n){"use strict";"undefined"!=typeof jest&&"undefined"!=typeof window&&console.warn("Mongoose: looks like you're trying to test a Mongoose app with Jest's default jsdom test environment. Please make sure you read Mongoose's docs on configuring Jest to test Node.js apps: http://mongoosejs.com/docs/jest.html")},function(t,e,n){var r={"./connection":209,"./drivers/node-mongodb-native/connection":394};function o(t){var e=i(t);return n(e)}function i(t){var e=r[t];if(!(e+1)){var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}return e}o.keys=function(){return Object.keys(r)},o.resolve=i,t.exports=o,o.id=393},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(209),o=n(81);function i(){r.apply(this,arguments),this._listening=!1}i.STATES=o,
/*!
 * Inherits from Connection.
 */
i.prototype.__proto__=r.prototype,i.prototype.useDb=function(t,e){if(e&&e.useCache&&this.relatedDbs[t])return this.relatedDbs[t];const n=new this.constructor;n.name=t,n.base=this.base,n.collections={},n.models={},n.replica=this.replica,n.name=this.name,n.options=this.options,n._readyState=this._readyState,n._closeCalled=this._closeCalled,n._hasOpened=this._hasOpened,n._listening=!1,n.host=this.host,n.port=this.port,n.user=this.user,n.pass=this.pass;const r=this;function i(){n.client=r.client,n.db=r.client.db(t),n.onOpen(),
/*!
 * Register listeners for important events and bubble appropriately.
 */
function(t){if(t.db._listening)return;t.db._listening=!0,t.db.on("close",function(e){if(!t._closeCalled)return t.db.serverConfig.autoReconnect?(t.readyState=o.disconnected,void t.emit("close")):void t.onClose(e)}),t.db.on("error",function(e){t.emit("error",e)}),t.db.on("reconnect",function(){t.readyState=o.connected,t.emit("reconnect"),t.emit("reconnected"),t.onOpen()}),t.db.on("timeout",function(e){t.emit("timeout",e)}),t.db.on("open",function(e,n){o.disconnected===t.readyState&&n&&n.databaseName&&(t.readyState=o.connected,t.emit("reconnect"),t.emit("reconnected"))}),t.db.on("parseError",function(e){t.emit("parseError",e)})}(n)}return n.client=r.client,this.db&&this._readyState===o.connected?i():this.once("connected",i),n.name=t,this.otherDbs.push(n),n.otherDbs.push(this),e&&e.useCache&&(this.relatedDbs[n.name]=n,n.relatedDbs=this.relatedDbs),n},i.prototype.doClose=function(t,e){return this.client.close(t,(t,n)=>{setTimeout(()=>e(t,n),1)}),this},
/*!
 * Module exports.
 */
t.exports=i},function(t,e,n){var r={"./collection":158,"./drivers/node-mongodb-native/collection":157};function o(t){var e=i(t);return n(e)}function i(t){var e=r[t];if(!(e+1)){var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}return e}o.keys=function(){return Object.keys(r)},o.resolve=i,t.exports=o,o.id=395},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,o=(r=n(142))&&r.__esModule?r:{default:r};const i=new o.default.Schema({_id:o.default.Schema.Types.ObjectId,username:{type:String,required:[!0,"Username field is required"]},profile_image:{type:String,required:[!0,"Profile Image field is required"]},content:{type:String,required:[!0,"Content field is required"]}},{timestamps:!0});var s=o.default.model("posts",i);e.default=s}]));